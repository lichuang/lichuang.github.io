<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="codedump">

  
  
  <meta name="description" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹">
  

  
  <link rel="icon" href="https://www.codedump.info/favicon.ico">

  
  
  <meta name="keywords" content=" å‘¨åˆŠ  rr ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:title" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹" />
<meta property="og:description" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.codedump.info/post/20220313-weekly-9/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-03-13T11:20:59+08:00" />
<meta property="article:modified_time" content="2022-03-13T11:20:59+08:00" />



  
  <link rel="canonical" href="https://www.codedump.info/post/20220313-weekly-9/">

  
  
  <meta itemprop="name" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹">
<meta itemprop="description" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹"><meta itemprop="datePublished" content="2022-03-13T11:20:59+08:00" />
<meta itemprop="dateModified" content="2022-03-13T11:20:59+08:00" />
<meta itemprop="wordCount" content="2722">
<meta itemprop="keywords" content="å‘¨åˆŠ," />

  
  <link media="screen" rel="stylesheet" href='https://www.codedump.info/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://www.codedump.info/css/content.css'>

  
  
  <title>å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹ - codedumpçš„ç½‘ç»œæ—¥å¿—</title>
  

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹"/>
<meta name="twitter:description" content="å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹"/>


  
<link rel="stylesheet" href='https://www.codedump.info/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="https://www.codedump.info">codedumpçš„ç½‘ç»œæ—¥å¿—</a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/">ä¸»é¡µ</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/post/">å‘è¡¨</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/post/20200122-series-pages/">ç³»åˆ—æ–‡ç« ç´¢å¼•</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/page/weekly">å‘¨åˆŠ</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="https://www.codedump.info/index.xml">è®¢é˜…</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/page/about">å…³äº</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  
  <h1>å‘¨åˆŠï¼ˆç¬¬9æœŸï¼‰ï¼šMozilla rrä½¿ç”¨ç®€ä»‹</h1>
  
  <div>
    <b>Keywords: </b>
    
    <a class="link" href='https://www.codedump.info/tags/%E5%91%A8%E5%88%8A'>#å‘¨åˆŠ</a>
    
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#deterministically">deterministically</a></li>
    <li><a href="#record-and-replay">record and replay</a></li>
    <li><a href="#é«˜çº§ç”¨æ³•">é«˜çº§ç”¨æ³•</a>
      <ul>
        <li><a href="#äº‹ä»¶">äº‹ä»¶</a></li>
        <li><a href="#åå‘æ‰§è¡Œreverse-execution">åå‘æ‰§è¡Œï¼ˆReverse executionï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#ç¼ºç‚¹">ç¼ºç‚¹</a></li>
  </ul>

  <ul>
    <li><a href="#rrä½¿ç”¨çš„wiki">rrä½¿ç”¨çš„wiki</a></li>
    <li><a href="#rrè§†é¢‘æ•™ç¨‹">rrè§†é¢‘æ•™ç¨‹</a></li>
    <li><a href="#å…¶å®ƒæ–‡æ¡£">å…¶å®ƒæ–‡æ¡£</a></li>
    <li><a href="#gdbç›¸å…³æ–‡æ¡£">GDBç›¸å…³æ–‡æ¡£</a></li>
  </ul>

  <ul>
    <li><a href="#å¦‚ä½•åœ¨å¼€æºé¡¹ç›®ä¸­åšé‡æ„">ã€Šå¦‚ä½•åœ¨å¼€æºé¡¹ç›®ä¸­åšé‡æ„ï¼Ÿã€‹</a></li>
    <li><a href="#linux-containers-in-500-lines-of-code">ã€ŠLinux containers in 500 lines of codeã€‹</a></li>
    <li><a href="#æ”¶é›†æ•´ç†è¿œç¨‹å·¥ä½œç›¸å…³çš„èµ„æ–™">æ”¶é›†æ•´ç†è¿œç¨‹å·¥ä½œç›¸å…³çš„èµ„æ–™</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content">
    
    <hr>
<p>å¼•è¨€ï¼šåœ¨ä¹‹å‰çš„<a href="https://www.codedump.info/post/20220227-weekly-7/">å‘¨åˆŠï¼ˆç¬¬7æœŸï¼‰ï¼šä¸€ä¸ªCç³»ç¨‹åºå‘˜çš„Ruståˆä½“éªŒ</a>ä¸­ï¼Œç®€å•æåˆ°è¿‡Mozilla rrè¿™æ¬¾è°ƒè¯•å·¥å…·ï¼Œç”±äºè¿™ä¸ªå·¥å…·å¹¶ä¸æ˜¯å¤ªä¸ºäººæ‰€çŸ¥ï¼Œæ‰€ä»¥æœ¬æ–‡å¯¹è¯¥å·¥å…·åšä¸€ä¸ªç®€ä»‹ã€‚</p>
<hr>
<h1 id="mozilla-rrä½¿ç”¨ç®€ä»‹">Mozilla rrä½¿ç”¨ç®€ä»‹</h1>
<p><a href="https://rr-project.org/">rr</a>æ˜¯ç”±Mozillaå‡ºå“çš„ä¸€æ¬¾è°ƒè¯•å·¥å…·ï¼Œç”¨å®˜ç½‘çš„è¯æ¥è¯´ï¼š</p>
<blockquote>
<p>rr aspires to be your primary C/C++ debugging tool for Linux, replacing â€” well, enhancing â€” gdb. You record a failure once, then debug the recording, deterministically, as many times as you want. The same execution is replayed every time.</p>
</blockquote>
<p>å³å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šå¯ä»¥è®°å½•ä¸‹æ¥ç¨‹åºè¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…æ‹¬çº¿ç¨‹ã€å †æ ˆã€å¯„å­˜å™¨ç­‰ç­‰ï¼Œè¿™æ ·çš„å¥½å¤„æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>â€œdeterministicallyâ€ï¼šå¾ˆå¤šé—®é¢˜é—®é¢˜çš„äº§ç”Ÿï¼Œéƒ½ä¸ç‰¹å®šçš„ç¯å¢ƒç›¸å…³ï¼Œå¦‚ï¼š
<ul>
<li>çº¿ç¨‹è°ƒåº¦æ‰§è¡Œçš„é¡ºåºï¼Œå…ˆæ‰§è¡ŒAçº¿ç¨‹å†Bçº¿ç¨‹ï¼Œä»¥åŠåä¹‹ï¼Œå¯èƒ½å¾—åˆ°çš„æ˜¯ä¸åŒçš„ç»“æœã€‚</li>
<li>ç¯å¢ƒå‚æ•°ï¼Œå¦‚è¾“å…¥ä¸åŒçš„å‚æ•°ï¼Œå°¤å…¶ä¸€äº›è¾¹ç•Œæ¡ä»¶çš„è§¦å‘å°±è·Ÿè¾“å…¥ä¸åŒçš„å‚æ•°æœ‰å…³ã€‚</li>
</ul>
</li>
<li>replayï¼šè®°å½•ä¸‹æ¥ç¨‹åºæ‰§è¡Œçš„ç¯å¢ƒä¹‹åï¼Œrré™¤äº†æ”¯æŒgdbæ–¹å¼çš„è°ƒè¯•ä¹‹åï¼Œè¿˜èƒ½åˆ©ç”¨ç¯å¢ƒæ¥ä¸åœçš„é‡æ”¾ç¨‹åºï¼Œç”šè‡³åå‘æ¥æ‰§è¡Œç¨‹åºã€‚</li>
</ul>
<p>ä»¥ä¸‹å¯¹<code>rr</code>çš„ä½¿ç”¨åšä¸€äº›ç®€å•çš„ä»‹ç»ã€‚</p>
<h2 id="deterministically">deterministically</h2>
<p>ä»¥ä¸‹é¢ä¸€ä¸ªæœ€ç®€å•çš„å¤šçº¿ç¨‹ç¨‹åºæ¥è§£é‡Šä½•ä¸º<code>deterministically</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;pthread.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;stdio.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#666">*</span> <span style="color:#00a000">doPrint</span>(<span style="color:#0b0;font-weight:bold">void</span> <span style="color:#666">*</span>arg)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>() {
</span></span><span style="display:flex;"><span>    pthread_t pid;
</span></span><span style="display:flex;"><span>    pthread_create(<span style="color:#666">&amp;</span>pid, <span style="color:#a2f">NULL</span>, doPrint, <span style="color:#a2f">NULL</span>);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#b44">&#34;pid = %lu</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#b44">&#34;</span>, pid);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™ä¸ªç¨‹åºå¾ˆç®€å•ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä¹‹åï¼Œæ‰“å°çº¿ç¨‹çš„pidã€‚</p>
<p>å¦‚æœå¤šæ¬¡æ‰§è¡Œï¼Œä¼šå‘ç°æ¯æ¬¡æ‰“å°å‡ºæ¥çš„pidå¹¶ä¸ä¸€æ ·ï¼š</p>
<pre tabindex="0"><code>$ ./a.out
pid = 140301410010880

$ ./a.out
pid = 139804250023680
</code></pre><p>è¿™ä¸ªåŸå› è‡ªä¸å¿…å¤šè¯´ï¼šæ¯æ¬¡ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰§è¡Œç¯å¢ƒæ˜¯æœ‰å˜åŒ–çš„ã€‚</p>
<p>è¿™ä¸ªç®€å•çš„ç»“è®ºï¼Œå¯¹åº”åˆ°bugå‡ºç°çš„åœºæ™¯ä¸Šï¼Œæœ‰çš„ä»£ç å¯èƒ½æ­£å¸¸çš„æƒ…å†µä¸‹æ²¡æœ‰å¼‚å¸¸ï¼Œä½†æ˜¯ä¼šå‡ºç°åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼šç‰¹å®šçš„è¾“å…¥å‚æ•°ã€ç‰¹å®šçš„çº¿ç¨‹æ‰§è¡Œé¡ºåºï¼Œç­‰ç­‰ã€‚æ¢è¨€ä¹‹ï¼Œé—®é¢˜å¹¶ä¸æ˜¯å¿…ç°çš„ï¼Œå³<code>un-deterministically</code>ã€‚</p>
<p><code>rr</code>çš„ä¸€å¤§åŠŸèƒ½ï¼Œå°±æ˜¯è¦è§£å†³è¿™ä¸ª<code>deterministically</code>é—®é¢˜ï¼Œå³åœ¨é—®é¢˜å‘ç°çš„æ—¶å€™ï¼Œèƒ½æœ‰ä¸€ä¸ªç¡®å®šçš„ç¯å¢ƒï¼Œå¯ä»¥åå¤é‡ç°é—®é¢˜ã€‚</p>
<h2 id="record-and-replay">record and replay</h2>
<p><code>rr</code>è¿™ä¸ªåå­—é‡Œçš„ä¸¤ä¸ªrï¼Œæ„æŒ‡<code>record and replay</code>ï¼Œå³â€œè®°å½•åŠå›æ”¾â€ï¼Œå®ƒçš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è¿™ä¸¤æ­¥ï¼š</p>
<ul>
<li>recordï¼š<code>rr record /your/application --args</code> è®°å½•ä¸‹æ¥ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒã€‚</li>
<li>replayï¼š<code>rr replay</code>ï¼Œé»˜è®¤å°†ä½¿ç”¨æœ€è¿‘ä¿å­˜çš„è®°å½•æ–‡ä»¶è¿›è¡Œå›æ”¾ï¼Œå›æ”¾æ—¶å¯ä»¥è¿›å…¥ç±»ä¼¼gdbé‚£æ ·çš„è°ƒè¯•ç¯å¢ƒã€‚</li>
</ul>
<p>æ¯”å¦‚å‰é¢é‚£ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Œä½¿ç”¨<code>rr</code>æ¥è®°å½•åŠå›æ”¾å°±æ˜¯ï¼š</p>
<ul>
<li>recordï¼š</li>
</ul>
<pre tabindex="0"><code>$ rr record ./a.out
Freezing performance counters on SMIs should be turned on for maximum rr
reliability on Comet Lake and later CPUs. Consider putting
&#39;w /sys/devices/cpu/freeze_on_smi - - - - 1&#39; in /etc/tmpfiles.d/10-rr.conf
See &#39;man 5 sysfs&#39;, &#39;man 5 tmpfiles.d&#39; (systemd systems)
rr: Saving execution to trace directory `/home/codedump/.local/share/rr/a.out-0&#39;.
pid = 139837942626048
</code></pre><p>å¯ä»¥çœ‹åˆ°è®°å½•æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰“å°å‡ºæ¥çš„<code>pid</code>æ˜¯<code>139837942626048</code>ã€‚</p>
<ul>
<li>replayï¼š</li>
</ul>
<pre tabindex="0"><code>$ rr replay

...çœç•¥ä¸é‡è¦ä¿¡æ¯...

ï¼ˆè¿›å…¥replayä¹‹åç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæ˜¯æŒ‰`c`ï¼‰

(rr) c
Continuing.
pid = 139837942626048

ï¼ˆå‰é¢å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œæƒ³è¦ç¬¬äºŒæ¬¡æ‰§è¡Œï¼ŒæŒ‰`r`ï¼ˆrunï¼‰ï¼‰

(rr) r
[Inferior 1 (process 36022) exited normally]
Starting program: /home/codedump/.local/share/rr/a.out-0/mmap_hardlink_4_a.out

Program stopped.
0x00007f2e8f19c100 in ?? () from /lib64/ld-linux-x86-64.so.2
(rr) c
Continuing.
pid = 139837942626048
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå‰åä¸¤æ¬¡é‡æ”¾æ‰§è¡Œï¼Œæ‰“å°çš„<code>pid</code>éƒ½æ˜¯ä¹‹å‰è®°å½•çš„å€¼<code>139837942626048</code>ã€‚</p>
<p>è¿™å°±æ„å‘³ç€ï¼šrecordä¸‹æ¥çš„ç¨‹åºæ‰§è¡Œç¯å¢ƒï¼Œåé¢å¯ä»¥ä¸åœçš„å›æ”¾ã€‚å› ä¸ºé‡ç°é—®é¢˜çš„åœºæ™¯å¾ˆé‡è¦ï¼Œæœ‰æ—¶å€™è¿˜ä¸å¥½å¤ç°ï¼Œé‚£ä¹ˆç±»ä¼¼<code>rr</code>è¿™æ ·èƒ½è®°å½•ä¸‹æ¥æ‰§è¡Œç¯å¢ƒå¹¶ä¸”é‡æ”¾çš„èƒ½åŠ›ï¼Œå¯¹äºæŸ¥æ‰¾é—®é¢˜å°±ç‰¹åˆ«é‡è¦äº†ã€‚</p>
<h2 id="é«˜çº§ç”¨æ³•">é«˜çº§ç”¨æ³•</h2>
<p>å‰é¢æåˆ°è¿‡ï¼Œä½¿ç”¨<code>rr replay</code>æ¥é‡æ”¾è®°å½•æ—¶ï¼Œå®é™…ä¼šè¿›å…¥ç±»ä¼¼gdbé‚£æ ·çš„ä¸€ä¸ªè°ƒè¯•ç¯å¢ƒï¼Œåœ¨è¿™ä¸ªç¯å¢ƒé‡Œï¼Œå¸¸ç”¨çš„gdbå‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™äº›ä¸ä¼šå±•å¼€è®¨è®ºï¼Œåªè¯´ä¸€ä¸‹<code>rr</code>åœ¨è¿™é‡Œå…·å¤‡çš„ä¸€äº›å…¶ä»–æ›´é«˜çº§çš„è°ƒè¯•èƒ½åŠ›ã€‚</p>
<h3 id="äº‹ä»¶">äº‹ä»¶</h3>
<p>ä¸ºäº†èƒ½å¤Ÿæ›´åŠ ç²¾å‡†çš„è·Ÿè¿›æŸä¸ªé—®é¢˜ï¼Œ<code>rr</code>æä¾›äº†äº‹ä»¶ï¼ˆeventï¼‰çš„æ¦‚å¿µï¼Œæ¯ä¸ªäº‹ä»¶æœ‰ä¸ä¹‹ç›¸å…³çš„ä¸¤ä¸ªå€¼ï¼š</p>
<ul>
<li>è¿›ç¨‹pidã€‚</li>
<li>äº‹ä»¶ç¼–å·ã€‚</li>
</ul>
<p><code>rr</code>åœ¨replayçš„æ—¶å€™ï¼Œå¯ä»¥å¸¦ä¸Š<code>-M</code>å‚æ•°æ‰“å°å‡ºæ¥äº‹ä»¶ç¼–å·ï¼Œæ¯”å¦‚å‰é¢çš„å®ä¾‹ç¨‹åºæ”¹æˆè¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;pthread.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;stdio.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#666">*</span> <span style="color:#00a000">doPrint</span>(<span style="color:#0b0;font-weight:bold">void</span> <span style="color:#666">*</span>arg) {
</span></span><span style="display:flex;"><span>  <span style="color:#0b0;font-weight:bold">int</span> i <span style="color:#666">=</span> <span style="color:#666">*</span>((<span style="color:#0b0;font-weight:bold">int</span><span style="color:#666">*</span>)arg);
</span></span><span style="display:flex;"><span>  printf(<span style="color:#b44">&#34;in thread %d</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#b44">&#34;</span>, i);
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#0b0;font-weight:bold">int</span> i <span style="color:#666">=</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">for</span> (i <span style="color:#666">=</span> <span style="color:#666">0</span>; i <span style="color:#666">&lt;</span> <span style="color:#666">10</span>; <span style="color:#666">++</span>i) {
</span></span><span style="display:flex;"><span>    pthread_t pid;
</span></span><span style="display:flex;"><span>    pthread_create(<span style="color:#666">&amp;</span>pid, <span style="color:#a2f">NULL</span>, doPrint, <span style="color:#666">&amp;</span>i);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#b44">&#34;pid = %lu</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#b44">&#34;</span>, pid);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™é‡Œåˆ›å»ºäº†10ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ä¸­åˆ†åˆ«æ‰“å°å¾ªç¯å˜é‡ï¼Œå¦‚æœä½¿ç”¨<code>-M</code>åœ¨è¾“å‡ºæ—¶å°±èƒ½çœ‹åˆ°å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code>(rr) c
Continuing.
[rr 4450 288]pid = 140096584951552
[rr 4450 305]in thread 1
[rr 4450 313]pid = 140096574461696
[rr 4450 330]in thread 2
[rr 4450 337]pid = 140096563971840
[rr 4450 354]in thread 3
[rr 4450 361]pid = 140096555579136
[rr 4450 378]in thread 4
[rr 4450 385]pid = 140096547186432
[rr 4450 402]in thread 5
[rr 4450 409]pid = 140096538793728
[rr 4450 426]in thread 6
[rr 4450 433]pid = 140096530401024
[rr 4450 450]in thread 7
[rr 4450 457]pid = 140096522008320
[rr 4450 474]in thread 8
[rr 4450 481]pid = 140096513615616
[rr 4450 498]in thread 9
[rr 4450 505]pid = 140096505222912
</code></pre><p>æœ€å·¦è¾¹æ˜¾ç¤ºäº‹ä»¶çš„æ ¼å¼ä¸º<code>[rr pid äº‹ä»¶id]</code>ã€‚</p>
<p>çŸ¥é“äº†äº‹ä»¶å¯¹åº”çš„<code>(pid,äº‹ä»¶id)</code>äºŒå…ƒç»„ä¹‹åï¼Œåœ¨replayçš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸¤ä¸ªå€¼ï¼Œæ¯”å¦‚ï¼š</p>
<blockquote>
<pre tabindex="0"><code>rr -M replay -g äº‹ä»¶id
æˆ–è€…
rr -M replay -p pid
</code></pre></blockquote>
<p>è®©ç¨‹åºreplayçš„æ—¶å€™è¿…é€Ÿåˆ°è¾¾æŒ‡å®šäº‹ä»¶å‘ç”Ÿçš„åœºæ™¯ä¸‹ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœä½¿ç”¨<code>rr -M replay -g 354</code>å°±èƒ½é©¬ä¸Šé‡æ”¾åˆ°<code>[rr 4450 354]in thread 3</code>è¿™ä¸€å¤„ã€‚</p>
<p>è¿™ç§åŸºäºäº‹ä»¶çš„è°ƒè¯•æ–¹å¼ï¼Œè°ƒè¯•é‚£ç§ä»£ç ç›¸åŒï¼Œä½†æ˜¯ç”±äºè¾“å…¥å‚æ•°ä¸åŒå¯¼è‡´çš„é—®é¢˜æ—¶ï¼Œç‰¹åˆ«ç®¡ç”¨ï¼Œå› ä¸ºå¯ä»¥ç›´è¾¾é—®é¢˜å‘ç”Ÿçš„ç¯å¢ƒã€‚</p>
<h3 id="åå‘æ‰§è¡Œreverse-execution">åå‘æ‰§è¡Œï¼ˆReverse executionï¼‰</h3>
<p>æœ‰äº†è®°å½•çš„èƒ½åŠ›ä¹‹åï¼Œ<code>rr</code>é™¤äº†èƒ½æ­£å‘æ‰§è¡Œç¨‹åºï¼Œè¿˜èƒ½åå‘æ¥æ‰§è¡Œç¨‹åºï¼Œè¿™ç‚¹åœ¨é‚£ç§çœ‹åˆ°ç¨‹åºçš„ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆå‘ç”Ÿï¼Œæƒ³é‡è¯•ä¸€ä¸‹çš„æƒ…å†µä¸‹ç‰¹åˆ«ç®¡ç”¨ã€‚</p>
<p>å•å‘è°ƒè¯•æ‰§è¡Œç¨‹åºæ—¶ï¼Œç”¨çš„æ˜¯<code>step</code>ã€<code>next</code>ã€<code>continue</code>ã€<code>finish</code>ç­‰å‘½ä»¤ï¼Œåå‘æ‰§è¡Œå°±åœ¨è¿™äº›å‘½ä»¤å‰é¢åŠ ä¸Š<code>reverse-</code>å‰ç¼€ï¼Œå¦‚<code>reverse-cont</code>ï¼ˆåé¢çš„å¯ä»¥ç®€å†™ï¼‰ã€‚</p>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<p>å‰é¢ä»‹ç»äº†<code>rr</code>è¦è§£å†³çš„é—®é¢˜ï¼Œæœ€åèŠä¸€ä¸‹å®ƒçš„ç¼ºé™·ã€‚</p>
<ul>
<li><code>rr</code>æœ€å¼€å§‹æ˜¯ç”±Mozillaå¼€å‘çš„å·¥å…·ï¼Œçœ‹æ¥Mozillaå¯¹è¿™ç±»è¿è¡Œæ—¶é—®é¢˜ä¹Ÿæ˜¯æ·±æ¶ç—›ç»ï¼Œå‘æ˜äº†å¾ˆå¤šå·¥å…·è¯•å›¾æé«˜æ•ˆç‡ï¼ŒRustæ˜¯å¦å¤–ä¸€ä¸ªé‡è¦çš„å·¥å…·ï¼Œå¯ä»¥å‚è§ä¹‹å‰<a href="https://www.codedump.info/post/20220227-weekly-7/">å‘¨åˆŠï¼ˆç¬¬7æœŸï¼‰ï¼šä¸€ä¸ªCç³»ç¨‹åºå‘˜çš„Ruståˆä½“éªŒ</a>ä¸­æˆ‘å¯¹Rustçš„ä½¿ç”¨ä½“éªŒã€‚</li>
<li>å¾ˆå¯æƒœï¼Œè¿™ä¸ªå·¥å…·è²Œä¼¼åªèƒ½åœ¨Linuxä¸Šé¢è¿è¡Œï¼Œå¹¶æ²¡æœ‰Win\Macç‰ˆæœ¬ï¼Œè€Œä¸”è²Œä¼¼ä¹Ÿä¸æ€ä¹ˆæ›´æ–°äº†ã€‚</li>
<li>ç”±äº<code>rr</code>åœ¨è®°å½•æ—¶ï¼Œéœ€è¦è®°å½•å¤§é‡çš„æ•°æ®æ¥ä¿å­˜ç¨‹åºè¿è¡Œæ—¶çš„åœºæ™¯ï¼Œè¿™æ ·ä¸€æ¥ä¼šç»™ç¨‹åºå¸¦æ¥å¡é¡¿ï¼ŒäºŒæ¥ä¼šæœ‰å¤§é‡çš„è®°å½•æ•°æ®ï¼Œæ‰€ä»¥å¹¶ä¸é€‚åˆç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨è¿™ä¸ªå·¥å…·ã€‚æ›´é€‚åˆçš„åœºæ™¯æ˜¯ï¼šå·²ç»æ‰¾åˆ°äº†é‡ç°é—®é¢˜çš„åŠæ³•ï¼Œæ­¤æ—¶å¯ä»¥æ­å»ºä¸€ä¸ªç¯å¢ƒå¼€å¯<code>rr</code>è®°å½•ä¸‹æ¥é‡ç°æ—¶çš„ç¯å¢ƒï¼Œå³å¹¶ä¸é€‚åˆæ¼«æ— ç›®çš„çš„å°±æ‰“å¼€è¿™ä¸ªå·¥å…·ä½¿ç”¨ã€‚</li>
<li>ä»¥ä¸Š<code>rr</code>çš„ç¼ºé™·ï¼Œå½’æ ¹åˆ°åº•è¿˜æ˜¯ä¹‹å‰æåˆ°çš„ï¼šæŸ¥æ‰¾è¿è¡Œæ—¶çš„é—®é¢˜å¤ªéš¾äº†ï¼Œå°½é‡åœ¨ç¼–è¯‘æ—¶å±è”½å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼ŒçœŸç­‰é—®é¢˜åˆ°äº†è¿è¡Œæ—¶å†è§£å†³çš„æ—¶å€™ï¼Œæ—¶é—´ã€ç²¾åŠ›ã€åœºæ™¯å¤ç°ç­‰ç­‰éƒ½æ˜¯ä¸å¯æ§çš„ã€‚</li>
</ul>
<h1 id="ç•ªå¤–ç¯‡">ç•ªå¤–ç¯‡</h1>
<h2 id="rrä½¿ç”¨çš„wiki">rrä½¿ç”¨çš„wiki</h2>
<p><code>rr</code>çš„githubä¸Šï¼Œæœ‰ä¸€ç¯‡æ›´ä¸ºè¯¦ç»†ä¸€äº›çš„ä»‹ç»ä½¿ç”¨çš„<a href="https://github.com/rr-debugger/rr/wiki/Usage">Usage Â· rr-debugger/rr Wiki</a>ã€‚</p>
<h2 id="rrè§†é¢‘æ•™ç¨‹">rrè§†é¢‘æ•™ç¨‹</h2>
<p>æ²¹ç®¡ä¸Šæœ‰å‡ ä¸ªè§†é¢‘æ•™ç¨‹ï¼Œè§ï¼š</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=hYsLBcTX00I">Quick rr Demo - YouTube</a></li>
<li><a href="https://www.youtube.com/watch?v=61kD3x4Pu8I">rr 1.2 basic demo - YouTube</a></li>
<li><a href="https://www.youtube.com/watch?v=H4iNuufAe_8">Robert O&rsquo;Callahan - Corporation Taming Nondeterminism - YouTube</a></li>
</ul>
<h2 id="å…¶å®ƒæ–‡æ¡£">å…¶å®ƒæ–‡æ¡£</h2>
<ul>
<li>ä»‹ç»äº†<code>rr</code>æ˜¯å¦‚ä½•å®ç°çš„ï¼š<a href="https://arxiv.org/pdf/1705.05937.pdf">Engineering Record And Replay For Deployability Extended Technical Report</a></li>
</ul>
<h2 id="gdbç›¸å…³æ–‡æ¡£">GDBç›¸å…³æ–‡æ¡£</h2>
<ul>
<li><a href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/index.html">ä»‹ç» | 100ä¸ªgdbå°æŠ€å·§</a></li>
<li><a href="https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30">GDB cheat sheet</a></li>
<li><a href="https://segmentfault.com/a/1190000022499197">gdbæ·±å…¥å­¦ä¹ æ‰‹å†Œ - SegmentFault æ€å¦</a></li>
</ul>
<h1 id="å…¶ä»–æ¨è">å…¶ä»–æ¨è</h1>
<h2 id="å¦‚ä½•åœ¨å¼€æºé¡¹ç›®ä¸­åšé‡æ„">ã€Šå¦‚ä½•åœ¨å¼€æºé¡¹ç›®ä¸­åšé‡æ„ï¼Ÿã€‹</h2>
<p><a href="https://mp.weixin.qq.com/s/JrxNyDKNg9MseQZ7PlG2VQ">ã€Šå¦‚ä½•åœ¨å¼€æºé¡¹ç›®ä¸­åšé‡æ„ï¼Ÿã€‹</a>ï¼Œæ€»ç»“äº†ç»´æŠ¤ä¸€ä¸ªå¼€æºé¡¹ç›®é‡æ„çš„ç»éªŒã€‚</p>
<h2 id="linux-containers-in-500-lines-of-code">ã€ŠLinux containers in 500 lines of codeã€‹</h2>
<p><a href="https://blog.lizzie.io/linux-containers-in-500-loc.html">Linux containers in 500 lines of code</a>ï¼Œè®²è§£Linuxå®¹å™¨åŸç†çš„æ–‡ç« ã€‚</p>
<h2 id="æ”¶é›†æ•´ç†è¿œç¨‹å·¥ä½œç›¸å…³çš„èµ„æ–™">æ”¶é›†æ•´ç†è¿œç¨‹å·¥ä½œç›¸å…³çš„èµ„æ–™</h2>
<p><a href="https://github.com/greatghoul/remote-working">greatghoul/remote-working: æ”¶é›†æ•´ç†è¿œç¨‹å·¥ä½œç›¸å…³çš„èµ„æ–™</a>ï¼Œä½†æ˜¯è²Œä¼¼å·²ç»ä¸æ›´æ–°äº†ã€‚</p>

    
  </article>
  <div class="paginator">
    
    <a class="link" href="https://www.codedump.info/post/20220304-weekly-8/">â† prev</a>
    
    
    <a class="link" href="https://www.codedump.info/post/20220319-weekly-10/">next â†’</a>
    
  </div>

    
<h1>ç›¸å…³æ–‡ç« </h1>
<li><strong> 14059-05-14: </strong> <a href="https://www.codedump.info/post/20220514-weekly-15/">å‘¨åˆŠï¼ˆç¬¬15æœŸï¼‰ï¼šå›¾è§£ARIESè®ºæ–‡ï¼ˆä¸Šï¼‰</a>  </li><li><strong> 7059-05-07: </strong> <a href="https://www.codedump.info/post/20220507-weekly-14/">å‘¨åˆŠï¼ˆç¬¬14æœŸï¼‰ï¼šé‡è¯»Raftè®ºæ–‡ä¸­çš„é›†ç¾¤æˆå‘˜å˜æ›´ç®—æ³•ï¼ˆäºŒï¼‰ï¼šå®è·µç¯‡</a>  </li><li><strong> 17049-04-17: </strong> <a href="https://www.codedump.info/post/20220417-weekly-13/">å‘¨åˆŠï¼ˆç¬¬13æœŸï¼‰ï¼šé‡è¯»Raftè®ºæ–‡ä¸­çš„é›†ç¾¤æˆå‘˜å˜æ›´ç®—æ³•ï¼ˆä¸€ï¼‰ï¼šç†è®ºç¯‡</a>  </li><li><strong> 10049-04-10: </strong> <a href="https://www.codedump.info/post/20220410-weekly-12/">å‘¨åˆŠï¼ˆç¬¬12æœŸï¼‰ï¼šPage orientedç±»å­˜å‚¨å¼•æ“é‡Œå¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§ç»“æ„</a>  </li><li><strong> 27039-03-27: </strong> <a href="https://www.codedump.info/post/20220327-weekly-11/">å‘¨åˆŠï¼ˆç¬¬11æœŸï¼‰ï¼šmmapé€‚ç”¨äºå­˜å‚¨å¼•æ“å—ï¼Ÿ</a>  </li>
<h1>é‚®ä»¶è®¢é˜…</h1>

<div class="custom-footer">
  <form action="https://www.getrevue.co/profile/lichuang/add_subscriber" method="post" id="revue-form" name="revue-form"  target="_blank" align="center">
    <input class="newsletter-email-field" placeholder="é‚®ä»¶è®¢é˜…æœ¬ç«™æ›´æ–°" type="email" name="member[email]" size="26">
    <input class="newsletter-submit-button" type="submit" value="ç‚¹å‡»è®¢é˜…" name="member[subscribe]">
    <div class="revue-form-footer">By subscribing, you agree with Revueâ€™s <a target="_blank" href="https://www.getrevue.co/terms">Terms of Service</a> and <a target="_blank" href="https://www.getrevue.co/privacy">Privacy Policy</a>.</div>
  </form>
</div>

<img align="center" src="https://cdn.jsdelivr.net/gh/lichuang/lichuang.github.io/media/imgs/reward/qrcode.png" alt="wechat-account-qrcode">
    <footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%91%A8%E5%88%8A/">å‘¨åˆŠ</a>
          </div><div class="comment">
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lichuang-codedump" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    
    
        <script src="https://utteranc.es/client.js"
            repo="{{ .Site.Params.utterances.owner }}/{{ .Site.Params.utterances.repo }}"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
  
    
  </div>

  <main id="main" class="main">
    <div class="content-wrapper">
      <div id="content" class="content">
        
      </div>
      <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'lichuang-codedump';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  
    <script src="https://utteranc.es/client.js"
            repo="lichuang/lichuang.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </div>
  </main>


  
</main>

    <footer id="footer">
  <div>
    <span>Â© 2019</span> - <span>2022</span>
  </div>

  <div>
    <span>Powered by </span>
    <a class="link" href="https://gohugo.io/">Hugo</a>
    <span> ğŸ¦ Theme </span>
    <a class="link" href="https://github.com/queensferryme/hugo-theme-texify">TeXify</a>
  </div>

  <div class="footnote">
    <span>Follow me on <a class=link href=https://github.com/lichuang>GitHub</a>,
<a class=link href=https://twitter.com/lichuang>Twitter</a> or
<a class=link href=/index.xml>RSS</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  



  
  

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-126255685-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>

</html>
