<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>å­˜å‚¨å¼•æ“ on codedumpçš„ç½‘ç»œæ—¥å¿—</title>
    <link>https://www.codedump.info/tags/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</link>
    <description>Recent content in å­˜å‚¨å¼•æ“ on codedumpçš„ç½‘ç»œæ—¥å¿—</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sat, 14 May 2022 06:33:26 +0800</lastBuildDate><atom:link href="https://www.codedump.info/tags/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>å‘¨åˆŠï¼ˆç¬¬15æœŸï¼‰ï¼šå›¾è§£ARIESè®ºæ–‡ï¼ˆä¸Šï¼‰ï¼šæ—¥å¿—ç³»ç»Ÿ</title>
      <link>https://www.codedump.info/post/20220514-weekly-15/</link>
      <pubDate>Sat, 14 May 2022 06:33:26 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20220514-weekly-15/</guid>
      
      <description>&lt;hr&gt;
&lt;p&gt;å¼•è¨€ï¼šARIES(Algorithm for Recovery and Isolation Exploiting Semanticsçš„ç®€ç§°ï¼‰æ˜¯è®ºæ–‡&lt;a href=&#34;https://cs.stanford.edu/people/chrismre/cs345/rl/aries.pdf&#34;&gt;ã€ŠARIES: A Transaction Recovery Method Supporting Fine-Franularity Locking and Partial Rollbacks Using Write-Ahead Loggingã€‹&lt;/a&gt;ä¸­æåˆ°çš„ä¸€ç§å­˜å‚¨å¼•æ“ä¸­æ•°æ®æ¢å¤çš„ç®—æ³•ã€‚è¿™ç¯‡è®ºæ–‡å¯ä»¥è¯´æ˜¯å­˜å‚¨å¼•æ“æ•°æ®æ¢å¤é¢†åŸŸå¿…è¯»çš„ä¸€ç¯‡è®ºæ–‡ï¼Œè¿™ä¸¤æœŸçš„å‘¨åˆŠå°±æ˜¯å¯¹è¿™ç¯‡è®ºæ–‡çš„å›¾è§£ï¼Œè¿™æ˜¯å…¶ä¸­çš„ä¸Šç¯‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;å›¾è§£ariesè®ºæ–‡ä¸Š&#34;&gt;å›¾è§£ARIESè®ºæ–‡ï¼ˆä¸Šï¼‰&lt;/h1&gt;
&lt;p&gt;åœ¨å±•å¼€è§£é‡ŠARIESç®—æ³•åŸç†ä¹‹å‰ï¼Œéœ€è¦å¯¹&lt;a href=&#34;https://www.codedump.info/post/20220410-weekly-12/&#34;&gt;Page orientedç±»å­˜å‚¨å¼•æ“&lt;/a&gt;çš„æ—¥å¿—ç³»ç»Ÿæœ‰ä¸€å®šçš„äº†è§£ï¼Œæ‰èƒ½ç»§ç»­è§£é‡ŠåŸºäºè¿™ä¸ªæ—¥å¿—ç³»ç»Ÿä¹‹ä¸Šåšçš„æ¢å¤ç®—æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­ï¼Œå‡ºé”™æ˜¯éå¸¸å¸¸è§çš„æƒ…å†µçš„ï¼Œè¿™å°±æ¶‰åŠåˆ°å‡ºé”™äº†ä¹‹åç³»ç»Ÿæ¢å¤æ—¶è¿˜éœ€è¦èƒ½ç»§ç»­å·¥ä½œï¼Œå³æ•°æ®ä¸èƒ½å‘ç”Ÿç ´åå¯¼è‡´æ•´ä¸ªç³»ç»Ÿè·‘ä¸èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯ï¼Œå½“ç³»ç»Ÿå‡ºé”™éœ€è¦é‡å¯æ¢å¤æ—¶ï¼Œå°±æ¶‰åŠåˆ°ä»¥ä¸‹ä¸¤ä¸ªåŠ¨ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’¤é”€ï¼ˆUndoï¼‰ï¼šæœªå®Œæˆæˆ–è€…ç”±äºå„ç§åŸå› å‘ç”Ÿçš„äº‹åŠ¡ï¼Œå…¶ä¿®æ”¹éœ€è¦è¢«æ’¤é”€ï¼Œå³å›æ»šä¸ºäº‹åŠ¡ä¹‹å‰çš„æ—§å€¼ã€‚&lt;/li&gt;
&lt;li&gt;é‡åšï¼ˆRedoï¼‰ï¼šå·²ç»æäº¤çš„äº‹åŠ¡ï¼Œå…¶ä¿®æ”¹æ“ä½œçš„æ•ˆæœéœ€è¦ä½“ç°ä¸ºæ–°å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥çœ‹ä¸‹å›¾ä¸­æå‡ºçš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/bufferpool.png&#34; alt=&#34;bufferpool&#34; title=&#34;bufferpool&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜åœ¨äº‹åŠ¡T1å’ŒT2åœ¨åŒæ—¶æ‰§è¡Œï¼š
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡T1ï¼šä¿®æ”¹Aå€¼ä¸º3ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡è¿˜æœªæäº¤å‰ï¼Œäº‹åŠ¡T2å¼€å§‹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡T2ï¼šä¿®æ”¹Bå€¼ä¸º8ï¼Œå¹¶ä¸”æˆåŠŸæäº¤ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡T1ç»ˆæ­¢ï¼šåœ¨äº‹åŠ¡T2æˆåŠŸæäº¤ä¹‹åï¼Œäº‹åŠ¡T1ç»ˆæ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªäº‹åŠ¡è°ƒåº¦çš„æ‰§è¡Œé¡ºåºå¼•å‘äº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›æ»šæœªæäº¤çš„äº‹åŠ¡T1éœ€è¦åšä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¯¹äºæœªæäº¤çš„äº‹åŠ¡T1ï¼Œæ˜¯å¦å…è®¸å…¶ä¿®æ”¹æ“ä½œåœ¨æŒä¹…åŒ–å­˜å‚¨ä¸Šç”Ÿæ•ˆï¼ˆå³å°†Aä¿®æ”¹ä¸º3ï¼‰ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åœ¨ç£ç›˜çš„æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå·²æˆåŠŸæäº¤çš„äº‹åŠ¡T2ï¼Œå…¶ä¿®æ”¹æ“ä½œæ˜¯å¦åº”è¯¥ç«‹å³è½ç›˜ï¼ˆå³ä»buffer poolä¸­åŒæ­¥ä¿®æ”¹çš„å†…å®¹åˆ°ç¡¬ç›˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé—®é¢˜å½“å‰æš‚ä¸”æ”¾åˆ°ä¸€è¾¹ï¼Œæ¥çœ‹åé¢ä¸¤ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;â€œæ˜¯å¦å…è®¸æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹åœ¨æŒä¹…åŒ–å­˜å‚¨ä¸Šç”Ÿæ•ˆâ€ï¼ˆWhether the DBMS allows an uncommitted txn to overwrite the most recent committed value of an object in non-volatile storageï¼‰ï¼Œè¢«ç§°ä¸º&lt;code&gt;Steal policy&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stealï¼šå…è®¸æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æŒä¹…åŒ–å­˜å‚¨ä¸Šç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;no stealï¼šåä¹‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤ä¹‹å‰æ˜¯å¦éœ€è¦å°†æ‰€æœ‰ä¿®æ”¹åŒæ­¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸Šï¼ˆWhether the DBMS requires that all updates made by a txn are reflected on non-volatile storage before the txn is allowed to commit.ï¼‰ï¼Œä¹Ÿæœ‰ä¸¤ç§ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;forceï¼šå¿…é¡»å°†äº‹åŠ¡çš„æ‰€æœ‰ä¿®æ”¹éƒ½åŒæ­¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸Šï¼Œäº‹åŠ¡æ‰è¢«å…è®¸æäº¤ã€‚&lt;/li&gt;
&lt;li&gt;no-forceï¼šåä¹‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›´ç»•ç€è¿™ä¸¤ä¸ªä¸åŒçš„ç»´åº¦ï¼Œæœ‰äº†ä¸åŒçš„åšæ³•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥æŒ‰ç…§ä¸Šé¢çš„å®šä¹‰ï¼Œä½¿ç”¨&lt;code&gt;no-steal+force&lt;/code&gt;çš„ç­–ç•¥ï¼Œæ¥é‡æ–°çœ‹çœ‹å‰é¢çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/no-steal+force.png&#34; alt=&#34;no-steal+force&#34; title=&#34;no-steal+force&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡T1ï¼šç”±äºé‡‡ç”¨no-stealç­–ç•¥ï¼Œæ‰€ä»¥å¯¹äºæœªèƒ½æäº¤çš„äº‹åŠ¡T1è€Œè¨€ï¼Œè¯¥äº‹åŠ¡çš„ä¿®æ”¹é¡¶å¤šåˆ°å†…å­˜çš„buffer poolä¸­ï¼Œä¸ä¼šåœ¨ç£ç›˜ä¸Šç”Ÿæ•ˆï¼Œå› æ­¤å›æ»šäº‹åŠ¡çš„æ“ä½œåªéœ€è¦å°†å†…å­˜çš„buffer poolä¸­çš„æ•°æ®æ’¤é”€å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡T2ï¼šç”±äºé‡‡ç”¨forceç­–ç•¥ï¼Œå› æ­¤åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¿…é¡»å°†æ‰€æœ‰ä¿®æ”¹éƒ½åŒæ­¥åˆ°ç£ç›˜çš„æ•°æ®åº“æ–‡ä»¶ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨&lt;code&gt;no-steal+force&lt;/code&gt;çš„ç­–ç•¥æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;undo&lt;/code&gt;æ“ä½œåªéœ€è¦å›æ»šå†…å­˜ä¸­çš„æ•°æ®å³å¯ï¼Œå› ä¸ºè¿˜æœªåŒæ­¥åˆ°ç£ç›˜çš„æ•°æ®åº“æ–‡ä»¶ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå·²æäº¤äº‹åŠ¡è€Œè¨€ï¼Œæ— éœ€&lt;code&gt;redo&lt;/code&gt;æ“ä½œï¼Œè¿™æ˜¯å› ä¸ºäº‹åŠ¡æäº¤ä¹‹å‰å¿…é¡»å¼ºåˆ¶åŒæ­¥æ‰€æœ‰ä¿®æ”¹åˆ°æ•°æ®åº“æ–‡ä»¶ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™ä¸ªç­–ç•¥ç»„åˆçš„é—®é¢˜åœ¨äºï¼šæ— æ³•æ”¯æ’‘ä¸€ä¸ªä¿®æ”¹äº†å¤§é‡æ•°æ®çš„äº‹åŠ¡ã€‚æ¯”å¦‚å‡è®¾å†…å­˜ä¸­çš„buffer poolä»…èƒ½å®¹çº³1Kå¤§å°çš„ä¿®æ”¹ç¼“å†²åŒºï¼Œè€ŒæŸä¸€ä¸ªäº‹åŠ¡ä¸€å…±ä¿®æ”¹äº†2Kçš„æ•°æ®ï¼Œè¿™æ—¶å€™è¶…è¿‡buffer poolå¤§å°çš„æ•°æ®ï¼Œæ˜¯å¦åº”è¯¥å³æ—¶è½ç›˜ï¼ŸæŒ‰ç…§è¿™ä¸ªç­–ç•¥æ˜¯è§£å†³ä¸äº†è¿™ä¸ªé—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹çœ‹ä¸¤ç§æœ€å¸¸è§çš„åšæ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½±å­é¡µé¢ï¼ˆshadow pageï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;WALï¼ˆWrite Ahead Logï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å½±å­é¡µé¢shadow-page&#34;&gt;å½±å­é¡µé¢ï¼ˆshadow pageï¼‰&lt;/h2&gt;
&lt;p&gt;å½±å­é¡µé¢çš„åŸç†æ˜¯è¿™æ ·çš„ï¼Œç»´æŠ¤ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åº“æ–‡ä»¶çš„æ‹·è´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»æ‹·è´ï¼šåªä¿å­˜å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;å½±å­æ‹·è´ï¼šæ‹·è´å¾…ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œä¿å­˜æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰äº†ä¸¤ä»½ä¸åŒçš„æ•°æ®ï¼Œåœ¨è¿›è¡Œä¸­çš„äº‹åŠ¡åªéœ€è¦ä¿®æ”¹å½±å­æ‹·è´å³å¯ï¼Œå½“æœªæäº¤äº‹åŠ¡éœ€è¦æäº¤æ—¶ï¼Œåˆ‡æ¢å½±å­æ‹·è´å˜æˆä¸»æ‹·è´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹å›¾æ¥è§£é‡Šå½±å­é¡µé¢çš„å·¥ä½œåŸç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/shadow-page.png&#34; alt=&#34;shadow-page&#34; title=&#34;shadow-page&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†åˆ«ç”¨ä¸‰ç§é¢œè‰²æ ‡è®°äº†ä¸åŒç±»å‹çš„é¡µé¢ï¼šä¸»é¡µé¢ã€å½±å­é¡µé¢ã€ç©ºé—²é¡µé¢ï¼Œå…¶ä¸­ç©ºé—²é¡µé¢æ˜¯è¢«æ›¿æ¢å‡ºå»çš„ä¸»é¡µé¢ï¼Œç”±äºå·²ç»æœ‰æ–°çš„ä¸»é¡µé¢äº§ç”Ÿï¼Œæ‰€ä»¥ä¹‹å‰çš„ä¸»é¡µé¢å°±å˜æˆäº†ç©ºé—²é¡µé¢å¯ä»¥é‡æ–°åœ¨ä¸‹ä¸€æ¬¡ç”Ÿæˆå½±å­é¡µé¢çš„æ—¶å€™ä½¿ç”¨ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¿®æ”¹ä¹‹å‰ï¼Œå·²ç»å­˜åœ¨3ä¸ªä¸»é¡µé¢ï¼Œå…¶ä¸­çš„é¡µé¢1ä¸ºå½“å‰çš„æ ¹é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å‡è®¾ä¸€ä¸ªäº‹åŠ¡ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹è¿™ä¸‰ä¸ªä¸»é¡µé¢ï¼Œç³»ç»Ÿå‘ç°å½“å‰æ²¡æœ‰å¯ç”¨çš„ç©ºé—²é¡µé¢ï¼Œäºæ˜¯æ‰©å±•æ•°æ®åº“æ–‡ä»¶ç”Ÿæˆä¸‰ä¸ªæ–°çš„ç‰©ç†é¡µé¢ï¼Œé¦–å…ˆæ‹·è´åŸé¡µé¢å†…å®¹ï¼Œç„¶åå†è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œäº‹åŠ¡çš„ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡ä¿®æ”¹å®Œæˆä¹‹åï¼Œåªéœ€è¦ä¿®æ”¹æ ¹é¡µé¢ä¸ºæœ€æ–°çš„é¡µé¢1å³å¯ï¼Œè€Œè¿™æ¬¡ä¿®æ”¹ä¸­æ¶‰åŠåˆ°å‡ ä¸ªä¹‹å‰çš„ä¸»é¡µé¢å°±å˜æˆäº†ç©ºé—²é¡µé¢ï¼Œä¸‹ä¸€æ¬¡ä¿®æ”¹æ—¶å¯ä»¥å›æ”¶åˆ©ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹æ®å‰é¢å¯¹ä¸¤ç§ç­–ç•¥çš„å®šä¹‰ï¼Œå½±å­é¡µé¢å±äºé‡‡ç”¨&lt;code&gt;no-steal+force&lt;/code&gt;ç­–ç•¥çš„æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;no-stealï¼šæœªæäº¤çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹å˜æˆä¸»é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;forceï¼šäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¿…é¡»æŠŠä¿®æ”¹åçš„å½±å­é¡µé¢åˆ‡æ¢ä¸ºæ–°çš„ä¸»é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸€çœ‹ï¼Œå½±å­é¡µé¢çš„é‡åšå’Œæ’¤é”€æ˜¯æ€ä¹ˆåšçš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’¤é”€ï¼šåªéœ€è¦å°†å†™äº‹åŠ¡æ—¶å¤šåˆ†é…å‡ºæ¥çš„ç‰©ç†é¡µé¢å†æ¬¡å˜æˆç©ºé—²é¡µé¢å³å¯ï¼Œä¸‹ä¸€æ¬¡å¯ä»¥å›æ”¶åˆ©ç”¨ã€‚ç”±äºæ²¡æœ‰åˆ‡æ¢æ ¹é¡µé¢ç¼–å·ï¼Œå¹¶ä¸éœ€è¦å¤šåšä»€ä¹ˆå…¶å®ƒçš„å·¥ä½œäº†ã€‚&lt;/li&gt;
&lt;li&gt;é‡åšï¼šä¸éœ€è¦é‡åšæ“ä½œï¼Œå› ä¸ºåªè¦å®Œæˆäº†å½±å­é¡µé¢åˆ‡æ¢åˆ°ä¸»é¡µé¢çš„æ“ä½œï¼Œå°±ç›¸å½“äºè¿™ä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯è§äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥çœ‹çœ‹å½±å­é¡µé¢çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¢ç„¶æ˜¯â€œå½±å­â€ï¼Œé‚£ä¹ˆå°±è¦æ±‚è¿™äº›é¡µé¢åœ¨ä¿®æ”¹ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‹·è´ä¸€ä»½åŸå§‹é¡µé¢çš„æ•°æ®ï¼Œè¿™ä¸ªä»£ä»·æ˜¯å¾ˆé‡çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç±»ä¼¼B-Treeè¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªä¿®æ”¹ä¼šä¸€ç›´ä»ä¸‹å¾€ä¸Šè¿›è¡Œï¼Œè·¯å¾„ä¸­ç»è¿‡çš„èŠ‚ç‚¹éƒ½éœ€è¦ä¸€ä¸ªå½±å­é¡µé¢æ¥å­˜å‚¨ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;è¢«æ›¿æ¢çš„ä¸»é¡µé¢ä¼šäº§ç”Ÿç©ºé—²é¡µé¢ï¼Œå¯¹åº”çš„å°±éœ€è¦åƒåœ¾å›æ”¶ç­–ç•¥æŠŠè¿™äº›ç©ºé—²é¡µé¢ç»™å›æ”¶åˆ©ç”¨ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢å†…å®¹ä¼šç¢ç‰‡åŒ–ï¼Œå› ä¸ºå†™å…¥çš„å½±å­é¡µé¢å¯èƒ½æ˜¯æ–°å¢çš„ç‰©ç†é¡µé¢ï¼Œè¿˜å¯èƒ½æ˜¯è¢«å›æ”¶åˆ©ç”¨çš„ç©ºé—²é¡µé¢ï¼Œå¦‚æœé€»è¾‘ä¸Šç›¸é‚»çš„é¡µé¢åœ¨ç‰©ç†ä¸Šåˆ†æ•£ï¼Œå¯¹äºè¯»å†™ç¼“å­˜æ˜¯ä¸å‹å¥½çš„ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œå½“æ•°æ®è½ç›˜åˆ°å½±å­é¡µé¢æ—¶ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯é’ˆå¯¹æ–‡ä»¶çš„ä¸€ä¸ªéšæœºå†™ï¼Œéšæœºå†™çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„ï¼šéœ€è¦é¦–å…ˆå¯»å€åˆ°æŒ‡å®šä½ç½®ï¼Œç„¶åå†è¿›è¡Œä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;åŒä¸€æ—¶é—´ï¼Œåªå…è®¸æœ‰ä¸€ä¸ªå†™äº‹åŠ¡åœ¨è¿›è¡Œï¼Œå› ä¸ºå¦‚æœå­˜åœ¨å¤šä¸ªå†™äº‹åŠ¡ï¼Œè€Œä¸åŒå†™äº‹åŠ¡åˆä¿®æ”¹äº†åŒä¸€ä¸ªé¡µé¢çš„è¯ï¼Œæ˜¯æ— æ³•å¤„ç†çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡‡ç”¨å½±å­é¡µé¢çš„ä¾‹å­&#34;&gt;é‡‡ç”¨å½±å­é¡µé¢çš„ä¾‹å­&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰çš„åšå®¢ä¸­åˆ†æè¿‡boltdbçš„å®ç°ï¼Œä»¥åŠsqliteçš„journalå®ç°ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯å½±å­é¡µé¢çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200625-boltdb-1/&#34;&gt;boltdb 1.3.0å®ç°åˆ†æï¼ˆä¸€ï¼‰&lt;/a&gt;ï¼šåœ¨boltdbä¸­ï¼Œä¿®æ”¹é¡µé¢ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨mmapæœºåˆ¶å¤åˆ¶å‡ºæ¥å¾…ä¿®æ”¹çš„é¡µé¢ï¼Œä¿®æ”¹å®Œæ¯•ä¹‹åç»Ÿä¸€åˆ‡æ¢ä¸»é¡µé¢å’Œå½±å­é¡µé¢ï¼ŒåŒæ—¶å°†ä¿®æ”¹ä¹‹å‰çš„ä¸»é¡µé¢è®¾ç½®ä¸ºç©ºé—²é¡µé¢å¯ä¾›ä¸‹ä¸€æ¬¡å›æ”¶åˆ©ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶&lt;/a&gt;ï¼šsqliteçš„journalæ–‡ä»¶ï¼Œè´Ÿè´£å¤‡ä»½ä¿®æ”¹çš„é¡µé¢åœ¨ä¿®æ”¹å‰çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤ä¹‹åè¿™äº›å¤‡ä»½çš„æ•°æ®å°±æ— ç”¨äº†ï¼Œå¦‚æœä¸­é—´äº‹åŠ¡ä¸­æ–­å¯ä»¥ç›´æ¥ç”¨journalå¤‡ä»½æ–‡ä»¶çš„å†…å®¹æ¥æ¢å¤æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥ç”±è¿™ä¸¤ç¯‡æ–‡ç« äº†è§£æ›´è¯¦ç»†çš„å½±å­é¡µé¢çš„å®ç°ã€‚ä¸è¿‡ï¼Œå½±å­é¡µé¢æœºåˆ¶çš„ä½¿ç”¨å·²ç»ä¸å¤šï¼Œæ›´å¤šçš„æ˜¯ä¸‹é¢ä»‹ç»çš„WALã€‚&lt;/p&gt;
&lt;h2 id=&#34;walwrite-ahead-log&#34;&gt;WALï¼ˆWrite Ahead Logï¼‰&lt;/h2&gt;
&lt;p&gt;é™¤äº†shadow pagingç­–ç•¥ä»¥å¤–ï¼Œå¦ä¸€ç§ä¿å­˜ä¿®æ”¹çš„ç­–ç•¥å°±æ˜¯ä½¿ç”¨WALï¼ˆWrite Ahead Logï¼‰ï¼Œå¯¹æ¯”å‰è€…è€Œè¨€ï¼ŒWALæœ€å¤§çš„å¥½å¤„æ˜¯ï¼šç”±äºå°†ä¿®æ”¹æ·»åŠ åˆ°æ—¥å¿—ä¸­å°±å¯ä»¥è®¤ä¸ºä¿å­˜ä¿®æ”¹å®Œæˆï¼Œè€Œåœ¨æ–‡ä»¶å°¾è¿½åŠ ï¼ˆappendï¼‰æ“ä½œå¯¹æ¯”éšæœºå†™æ˜¯ç›¸å¯¹å¿«å¾ˆå¤šçš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªå†™äº‹åŠ¡è€Œè¨€ï¼Œå¦‚æœé‡‡ç”¨WALæœºåˆ¶ï¼ŒWALæ—¥å¿—çš„æ ¼å¼æœ‰ä»¥ä¸‹ä¸‰ç±»ï¼ˆåé¢è¿˜ä¼šæ‰©å±•ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡å¼€å§‹æ—¶ï¼Œå†™å…¥ä¸€æ¡&lt;code&gt;BEGIN&lt;/code&gt;è¡¨ç¤ºå†™äº‹åŠ¡å¼€å§‹ã€‚&lt;/li&gt;
&lt;li&gt;è®°å½•äº‹åŠ¡çš„ä¿®æ”¹æ“ä½œï¼šå¯¹äºå†™äº‹åŠ¡ä¸­çš„æ¯ä¸€æ¡ä¿®æ”¹æ“ä½œï¼Œéƒ½è¦è®°ä¸‹ä»¥ä¸‹å››ä¸ªæ•°æ®ï¼š
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡IDï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´è¿›è¡Œå¤šä¸ªå†™äº‹åŠ¡æ—¶ï¼Œå¯ä»¥çŸ¥é“å¯¹åº”çš„æ˜¯å“ªä¸ªäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹çš„é”®å€¼ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ä¹‹å‰çš„å€¼ï¼Œç”¨äºæ’¤æ‰äº‹åŠ¡æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ä¹‹åçš„å€¼ï¼Œç”¨äºé‡åšäº‹åŠ¡æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æäº¤æ—¶ï¼Œå†™å…¥ä¸€æ¡&lt;code&gt;COMMIT&lt;/code&gt;è¡¨ç¤ºäº‹åŠ¡ç»“æŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ä¸­æ¼”ç¤ºäº†ä¹‹å‰çš„ä¸¤ä¸ªå†™äº‹åŠ¡ä½¿ç”¨WALç­–ç•¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/wal.png&#34; alt=&#34;WAL&#34; title=&#34;WAL&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒæ—¶å¹¶å‘äº†ä¸¤ä¸ªå†™äº‹åŠ¡ï¼Œæ¯ä¸ªå†™äº‹åŠ¡çš„ä¸‰ç±»ä¸åŒçš„æ—¥å¿—ï¼Œéƒ½éœ€è¦å†™åˆ°å†…å­˜çš„buffer poolä¸­ï¼Œæ—¥å¿—çš„æ ¼å¼å·²ç»åœ¨ä¸Šé¢ç»™å‡ºæ¥ã€‚&lt;/li&gt;
&lt;li&gt;ç£ç›˜ä¸Šå­˜å‚¨çš„æ–‡ä»¶ï¼Œé™¤äº†ä¹‹å‰çš„æ•°æ®åº“æ–‡ä»¶ä¹‹å¤–ï¼Œæ–°å¢äº†ä¸€ä¸ªå«WALçš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸ä¼šéšæœºå†™ï¼Œåªä¼šæŒ‰ç…§buffer poolä¸­è®°å½•çš„æ—¥å¿—é¡ºåºæ·»åŠ åˆ°æ–‡ä»¶ç»“å°¾å¤„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå†™äº‹åŠ¡çš„æ“ä½œæ—¥å¿—ï¼Œé¦–å…ˆä¼šè®°å½•åˆ°buffer poolä¸­ï¼Œè€Œä¸å¿…ç«‹å³åŒæ­¥åˆ°walæ—¥å¿—ä¸­ï¼Œbuffer poolä¸­çš„æ—¥å¿—åŒæ­¥åˆ°walçš„æ“ä½œï¼Œå¯ä»¥æ‰¹é‡ä¸€æ¬¡æ€§å†™å¤šå¤šæ¡è®°å½•ï¼Œåˆè¿›ä¸€æ­¥æå‡äº†å†™æ“ä½œçš„æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨WALç­–ç•¥ä¹‹åï¼Œä¸€ä¸ªå†™æ“ä½œå®Œæˆä¸è¦æ±‚ä¸€å®šè¦å°†ä¿®æ”¹åŒæ­¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œåªéœ€è¦æ‰€æœ‰è¯¥äº‹åŠ¡çš„æ“ä½œéƒ½å†™å…¥WALæ–‡ä»¶å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå‰é¢æåˆ°&lt;code&gt;steal&lt;/code&gt;ä»¥åŠ&lt;code&gt;force&lt;/code&gt;è¿™ä¸¤ä¸ªç»´åº¦çš„ç­–ç•¥æ—¶ï¼Œéƒ½ä¸æ˜¯å¦éœ€è¦åŒæ­¥æ•°æ®åˆ°æŒä¹…åŒ–å­˜å‚¨æœ‰å…³ã€‚ä½†æ˜¯ï¼Œåœ¨WALä¸­ï¼Œç”±äºæ–°å¢äº†WALæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯ä¿å­˜åœ¨æŒä¹…åŒ–å­˜å‚¨ä¸­çš„ï¼Œæ‰€ä»¥&lt;code&gt;æŒä¹…åŒ–å­˜å‚¨&lt;/code&gt;æ–‡ä»¶è¿™ä¸ªæ¦‚å¿µçš„èŒƒç•´ï¼Œä»ä»…æœ‰æ•°æ®åº“æ–‡ä»¶ï¼Œæ‰©å±•åˆ°äº†æ•°æ®åº“æ–‡ä»¶å’ŒWALæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯ï¼Œä»ä¸Šé¢å¯¹WALçš„åˆ†æå¯ä»¥çœ‹åˆ°ï¼ŒWALæ˜¯&lt;code&gt;steal+no-force&lt;/code&gt;çš„ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stealï¼šå…è®¸æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æ“ä½œåŒæ­¥åˆ°ç£ç›˜çš„WALæ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;no-forceï¼šäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¿…é¡»æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½å†™å…¥ç£ç›˜çš„WALä¸­æ‰èƒ½æäº¤ï¼Œä½†å¹¶ä¸è¦æ±‚ä¸€å®šè¦è½å…¥æ•°æ®åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äº&lt;code&gt;æŒä¹…åŒ–å­˜å‚¨&lt;/code&gt;åŒ…æ‹¬äº†WALæ–‡ä»¶å’Œæ•°æ®åº“æ–‡ä»¶ï¼Œå³å¯ä»¥è®¤ä¸ºä»»æ„æ—¶åˆ»çš„æ•°æ®ä¸ºï¼š&lt;code&gt;æ•°æ®åº“æ–‡ä»¶&lt;/code&gt; + &lt;code&gt;WALä¸­çš„å·²æäº¤äº‹åŠ¡æ•°æ®&lt;/code&gt;ï¼Œäºæ˜¯æŸ¥è¯¢ä¸€ä¸ªæ•°æ®æ—¶å°±éœ€è¦åœ¨è¿™ä¸¤ç±»æ–‡ä»¶ä¸­ä¾æ¬¡æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆåˆ°WALä¸­æŸ¥è¯¢å·²æäº¤çš„äº‹åŠ¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç¬¬ä¸€æ­¥æ²¡æœ‰æŸ¥åˆ°ï¼Œè¯´æ˜WALä¸­å¹¶æ²¡æœ‰å¯¹è¿™ä¸ªæ•°æ®çš„ä¿®æ”¹ï¼Œäºæ˜¯åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­æŸ¥è¯¢æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä¸Šé¢å¯¹å½±å­é¡µé¢å’ŒWALçš„åˆ†æå¯ä»¥çœ‹å‡ºæ¥ï¼Œä»¥&lt;code&gt;steal&lt;/code&gt;å’Œ&lt;code&gt;force&lt;/code&gt;ä¸¤ä¸ªç­–ç•¥çš„ç»´åº¦ç»„åˆï¼ˆä¸€å…±å››ä¸ªç»„åˆï¼Œè§ä¸‹å›¾ï¼‰æ¥çœ‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œæ—¶æ•ˆç‡ï¼š&lt;code&gt;steal&lt;/code&gt; + &lt;code&gt;no-force&lt;/code&gt;æ˜¯æœ€å¿«çš„ï¼Œè€Œ&lt;code&gt;no-steal&lt;/code&gt; + &lt;code&gt;force&lt;/code&gt;åˆ™æ˜¯æœ€æ…¢çš„ã€‚&lt;/li&gt;
&lt;li&gt;æ¢å¤æ—¶æ•ˆç‡ï¼šå¯¹æ¯”è¿è¡Œæ—¶æ•ˆç‡ï¼Œæ¢å¤æ—¶çš„æ•ˆç‡å°±åè¿‡æ¥äº†ï¼Œ&lt;code&gt;steal&lt;/code&gt; + &lt;code&gt;no-force&lt;/code&gt;æ˜¯æœ€æ…¢çš„ï¼Œè€Œ&lt;code&gt;no-steal&lt;/code&gt; + &lt;code&gt;force&lt;/code&gt;åˆ™æ˜¯æœ€å¿«çš„ï¼ŒåŸå› åœ¨äºå‰è€…éœ€è¦æ‰§è¡Œ&lt;code&gt;undo&lt;/code&gt;ã€&lt;code&gt;redo&lt;/code&gt;æ“ä½œï¼Œè€Œåè€…åˆ™ä¸éœ€è¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/policies.png&#34; alt=&#34;policies&#34; title=&#34;policies&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;checkpointæ£€æŸ¥ç‚¹&#34;&gt;Checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰&lt;/h2&gt;
&lt;p&gt;å‰é¢æåˆ°è¿‡ï¼Œé‡‡ç”¨äº†WALç­–ç•¥çš„æ•°æ®åº“ï¼Œä»»æ„æ—¶åˆ»çš„æ•°æ®ä¸ºï¼š&lt;code&gt;æ•°æ®åº“æ–‡ä»¶&lt;/code&gt; + &lt;code&gt;WALä¸­çš„å·²æäº¤äº‹åŠ¡æ•°æ®&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯WALæ–‡ä»¶ä¸å¯èƒ½ä¸€ç›´å¢é•¿ä¸‹å»ï¼Œå¦åˆ™ä¸€æ¥æ–‡ä»¶å¤ªå¤§ï¼Œå¯¼è‡´å½±å“è¯»æ€§èƒ½ï¼ŒäºŒæ¥æ•°æ®æ¢å¤çš„æ—¶å€™æ—¶é—´è¿‡é•¿ã€‚æ‰€ä»¥ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œéƒ½éœ€è¦å°†WALæ–‡ä»¶ä¸­çš„å·²æäº¤äº‹åŠ¡æ•°æ®è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæµç¨‹è¢«ç§°ä¸º&lt;code&gt;checkpoint&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åš&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œï¼Œéœ€è¦æ–°å¢ä¸€ç±»&lt;code&gt;checkpoint&lt;/code&gt;æ—¥å¿—ï¼Œç»“åˆå‰é¢æåˆ°çš„å‡ ç±»WALæ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡å¼€å§‹æ—¶ï¼Œå†™å…¥ä¸€æ¡&lt;code&gt;BEGIN&lt;/code&gt;è¡¨ç¤ºå†™äº‹åŠ¡å¼€å§‹ã€‚&lt;/li&gt;
&lt;li&gt;è®°å½•äº‹åŠ¡çš„ä¿®æ”¹æ“ä½œï¼šå¯¹äºå†™äº‹åŠ¡ä¸­çš„æ¯ä¸€æ¡ä¿®æ”¹æ“ä½œï¼Œéƒ½è¦è®°ä¸‹ä»¥ä¸‹å››ä¸ªæ•°æ®ï¼š
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡IDï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´è¿›è¡Œå¤šä¸ªå†™äº‹åŠ¡æ—¶ï¼Œå¯ä»¥çŸ¥é“å¯¹åº”çš„æ˜¯å“ªä¸ªäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹çš„é”®å€¼ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ä¹‹å‰çš„å€¼ï¼Œç”¨äºæ’¤æ‰äº‹åŠ¡æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ä¹‹åçš„å€¼ï¼Œç”¨äºé‡åšäº‹åŠ¡æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æäº¤æ—¶ï¼Œå†™å…¥ä¸€æ¡&lt;code&gt;COMMIT&lt;/code&gt;è¡¨ç¤ºäº‹åŠ¡ç»“æŸã€‚&lt;/li&gt;
&lt;li&gt;åš&lt;code&gt;checkpoint&lt;/code&gt;æ—¶ï¼Œå†™å…¥ä¸€æ¡&lt;code&gt;CHECKPOINT&lt;/code&gt;è¡¨ç¤ºåœ¨è¿™ä¸ªç‚¹åšäº†&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥çœ‹çœ‹æœ‰äº†&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œä¹‹åï¼Œå¦‚ä½•å¤„ç†æ¢å¤é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220514-weekly-15/checkpoint.png&#34; alt=&#34;checkpoint&#34; title=&#34;checkpoint&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡T1æäº¤ä¹‹åï¼Œåˆå¼€å§‹äº†äº‹åŠ¡T2ã€T3ï¼Œåœ¨T2ã€T3æœªæäº¤ä¹‹å‰ï¼Œå¼€å§‹äº†ä¸€ä¸ª&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;checkpoint&lt;/code&gt;å®Œæˆä¹‹åï¼ŒT2å®Œæˆæäº¤ã€‚ä½†æ˜¯åœ¨T3ä¿®æ”¹ä¹‹åï¼Œå°±å‘ç”Ÿäº†å®•æœºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œå¦‚æœè¿›è¡Œæ•°æ®æ¢å¤çš„è¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ–‡ä»¶ä¸­å·²ç»æœ‰äº‹åŠ¡T1çš„ä¿®æ”¹äº†ï¼Œå› ä¸ºT1æ˜¯åœ¨&lt;code&gt;checkpoint&lt;/code&gt;ä¹‹å‰æäº¤çš„äº‹åŠ¡ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ä¼šåœ¨&lt;code&gt;checkpoint&lt;/code&gt;çš„æ—¶å€™åŒæ­¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯T2ã€T3è¿™ä¸¤ä¸ªåœ¨&lt;code&gt;checkpoint&lt;/code&gt;æ—¶è¿˜æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¹¶ä¸ä¼šåœ¨è¿™ä¸€æ¬¡&lt;code&gt;checkpoint&lt;/code&gt;æ—¶åŒæ­¥åˆ°æ•°æ®åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºWALä¸­å­˜åœ¨äº‹åŠ¡T2çš„&lt;code&gt;COMMIT&lt;/code&gt;æ—¥å¿—ï¼Œè¡¨ç¤ºäº‹åŠ¡T2å·²ç»å®Œæˆæäº¤ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿæ¢å¤æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰¾åˆ°å´©æºƒä¹‹å‰æœ€åä¸€æ¬¡&lt;code&gt;checkpoint&lt;/code&gt;çš„ä½ç½®ï¼Œé’ˆå¯¹è¿™ä¸ª&lt;code&gt;checkpoint&lt;/code&gt;ä¹‹åçš„æ—¥å¿—ï¼Œè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå­˜åœ¨&lt;code&gt;COMMIT&lt;/code&gt;æ—¥å¿—çš„äº‹åŠ¡ï¼Œæ¯”å¦‚äº‹åŠ¡T2ï¼Œåªéœ€é‡æ”¾å…¶WALæ—¥å¿—å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºä¸å­˜åœ¨&lt;code&gt;COMMIT&lt;/code&gt;æ—¥å¿—çš„äº‹åŠ¡ï¼Œæ¯”å¦‚äº‹åŠ¡T3ï¼Œä¸èƒ½é‡æ”¾è¿™ä¸ªäº‹åŠ¡ï¼Œå› ä¸ºåœ¨å´©æºƒä¹‹å‰æ²¡æœ‰è½ç›˜æ‰€æœ‰çš„ä¿®æ”¹åœ¨WALä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;checkpoint&lt;/code&gt;æµç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼šè¦æ±‚&lt;code&gt;checkpoint&lt;/code&gt;åœ¨è¿›è¡Œçš„æ—¶å€™ï¼Œä¸å¾—æœ‰ä»»ä½•çš„å†™äº‹åŠ¡åœ¨è¿›è¡Œï¼Œæ¢è¨€ä¹‹&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œä¼šå½±å“å†™äº‹åŠ¡çš„è¿›è¡Œã€‚æ‰€ä»¥ï¼Œå¦‚æœ&lt;code&gt;checkpoint&lt;/code&gt;çš„é¢‘ç‡å¤ªé«˜ï¼Œå½±å“å†™äº‹åŠ¡ï¼›é¢‘ç‡å¤ªä½ï¼Œåˆä¼šè®©å•æ¬¡&lt;code&gt;checkpoint&lt;/code&gt;æ—¶é—´å¾ˆé•¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æœŸå‘¨åˆŠä¼šåœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»ARIESè®ºæ–‡çš„æ€æƒ³ï¼Œè®ºæ–‡ä¸­ç»™å‡ºäº†&lt;code&gt;checkpoint&lt;/code&gt;çš„ä¼˜åŒ–åšæ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨walçš„ä¾‹å­&#34;&gt;ä½¿ç”¨WALçš„ä¾‹å­&lt;/h2&gt;
&lt;p&gt;åœ¨sqliteçš„3.7.0ç‰ˆæœ¬ä¹‹åï¼Œå°±é‡‡ç”¨äº†WALæœºåˆ¶ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡æ–‡ç« åˆ†æï¼Œè§&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‰ç…§è½ç›˜çš„ç­–ç•¥ï¼Œåˆ†ä¸ºäº†&lt;code&gt;steal&lt;/code&gt;å’Œ&lt;code&gt;force&lt;/code&gt;è¿™ä¸¤ä¸ªç»´åº¦ã€‚&lt;/li&gt;
&lt;li&gt;shadow pageé‡‡ç”¨çš„æ˜¯&lt;code&gt;no-steal+force&lt;/code&gt;ç­–ç•¥ï¼Œè€ŒWALé‡‡ç”¨çš„æ˜¯&lt;code&gt;steal+no-force&lt;/code&gt;ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¶ä»–æ¨è&#34;&gt;å…¶ä»–æ¨è&lt;/h1&gt;
&lt;h2 id=&#34;çº³ç“¦å°”å®å…¸&#34;&gt;ã€Šçº³ç“¦å°”å®å…¸ã€‹&lt;/h2&gt;
&lt;p&gt;ã€Šçº³ç“¦å°”å®å…¸ã€‹æ˜¯æŠ•èµ„äºº&lt;a href=&#34;https://twitter.com/naval&#34;&gt;Naval Ravikant&lt;/a&gt;çš„ç®´è¨€è®°å½•ï¼Œæœ€æ—©çŸ¥é“æ­¤äººæ˜¯å› ä¸ºä»–çš„é‚£ç¯‡è¢«å’Œèœå¤´ç¿»è¯‘æˆä¸­æ–‡çš„æ–‡ç« ã€Šå¦‚ä½•ä¸é è¿æ°”è‡´å¯Œã€‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸­æ–‡ç‰ˆï¼š&lt;a href=&#34;https://mp.weixin.qq.com/s/TfhBCbr8-IoHyPKtB3hTlw&#34;&gt;Navalï¼šå¦‚ä½•ä¸é è¿æ°”è‡´å¯Œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è‹±æ–‡ç‰ˆï¼š&lt;a href=&#34;https://twitter.com/naval/status/1002103360646823936&#34;&gt;Naval on Twitter: &amp;ldquo;How to Get Rich (without getting lucky):&amp;rdquo; / Twitter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†åæ¥ï¼Œ &lt;a href=&#34;https://ejorgenson.com/&#34;&gt;Eric Jorgenson&lt;/a&gt;å°†Navalçš„æ¨ç‰¹æ–‡å­—æ•´ç†æˆäº†ã€ŠAlmanack of Naval Ravikantã€‹ï¼Œå…è´¹ç”µå­ç‰ˆåœ¨ç½‘ä¸Šå®Œå…¨å…¬å¼€ï¼š&lt;a href=&#34;https://www.navalmanack.com/&#34;&gt;Almanack of Naval Ravikant&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ï¼Œä¸­æ–‡ç‰ˆçš„ã€Šçº³ç“¦å°”å®å…¸ã€‹ä¹Ÿè¢«ç¿»è¯‘å‡ºç‰ˆäº†ï¼š&lt;a href=&#34;https://book.douban.com/subject/35876121/&#34;&gt;çº³ç“¦å°”å®å…¸ (è±†ç“£)&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;cè¯­è¨€ç¼–ç¨‹é€è§†&#34;&gt;ã€ŠCè¯­è¨€ç¼–ç¨‹é€è§†ã€‹&lt;/h2&gt;
&lt;p&gt;Cçš„è¯­æ³•ç³–ä¸å¤šï¼Œè¯­æ³•å±‚é¢è¦å­¦ä¹ çš„ä¸œè¥¿ä¹Ÿå®åœ¨ä¸å¤šï¼Œä½†æ˜¯Cçš„éš¾ç‚¹ä¸»è¦æ˜¯å’Œç³»ç»Ÿæ‰“äº¤é“å±‚é¢çš„ï¼Œè¿™ç¯‡æ–‡æ¡£å°±ä¸“æ³¨åœ¨è¿™æ–¹é¢çš„è§£é‡Šä¸Šï¼Œç®—æ˜¯è¿™æ–¹é¢æ¯”è¾ƒå°‘è§çš„æ–‡æ¡£äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tinylab-1.gitbook.io/cbook/&#34;&gt;ç®€ä»‹ - C è¯­è¨€ç¼–ç¨‹é€è§†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;githubåœ°å€ï¼šhttps://github.com/tinyclub/open-c-book&lt;/p&gt;
&lt;h2 id=&#34;rust-databend-and-the-cloud-warehouse5ä»-git-åˆ°-fuse-engine-å­˜å‚¨å¼•æ“&#34;&gt;ã€ŠRust, Databend and the Cloud Warehouseï¼ˆ5ï¼‰ä» Git åˆ° Fuse Engine å­˜å‚¨å¼•æ“ã€‹&lt;/h2&gt;
&lt;p&gt;è™å“¥çš„å¤§ä½œ&lt;a href=&#34;https://bohutang.me/2022/05/06/databend-cloud-warehouse-fuse-engine/&#34;&gt;Rust, Databend and the Cloud Warehouseï¼ˆ5ï¼‰ä» Git åˆ° Fuse Engine å­˜å‚¨å¼•æ“ [ è™å“¥çš„åšå®¢ ]&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;è¿™åä¸šä½™ç¨‹åºå‘˜æ›¾ç”¨50å¼ 1080tiå¯¹æŠ—ç™Œç—‡&#34;&gt;è¿™åâ€œä¸šä½™â€ç¨‹åºå‘˜ï¼Œæ›¾ç”¨50å¼ 1080Tiå¯¹æŠ—ç™Œç—‡ã€‚&lt;/h2&gt;
&lt;p&gt;ä¸€ä½ä¸šä½™ç¨‹åºå‘˜ï¼Œä½¿ç”¨äººå·¥æ™ºèƒ½çš„ç®—æ³•æ¥è¯†åˆ«è‚¿ç˜¤ï¼Œå¾ˆä½©æœä»–çš„è¡ŒåŠ¨åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/2zNoWtOHdwC0nNnT0d_WBQ&#34;&gt;è¿™åâ€œä¸šä½™â€ç¨‹åºå‘˜ï¼Œæ›¾ç”¨50å¼ 1080Tiå¯¹æŠ—ç™Œç—‡ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…åœ¨V2EXçš„åŸè´´ï¼š&lt;a href=&#34;https://www.v2ex.com/t/843341&#34;&gt;è®°å¾— 4 å¹´å‰æˆ‘åšçš„ AI ä¹³è…ºå¹³å°å—ï¼Ÿè¿™æ˜¯æˆ‘çš„æ–°é¡¹ç›® - V2EX&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å››å¹´å‰çš„åŸè´´ï¼š&lt;a href=&#34;https://www.v2ex.com/t/462641#reply303&#34;&gt;åœ¨ D ç‰ˆå‘è¿‡äº†ï¼Œä¸è¿‡å› ä¸ºä¸å°‘æœ‹å‹çœ‹ä¸åˆ° D ç‰ˆï¼Œæˆ‘å°±æ”¾åœ¨è¿™é‡Œå§ï¼Œè¯´è¯´æˆ‘æœ€è¿‘åšçš„è¿™ä¸ª Project - V2EX&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>å‘¨åˆŠï¼ˆç¬¬12æœŸï¼‰ï¼šPage orientedç±»å­˜å‚¨å¼•æ“é‡Œå¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§ç»“æ„</title>
      <link>https://www.codedump.info/post/20220410-weekly-12/</link>
      <pubDate>Sun, 10 Apr 2022 11:38:16 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20220410-weekly-12/</guid>
      
      <description>&lt;hr&gt;
&lt;p&gt;å¼•è¨€ï¼šæœ¬æœŸèŠä¸€èŠPage orientedç±»å­˜å‚¨å¼•æ“å†…çš„æ•°æ®ç»“æ„ç»„ç»‡ã€‚åœ¨æ»¡è¶³â€œå‘ç£ç›˜è¯»å†™çš„åŸºæœ¬å•ä½æ˜¯ç‰©ç†é¡µé¢â€è¿™ä¸ªå¤§å‰æä¸‹ï¼Œè¿™ç±»å­˜å‚¨å¼•æ“çš„å¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§ç»“æ„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;page-orientedç±»å­˜å‚¨å¼•æ“é‡Œå¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§æ ‘å½¢ç»“æ„&#34;&gt;page orientedç±»å­˜å‚¨å¼•æ“é‡Œå¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§æ ‘å½¢ç»“æ„&lt;/h1&gt;
&lt;h2 id=&#34;å­˜å‚¨å¼•æ“çš„åˆ†ç±»&#34;&gt;å­˜å‚¨å¼•æ“çš„åˆ†ç±»&lt;/h2&gt;
&lt;p&gt;ç›®å‰æ¥è§¦åˆ°çš„å­˜å‚¨å¼•æ“ï¼Œä»¥å‘ç£ç›˜è¯»å†™æ–¹å¼æ¥åˆ†ç±»çš„è¯ï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LSM-Treeç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;Page orientedç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;LSM-Treeæ˜¯â€œLog-Structured Merge-Treeâ€çš„ç®€ç§°ï¼Œè¿™ç±»å­˜å‚¨å¼•æ“å†™å…¥ä¸€æ¡æ•°æ®çš„æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘å†…å­˜ä»¥åŠWALæ—¥å¿—ä¸­å†™å…¥å®Œæˆï¼Œå³å¯è®¤ä¸ºå†™å…¥æˆåŠŸã€‚&lt;/li&gt;
&lt;li&gt;å†…å­˜ä¸­çš„æ•°æ®å†™æ»¡ä¹‹åï¼Œå°†è½ç›˜åˆ°æ‰€è°“çš„sstableä¸­ã€‚&lt;/li&gt;
&lt;li&gt;sstableåˆ†ä¸ºå¤šå±‚ï¼Œéšç€å†™å…¥è¿›è¡Œï¼Œä¸åŒå±‚æ¬¡çš„sstableæ•°æ®å°†è¿›è¡Œåˆå¹¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220410-weekly-12/LSM.jpeg&#34; alt=&#34;LSM&#34; title=&#34;LSM&#34;&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆå›¾ç‰‡å¼•ç”¨è‡ª&lt;a href=&#34;https://zhuanlan.zhihu.com/p/181498475&#34;&gt;LSMæ ‘è¯¦è§£ - çŸ¥ä¹&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢ç®€å•çš„å†™å…¥LSMçš„æµç¨‹å¯ä»¥çœ‹åˆ°ï¼šæ— è®ºæ˜¯å†™å…¥å†…å­˜è¿˜æ˜¯ç£ç›˜ï¼Œè¿™ç±»å­˜å‚¨å¼•æ“åœ¨å†™å…¥æ–°æ•°æ®æ—¶ï¼ˆä¸æ˜¯åˆå¹¶sstableæµç¨‹ï¼‰ï¼Œç£ç›˜æ“ä½œçš„å•ä½æ˜¯ä¸€æ¡è®°å½•ã€‚è€Œä¸€æ¡è®°å½•çš„é•¿åº¦ï¼Œæ˜¯ä¸å®šé•¿çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸LSM-Treeç±»çš„ç»“æ„ä¸åŒçš„æ˜¯ï¼ŒPage orientedç±»çš„å­˜å‚¨å¼•æ“ï¼Œå‘ç£ç›˜å‘èµ·è¯»å†™æ“ä½œçš„åŸºæœ¬å•ä½æ˜¯é¡µé¢ï¼ˆpageï¼‰ï¼Œä¸€ä¸ªé¡µé¢é€šå¸¸çš„å¤§å°æ˜¯2çš„æ¬¡æ–¹ï¼Œæœ€å°ä¸€èˆ¬æ˜¯1024å­—èŠ‚ï¼Œæ¯”å¦‚sqliteçš„å­˜å‚¨ï¼Œå…¶é¡µé¢å¤§å°ä¸º4Kï¼ˆå¯ä»¥ä¿®æ”¹ç¼–è¯‘é€‰é¡¹é…ç½®é¡µé¢å¤§å°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸€ä¸ªç‰©ç†é¡µé¢ä¸ºè¯»å†™ç£ç›˜çš„åŸºæœ¬å•ä½ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸€ç±»å­˜å‚¨å¼•æ“ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€Page orientedç±»å­˜å‚¨å¼•æ“â€œçš„åŸå› ã€‚æœ¬æ–‡é‡ç‚¹æ˜¯ä»‹ç»Page orientedç±»å­˜å‚¨å¼•æ“çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;page-orientedå­˜å‚¨å¼•æ“çš„ç»“æ„&#34;&gt;Page orientedå­˜å‚¨å¼•æ“çš„ç»“æ„&lt;/h2&gt;
&lt;p&gt;è¿˜æ˜¯ä»¥ä¹‹å‰ä»‹ç»è¿‡çš„sqliteçš„æ¶æ„å›¾æ¥å¼€å¤´ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/btree-arch.png&#34; alt=&#34;btreeæ¶æ„&#34; title=&#34;btreeæ¶æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¶æ„ç”±ä¸‹å¾€ä¸Šä¾æ¬¡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿå±‚ï¼šæä¾›ä¸åŒç³»ç»Ÿçº§APIçš„å°è£…ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€åŠ è§£é”æ“ä½œç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ç‰©ç†é¡µé¢ç®¡ç†å±‚ï¼šæä¾›ç‰©ç†é¡µé¢è¯»å†™ã€ç¼“å­˜ç­‰åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æ ‘å½¢ç»“æ„çš„å®ç°ï¼šæ ¹æ®å…·ä½“çš„æ ‘å½¢ç®—æ³•ï¼Œç»„ç»‡ç‰©ç†é¡µé¢ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼ˆæ¯”å¦‚çˆ¶å­é¡µé¢ã€å…„å¼Ÿé¡µé¢ï¼‰ï¼Œä»¥åŠå•ä¸ªç‰©ç†é¡µé¢ä¹‹å†…çš„æ•°æ®çš„ç»„ç»‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œçš„é‡ç‚¹æ˜¯é¡µé¢ç®¡ç†å±‚å’Œæ ‘å½¢ç»“æ„çš„å®ç°è¿™ä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‰©ç†é¡µé¢ç®¡ç†ç›¸å½“äºæ˜¯ç£ç›˜æ–‡ä»¶çš„â€åŸææ–™ä¾›åº”å•†â€œï¼Œè´Ÿè´£å¯¹å®ƒçš„å®¢æˆ·ä¹Ÿå°±æ˜¯å„ç§ä¸åŒç»“æ„çš„å®ç°æä¾›ç‰©ç†é¡µé¢è¿™ä¸€â€åŸææ–™â€œçš„è¯»å†™ã€ç¼“å­˜ç®¡ç†ï¼Œè€Œå®ƒå¯¹è¿™äº›ææ–™è¢«å®¢æˆ·æ‹¿å»åšæˆäº†ä»€ä¹ˆï¼Œä¸€æ— æ‰€çŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;æ ‘å½¢ç»“æ„çš„å®ç°ï¼Œä»é¡µé¢ç®¡ç†å™¨æ‹¿åˆ°äº†â€ç‰©ç†é¡µé¢â€œè¿™ä¸ªåŸææ–™ä¹‹åï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„ç®—æ³•å’Œæ•°æ®ç»“æ„ä»»æ„å¡‘é€ æˆä»»ä½•åˆç†çš„ç»“æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/database-file.png&#34; alt=&#34;æ•°æ®åº“æ–‡ä»¶çš„ç‰©ç†é¡µé¢ç»„ç»‡å’Œé€»è¾‘é¡µé¢ç»“æ„&#34; title=&#34;æ•°æ®åº“æ–‡ä»¶çš„ç‰©ç†é¡µé¢ç»„ç»‡å’Œé€»è¾‘é¡µé¢ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒPage orientedå­˜å‚¨å¼•æ“ï¼Œåœ¨æ»¡è¶³â€œå‘ç£ç›˜è¯»å†™çš„åŸºæœ¬å•ä½æ˜¯ç‰©ç†é¡µé¢â€è¿™ä¸ªå¤§å‰æä¸‹ï¼Œè¿™ç±»å­˜å‚¨å¼•æ“çš„å¯èƒ½åŒæ—¶å­˜åœ¨å¤šç§ç»“æ„ï¼šå¯èƒ½åªæœ‰B-Treeï¼Œä¹Ÿå¯èƒ½åªæœ‰B+Treeã€‚è¿˜æœ‰å¦ä¸€ç§æƒ…å†µæ˜¯ï¼šè¿™ç±»å­˜å‚¨å¼•æ“å†…éƒ¨åŒæ—¶å­˜åœ¨å¤šç§ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥sqliteä¸ºä¾‹ï¼Œå†…éƒ¨å…¶å®å°±å­˜åœ¨ä¸¤ç§ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨ç´¢å¼•çš„index treeï¼šç»“æ„ä¸ºB-Treeï¼Œé”®ä¸ºè¡¨ç´¢å¼•ï¼Œå€¼ä¸ºè¿™ä¸€è¡Œæ•°æ®çš„&lt;code&gt;rowid&lt;/code&gt;ï¼Œå…¶ä¸­&lt;code&gt;rowid&lt;/code&gt;ä¸ºéšè—åˆ—ï¼Œåˆ›å»ºæ•°æ®è¡¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œè¿™ä¸€åˆ—æ˜¯è‡ªå¢æ•´æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨æ•°æ®çš„table treeï¼šç»“æ„ä¸ºB+Treeï¼Œé”®ä¸º&lt;code&gt;rowid&lt;/code&gt;ï¼Œå€¼ä¸ºä¸€è¡Œæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ç±»å­˜å‚¨å¼•æ“ï¼Œç”±äºåŒå±äºâ€œPage orientedç±»å­˜å‚¨å¼•æ“â€ï¼Œå› æ­¤å¯ä»¥å…±ç”¨åŒä¸€ä¸ªç‰©ç†é¡µé¢ç®¡ç†å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/btree-rowid.png&#34; alt=&#34;æ•°æ®åº“æ–‡ä»¶çš„rowidå…¨é‡æ•°æ®è¡¨å’Œç´¢å¼•è¡¨&#34; title=&#34;æ•°æ®åº“æ–‡ä»¶çš„rowidå…¨é‡æ•°æ®è¡¨å’Œç´¢å¼•è¡¨&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ï¼Œä»¥sqliteä¸­çš„ä¸€ä¸ªè¡¨ä¸ºä¾‹æ¥è§£é‡Šä¸Šé¢è¿™ä¸ªæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªè¡¨ä»¥åŠç´¢å¼•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;&#34;&gt;åˆ›å»ºæ•°æ®åº“&lt;/span&gt;COMPANY&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;COMPANY(&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;   &lt;/span&gt;ID&lt;span style=&#34;color:#bbb&#34;&gt;             &lt;/span&gt;&lt;span style=&#34;color:#a2f&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NOT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NULL&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;   &lt;/span&gt;NAME&lt;span style=&#34;color:#bbb&#34;&gt;           &lt;/span&gt;&lt;span style=&#34;color:#a2f&#34;&gt;TEXT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NOT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NULL&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;   &lt;/span&gt;AGE&lt;span style=&#34;color:#bbb&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#a2f&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;     &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NOT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;NULL&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;&#34;&gt;åˆ›å»ºç´¢å¼•&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;INDEX&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;id_index&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;ON&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;COMPANY&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;(id);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢è¿™ä¸ªå»ºè¡¨ä»¥åŠåˆ›å»ºç´¢å¼•ä¹‹åï¼Œå¯¹åº”çš„åœ¨è¿™ä¸ªæ•°æ®æ–‡ä»¶ä¸­å°±æœ‰äº†ä¸¤ä¸ªæ ‘å½¢ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨&lt;code&gt;COMPANY&lt;/code&gt;è¡¨æ•°æ®çš„table-treeã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨ç´¢å¼•&lt;code&gt;id&lt;/code&gt;åˆ°&lt;code&gt;rowid&lt;/code&gt;å…³ç³»çš„index-treeã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå‘è¿™ä¸ªè¡¨æ’å…¥æ•°æ®ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;INSERT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;INTO&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;COMPANY&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;(ID,NAME,AGE)&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;VALUES&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#b44&#34;&gt;&amp;#39;Paul&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆï¼Œè¿™ä¸ªæ’å…¥æ“ä½œèƒŒåå®é™…å¯¹åº”äº†å‘è¿™ä¸¤æ£µæ ‘çš„æ’å…¥æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œå°†è¿™ä¸€è¡Œæ•°æ®æ’å…¥åˆ°table-treeä¸­ï¼ŒåŒæ—¶å¾—åˆ°&lt;code&gt;rowid&lt;/code&gt;ä»¥åŠæ’å…¥æ—¶å€™çš„&lt;code&gt;id&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†å°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„&lt;code&gt;rowid&lt;/code&gt;ä»¥åŠ&lt;code&gt;id&lt;/code&gt;æ’å…¥åˆ°index-treeä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨&lt;code&gt;id_index&lt;/code&gt;ç´¢å¼•æ¥æŸ¥è¯¢&lt;code&gt;COMPANY&lt;/code&gt;è¡¨ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;select&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;from&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;COMPANY&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;id&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæŸ¥è¯¢æ“ä½œä¹Ÿå®é™…ä¸Šç»è¿‡äº†ä¸Šé¢è¿™ä¸¤ä¸ªè¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œé€šè¿‡å­˜å‚¨&lt;code&gt;id_index&lt;/code&gt;åˆ°&lt;code&gt;rowid&lt;/code&gt;å…³ç³»çš„index-treeï¼Œæ‰¾åˆ°&lt;code&gt;id=1&lt;/code&gt;å¯¹åº”çš„&lt;code&gt;rowid&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œå†æ ¹æ®ç¬¬ä¸€æ­¥å¾—åˆ°çš„&lt;code&gt;rowid&lt;/code&gt;åˆ°table-treeä¸­æŸ¥è¯¢åˆ°è¿™ä¸€è¡Œæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨å¼•æ“ï¼ŒæŒ‰ç…§å¯¹ç£ç›˜è¯»å†™æ–¹å¼çš„ä¸åŒï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š
&lt;ul&gt;
&lt;li&gt;LSM-Treeï¼šå†™ç£ç›˜çš„åŸºæœ¬å•ä½æ˜¯ä¸€æ¡è®°å½•ï¼Œè€Œä¸€æ¡è®°å½•å¤§å°æ˜¯ä¸å®šé•¿çš„ã€‚&lt;/li&gt;
&lt;li&gt;Page orientedï¼šè¯»å†™ç£ç›˜çš„åŸºæœ¬å•ä½æ˜¯é¡µé¢ï¼Œé¡µé¢å¤§å°ä¸º2çš„æ¬¡æ–¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;â€œPage orientedâ€ç±»å­˜å‚¨å¼•æ“çš„æ ¸å¿ƒæ¨¡å—æ˜¯é¡µé¢ç®¡ç†å™¨å’Œæ ‘å½¢ç»“æ„çš„å®ç°ï¼Œå‰è€…æä¾›ç‰©ç†é¡µé¢è¿™ä¸€â€œåŸææ–™â€çš„è¯»å†™æ“ä½œï¼Œå¯¹é¡µé¢å†…éƒ¨çš„ç»“æ„ä¸€æ— æ‰€çŸ¥ï¼›åè€…ç»„ç»‡ç®¡ç†ç‰©ç†é¡µé¢é—´çš„é€»è¾‘å…³ç³»ï¼Œä»¥åŠç‰©ç†é¡µé¢å†…éƒ¨çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ»¡è¶³â€œè¯»å†™ç£ç›˜çš„åŸºæœ¬å•ä½æ˜¯é¡µé¢â€çš„å¤§å‰æä¸‹ï¼Œâ€œPage orientedâ€ç±»å­˜å‚¨å¼•æ“å¯ä»¥ä½¿ç”¨å„ç§æ ‘å½¢ç»“æ„ï¼Œè¿˜å¯èƒ½åœ¨åŒä¸€ä¸ªå­˜å‚¨å¼•æ“ä¸­åŒæ—¶å­˜åœ¨å¤šç§æ ‘å½¢ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;sqliteçš„å®ç°ï¼Œå†…éƒ¨å­˜åœ¨ä¸¤ç§ä¸åŒçš„æ ‘å½¢ç»“æ„ï¼šä½¿ç”¨B-Treeæ¥ç®¡ç†ç´¢å¼•æ•°æ®ï¼Œä»¥B+Treeæ¥ç®¡ç†è¡¨æ•°æ®ã€‚è¿™æ˜¯å› ä¸ºï¼š
&lt;ul&gt;
&lt;li&gt;ç´¢å¼•æ•°æ®çš„å€¼åªæœ‰&lt;code&gt;rowid&lt;/code&gt;è¿™æ ·çš„æ•´å‹æ•°æ®ï¼Œæ‰€ä»¥å•ä¸ªç‰©ç†é¡µé¢å†…èƒ½å­˜å‚¨æ›´å¤šçš„ç´¢å¼•æ•°æ®ï¼Œé€‚åˆä½¿ç”¨B-Treeè¿™æ ·â€œé«˜è€Œç˜¦â€çš„ç»“æ„æ¥ç®¡ç†è¿™ç±»å•æ¡æ•°æ®å¾ˆå°çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;è€ŒB+Treeçš„æ ‘å½¢ç»“æ„æ˜¯â€œçŸ®è€Œèƒ–â€çš„ç»“æ„ï¼Œæ›´é€‚åˆå­˜å‚¨ç®¡ç†å¤šç§ä¸å®šé•¿çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¶ä»–æ¨è&#34;&gt;å…¶ä»–æ¨è&lt;/h1&gt;
&lt;h2 id=&#34;gitçš„ç¬¬ä¸€ç‰ˆ&#34;&gt;Gitçš„ç¬¬ä¸€ç‰ˆ&lt;/h2&gt;
&lt;p&gt;2005å¹´4æœˆ6æ—¥ï¼ŒGitå‘å¸ƒäº†ç¬¬ä¸€ç‰ˆã€‚Gitæ— ç–‘æ˜¯æœ€ä¼Ÿå¤§çš„å¼€æºè½¯ä»¶ä¹‹ä¸€ï¼Œå®ƒçš„å‡ºç°æå¤§æ”¹å˜äº†å¼€æºè½¯ä»¶çš„åä½œã€å¼€å‘æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®è¿™é‡Œçš„â€œå²æ–™â€ï¼ˆ &lt;a href=&#34;https://www.ithome.com.tw/news/95088&#34;&gt;Gitåæ­²äº†ï¼Gitä¹‹çˆ¶Linus Torvaldsèªªå¤ï¼Œå¤§è«‡Gité–‹ç™¼ç§˜è¾› | iThome&lt;/a&gt; ï¼‰è®°è½½ï¼šLinusæœ€åˆåªèŠ±äº†10å¤©å°±å†™å‡ºäº†ç¬¬ä¸€ç‰ˆå¯ä»¥è·‘çš„Gitäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨rustç¼–å†™grpcæœåŠ¡çš„åˆå­¦è€…æŒ‡å—&#34;&gt;ä½¿ç”¨Rustç¼–å†™gRPCæœåŠ¡çš„åˆå­¦è€…æŒ‡å—&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨ä½¿ç”¨Rustç¼–å†™gRPCæœåŠ¡ï¼Œè¿™ç¯‡æ•™ç¨‹è®²è§£äº†è¿™éƒ¨åˆ†å†…å®¹ï¼ŒåŒ…æ‹¬ä¸€åº”ä¸€ç­”æ¨¡å¼ã€å•å‘streamæ¨¡å¼ã€åŒå‘streamæ¨¡å¼éƒ½æœ‰å¯¹åº”çš„ä»£ç ä¾‹å­ï¼Œè§ï¼š&lt;a href=&#34;https://dev.to/anshulgoyal15/a-beginners-guide-to-grpc-with-rust-3c7o&#34;&gt;Rust gRPC: A beginners guide to gRPC with Rust&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœ¨å¤§å…¬å¸å·¥ä½œçš„åæ§½&#34;&gt;åœ¨å¤§å…¬å¸å·¥ä½œçš„åæ§½&lt;/h2&gt;
&lt;p&gt;ä¸€ä½åœ¨ç¾å›½å·¥ä½œçš„å·¥ç¨‹å¸ˆå†™çš„å›½å¤–å¤§å…¬å¸ï¼ˆæ–‡ä¸­æ˜¯äºšé©¬é€Šï¼‰æ™‹å‡çš„ä¸€äº›æ§½ç‚¹ï¼Œçœ‹èµ·æ¥å’Œå›½å†…å¤§å…¬å¸ä¹Ÿå·®ä¸å¤šï¼Œè§ï¼š&lt;a href=&#34;https://yorotoo.medium.com/%E5%85%B3%E4%BA%8E%E5%8D%87%E8%81%8C-55dbe62ebaf&#34;&gt;å…³äºå‡èŒ - Yang Letu - Medium&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–æ–‡ä¸­è¿˜æ¨èäº†ä¸€ä¸ªæ¨ç‰¹ä¸Šçš„åæ§½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://twitter.com/kantrn/status/1511791378497384454&#34;&gt;Noah Kantrowitz on Twitter: &amp;ldquo;FAANG promo committees are killing Kubernetes: A Short Thread ğŸ§µ&amp;rdquo; / Twitter&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å…³äºå¨å°”å²å¯†æ–¯æ‰“äººä¸€ä½å°æ¹¾è€å¸ˆçš„ç¤¾ä¼šè¯¾å¼•å¯¼æ€è€ƒ&#34;&gt;ã€Šå…³äºå¨å°”å²å¯†æ–¯æ‰“äººï¼Œä¸€ä½å°æ¹¾è€å¸ˆçš„ç¤¾ä¼šè¯¾å¼•å¯¼æ€è€ƒã€‹&lt;/h2&gt;
&lt;p&gt;å…³äºå¨å°”å²å¯†æ–¯æ‰“äººï¼Œä¸€ä½å°æ¹¾è€å¸ˆçš„ç¤¾ä¼šè¯¾å¼•å¯¼æ€è€ƒï¼Œè§ï¼šhttps://www.facebook.com/hhsleo/posts/5543635368999794&lt;/p&gt;
&lt;p&gt;ï¼ˆä¸Šé¢çš„æ–‡ç« å¯èƒ½éœ€è¦FBæƒé™æ‰èƒ½æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥çœ‹è¿™ç¯‡å¾®ä¿¡å…¬ä¼—å·çš„è½¬å‘ï¼š&lt;a href=&#34;https://mp.weixin.qq.com/s/lGJpnq89gxTPxj_KUA2ZCg&#34;&gt;å…³äºå¨å°”å²å¯†æ–¯æ‰“äººï¼Œä¸€ä½å°æ¹¾è€å¸ˆçš„ç¤¾ä¼šè¯¾å¼•å¯¼æ€è€ƒ&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæˆ‘å‘Šè¨´å­¸ç”Ÿï¼Œæˆ‘ä»Šå¤©æ‰®æ¼”çš„è§’è‰²ï¼Œå°±åƒæ˜¯æ”¿æ²»äººç‰©æˆ–åª’é«”ï¼Œæˆ‘è“„æ„é¤µé¤Šä½ ç‰‡é¢çš„ã€æˆ‘æƒ³è¦ä½ çŸ¥é“çš„è³‡è¨Šï¼Œè€Œæœ‰è¶…é7æˆçš„äººï¼Œåœ¨é€™å€‹éç¨‹ä¸­ï¼Œè¢«æˆ‘æ“å¼„äº†ï¼Œä½ å› ç‚ºæˆ‘æ¯æ¬¡é¤µé¤Šçš„è³‡è¨Šä¸åŒï¼Œè€Œç”¢ç”Ÿç«‹å ´åè¦†çš„ç‹€æ³ï¼æ˜æ˜æ”¿æ²»äººç‰©æ‡‰è©²è€ƒæ…®çš„æ˜¯å…¬ç›Šï¼Œåª’é«”æ‡‰è©²å ±å°çš„æ˜¯çœŸç›¸ï¼Œä½†æˆ‘è‹¥æ•…æ„è¦æ“å¼„è¼¿è«–ï¼Œæˆ‘åªè¦çµ¦ä½ æˆ‘è¦ä½ çŸ¥é“çš„è¨Šæ¯å°±å¥½ï¼Œå°æˆ‘ä¸åˆ©çš„ï¼Œæˆ‘ä¸€æ¦‚ä¸æã€‚æ…¢æ…¢çš„ï¼Œæˆ‘å°±å¯ä»¥é€éé€™ç¨®æ„šå¼„çš„æ‰‹æ³•ï¼Œè®“æ°‘çœ¾è®Šæˆå°æˆ‘æ­»å¿ è€Œæ·±ä¿¡ä¸ç–‘çš„ç¦è‡ è€Œä¸è‡ªçŸ¥ï¼Œæˆ‘è¦ä½ è†œæ‹œä½ å°±è†œæ‹œï¼Œæˆ‘è¦ä½ æ‰“ç ¸æ®ºä½ å°±æ‰“ç ¸æ®ºï¼Œæˆ‘è¦ä½ å‰·é™¤ç•°å·±ä½ å°±å‰·é™¤ç•°å·±ï¼Œæˆ‘è¦ä½ ä¸Šåˆ€å±±ä¸‹æ²¹é‹ï¼Œä½ é‚„æœƒçˆ­å…ˆæå¾Œæƒ³è¦èº«å…ˆå£«å’ã€‚è€Œé€™æ¨£çš„ç¾è±¡ï¼Œæ­£åœ¨ä¸–ç•Œå„åœ°ä¸Šæ¼”â€&lt;/p&gt;
&lt;/blockquote&gt;
</description>
      
    </item>
    
    <item>
      <title>å‘¨åˆŠï¼ˆç¬¬11æœŸï¼‰ï¼šmmapé€‚ç”¨äºå­˜å‚¨å¼•æ“å—ï¼Ÿ</title>
      <link>https://www.codedump.info/post/20220327-weekly-11/</link>
      <pubDate>Sun, 27 Mar 2022 15:06:38 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20220327-weekly-11/</guid>
      
      <description>&lt;hr&gt;
&lt;p&gt;å¼•è¨€ï¼šæœ¬æœŸèŠä¸€èŠmmapæŠ€æœ¯åœ¨å­˜å‚¨å¼•æ“ä¸­çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;mmapé€‚ç”¨äºå­˜å‚¨å¼•æ“å—&#34;&gt;mmapé€‚ç”¨äºå­˜å‚¨å¼•æ“å—ï¼Ÿ&lt;/h1&gt;
&lt;p&gt;æƒ³å†™è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦æºäºä¸¤ç¯‡æ–‡ç« ï¼ˆè®ºæ–‡ï¼‰ä¸­çš„å¯¹mmapåœ¨å­˜å‚¨å¼•æ“ä¸­ä½¿ç”¨çš„ä¸¤ç§æˆªç„¶ä¸åŒçš„è§‚ç‚¹è®¨è®ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åæ–¹ï¼ˆmmapä¸åº”è¯¥ç”¨äºå­˜å‚¨å¼•æ“ï¼‰ï¼š&lt;a href=&#34;https://db.cs.cmu.edu/mmap-cidr2022/&#34;&gt;Are You Sure You Want to Use MMAP in Your Database Management System? (CIDR 2022)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ­£æ–¹ï¼ˆmmapå¯ä»¥ç”¨äºå­˜å‚¨å¼•æ“ï¼‰ï¼š&lt;a href=&#34;https://ayende.com/blog/196161-C/re-are-you-sure-you-want-to-use-mmap-in-your-database-management-system&#34;&gt;re: Are You Sure You Want to Use MMAP in Your Database Management System? - Ayende @ Rahien&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºåˆšå¥½çœ‹è¿‡è¿™ä¸¤ç§æ–¹å¼çš„btreeå­˜å‚¨å¼•æ“ï¼šsqliteçš„btreeå®ç°ä»¥åŠboltdbï¼Œæ‰€ä»¥å¯ä»¥ç»“åˆæˆ‘çš„è®¤çŸ¥æ¥èŠä¸€èŠè¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸¤ä¸ªå­˜å‚¨å¼•æ“çš„å®ç°éƒ½å·²ç»æ•´ç†æˆäº†ç³»åˆ—åšå®¢ï¼Œè¿™ä¸¤ä¸ªç³»åˆ—çš„ç¬¬ä¸€ç¯‡åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200625-boltdb-1/&#34;&gt;boltdb 1.3.0å®ç°åˆ†æï¼ˆä¸€ï¼‰ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªå­˜å‚¨å¼•æ“å®ç°æ—¶çš„å¤§ä½“åˆ†å±‚ï¼Œä»¥sqliteä¸ºä¾‹åˆ†ä¸ºä¸‰å±‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/btree-arch.png&#34; alt=&#34;btreeæ¶æ„&#34; title=&#34;btreeæ¶æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;è‡ªä¸‹è€Œä¸Šï¼Œè¿™ä¸‰ä¸ªå±‚æ¬¡åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;oså±‚ï¼šå°è£…ç³»ç»Ÿçº§APIå®ç°æ–‡ä»¶çš„è¯»å†™ç­‰æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢ç®¡ç†å±‚ï¼šæä¾›ä»¥é¡µé¢ä¸ºå•ä½çš„è¯»ã€å†™ã€åŠ è½½ã€ç¼“å­˜ç­‰æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;btreeå®ç°ï¼šbtreeä»¥ç‰©ç†é¡µé¢ä¸ºå•ä½å‘ä¸‹ä¸€å±‚çš„é¡µé¢ç®¡ç†å±‚æ¥è¯»å†™é¡µé¢ï¼Œè€Œç‰©ç†é¡µé¢å†…éƒ¨çš„é€»è¾‘ç»„ç»‡ï¼ˆæ¯”å¦‚çˆ¶å­å…³ç³»ï¼‰ï¼Œä»¥åŠé¡µé¢å†…çš„æ•°æ®ç»„ç»‡ï¼ˆæ¯”å¦‚ä¸€ä¸ªé¡µé¢ä¸­ç®¡ç†çš„æ•°æ®ï¼‰ç”±è¿™ä¸€å±‚è´Ÿè´£ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥è¿™æ ·æ¥ç®€å•åŒºåˆ«ç†è§£â€œé¡µé¢ç®¡ç†â€æ¨¡å—å’Œbtreeæ¨¡å—çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¡µé¢ç®¡ç†ï¼šé¡¾åæ€ä¹‰ï¼Œé¡µé¢ç®¡ç†æ¨¡å—çš„æœ€åŸºæœ¬å•ä½æ˜¯â€é¡µé¢â€œï¼Œé¡µé¢çš„è¯»ã€å†™ã€ç¼“å­˜ã€è½ç›˜ã€æ¢å¤ã€å›æ»šç­‰ï¼Œéƒ½ç”±é¡µé¢æ¨¡å—è´Ÿè´£ã€‚ä¸Šä¸€å±‚ä¾èµ–é¡µé¢ç®¡ç†æ¨¡å—çš„btreeæ¨¡å—ï¼Œä¸éœ€è¦å…³å¿ƒä¸€ä¸ªé¡µé¢ä½•æ—¶ç¼“å­˜ã€ä½•æ—¶è½ç›˜ç­‰ç»†èŠ‚ã€‚å³ï¼š&lt;strong&gt;é¡µé¢æ¨¡å—è´Ÿè´£é¡µé¢çš„ç‰©ç†çº§åˆ«çš„æ“ä½œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;btreeï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè´£æŒ‰ç…§btreeç®—æ³•ï¼Œæ¥ç»„ç»‡é¡µé¢ï¼Œå³è´Ÿè´£çš„æ˜¯é¡µé¢ä¹‹é—´é€»è¾‘å…³ç³»ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;é™¤æ­¤ä»¥å¤–ï¼Œä¸€ä¸ªé¡µé¢å†…éƒ¨çš„æ•°æ®çš„ç‰©ç†ã€é€»è¾‘ç»„ç»‡ï¼Œä¹Ÿæ˜¯btreeæ¨¡å—æ¥è´Ÿè´£çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å³ï¼š&lt;strong&gt;btreeè´Ÿè´£ç»´æŠ¤é¡µé¢é—´çš„é€»è¾‘å…³ç³»ï¼Œä»¥åŠä¸€ä¸ªé¡µé¢å†…æ•°æ®çš„ç»„ç»‡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/page-module.png&#34; alt=&#34;ä»¥é¡µé¢ç‰©ç†ã€é€»è¾‘å…³ç³»çš„ç»´æŠ¤çœ‹æ¨¡å—åˆ’åˆ†&#34; title=&#34;ä»¥é¡µé¢ç‰©ç†ã€é€»è¾‘å…³ç³»çš„ç»´æŠ¤çœ‹æ¨¡å—åˆ’åˆ†&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œé€šå¸¸æŒ‰ç…§é¡µé¢ä¸ºå•ä½æ¥åˆ’åˆ†æ–‡ä»¶ï¼Œæ¯”å¦‚sqliteä¸€èˆ¬æ˜¯4KBå¤§å°ä¸ºä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œæ‰€ä»¥ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå¤§çš„â€œç‰©ç†é¡µé¢æ•°ç»„â€ï¼Œè¿™æ ·çš„è¯æ¯ä¸ªç‰©ç†é¡µé¢éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç¼–å·ï¼ˆä»1å¼€å§‹ï¼‰ï¼Œè¿™ä¸ªç¼–å·é€šå¸¸ç®€ç§°ä¸ºPIDï¼ˆpage idï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„åŠŸèƒ½åˆ’åˆ†å¯ä»¥çœ‹åˆ°ï¼Œâ€œé¡µé¢ç®¡ç†å™¨ï¼ˆä¹Ÿè¢«ç§°ä¸ºâ€œbuffer poolï¼‰â€çš„åŠŸèƒ½æ˜¯éå¸¸å¤æ‚çš„ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªæœ€å…³é”®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¯»é¡µé¢ï¼šä¸Šå±‚çš„btreeè¦è¯»ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä¸­çš„é¡µé¢æ—¶ï¼Œé€šå¸¸ä¼ å…¥ä¸€ä¸ªPIDï¼Œç”±é¡µé¢ç®¡ç†å™¨å»åŠ è½½è¿™ä¸ªé¡µé¢çš„æ•°æ®ã€‚è€Œé¡µé¢æ•°æ®å¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šåˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ä¸€æ¬¡ç£ç›˜IOè¯»å‡ºæ¥ï¼Œä¹Ÿå¾ˆå¯èƒ½åœ¨å†…å­˜ä¸­ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦è¯»ç£ç›˜æ“ä½œäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™é¡µé¢ï¼šå½“ä¸€ä¸ªé¡µé¢è¢«ä¿®æ”¹åï¼Œå°±è¢«ç§°ä¸ºâ€œè„é¡µé¢ï¼ˆdirty pageï¼‰â€ï¼Œéœ€è¦è½ç›˜ï¼›ä½†å¹¶ä¸æ˜¯æ¯ä¸€æ¬¡ä¿®æ”¹äº†ä¸€ä¸ªé¡µé¢çš„å†…å®¹ä¹‹åå°±é©¬ä¸Šè½ç›˜ï¼Œå…¶åŸå› åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€æ¬¡å†™äº‹åŠ¡å¯èƒ½ä¿®æ”¹äº†ä¸æ­¢ä¸€ä¸ªé¡µé¢ï¼Œéœ€è¦ä»¥äº‹åŠ¡ä¸ºå•ä½å»è½ç›˜è„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å³ä¾¿æ˜¯è½ç›˜è„é¡µé¢ï¼Œç”±äºæ¶‰åŠåˆ°å†™ç£ç›˜æ“ä½œï¼Œæ‰€ä»¥è¿˜ä¼šç”¨å…¶ä»–æ–¹å¼å‡å°‘å†™ç£ç›˜çš„æ¬¡æ•°ã€‚æ¯”å¦‚sqliteçš„walå¤‡ä»½æ–‡ä»¶æœºåˆ¶ä¸­ï¼Œè„é¡µé¢çš„å†…å®¹æ˜¯é¦–å…ˆå†™å…¥walæ–‡ä»¶çš„ï¼Œç”±äºå†™walæ–‡ä»¶æ˜¯ä¸€æ¬¡appendæ“ä½œè€Œä¸æ˜¯éšæœºå†™ï¼Œæ‰€ä»¥æ•ˆç‡ä¼šæ›´é«˜ï¼Œå¦‚æœä¸€ä¸ªè„é¡µé¢çš„å†…å®¹è¢«å†™å…¥walæ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†é¡µé¢å†…å®¹æ˜¯ä¸æ€¥äºé©¬ä¸Šå†™å…¥æ•°æ®åº“æ–‡ä»¶çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼“å­˜é¡µé¢ï¼šç”±äºé¡µé¢ç¼“å­˜çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªé¡µé¢ç¼“å­˜ç®¡ç†çš„åŠŸèƒ½ï¼Œä¸»è¦è´Ÿè´£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç¼“å­˜æ§åˆ¶ç®—æ³•ï¼ˆsqliteä¸­æ˜¯LRUï¼‰å°†ç»å¸¸è¯»åˆ°çš„é¡µé¢ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·ä¸å¿…æ¯æ¬¡éƒ½è¯»ç£ç›˜åŠ è½½æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å½“ç¼“å­˜å¤§å°ä¸å¤Ÿæ—¶ï¼Œå°†è„é¡µé¢è½ç›˜ï¼Œç©ºå‡ºæ¥ç©ºé—´åŠ è½½è¦è¯»çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹äº†ä¸Šé¢å¯¹é¡µé¢ç®¡ç†å™¨è¿™ä¸ªæ¨¡å—åŠŸèƒ½çš„æè¿°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±äºæœ‰é¡µé¢ç¼“å­˜çš„ä½œç”¨ï¼Œæ‰€ä»¥èƒ½å¤Ÿç²¾å‡†çš„æ§åˆ¶é¡µé¢ç¼“å­˜çš„å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;å°†â€œè„é¡µé¢è½ç›˜â€è¿™ä¸ªæ“ä½œï¼Œæ˜¯ä¸å…·ä½“çš„äº‹åŠ¡æœ‰å…³ï¼Œå¹¶ä¸æ˜¯ä¿®æ”¹å®Œæ¯•å°±èƒ½ç›´æ¥è½ç›˜ï¼Œå¦åˆ™çš„è¯å¯èƒ½ä¼šæ¶‰åŠåˆ°è„å†™ç­‰é—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†1ã€2ã€3ä¸‰ä¸ªPIDçš„é¡µé¢ï¼Œä¿®æ”¹é¡µé¢1ä¹‹åå¹¶ä¸èƒ½é©¬ä¸Šè½ç›˜è¿™ä¸ªä¿®æ”¹ï¼Œéœ€è¦ç­‰åˆ°ä¸‰ä¸ªé¡µé¢éƒ½æ”¹å®Œäº†æ‰è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœä½¿ç”¨mmapæŠ€æœ¯æ¥ä»£æ›¿ä¸Šé¢çš„â€œé¡µé¢ç®¡ç†å™¨â€ä¼šé¢å¯¹ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ— æ³•åšåˆ°å¯¹å†…å­˜å®¹é‡çš„ç²¾å‡†æ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œå†™äº‹åŠ¡å¦‚ä½•å¤„ç†ï¼Œå› ä¸ºå½“ä½¿ç”¨mmapæŠ€æœ¯ä¿®æ”¹äº†ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå®é™…ä¸Šè¿™ä¸ªè¢«ä¿®æ”¹çš„é¡µé¢å†…å®¹ä½•æ—¶è¢«OSå†…æ ¸è½åˆ°ç¡¬ç›˜ï¼Œå·²ç»ä¸ç”±ä½¿ç”¨è€…æ¥æ§åˆ¶äº†ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³ä¸Šé¢æåˆ°çš„ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†å¤šä¸ªé¡µé¢éœ€è¦åŒæ—¶è½ç›˜çš„é—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»¥boltdbä¸ºä¾‹ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ç±»ä¼¼COWçš„æœºåˆ¶æ¥è§£å†³ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220327-weekly-11/boltdb-write.png&#34; alt=&#34;boltdbå®ç°å†™äº‹åŠ¡&#34; title=&#34;boltdbå®ç°å†™äº‹åŠ¡&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;boltdbçš„æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå‰é¢ä¸‰ä¸ªé¡µé¢ä¾æ¬¡æ˜¯ï¼šmeta1é¡µé¢ã€meta2é¡µé¢ã€freelisté¡µé¢ï¼Œå‰ä¸¤è€…æ˜¯å­˜å‚¨æ•°æ®åº“å…ƒä¿¡æ¯çš„é¡µé¢ï¼Œfreelisté¡µé¢å¯ä»¥è®¤ä¸ºæ˜¯å­˜å‚¨å½“å‰ç©ºé—²é¡µé¢æ•°æ®ã€‚ä¹‹æ‰€ä»¥éœ€è¦ä¸¤ä¸ªmetaé¡µé¢ï¼Œæ˜¯ä¸ºäº†ä¿å­˜å†™ä¿¡æ¯ï¼šå³ä¾¿ä¸€æ¬¡å†™æ“ä½œå¤±è´¥ï¼Œå› ä¸ºè¿˜æœ‰å¦ä¸€ä¸ªmetaé¡µé¢ï¼Œè¿™æ ·å°±è¿˜èƒ½æ¢å¤å›æ¥ã€‚æ¯ä¸ªmetaé¡µé¢éƒ½æœ‰ä¸€ä¸ªå•è°ƒé€’å¢çš„äº‹åŠ¡idï¼Œäº‹åŠ¡idè¶Šå¤§è¯´æ˜æ˜¯è¶Šè¿‘çš„å†™æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›¾ä¸­ç´§è·Ÿç€å‰é¢ä¸‰ä¸ªå…ƒé¡µé¢çš„æ˜¯é¡µé¢1ã€2ã€3ï¼Œå‡è®¾è¿™é‡Œçš„å†™äº‹åŠ¡å°±ä¿®æ”¹äº†è¿™ä¸‰ä¸ªé¡µé¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œé¦–å…ˆæ‹¿åˆ°å½“å‰ä¿å­˜è¾ƒå¤§äº‹åŠ¡idçš„metaé¡µé¢ï¼Œè¿™é‡Œå‡è®¾æ˜¯meta1é¡µé¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶åè¿›è¡Œå†™äº‹åŠ¡çš„é¡µé¢ä¿®æ”¹ï¼Œæ­¤æ—¶çš„ä¿®æ”¹è¿˜åªæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™äº‹åŠ¡å®Œæˆä¹‹åï¼Œéœ€è¦å°†ä¿®æ”¹è½ç›˜ï¼Œå°†æŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºæ¥è¿›è¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œæ•°æ®åº“æ–‡ä»¶ä¸­æ–°å¢ä¸‰ä¸ªé¡µé¢ä¿å­˜ä¿®æ”¹åçš„å†…å®¹ï¼Œè€ŒåŸæ¥çš„ä¸‰ä¸ªé¡µé¢å†…å®¹ä¸åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œå°†åŸå…ˆçš„ä¸‰ä¸ªé¡µé¢åŠ å…¥freelistç©ºé—²é¡µé¢é“¾è¡¨ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å°±å¯ä»¥å›æ”¶åˆ©ç”¨äº†ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œå°†meta1é¡µé¢çš„ä¿®æ”¹è½åœ°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªä¿®æ”¹çš„é¡ºåºå¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œå¦åˆ™ä¸­é—´ä¸€ä¸ªè¿‡ç¨‹å¤±è´¥æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶å°±æŸåäº†ã€‚åªæœ‰å½“å®Œæˆmetaé¡µé¢çš„ä¿®æ”¹ï¼Œæ‰è®¤ä¸ºè¿™æ¬¡ä¿®æ”¹å®Œæˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™å°±æ˜¯boltdbè¿™ä¸ªä½¿ç”¨äº†mmapæ¥åšé¡µé¢ç®¡ç†çš„å­˜å‚¨å¼•æ“ï¼Œåº”å¯¹å†™äº‹åŠ¡æ“ä½œçš„æ‰‹æ®µï¼Œæœ¬è´¨ä¸Šç®—ä¸€ä¸ªCOWçš„åšæ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;â€œé¡µé¢ç®¡ç†å™¨â€åœ¨æ•´ä¸ªå­˜å‚¨å¼•æ“çš„æ¶æ„é‡Œï¼Œå¤„äºæ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼šå¯¹ä¸Šæä¾›ç‰©ç†é¡µé¢çº§åˆ«çš„è¯»ã€å†™ã€ç¼“å­˜æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œå¯¹ä¸‹ä½¿ç”¨OSç³»ç»ŸAPIæ¥å®ç°æ–‡ä»¶è¯»å†™æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;å…¶ç¼“å­˜åŠŸèƒ½ï¼Œèƒ½å¤Ÿè¾¾åˆ°ç²¾å‡†æ§åˆ¶é¡µé¢ç¼“å­˜è¿™éƒ¨åˆ†å†…å®¹å®¹é‡çš„ä½œç”¨ï¼›å¦å¤–ï¼Œç”±äºä¸€æ¬¡å†™äº‹åŠ¡é€šå¸¸ä¸æ­¢ä¿®æ”¹äº†ä¸€ä¸ªé¡µé¢ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç²¾å‡†æ§åˆ¶è„é¡µé¢çš„è½ç›˜çš„æ—¶æœºï¼Œå¦åˆ™ä¼šå‡ºç°å†™åæ•°æ®åº“çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨mmapæ¥æ›¿ä»£è‡ªå®ç°çš„é¡µé¢ç®¡ç†å™¨æœ€å¤§çš„å°±æ˜¯è¿™ä¸¤ä¸ªé—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;æ— æ³•åšåˆ°ç²¾å‡†æ§åˆ¶é¡µé¢ç¼“å­˜å®¹é‡ã€‚&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨ç±»COWçš„åšæ³•æ¥è§£å†³å†™äº‹åŠ¡é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸Šé¢çš„ç¬¬äºŒä¸ªé—®é¢˜æœ‰è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯é—®é¢˜ä¸€è²Œä¼¼æ²¡æœ‰ã€‚æ‰€ä»¥ä¸€ä¸ªå­˜å‚¨å¼•æ“å¦‚æœä½¿ç”¨mmapæ¥å®ç°é¡µé¢ç®¡ç†ï¼Œå¯ä»¥è¯´è¿™ä¸ªå­˜å‚¨å¼•æ“å¯èƒ½åªé€‚ç”¨äºâ€œå†…å­˜ä¸æ•æ„Ÿâ€çš„ä¸šåŠ¡åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¶ä»–æ¨è&#34;&gt;å…¶ä»–æ¨è&lt;/h1&gt;
&lt;h2 id=&#34;ç±»notepadçš„ç¼–è¾‘å™¨&#34;&gt;ç±»notepad++çš„ç¼–è¾‘å™¨&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/dail8859/NotepadNext&#34;&gt;dail8859/NotepadNext: A cross-platform, reimplementation of Notepad++&lt;/a&gt;æ˜¯ä¸€æ¬¾åŸºäºqtç¼–å†™çš„ç¼–è¾‘å™¨ï¼Œä»…çœ‹ä½œè€…æä¾›çš„è½¯ä»¶æˆªå›¾å¯ä»¥è¯´å¾ˆåƒnotepad++äº†ï¼Œä½†æ˜¯ç›®å‰ä¸ºæ­¢å¥½åƒè¿˜åªæœ‰Linuxã€Winç‰ˆæœ¬ï¼Œå¸Œæœ›ä»¥åèƒ½æœ‰Macç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;etcdä¸­çš„çº¢é»‘æ ‘å®ç°&#34;&gt;etcdä¸­çš„çº¢é»‘æ ‘å®ç°&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨çœ‹etcdçš„watcheræœºåˆ¶çš„å®ç°ï¼Œçœ‹ç€çœ‹ç€ï¼Œå‘ç°etcdè¿˜è‡ªå¸¦äº†ä¸€ä¸ªå«adtçš„åŒ…ï¼Œé‡Œé¢æ‰‹å†™äº†ä¸€ä¸ªçº¢é»‘æ ‘çš„å®ç°ï¼š&lt;a href=&#34;https://github.com/etcd-io/etcd/tree/main/pkg/adt&#34;&gt;etcd/pkg/adt&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸€æ¡è±†ç“£åŠ¨æ€å¼•å‘çš„ç–«æƒ…æ–‡å­¦å¤å…´&#34;&gt;ä¸€æ¡è±†ç“£åŠ¨æ€å¼•å‘çš„â€œç–«æƒ…æ–‡å­¦â€å¤å…´&lt;/h2&gt;
&lt;p&gt;ç–«æƒ…æ—¶æœŸçš„è±†ç“£ç½‘ç»œæ–‡å­¦å¤§èµ›ï¼Œç”±ä¸€æ¡è±†ç“£å¼•å‘çš„ç½‘å‹è¯„è®ºå›å¤ï¼š&lt;a href=&#34;https://www.douban.com/note/827837123/?_dtcc=1&amp;amp;_i=7741611DTua3Gc,8390080DTua3Gc&#34;&gt;ä¸€æ¡è±†ç“£åŠ¨æ€å¼•å‘çš„â€œç–«æƒ…æ–‡å­¦â€å¤å…´&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä½ æœ€å¥½çš„ä¸€æ¡èŒä¸šå»ºè®®æ˜¯ä»€ä¹ˆ&#34;&gt;ä½ æœ€å¥½çš„ä¸€æ¡èŒä¸šå»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Twitterä¸Šæœ‰äººå‘äº†ä¸€ä¸ªæ¨ï¼Œè¯´ä»–ä¹‹å‰é—®è¿‡ä¸€ä¸ªé—®é¢˜ï¼šâ€œä½ æœ€å¥½çš„ä¸€æ¡èŒä¸šå»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼Œä»–å¾—åˆ°äº†1300å¤šä¸ªç­”æ¡ˆï¼Œæœ€åä»–æ•´ç†äº†12æ¡æœ€å¥½çš„å»ºè®®ã€‚è¿™äº›å»ºè®®ï¼Œä¹Ÿè¢«äººæ•´ç†æˆäº†ä¸­æ–‡å‘åˆ°äº†å¾®åšï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹±æ–‡ç‰ˆï¼š&lt;a href=&#34;https://twitter.com/chrishlad/status/1502650707274608644&#34;&gt;Chris Hladczuk on Twitter: &amp;ldquo;So I asked &amp;ldquo;What&amp;rsquo;s your single best piece of career advice&amp;rdquo;? I got 1,300+ answers. Here are the 12 best you wish you knew yesterdayğŸ‘‡&amp;rdquo; / Twitter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸­æ–‡ç‰ˆï¼š&lt;a href=&#34;https://weibo.com/1727858283/Ljvv75q62&#34;&gt;å®ç‰xpçš„å¾®åš - å¾®åš&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç°</title>
      <link>https://www.codedump.info/post/20220201-sqlite-btree-5-btree/</link>
      <pubDate>Tue, 01 Feb 2022 15:55:40 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20220201-sqlite-btree-5-btree/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;å‰é¢çš„å†…å®¹é‡Œï¼Œè¯¦ç»†ä»‹ç»äº†é¡µé¢ç®¡ç†å™¨éƒ¨åˆ†çš„å†…å®¹ï¼Œå›é¡¾ä¸€ä¸‹é¡µé¢ç®¡ç†å™¨å’ŒBtreeæ¨¡å—çš„åˆ†å·¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ç®¡ç†å™¨ï¼šæä¾›é¡µé¢çº§åˆ«çš„ç‰©ç†ç®¡ç†ï¼Œå¦‚ç¼“å­˜ã€è¯»å–ã€å†™å…¥ã€é¡µé¢å¤‡ä»½ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Btreeï¼šæ ¹æ®btreeæ•°æ®ç»“æ„æä¾›é¡µé¢åœ¨é€»è¾‘ä¸Šçš„ç»„ç»‡ï¼Œä»¥åŠå•ä¸ªé¡µé¢å†…çš„åˆ’åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜è®°å¾—æœ€å¼€å§‹ï¼Œç ”ç©¶ç”Ÿäº§çº§åˆ«btreeå®ç°æ—¶çš„å‡ ä¸ªç–‘é—®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ•™ç§‘ä¹¦ä¸­ï¼Œæ¼”ç¤ºbtreeç®—æ³•æ—¶ï¼Œä½¿ç”¨çš„éƒ½æ˜¯å®šé•¿çš„ç®€å•æ•°æ®ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯å˜é•¿çš„ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•å­˜å‚¨å˜é•¿çš„æ•°æ®å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€è¡Œæ•°æ®çš„å¤§å°ï¼Œè¶…è¿‡äº†ä¸€ä¸ªç‰©ç†é¡µé¢çš„å¤§å°ï¼Œåˆè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸€è¡Œæ•°æ®ä¹‹åï¼Œå®ƒç•™ä¸‹çš„ç©ºé—´å¦‚ä½•å›æ”¶åˆ©ç”¨ï¼Ÿè€Œå›æ”¶åˆ©ç”¨æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šå‡ºç°ç¢ç‰‡çš„é—®é¢˜ï¼Œæ¯”å¦‚åŸå…ˆ10å­—èŠ‚çš„æ•°æ®è¢«å›æ”¶ï¼Œç”¨æ¥å­˜å‚¨9å­—èŠ‚çš„æ•°æ®ï¼Œå¤šå‡ºæ¥çš„1å­—èŠ‚æ•°æ®å°±è¢«æµªè´¹äº†ï¼Œç¢ç‰‡é—®é¢˜åº”è¯¥å¦‚ä½•è§£å†³ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›é—®é¢˜ï¼Œéƒ½ä¸â€œä¸€ä¸ªç‰©ç†é¡µé¢å†…æ•°æ®å¦‚ä½•ç»„ç»‡â€è¿™ä¸ªæ ¸å¿ƒé—®é¢˜æ¯æ¯ç›¸å…³ï¼Œå¸¦ç€è¿™äº›é—®é¢˜å±•å¼€btreeå®ç°çš„è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸‹æ–‡ä¸­ï¼Œä¸ä¼šè®¨è®ºbtreeç®—æ³•çš„ç»†èŠ‚ï¼Œè¿™éƒ¨åˆ†ä¸ç†Ÿæ‚‰çš„ï¼Œå¯ä»¥å›çœ‹ä¹‹å‰çš„æ–‡ç« æˆ–è€…æ•™ç§‘ä¹¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200609-btree-1/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸Šï¼‰ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200615-btree-2/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸‹ï¼‰ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç‰©ç†é¡µé¢çš„æ•°æ®ç»„ç»‡&#34;&gt;ç‰©ç†é¡µé¢çš„æ•°æ®ç»„ç»‡&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®è¡¨çš„é€»è¾‘ç»„ç»‡å’Œé¡µé¢ç±»å‹&#34;&gt;æ•°æ®è¡¨çš„é€»è¾‘ç»„ç»‡å’Œé¡µé¢ç±»å‹&lt;/h2&gt;
&lt;p&gt;åœ¨å±•å¼€å…·ä½“çš„æ ¼å¼è®¨è®ºä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹æ•°æ®åº“æ–‡ä»¶çš„å¤§ä½“ç»“æ„ï¼Œå·²ç»ä¸åŒçš„é¡µé¢ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;sqliteä¸­æ‰€è°“çš„&lt;code&gt;æ•°æ®åº“æ–‡ä»¶&lt;/code&gt;æ˜¯å•ä¸€æ–‡ä»¶ï¼ŒæŒ‰ç…§ç‰©ç†é¡µé¢ï¼ˆ2çš„æ¬¡æ–¹ï¼‰çš„å¤§å°æ¥åˆ’åˆ†ä¸ºå¤šä¸ªé¡µé¢ã€‚å…¶ä¸­ï¼Œæ¯ä¸ªè¡¨åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­æ˜¯ä¸€æ£µbtreeçš„ç»“æ„æ¥ç»„ç»‡ï¼Œè€Œä¸åŒç±»å‹çš„btreeè¿˜åŒºåˆ†äº†ä¸åŒçš„é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œå°†å¹³é¢çš„æ•°æ®åº“æ–‡ä»¶ï¼ŒæŒ‰ç…§é¢œè‰²åˆ’åˆ†æˆå­˜å‚¨ä¸¤ä¸ªè¡¨çš„btreeï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/database-file.png&#34; alt=&#34;æ•°æ®åº“æ–‡ä»¶çš„ç‰©ç†é¡µé¢ç»„ç»‡å’Œé€»è¾‘é¡µé¢ç»“æ„&#34; title=&#34;æ•°æ®åº“æ–‡ä»¶çš„ç‰©ç†é¡µé¢ç»„ç»‡å’Œé€»è¾‘é¡µé¢ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ŠåŠéƒ¨åˆ†è¡¨ç¤ºï¼Œåœ¨ç‰©ç†çš„ç»„ç»‡ä¸Šï¼Œä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä»¥ä¸€ä¸ªç‰©ç†é¡µé¢ä¸ºåŸºæœ¬å•ä½æ¥å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;ä¸‹åŠéƒ¨åˆ†è¡¨ç¤ºï¼Œåœ¨é€»è¾‘çš„ç»„ç»‡ä¸Šï¼Œä¸åŒçš„è¡¨éƒ½æœ‰è‡ªå·±çš„btreeæ ‘å½¢ç»“æ„ï¼Œè¿™æ˜¯ç‰©ç†é¡µé¢åœ¨é€»è¾‘ä¸Šçš„ç»„ç»‡æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºæ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„btreeæ ‘å½¢ç»“æ„ï¼Œå¦‚æœæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ ¹é¡µé¢ç¼–å·ï¼Œæ¯”å¦‚å›¾ä¸­çš„ä¸¤ä¸ªè¡¨ï¼Œå¯¹åº”çš„æ ‘å½¢ç»“æ„ä¸­ï¼Œæ ¹èŠ‚ç‚¹æ‰€åœ¨çš„é¡µé¢åˆ†åˆ«æ˜¯1å’Œ2ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€æ¥çœ‹ä¸åŒçš„é¡µé¢ç±»å‹ï¼Œä»¥åŠå­˜å‚¨ä¸Šçš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œåˆ›å»ºä»¥ä¸‹çš„æ•°æ®åº“ï¼Œæ’å…¥æ•°æ®ï¼Œä»¥åŠç´¢å¼•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åˆ›å»ºæ•°æ®åº“COMPANY
CREATE TABLE COMPANY(
   ID             INT      NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL
);

// åˆ›å»ºç´¢å¼•
CREATE INDEX id_index ON COMPANY (id);

// æ’å…¥2æ¡æ•°æ®
INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY) VALUES (1, &amp;#39;Paul&amp;#39;, 32, &amp;#39;California&amp;#39;, 20000.00 );
INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)
VALUES (2, &amp;#39;Allen&amp;#39;, 25, &amp;#39;Texas&amp;#39;, 15000.00 );

// æŸ¥è¯¢æ•°æ®
sqlite&amp;gt; select * from COMPANY;
1|Paul|32|California|20000.0
2|Allen|25|Texas|15000.0

// æŸ¥è¯¢rowidå’Œæ•°æ®
sqlite&amp;gt; select rowid,* from COMPANY;
1|1|Paul|32|California|20000.0
2|2|Allen|25|Texas|15000.0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„æµç¨‹é‡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªè¡¨&lt;code&gt;COMPANY&lt;/code&gt;ï¼Œæ³¨æ„è¿™ä¸ªè¡¨åœ¨æœ€å¼€å§‹æ˜¯æ²¡æœ‰ä»»ä½•ç´¢å¼•çš„ã€‚&lt;/li&gt;
&lt;li&gt;æ¥ä¸‹æ¥ï¼Œä»¥å­—æ®µ&lt;code&gt;id&lt;/code&gt;æ¥åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œæ’å…¥2æ¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä½œäº†ä¸¤æ¬¡æŸ¥è¯¢ï¼šä¸€æ¬¡æŸ¥è¯¢å…¨é‡çš„æ•°æ®ï¼Œç¬¬äºŒæ¬¡å‡ºç°äº†ä¸€ä¸ªåœ¨ä¸Šé¢æ²¡æœ‰å‡ºç°çš„ä¸€ä¸ªå­—æ®µ&lt;code&gt;rowid&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ°äº†è¿™é‡Œï¼Œé—®é¢˜å°±æ¥äº†ï¼Œ&lt;code&gt;rowid&lt;/code&gt;æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨å­˜åœ¨è¿™ä¸ªå­—æ®µï¼Œèµ·äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rowid&lt;/code&gt;æ˜¯sqliteä¸­çš„ä¸€ä¸ªéšè—åˆ—ï¼šæ•´æ•°ç±»å‹ï¼Œè‡ªå¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªéšè—åˆ—ï¼Ÿæœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥&lt;code&gt;rowid&lt;/code&gt;ä¸ºé”®ï¼Œæ¥å­˜å‚¨ä¸€è¡Œæ•°æ®çš„å…¨é‡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰äº†&lt;code&gt;rowid&lt;/code&gt;åšä¸ºä¸€è¡Œæ•°æ®çš„é”®ï¼Œå…¶å®ƒç´¢å¼•å­˜å‚¨çš„å€¼å°±å¯ä»¥æ˜¯è¿™è¡Œæ•°æ®çš„&lt;code&gt;rowid&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å³ï¼š&lt;code&gt;rowid&lt;/code&gt;åœ¨sqliteä¸­æ˜¯åšä¸º&lt;code&gt;èšç°‡ç´¢å¼•ï¼ˆcluster indexï¼‰&lt;/code&gt;å‡ºç°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šé¢ä¸ºä¾‹ï¼Œåœ¨sqliteçš„btreeä¸­å¤§ä½“å°±æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/btree-rowid.png&#34; alt=&#34;æ•°æ®åº“æ–‡ä»¶çš„rowidå…¨é‡æ•°æ®è¡¨å’Œç´¢å¼•è¡¨&#34; title=&#34;æ•°æ®åº“æ–‡ä»¶çš„rowidå…¨é‡æ•°æ®è¡¨å’Œç´¢å¼•è¡¨&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­å­˜åœ¨ä¸¤ä¸ªè¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥&lt;code&gt;rowid&lt;/code&gt;ä¸ºé”®çš„å…¨é‡æ•°æ®è¡¨ï¼Œåœ¨sqliteä¸­å­˜å‚¨è¿™ç±»å‹æ•°æ®çš„btreeè¢«ç§°ä¸ºâ€œtable treeâ€ã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨idç´¢å¼•çš„ç´¢å¼•è¡¨ï¼Œè¿™ç±»btreeè¢«ç§°ä¸ºâ€œindex treeâ€ï¼Œå› æ­¤å­˜å‚¨çš„æ˜¯ç´¢å¼•æ•°æ®ã€‚è¿™ä¸ªè¡¨çš„é”®æ˜¯&lt;code&gt;id&lt;/code&gt;ï¼Œè€Œå€¼æ˜¯&lt;code&gt;rowid&lt;/code&gt;ï¼Œè¿™æ ·æ ¹æ®&lt;code&gt;id&lt;/code&gt;ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå…¶å®å°±æ˜¯ä¸¤æ­¥ï¼š
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œæ ¹æ®&lt;code&gt;id&lt;/code&gt;æ‰¾åˆ°å¯¹åº”çš„&lt;code&gt;rowid&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†æ ¹æ®&lt;code&gt;rowid&lt;/code&gt;åˆ°å…¨é‡æ•°æ®è¡¨é‡ŒæŸ¥è¯¢å…·ä½“çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä¸Šé¢çš„è¿™ä¸ªä¾‹å­é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œâ€œé€»è¾‘æ„ä¹‰â€ä¸Šçš„ä¸€ä¸ªæ•°æ®è¡¨ï¼Œä¸å®é™…å­˜å‚¨æ—¶åœ¨btreeä¸­çš„è¡¨å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œç”±äºç´¢å¼•è¡¨çš„å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†å‰é¢çš„å¯¹&lt;code&gt;rowid&lt;/code&gt;ä»¥åŠç´¢å¼•è¡¨ã€å…¨é‡æ•°æ®è¡¨çš„ç†è§£ï¼Œå°±å¯ä»¥å±•å¼€è®¨è®ºä¸åŒçš„é¡µé¢ç±»å‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;sqliteä¸­åˆ†ä¸ºå‡ ç±»é¡µé¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä»¥æ•´æ•°ä¸ºé”®çš„é¡µé¢ï¼šè¿™ç±»é¡µé¢æ˜¯ä»¥&lt;code&gt;b+tree&lt;/code&gt;æ¨¡å¼æ¥ç»„ç»‡çš„ã€‚å³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…éƒ¨èŠ‚ç‚¹éƒ½åªæœ‰é”®ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®éƒ¨åˆ†éƒ½å­˜å‚¨åœ¨å¶å­é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ˜¾ç„¶ï¼Œå…¨é‡æ•°æ®è¡¨çš„é¡µé¢å°±æ˜¯è¿™ç±»é¡µé¢ï¼Œå³å…¨é‡æ•°æ®è¡¨æ›´å‡†ç¡®çš„æ˜¯&lt;code&gt;b+tree&lt;/code&gt;ç»“æ„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¶ä»–ç±»å‹çš„é¡µé¢ï¼šå…¶ä»–è¡¨éƒ½æ˜¯ä»¥æ•´æ•°ä¸ºå€¼ï¼Œè¿™ç±»å‹çš„é¡µé¢éƒ½æ˜¯&lt;code&gt;btree&lt;/code&gt;ç±»å‹ï¼Œå³å†…éƒ¨èŠ‚ç‚¹ã€å¶å­èŠ‚ç‚¹éƒ½ä¸€æ ·å­˜å‚¨ç€é”®å’Œå€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è¡¨ç¤ºè¿™äº›é¡µé¢ï¼Œæœ‰å¦‚ä¸‹å‡ ç§é¡µé¢æ ‡å¿—ä½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;** Page type flags.  An ORed combination of these flags appear as the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;** first byte of on-disk image of every BTree page.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define PTF_INTKEY    0x01
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define PTF_ZERODATA  0x02
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define PTF_LEAFDATA  0x04
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define PTF_LEAF      0x08
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;PTF_INTKEYï¼ˆ1ï¼‰ï¼šè¡¨ç¤ºkeyä¸ºintç±»å‹æ•°æ®ï¼Œä¸€èˆ¬æ˜¯rowidï¼Œå³å‰é¢çš„&lt;code&gt;å…¨é‡æ•°æ®è¡¨&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;PTF_ZERODATAï¼ˆ2ï¼‰ï¼šè¡¨ç¤ºè¿™æ˜¯ç´¢å¼•è¡¨çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PTF_LEAFDATAï¼ˆ4ï¼‰ï¼šæ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ ‡å¿—ä½è¦å’ŒPTF_INTKEYä¸€èµ·ä½œç”¨ã€‚å³ï¼škeyä¸ºintç±»å‹æ•°æ®çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§é¡µé¢ï¼šä¸€ç§åªå­˜å‚¨intç±»å‹çš„keyï¼Œä¸€ç§åªå­˜å‚¨æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;PTF_LEAFï¼ˆ8ï¼‰ï¼šä»…ç”¨äºè¡¨ç¤ºè¯¥é¡µé¢æ˜¯å¦å¶å­é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¡µé¢æ ‡å¿—ä½åªå¯èƒ½æ˜¯ä»¥ä¸‹å‡ ç§ç»„åˆï¼Œå…¶ä½™ç»„åˆéƒ½è®¤ä¸ºæ–‡ä»¶æŸåäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTF_ZERODATAï¼šè¡¨ç¤ºè¿™æ˜¯ç´¢å¼•è¡¨çš„å†…éƒ¨é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PTF_ZERODATA | PTF_LEAFï¼šè¡¨ç¤ºè¿™æ˜¯ç´¢å¼•è¡¨çš„å¶å­é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PTF_LEAFDATA | PTF_INTKEYï¼šè¡¨ç¤ºæ•°æ®è¡¨çš„å†…éƒ¨é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PTF_LEAFDATA | PTF_INTKEY | PTF_LEAFï¼šè¡¨ç¤ºæ•°æ®è¡¨çš„å¶å­é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯´æ˜ï¼Œå…¶å®ä»¥ä¸Šå°±æ˜¯åˆ†æˆäº†ä¸¤ç»„&lt;code&gt;PTF_ZERODATA&lt;/code&gt;å’Œ&lt;code&gt;PTF_LEAFDATA | PTF_INTKEY&lt;/code&gt;ä¸&lt;code&gt;PTF_LEAF&lt;/code&gt;çš„ç»„åˆï¼ˆè§å‡½æ•°&lt;code&gt;decodeFlags&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTF_ZERODATAï¼šè‚¯å®šæ²¡æœ‰æ•°æ®ï¼ˆ&lt;code&gt;hasData&lt;/code&gt;ä¸€å®šä¸º0ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;PTF_LEAFDATA | PTF_INTKEYï¼šæ˜¯å¦æœ‰æ•°æ®ï¼Œå–å†³äºæ˜¯å¦æœ‰&lt;code&gt;PTF_LEAF&lt;/code&gt;æ ‡å¿—ä½ï¼ˆ&lt;code&gt;hasData&lt;/code&gt;å–å†³äºleaf ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç‰©ç†é¡µé¢çš„å¤§ä½“åˆ’åˆ†&#34;&gt;ç‰©ç†é¡µé¢çš„å¤§ä½“åˆ’åˆ†&lt;/h2&gt;
&lt;p&gt;æ¥çœ‹çœ‹sqliteä»£ç ä¸­&lt;code&gt;btreeInt.h&lt;/code&gt;æ–‡ä»¶é‡Œå¯¹btreeä¸€ä¸ªç‰©ç†é¡µé¢å†…æ•°æ®ç»„ç»‡çš„æ³¨é‡Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt; Each btree pages is divided into three &lt;span style=&#34;color:#a0a000&#34;&gt;sections&lt;/span&gt;:  The header, the
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt; cell pointer array, and the cell content area.  Page &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt; also has a &lt;span style=&#34;color:#666&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;byte
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt; file header that occurs before the page header.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; file header    &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;100&lt;/span&gt; bytes.  Page &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt; only.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; page header    &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;8&lt;/span&gt; bytes &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;for&lt;/span&gt; leaves.  &lt;span style=&#34;color:#666&#34;&gt;12&lt;/span&gt; bytes &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;for&lt;/span&gt; interior nodes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; cell pointer   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color:#666&#34;&gt;2&lt;/span&gt; bytes per cell.  Sorted order.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; array          &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;  Grows downward
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   v
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; unallocated    &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; space          &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;^&lt;/span&gt;  Grows upwards
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; cell content   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;  Arbitrary order interspersed with freeblocks.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt; area           &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color:#666&#34;&gt;|&lt;/span&gt;  and free space fragments.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#666&#34;&gt;**&lt;/span&gt;      &lt;span style=&#34;color:#666&#34;&gt;|----------------|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/page-format.png&#34; alt=&#34;é¡µé¢å†…æ•°ç»„çš„ç»„ç»‡&#34; title=&#34;é¡µé¢å†…æ•°ç»„çš„ç»„ç»‡&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§è¿™é‡Œçš„è¯´æ³•ï¼Œä¸€ä¸ªç‰©ç†é¡µé¢åœ¨btreeä¸­åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶å¤´ï¼ˆfile headerï¼‰ï¼š100å­—èŠ‚ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªé¡µé¢æ‰ä¼šå­˜åœ¨æ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢å¤´ï¼ˆpage headerï¼‰ï¼šæ¯ä¸ªé¡µé¢éƒ½ä¼šæœ‰é¡µé¢å¤´ï¼Œæ ¹æ®é¡µé¢çš„ç±»å‹åŒºåˆ†ï¼Œå¦‚æœæ˜¯å¶å­é¡µé¢å°±æ˜¯8å­—èŠ‚å¤§å°ï¼Œå¦‚æœæ˜¯å†…éƒ¨èŠ‚ç‚¹å°±æ˜¯12å­—èŠ‚å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨cellæŒ‡é’ˆçš„æ•°ç»„ï¼ˆcell pointer arrayï¼‰ï¼šæ¯ä¸ªcellæŒ‡é’ˆå¤§å°ä¸º2å­—èŠ‚ï¼ŒæŒ‰ç…§å­˜å‚¨çš„cellåœ°å€å¤§å°æ’åºï¼Œè¿™ä¸ªæ•°ç»„ä¸å®šé•¿ï¼Œå› æ­¤æ˜¯ä»ä½ä½å¾€é«˜ä½åœ°å€å¢é•¿çš„ã€‚è‡³äºä»€ä¹ˆæ˜¯&lt;code&gt;cell&lt;/code&gt;ï¼Œåé¢å±•å¼€è¯´ã€‚&lt;/li&gt;
&lt;li&gt;cellå†…å®¹ç©ºé—´ï¼ˆcell content areaï¼‰ï¼šå­˜å‚¨cellæ•°æ®çš„ç©ºé—´ï¼Œä»ä¸€ä¸ªç‰©ç†é¡µé¢çš„æœ€é«˜ä½ç½®å¾€ä½ä½å¢é•¿ã€‚&lt;/li&gt;
&lt;li&gt;æœªåˆ†é…ç©ºé—´ï¼ˆunallocated spaceï¼‰ï¼šä¸Šé¢ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œä¸€éƒ¨åˆ†ä»ä»é«˜å¾€ä½å¢é•¿ï¼Œå¦ä¸€éƒ¨åˆ†åä¹‹ï¼Œè€Œæœªåˆ†é…ç©ºé—´å°±å¤¹åœ¨è¿™ä¸¤è€…ä¸­é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰äº†è¿™é‡Œå¤§ä½“çš„åˆ’åˆ†ï¼Œæˆ‘ä»¬æ¥å±•å¼€çœ‹çœ‹å…·ä½“çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;file-headeræ–‡ä»¶å¤´&#34;&gt;file headerï¼ˆæ–‡ä»¶å¤´ï¼‰&lt;/h2&gt;
&lt;p&gt;å…¶ä¸­ï¼Œfile headeréƒ¨åˆ†åªæœ‰ç¬¬ä¸€é¡µæ‰æœ‰ï¼Œå›ºå®šé•¿åº¦100å­—èŠ‚ï¼Œå­˜å‚¨æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;é¡µé¢1æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é¡µé¢ï¼Œå…¶å‰100ä¸ªå­—èŠ‚æ˜¯æ•´ä¸ªæ•°æ®åº“çš„headeréƒ¨åˆ†ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;**   OFFSET   SIZE    DESCRIPTION
**      0      16     Header string: &amp;#34;SQLite format 3\000&amp;#34;
**     16       2     Page size in bytes.  
**     18       1     File format write version
**     19       1     File format read version
**     20       1     Bytes of unused space at the end of each page
**     21       1     Max embedded payload fraction
**     22       1     Min embedded payload fraction
**     23       1     Min leaf payload fraction
**     24       4     File change counter
**     28       4     Reserved for future use
**     32       4     First freelist page
**     36       4     Number of freelist pages in the file
**     40      60     15 4-byte meta values passed to higher layers
**
** All of the integer values are big-endian (most significant byte first).
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€ä¸ªè§£æè¿™ä¸ªheaderé‡Œçš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-16å­—èŠ‚ï¼šmagic stringã€‚&lt;/li&gt;
&lt;li&gt;16-18å­—èŠ‚ï¼šé¡µé¢å¤§å°ï¼Œä¸èƒ½å°äº512æˆ–è€…å¤§äº32768ï¼ŒåŒæ—¶éœ€è¦æ˜¯8ä½å¯¹é½ã€‚&lt;/li&gt;
&lt;li&gt;18-19ï¼šå¤§äº1è¡¨ç¤ºæ•°æ®åº“åªè¯»ã€‚&lt;/li&gt;
&lt;li&gt;19-20ï¼šå¿…é¡»å¤§äº1ã€‚&lt;/li&gt;
&lt;li&gt;20-21ï¼šæ¯ä¸ªé¡µé¢æœ€åæ— ç”¨ç©ºé—´çš„å¤§å°ã€‚å³å¯ç”¨ç©ºé—´=é¡µé¢å¤§å°-æ— ç”¨ç©ºé—´ï¼Œè¿™éƒ¨åˆ†ç©ºé—´ä¸å¾—å°äº500å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;21-23ï¼šå†™æ­»äº†å¿…é¡»æ˜¯&amp;quot;\100\040\040&amp;quot;ã€‚å…¶ä¸­ï¼š
&lt;ul&gt;
&lt;li&gt;21ï¼šMax embedded payload fractionï¼Œå†™æ­»äº†æ˜¯64ã€‚&lt;/li&gt;
&lt;li&gt;22ï¼šMin embedded payload fractionï¼Œå†™æ­»äº†æ˜¯32ã€‚&lt;/li&gt;
&lt;li&gt;23ï¼šMin leaf payload fraction&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;24-28ï¼šFile change counter&lt;/li&gt;
&lt;li&gt;32-36ï¼šç¬¬ä¸€ä¸ªç©ºé—²é¡µé¢ç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;36-40ï¼šç©ºé—²é¡µé¢æ•°é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;page-headeré¡µé¢å¤´&#34;&gt;page headerï¼ˆé¡µé¢å¤´ï¼‰&lt;/h2&gt;
&lt;p&gt;é™¤äº†ç¬¬ä¸€é¡µä»¥å¤–ï¼Œå…¶ä»–æƒ…å†µä¸‹é¡µé¢å¤´åœ¨é¡µé¢çš„å¼€å§‹ä½ç½®ï¼ˆå³åç§»é‡ä¸º0å¼€å§‹ï¼‰ï¼Œç¬¬ä¸€é¡µä»åç§»é‡100å¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;** The page headers looks like this:
**
**   OFFSET   SIZE     DESCRIPTION
**      0       1      Flags. 1: intkey, 2: zerodata, 4: leafdata, 8: leaf
**      1       2      byte offset to the first freeblock
**      3       2      number of cells on this page
**      5       2      first byte of the cell content area
**      7       1      number of fragmented free bytes
**      8       4      Right child (the Ptr(N) value).  Omitted on leaves.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ†æå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-1ï¼šè¡¨ç¤ºé¡µé¢ç±»å‹çš„æ ‡å¿—ä½ï¼Œè‡³äºé¡µé¢çš„ç±»å‹ä¸Šé¢å·²ç»æœ‰é˜è¿°ã€‚&lt;/li&gt;
&lt;li&gt;1-2ï¼šé¦–ä¸ªç©ºé—²blockåœ¨é¡µé¢å†…çš„åç§»é‡ã€‚&lt;/li&gt;
&lt;li&gt;3-5ï¼šcellæ•°ç»„çš„å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;5-7ï¼šcell contentçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;7-8ï¼šç¢ç‰‡ç©ºé—´æ€»å¤§å°ï¼ˆæ³¨æ„ä¸æ˜¯ç©ºé—²ç©ºé—´ï¼‰ï¼Œsqliteä¸­å°†å°äº4å­—èŠ‚çš„ç©ºé—²ç©ºé—´ç§°ä¸º&lt;code&gt;ç¢ç‰‡ç©ºé—´&lt;/code&gt;ï¼Œä¸€æ—¦ç¢ç‰‡ç©ºé—´å¤§å°ç´¯ç§¯åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±éœ€è¦è¿›è¡Œç¢ç‰‡æ•´ç†ï¼Œè¿™åœ¨ä¸‹é¢å±•å¼€è¯´æ˜ã€‚&lt;/li&gt;
&lt;li&gt;8-12ï¼ˆå¶å­é¡µé¢æ²¡æœ‰è¿™éƒ¨åˆ†å†…å®¹ï¼‰ï¼šå³å­æ ‘é¡µé¢çš„é¡µé¢ç¼–å·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‡ç‚¹è§£é‡Šå…¶ä¸­çš„å‡ éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;h3 id=&#34;cellæ•°ç»„&#34;&gt;cellæ•°ç»„&lt;/h3&gt;
&lt;p&gt;cellæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ å¤§å°ä¸º2å­—èŠ‚ï¼ŒæŒ‡å‘å¯¹åº”cellå†…å®¹åœ¨é¡µé¢ä¸­çš„ä½ç½®ã€‚ç”±äºä¸€ä¸ªé¡µé¢ä¸ä¼šè¶…è¿‡65535å­—èŠ‚å¤§å°ï¼Œæ‰€ä»¥2å­—èŠ‚æ˜¯è¶³å¤Ÿè¡¨ç¤ºè¿™ä¸ªé¡µé¢å†…çš„åç§»é‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œcellæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæ˜¯æŒ‰ç…§keyçš„å¤§å°æœ‰å°åˆ°å¤§æŒ‰é¡ºåºæ’åˆ—çš„ï¼Œè¿™æ ·æ‰èƒ½æ–¹ä¾¿æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†å¯¹ç‰©ç†é¡µé¢å†…æ•°æ®ç»„ç»‡çš„äº†è§£ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥æ‰¾æ•°æ®æ—¶ï¼Œé¦–å…ˆæŒ‰ç…§æŒ‰ç…§btreeçš„ç®—æ³•ï¼Œå®šä½åˆ°æ•°æ®æ‰€åœ¨çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å†åœ¨é¡µé¢å†…çš„cellæ•°ç»„ä¸­ï¼Œæ ¹æ®keyå¤§å°è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/find-key.png&#34; alt=&#34;æŸ¥æ‰¾keyçš„æµç¨‹&#34; title=&#34;æŸ¥æ‰¾keyçš„æµç¨‹&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç©ºé—²ç©ºé—´é“¾è¡¨&#34;&gt;ç©ºé—²ç©ºé—´é“¾è¡¨&lt;/h3&gt;
&lt;p&gt;æ‰€è°“çš„â€œç©ºé—²ç©ºé—´â€ï¼Œå°±æ˜¯å¤¹åœ¨&lt;code&gt;cellæ•°ç»„&lt;/code&gt;å’Œ&lt;code&gt;cellå†…å®¹æ•°ç»„&lt;/code&gt;ä¸­é—´çš„éƒ¨åˆ†ï¼Œæœ€å¼€å§‹æ˜¯ä¸€å¤§æ•´å—çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯éšç€å†™å…¥æ“ä½œè¿›è¡Œï¼Œæ¯”å¦‚ä¸€è¡Œæ•°æ®è¢«åˆ é™¤ä¹‹åï¼Œå›æ”¶çš„ç©ºé—´å°±ä¼šæ”¾åˆ°ç©ºé—²ç©ºé—´é“¾è¡¨ä¸Šã€‚ç©ºé—²ç©ºé—´é“¾è¡¨å°±æ˜¯ç”¨æ¥ç»„ç»‡ç°åœ¨ç©ºé—²ç©ºé—´çš„æ•°æ®çš„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ ä¸º4å­—èŠ‚ï¼Œå…¶å†…å®¹æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;   **    SIZE    DESCRIPTION
   **      2     Byte offset of the next freeblock
   **      2     Bytes in this freeblock
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-2å­—èŠ‚ï¼šä¸‹ä¸€å—ç©ºé—²ç©ºé—´é“¾è¡¨çš„é¡µå†…åç§»é‡ã€‚&lt;/li&gt;
&lt;li&gt;3-4å­—èŠ‚ï¼šå½“å‰è¿™å—ç©ºé—²ç©ºé—´çš„å¤§å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ï¼Œç©ºé—²ç©ºé—´é“¾è¡¨æ˜¯æŒ‰ç…§èµ·å§‹åœ°å€é€’å¢è¿›è¡Œæ’åºçš„ï¼Œè¿™æ ·æ‰èƒ½åœ¨ä»ç©ºé—²ç©ºé—´ä¸­åˆ†é…ç©ºé—´æ—¶é«˜æ•ˆæŸ¥æ‰¾æœ€åˆé€‚çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/freelist.png&#34; alt=&#34;ç©ºé—²åŒºé“¾è¡¨&#34; title=&#34;ç©ºé—²åŒºé“¾è¡¨&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç¢ç‰‡ç©ºé—´æ€»å¤§å°&#34;&gt;ç¢ç‰‡ç©ºé—´æ€»å¤§å°&lt;/h3&gt;
&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºé—²ç©ºé—´è‡³å°‘éœ€è¦4å­—èŠ‚ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªç©ºé—²ç©ºé—´ä¸è¶³4å­—èŠ‚æ—¶ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆ’ç®—çš„ã€‚æ‰€ä»¥ï¼Œå°†æ‰€æœ‰ç©ºé—²çš„ã€ä¸”å°äº4å­—èŠ‚çš„ç©ºé—´ï¼Œç§°ä¸ºâ€œç¢ç‰‡ç©ºé—´â€ï¼Œå…¶æ€»å¤§å°è®°å½•åœ¨å¤´çš„7-8å­—èŠ‚å¤„ï¼Œå½“è¿™ä¸ªå€¼è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶å°†è¿›è¡Œé¡µé¢ç¢ç‰‡ç©ºé—´æ•´ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¡µé¢æ ‡å¿—ä½&#34;&gt;é¡µé¢æ ‡å¿—ä½&lt;/h3&gt;
&lt;p&gt;è§å‰é¢&lt;code&gt;é¡µé¢ç±»å‹&lt;/code&gt;éƒ¨åˆ†çš„è§£é‡Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;cellçš„ç»“æ„&#34;&gt;cellçš„ç»“æ„&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ª&lt;code&gt;cell&lt;/code&gt;ï¼Œå°±æ˜¯å­˜å‚¨ä¸€è¡Œæ•°æ®çš„å•ä½ï¼Œç”±äºè¦è€ƒè™‘ä¸€è¡Œæ•°æ®æœ‰ä¸åŒçš„é•¿åº¦ï¼Œå› æ­¤&lt;code&gt;cell&lt;/code&gt;é‡Œé¢å°±è¦æœ‰åº”å¯¹å˜é•¿æ•°æ®çš„å‡†å¤‡ï¼Œæ¥çœ‹&lt;code&gt;cell&lt;/code&gt;çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;** The content of a cell looks like this:
**
**    SIZE    DESCRIPTION
**      4     Page number of the left child. Omitted if leaf flag is set.
**     var    Number of bytes of data. Omitted if the zerodata flag is set.
**     var    Number of bytes of key. Or the key itself if intkey flag is set.
**      *     Payload
**      4     First page of the overflow chain.  Omitted if no overflow
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€ä¸ªè§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-4ï¼šå·¦å­æ ‘çš„é¡µé¢ç¼–å·ï¼ˆå¦‚æœæ˜¯å¶å­é¡µé¢è¿™éƒ¨åˆ†æ²¡æœ‰ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å˜é•¿ï¼šæ•°æ®éƒ¨åˆ†çš„å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;å˜é•¿ï¼škeyéƒ¨åˆ†çš„å¤§å°ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªé¡µé¢æ˜¯&lt;code&gt;intkey&lt;/code&gt;é¡µé¢ï¼Œè¿™éƒ¨åˆ†ç›´æ¥ç”¨æ¥ä¿å­˜intç±»å‹çš„keyï¼Œå³è¿™ç§æƒ…å†µä¸‹intç±»å‹keyä¸ä¼šå‡ºç°åœ¨åé¢çš„payloadéƒ¨åˆ†ï¼Œè€Œæ˜¯ç›´æ¥å­˜åœ¨åœ¨keyéƒ¨åˆ†å¤§å°çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å˜é•¿ï¼špayloadã€‚&lt;/li&gt;
&lt;li&gt;4å­—èŠ‚ï¼šå¦‚æœå­˜åœ¨overflowé¡µé¢çš„è¯ï¼Œè¿™é‡Œå­˜å‚¨ç¬¬ä¸€ä¸ªoverflowé¡µé¢çš„é¡µé¢ç¼–å·ï¼Œä½•ä¸ºæº¢å‡ºé¡µé¢ä¸‹é¢å†åšè§£é‡Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºå¶å­é¡µé¢æ²¡æœ‰å·¦å­æ ‘ï¼Œæ‰€ä»¥ä¸éœ€è¦å­˜å‚¨&lt;code&gt;å·¦å­æ ‘é¡µé¢ç¼–å·&lt;/code&gt;ï¼Œå› ä¸ºå¦‚æœæ˜¯å¶å­é¡µé¢çš„è¯ï¼Œé¡µé¢å¤´çš„å¤§å°å°±åªæœ‰8å­—èŠ‚ï¼Œåä¹‹å¦‚æœæ˜¯å†…éƒ¨èŠ‚ç‚¹å°±éœ€è¦12å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/cell-content-format.png&#34; alt=&#34;cellç»“æ„&#34; title=&#34;cellç»“æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œæ ¹æ®è¡¨ç±»å‹çš„ä¸åŒï¼Œkeyã€dataã€payloadéƒ¨åˆ†çš„å¤§å°å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;intç±»å‹çš„keyï¼ˆå³table treeï¼‰ï¼šnPayload ä¸ nDataæ’ç›¸ç­‰ï¼Œå› ä¸ºintç±»å‹çš„è¡¨ï¼Œç”±äºkeyå°±æ˜¯ä¸€ä¸ªæ•´å‹æ•°ï¼Œæ‰€ä»¥ä¸æµªè´¹ç©ºé—´å­˜å‚¨è¿™ä¸ªæ•´å‹æ•°çš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥æ”¾åœ¨keyå¤§å°éƒ¨åˆ†ã€‚åŒºåˆ†æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ— æ•°æ®ï¼ˆå³å†…éƒ¨èŠ‚ç‚¹ï¼‰ï¼šå› ä¸ºnPayload ä¸ nDataæ’ç›¸ç­‰ï¼Œæ‰€ä»¥è¿™æ—¶å€™nData = nPayload = 0ã€‚ï¼ˆåˆ†æè¿™ç±»å‹é¡µé¢cellæ•°æ®çš„å…¥å£å‡½æ•°æ˜¯&lt;code&gt;btreeParseCellPtrNoPayload&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æœ‰æ•°æ®ï¼ˆå³å¶å­é¡µé¢ï¼‰ï¼šnData = nPayload = å˜é•¿æ•°æ®çš„å¤§å°ã€‚ï¼ˆåˆ†æè¿™ç±»å‹é¡µé¢cellæ•°æ®çš„å…¥å£å‡½æ•°æ˜¯&lt;code&gt;btreeParseCellPtr&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éintç±»å‹çš„è¡¨ï¼ˆå³index treeï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;è¿™ç§ç±»å‹çš„é¡µé¢ï¼Œè‚¯å®šæ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Œåªæœ‰keyéƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™æ—¶å€™nPayload = nKeyã€‚ï¼ˆåˆ†æè¿™ç±»å‹é¡µé¢cellæ•°æ®çš„å…¥å£å‡½æ•°æ˜¯&lt;code&gt;btreeParseCellPtrIndex&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéintç±»å‹çš„è¡¨ï¼Œä¼šæ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œå®Œæ•´çš„æ•°æ®ï¼Œéƒ½ä»¥rowidä¸ºkeyçš„æƒ…å†µï¼Œå­˜å‚¨åœ¨äº†intç±»å‹çš„è¡¨ä¸­ï¼›è€Œéintç±»å‹çš„è¡¨ï¼Œåªè¦å­˜å‚¨è¿™ä¸ªè¡¨çš„é”®å€¼æ•´æ•°å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è€Œæº¢å‡ºé¡µé¢çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;** Overflow pages form a linked list.  Each page except the last is completely
** filled with data (pagesize - 4 bytes).  The last page can have as little
** as 1 byte of data.
**
**    SIZE    DESCRIPTION
**      4     Page number of next overflow page
**      *     Data
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å³ï¼šå¯¹äºå­˜å‚¨æº¢å‡ºæ•°æ®çš„é¡µé¢è€Œè¨€ï¼Œå¤´éƒ¨çš„4å­—èŠ‚å­˜å‚¨ä¸‹ä¸€ä¸ªæº¢å‡ºé¡µé¢çš„é¡µé¢ç¼–å·ï¼ˆå¦‚æœè¿˜æœ‰æº¢å‡ºé¡µé¢çš„è¯ï¼‰ï¼Œè€Œå‰©ä½™åˆ™å­˜å‚¨æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆèµ·æ¥ï¼Œä¸€ä¸ªå­˜å‚¨äº†æº¢å‡ºæ•°æ®ï¼ˆå³å½“å‰é¡µé¢ä¸è¶³ä»¥å­˜å‚¨è¿™ä¸ªcellçš„æ‰€æœ‰æ•°æ®ï¼‰çš„ç»“æ„å¤§ä½“æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/cell-overflow.png&#34; alt=&#34;æœ‰æº¢å‡ºé¡µé¢çš„cellç»“æ„&#34; title=&#34;æœ‰æº¢å‡ºé¡µé¢çš„cellç»“æ„&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç©ºé—´åˆ©ç”¨å’Œç¢ç‰‡æ•´ç†&#34;&gt;ç©ºé—´åˆ©ç”¨å’Œç¢ç‰‡æ•´ç†&lt;/h1&gt;
&lt;p&gt;äº†è§£äº†ä¸€ä¸ªç‰©ç†é¡µé¢å†…éƒ¨çš„ç»“æ„ï¼Œæ¥ä¸‹æ¥çœ‹ç¢ç‰‡æ•´ç†çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æœ‰ç©ºé—²é“¾è¡¨ç”¨äºç»„ç»‡å·²è¢«å›æ”¶çš„ç©ºé—´ï¼Œä½†æ˜¯éšç€åˆ†é…çš„è¿›è¡Œï¼Œè¿˜æ˜¯ä¼šäº§ç”Ÿå„ç§å¤§å°çš„ç¢ç‰‡ã€‚å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šè™½ç„¶ç©ºé—²ç©ºé—´çš„æ€»å¤§å°å¤Ÿç”¨ï¼Œä½†æ˜¯ç”±äºæ•£è½åœ¨å„å—ç¢ç‰‡ç©ºé—´é‡Œï¼Œä»¥è‡³äºæ— æ³•åˆ†é…æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦&lt;code&gt;ç¢ç‰‡æ•´ç†&lt;/code&gt;æµç¨‹ï¼Œè¿™ä¸ªæµç¨‹åšå®Œä¹‹åï¼Œè¦è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼šç©ºé—²é“¾è¡¨ä¸Šåªæœ‰ä¸€å—å¤§çš„æ•´ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æ¥çœ‹çœ‹&lt;code&gt;ç¢ç‰‡æ•´ç†&lt;/code&gt;çš„è§¦å‘æ¡ä»¶å’Œè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¢ç‰‡æ•´ç†çš„è§¦å‘æ¡ä»¶&#34;&gt;ç¢ç‰‡æ•´ç†çš„è§¦å‘æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;åˆ†é…ç©ºé—´çš„å…¥å£å‡½æ•°æ˜¯&lt;code&gt;allocateSpace&lt;/code&gt;ï¼Œå…¶å…¥å‚&lt;code&gt;nByte&lt;/code&gt;è¡¨ç¤ºéœ€è¦ä»é¡µé¢ä¸­åˆ†é…å¤§å°ä¸º&lt;code&gt;nByte&lt;/code&gt;çš„ç©ºé—´è¿”å›ã€‚è¿›å…¥è¿™ä¸ªå‡½æ•°æ—¶ï¼Œéƒ½ä¼šé¦–å…ˆåˆ¤æ–­ï¼šé¡µé¢å‰©ä½™çš„ç©ºé—²ç©ºé—´æ˜¯è¶³å¤Ÿæ»¡è¶³&lt;code&gt;nByte&lt;/code&gt;çš„ï¼Œä½†æ˜¯å³ä¾¿å¦‚æ­¤ä¹Ÿå¯èƒ½ç”±äºç¢ç‰‡å¤ªå¤šå¯¼è‡´ä¸èƒ½å†åˆ†é…äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°çš„å¤§ä½“é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°è¯•åœ¨ç©ºé—²é“¾è¡¨ä¸­æ‰¾åˆ°åˆé€‚çš„ç©ºé—´åˆ†é…ã€‚ï¼ˆå‡½æ•°&lt;code&gt;pageFindSlot&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸Šé¢åˆ†é…ä¸æˆåŠŸï¼Œä¸”å½“å‰ç”šè‡³åœ¨cellæŒ‡é’ˆæ•°ç»„ä¸­éƒ½åˆ†é…ä¸å‡º2å­—èŠ‚æ¥å­˜å‚¨æ–°åˆ†é…å‡ºæ¥çš„cellåœ°å€ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œç¢ç‰‡æ•´ç†ã€‚ï¼ˆå‡½æ•°&lt;code&gt;defragmentPage&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ç¢ç‰‡æ•´ç†ç»“æŸä¹‹åï¼Œåˆ’å‡ºè¶³å¤Ÿçš„ç©ºé—´ï¼ˆ2å­—èŠ‚çš„cellæŒ‡é’ˆ+å¯¹åº”å¤§å°çš„cellå¤§å°ï¼‰è¿”å›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œåˆ†åˆ«æ¥çœ‹ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ¥çœ‹ä»€ä¹ˆæƒ…å†µä¸‹åœ¨ç©ºé—²é“¾è¡¨ä¸­åˆ†é…ä¸å‡ºé€‚åˆçš„ç©ºé—´ï¼Œå…¥å£å‡½æ•°æ˜¯&lt;code&gt;pageFindSlot&lt;/code&gt;ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºç©ºé—²é“¾è¡¨æ˜¯æŒ‰ç…§ç©ºé—²å—å¤§å°ä»å°åˆ°å¤§æ’åˆ—çš„ï¼Œå› æ­¤é¦–å…ˆæŒ‰åºæ‰¾åˆ°ç¬¬ä¸€å—æ»¡è¶³&lt;code&gt;nByte&lt;/code&gt;å¤§å°çš„ç©ºé—²å—ï¼Œå‡è®¾è¿™ä¸ªç©ºé—²å—åˆ’æ‰&lt;code&gt;nByte&lt;/code&gt;å¤§å°ä¹‹åä¸º&lt;code&gt;x&lt;/code&gt;ï¼Œè‹¥è¿™ä¸ª&lt;code&gt;x&lt;/code&gt;å°äº4å­—èŠ‚é‚£ä¹ˆè®¤ä¸ºæ˜¯ä¸€ä¸ª&lt;code&gt;ç¢ç‰‡&lt;/code&gt;ï¼Œå‡å¦‚å½“å‰çš„ç¢ç‰‡ç´¯åŠ èµ·æ¥è¶…è¿‡60å­—èŠ‚äº†ï¼Œé‚£ä¹ˆè®¤ä¸ºç¢ç‰‡è¿‡å¤šï¼Œè¿™æ—¶å€™å³ä¾¿èƒ½æ»¡è¶³åˆ†é…ä¹Ÿä¸èƒ½ç»§ç»­åˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºä¸ºä»€ä¹ˆå°äº4å­—èŠ‚è®¤ä¸ºæ˜¯ç¢ç‰‡ï¼Œä»¥åŠä¸ºä»€ä¹ˆç¢ç‰‡æ€»å¤§å°è¶…è¿‡60å­—èŠ‚å°±è®¤ä¸ºç¢ç‰‡è¿‡å¤šï¼Œå¯èƒ½æ˜¯ä½œè€…çš„ç»éªŒå€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒç§æƒ…å†µï¼Œå°±æ˜¯éå†äº†æ•´ä¸ªé“¾è¡¨éƒ½æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³&lt;code&gt;nByte&lt;/code&gt;å¤§å°çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå½“å‰cellæ•°ç»„ç»“æŸä½ç½®ï¼Œè·ç¦»cellå†…å®¹åŒºåŸŸä¸è¶³2å­—èŠ‚ï¼Œå³æ— æ³•å†åˆ†é…ä¸€ä¸ªcellæŒ‡é’ˆå‡ºæ¥ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œç¢ç‰‡æ•´ç†äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/defragment.png&#34; alt=&#34;è§¦å‘ç¢ç‰‡æ•´ç†çš„æ¡ä»¶&#34; title=&#34;è§¦å‘ç¢ç‰‡æ•´ç†çš„æ¡ä»¶&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹è§¦å‘ç¢ç‰‡æ•´ç†çš„æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»ç©ºé—²é“¾è¡¨ä¸­åˆ†é…ç©ºé—´å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¸”ï¼Œåœ¨&lt;code&gt;cellæŒ‡é’ˆæ•°ç»„&lt;/code&gt;ä»¥åŠ&lt;code&gt;cellå†…å®¹åŒºåŸŸ&lt;/code&gt;çš„ç©ºé—´ï¼Œå·²ç»ä¸è¶³2å­—èŠ‚ï¼Œå³è¿å¯¹åº”çš„cellæŒ‡é’ˆéƒ½æ— æ³•åˆ†é…å‡ºæ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¢ç‰‡æ•´ç†çš„æµç¨‹&#34;&gt;ç¢ç‰‡æ•´ç†çš„æµç¨‹&lt;/h2&gt;
&lt;p&gt;ç¢ç‰‡æ•´ç†çš„æµç¨‹ï¼Œå…¶å®ç›¸å¯¹ç®€å•ï¼Œç®€è€Œè¨€ä¹‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠå„å—cellå†…å®¹ï¼Œå…¨éƒ¨æ•´ç†åˆ°ä»é¡µé¢ç»“å°¾å¼€å§‹çš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œå°±èƒ½æŠŠæ•£è½åœ¨å„å¤„çš„ç©ºé—²ç©ºé—´é‡æ–°åˆå¹¶åœ¨ä¸€èµ·å½¢æˆä¸€å¤§å—çš„ç©ºé—²ç©ºé—´äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220201-sqlite-btree-5-btree/defragmentPage.png&#34; alt=&#34;ç¢ç‰‡æ•´ç†å‰å&#34; title=&#34;ç¢ç‰‡æ•´ç†å‰å&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¢ç‰‡æ•´ç†çš„æ•´ä½“æµç¨‹åœ¨å‡½æ•°&lt;code&gt;defragmentPage&lt;/code&gt;ä¸­ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;sqliteä¸­åˆ†ä¸ºtable treeï¼ˆå­˜å‚¨å…¨é‡æ•°æ®ï¼‰å’Œindex treeï¼ˆå­˜å‚¨ä»»æ„ç´¢å¼•åˆ°rowidçš„å¯¹åº”å…³ç³»ï¼‰ï¼Œtable treeæœ¬è´¨æ˜¯ä¸€æ£µb+treeï¼Œè€Œindex treeæ˜¯ä¸€æ£µbtreeã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ç‰©ç†é¡µé¢å†…éƒ¨ï¼Œæœ‰æ ¹æ®keyå¤§å°æ’åºçš„cellæ•°ç»„ï¼ŒæŸ¥æ‰¾æ•°æ®æ—¶åˆ†ä¸ºä¸¤æ­¥ï¼š
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ ¹æ®btreeç®—æ³•å®šä½åˆ°æ•°æ®æ‰€åœ¨çš„ç‰©ç†é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶ååœ¨è¯¥ç‰©ç†é¡µé¢å†…éƒ¨çš„cellæ•°ç»„ä¸­ï¼ŒäºŒåˆ†æŸ¥æ‰¾å®šä½keyçš„ä½ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‰©ç†é¡µé¢å†…çš„ç©ºé—²ç©ºé—´ä½¿ç”¨é“¾è¡¨ç»´æŠ¤èµ·æ¥ï¼Œå°äº4å­—èŠ‚çš„ç©ºé—²ç©ºé—´è¢«ç§°ä¸ºâ€œç¢ç‰‡ç©ºé—´â€ï¼Œå½“ç¢ç‰‡ç©ºé—´ç´¯è®¡å¤§å°è¶…è¿‡60å­—èŠ‚æ—¶ï¼Œå°±ä¼šè¿›è¡Œç¢ç‰‡æ•´ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlite.org/btreemodule.html&#34;&gt;SQLite B-Tree Module&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlite.org/fileformat.html&#34;&gt;Database File Format&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://barbra-coco.dyndns.org/sqlite/fileformat.html&#34;&gt;SQLite Database File Format&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç°</title>
      <link>https://www.codedump.info/post/20220106-sqlite-btree-4-wal/</link>
      <pubDate>Thu, 06 Jan 2022 21:48:18 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20220106-sqlite-btree-4-wal/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;å‰é¢ä¸¤èŠ‚ï¼Œåˆ†åˆ«è®²è§£äº†sqliteä¸­å†™å…¥äº‹åŠ¡æ—¶çš„å¹¶å‘æ§åˆ¶æ¡†æ¶ï¼Œä»¥åŠjournalå¤‡ä»½æ–‡ä»¶çš„å®ç°æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å›å¿†ä¸€ä¸‹journalå¤‡ä»½æ–‡ä»¶çš„å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡ä¸€ä¸ªæ–°çš„å†™äº‹åŠ¡å¼€å§‹ä¹‹å‰ï¼Œè¦é¦–å…ˆå†™journalæ–‡ä»¶çš„æ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;å†™äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¿®æ”¹äº†å“ªä¸ªé¡µé¢ï¼Œåœ¨ä¿®æ”¹ä¹‹å‰éœ€è¦é¦–å…ˆå°†è¿™ä¸ªé¡µé¢çš„å†…å®¹å†™å…¥åˆ°journalæ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å†™äº‹åŠ¡å®Œæˆåï¼Œåœ¨åŒæ­¥æ‰€æœ‰ç¼“å­˜ä¸­è¢«ä¿®æ”¹çš„é¡µé¢åˆ°æ•°æ®åº“æ–‡ä»¶ä¹‹å‰ï¼Œè¦é¦–å…ˆå°†journalæ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¿®æ”¹åŒæ­¥åˆ°ç£ç›˜ï¼Œç„¶åå†ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œjournalå¤‡ä»½çš„æ•´ä¸ªæµç¨‹éƒ½è¾ƒä¸ºåŸå§‹ï¼Œæ€§èƒ½ä¸é«˜ï¼Œæ‰€ä»¥åœ¨sqlite 3.7.0ç‰ˆæœ¬ï¼ˆ&lt;a href=&#34;https://www.sqlite.org/releaselog/3_7_0.html&#34;&gt;SQLite Release 3.7.0 On 2010-07-21&lt;/a&gt;ï¼Œ2010-07-21ï¼‰ä¸­ï¼Œå¼•å…¥äº†å¦ä¸€ç§å¤‡ä»½æœºåˆ¶ï¼šWALï¼ˆWrite Ahead Logï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚é¦–å…ˆä»‹ç»WALçš„å®ç°åŸç†ï¼Œç„¶åå†å±•å¼€å…¶å…·ä½“çš„å®ç°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;walå·¥ä½œåŸç†&#34;&gt;WALå·¥ä½œåŸç†&lt;/h1&gt;
&lt;p&gt;ä»å‰é¢journalçš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå†™å…¥journalæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ˜¯å¾…ä¿®æ”¹é¡µé¢ä¿®æ”¹ä¹‹å‰çš„å†…å®¹ï¼Œè€ŒWALåˆ™ç›¸åï¼šè¢«ä¿®æ”¹çš„é¡µé¢å†…å®¹é¦–å…ˆå†™å…¥åˆ°WALä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨sqliteå®˜ç½‘çš„æ–‡å­—æ¥è¯´ï¼ŒWALæ–‡ä»¶çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The write-ahead log or &amp;ldquo;wal&amp;rdquo; file is a roll-forward journal that records transactions that have been committed but not yet applied to the main database.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å³WALæ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯è¢«ä¿®æ”¹ä½†æ˜¯è¿˜æ²¡æœ‰å†™å…¥æ•°æ®åº“æ–‡ä»¶çš„é¡µé¢å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/page-backup.png&#34; alt=&#34;ä¸¤ç§é¡µé¢å¤‡ä»½æœºåˆ¶&#34; title=&#34;ä¸¤ç§é¡µé¢å¤‡ä»½æœºåˆ¶&#34;&gt;&lt;/p&gt;
&lt;p&gt;WALæ•´ä½“çš„å®ç°æœºåˆ¶ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹é¡µé¢çš„ä¿®æ”¹ï¼Œå¯ä»¥åªå†™å…¥åˆ°WALæ–‡ä»¶ä¸­å°±è®¤ä¸ºå®Œæˆï¼Œä¸å¿…ä¸€å®šè¦è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶æ‰èƒ½ç®—å®Œæˆï¼Œè¿™ä¸ªè®¾å®šä¿è¯äº†WALçš„ä¿®æ”¹æ“ä½œæ¯”journalæ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºä¸Šé¢çš„è¿™ä¸€ç‚¹ä¿è¯ï¼ŒåŒä¸€æ—¶é—´çš„å¹¶å‘è¯»æ“ä½œï¼Œèƒ½ç»§ç»­è¯»æ•°æ®åº“ä¸­æœªä¿®æ”¹çš„å†…å®¹ï¼Œæå¤§æå‡äº†è¯»å¹¶å‘çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å½“ç„¶WALä¹Ÿä¸èƒ½æ— é™åˆ¶çš„ä¸€ç›´å†™ä¸‹å»ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œè§¦å‘å°†ä¿å­˜åœ¨WALä¸­çš„é¡µé¢å†…å®¹å†™å…¥å›åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæµç¨‹è¢«ç§°ä¸º&lt;code&gt;checkpoint&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;walç›¸å…³æ–‡ä»¶ç»“æ„&#34;&gt;WALç›¸å…³æ–‡ä»¶ç»“æ„&lt;/h2&gt;
&lt;p&gt;åœ¨å·¥ä½œåŸç†éƒ¨åˆ†ï¼Œåªä¼šç®€å•è®²è§£WALç›¸å…³æ–‡ä»¶ç»“æ„ï¼Œå…·ä½“çš„æ ¼å¼ç­‰ç»†èŠ‚ç•™å¾…ä¸‹é¢çš„å®ç°éƒ¨åˆ†è¯¦ç»†è®²è§£ã€‚&lt;/p&gt;
&lt;p&gt;WALæ–‡ä»¶æœ¬èº«çš„æ ¼å¼å¾ˆç®€å•ï¼Œæœ‰å¦‚ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WALæ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;ç´§è·Ÿç€æ–‡ä»¶å¤´ä¹‹åçš„ï¼Œå°±æ˜¯ç”±ä¿®æ”¹ä¹‹åçš„é¡µé¢å†…å®¹ç»„æˆçš„é¡µé¢å†…å®¹æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œå½“äº‹åŠ¡è¢«æäº¤æ—¶ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªç‰¹æ®Šçš„WALæ—¥å¿—ï¼Œæ ‡è®°è¿™ä¸ªäº‹åŠ¡æäº¤äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¢è¨€ä¹‹ï¼Œä¸€ä¸ªWALä¸­ï¼Œå¯èƒ½å…ˆåå­˜å‚¨äº†å¤šä¸ªäº‹åŠ¡çš„å†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºWALæ–‡ä»¶ä¿å­˜çš„&lt;strong&gt;ä¿®æ”¹é¡µé¢&lt;/strong&gt;çš„å†…å®¹ï¼ŒåŒä¸€ä¸ªé¡µé¢ï¼Œå¯èƒ½åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­è¢«å¤šæ¬¡ä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/wal-and-index.png&#34; alt=&#34;WALåŠWALé¡µé¢ç´¢å¼•æ•°æ®&#34; title=&#34;WALåŠWALé¡µé¢ç´¢å¼•æ•°æ®&#34;&gt;&lt;/p&gt;
&lt;p&gt;WALå­˜å‚¨äº†å››ä¸ªé¡µé¢æ•°æ®ï¼Œå…¶ä¸­é¡µé¢ç¼–å·1è¢«ä¿®æ”¹äº†ä¸¤æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨è¿™ä¸ªå†™æ“ä½œå®Œæˆä¹‹åï¼Œéœ€è¦è¯»è¿™äº›é¡µé¢çš„å†…å®¹ï¼Œéƒ½éœ€è¦è¯»åˆ°æœ€æ–°çš„å†…å®¹ã€‚æ‰€ä»¥ï¼ŒWALè¿˜æœ‰ä¸€ä¸ªå¯¹åº”çš„&lt;code&gt;WALé¡µé¢ç´¢å¼•&lt;/code&gt;æ•°æ®ï¼Œè¿™éƒ¨åˆ†ç´¢å¼•æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½œç”¨æ˜¯æ ¹æ®é¡µé¢ç¼–å·ï¼ŒçŸ¥é“è¯¥é¡µé¢ç¼–å·å¯¹åº”çš„æœ€æ–°å†…å®¹ï¼Œå­˜å‚¨åœ¨WALæ–‡ä»¶ä¸­çš„å…·ä½“ä½ç½®ï¼Œä»¥å–å¾—æŸä¸ªé¡µé¢çš„æœ€æ–°é¡µé¢å†…å®¹ï¼›å¦‚æœåœ¨è¿™ä¸ªå†…å­˜ç´¢å¼•ä¸­æŸ¥ä¸åˆ°çš„æ•°æ®ï¼Œéƒ½éœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;checkpoint&#34;&gt;checkpoint&lt;/h2&gt;
&lt;p&gt;éšç€WALæ–‡ä»¶çš„å¢é•¿ï¼Œç»ˆç©¶è¦å°†é‡Œé¢ä¿®æ”¹çš„å†…å®¹åŒæ­¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæµç¨‹è¢«ç§°ä¸ºâ€œcheckpointâ€ã€‚åªè¦WALæ–‡ä»¶è¢«â€œcheckpointâ€ï¼Œå°±å¯ä»¥ä»å¤´å¼€å§‹å†™è¿™ä¸ªæ–‡ä»¶ï¼Œé¿å…æ–‡ä»¶çš„æ— é™å¢å¤§ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºjournalå¤‡ä»½æœºåˆ¶è€Œè¨€ï¼Œåªæœ‰ä¸¤ç§æ“ä½œï¼šè¯»å’Œå†™ï¼›è€Œå¯¹äºWALæœºåˆ¶è€Œè¨€ï¼Œå®é™…æœ‰ä¸‰ç§æ“ä½œï¼šè¯»ã€å†™ã€checkpointã€‚è¿™ä¹Ÿæ˜¯ä¸¤ç§æœºåˆ¶çš„ä¸»è¦åŒºåˆ«ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¹¶å‘çš„å®ç°&#34;&gt;å¹¶å‘çš„å®ç°&lt;/h2&gt;
&lt;p&gt;å‰é¢æåˆ°äº†ï¼ŒWALæœºåˆ¶çš„ä¸€ä¸ªä¼˜åŠ¿åœ¨äºï¼šåœ¨å†™æœªå®Œæˆä¹‹å‰ï¼Œå¯ä»¥å…è®¸åŒæ—¶å¹¶å‘å¤šä¸ªè¯»æ“ä½œï¼Œæ¥çœ‹çœ‹è¿™ä¸€ç‚¹æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ¯æ¬¡è¯»æ“ä½œå¼€å§‹ä¹‹å‰ï¼Œéƒ½ä¼šè®°å½•ä¸‹æ¥å½“å‰æœ€åæäº¤äº‹åŠ¡çš„æäº¤è®°å½•ï¼Œè¿™æ¡è®°å½•è¢«ç§°ä¸ºâ€œend markâ€ã€‚å› ä¸ºWALä¼šéšç€å†™æ“ä½œçš„è¿›è¡Œä¸æ–­å¢åŠ ï¼Œé€šè¿‡è¯»æ“ä½œçš„â€œend markâ€ï¼Œå°±èƒ½çŸ¥é“å¯¹äºè¿™ä¸ªè¯»æ“ä½œè€Œè¨€ï¼Œé¡µé¢å†…å®¹åº”è¯¥ä»¥å½“å‰WALå†…å®¹ä¸ºå‡†ï¼Œè¿˜æ˜¯ä»¥æ•°æ®åº“æ–‡ä»¶ä¸ºå‡†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ä¸ºä¾‹æ¥åšä¸ªè¯´æ˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/read-concurrency.png&#34; alt=&#34;è¯»å¹¶å‘çš„å®ç°&#34; title=&#34;è¯»å¹¶å‘çš„å®ç°&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WALæ–‡ä»¶ä¸­å…ˆåè®°å½•äº†ä¸¤ä¸ªå†™äº‹åŠ¡ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå†™äº‹åŠ¡ä¿®æ”¹äº†é¡µé¢ç¼–å·1ã€2ï¼Œå·²ç»æäº¤å®Œæˆï¼›è¿˜æœ‰ä¸€ä¸ªåœ¨è¿›è¡Œè¿˜æœªå®Œæˆçš„å†™äº‹åŠ¡ï¼Œä¿®æ”¹äº†é¡µé¢ç¼–å·1ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ—¶å€™ï¼Œå¦‚æœæ¥äº†ä¸€ä¸ªè¯»äº‹åŠ¡ï¼Œé‚£ä¹ˆå°†è®°å½•ä¸‹æ¥æœ€åä¸€ä¸ªå®Œæˆäº‹åŠ¡çš„æäº¤è®°å½•åšä¸ºè‡ªå·±çš„â€œend markâ€ï¼Œå³å›¾ä¸­çš„æµ…è“è‰²çš„é‚£ä¸ªæäº¤è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;å‡è®¾ç°åœ¨è¿™ä¸ªè¯»äº‹åŠ¡ï¼Œä¾æ¬¡è¦è¯»å–é¡µé¢ç¼–å·1å’Œ2çš„é¡µé¢ï¼Œé‚£ä¹ˆï¼š
&lt;ul&gt;
&lt;li&gt;åˆ°é¡µé¢ç´¢å¼•ä¸­æŸ¥è¯¢é¡µé¢1çš„ä½ç½®ï¼Œå‘ç°ä½ç½®æ¯”è‡ªå·±çš„â€œend markerâ€æ›´å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé¡µé¢åœ¨ä¸Šä¸€æ¬¡å®Œæˆå†™äº‹åŠ¡ä¹‹åï¼Œè¢«å½“å‰è¿˜æœªå®Œæˆçš„å†™äº‹åŠ¡ä¿®æ”¹äº†ï¼Œäºæ˜¯å¹¶ä¸èƒ½è¯»WALçš„å†…å®¹ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å®¹å¯¹è¿™ä¸ªè¯»æ“ä½œæ¥è¯´è¿˜æ˜¯æœªæäº¤çš„ï¼Œæ‰€ä»¥é¡µé¢1éœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;åˆ°é¡µé¢ç´¢å¼•ä¸­æŸ¥è¯¢é¡µé¢2çš„ä½ç½®ï¼Œå‘ç°ä½ç½®æ¯”è‡ªå·±çš„â€œend markerâ€æ›´å°ï¼Œä¹Ÿå°±æ˜¯åœ¨è‡ªå·±æ ‡è®°çš„å†™äº‹åŠ¡å®Œæˆä¹‹åå¹¶æœªè¢«ä¿®æ”¹è¿‡ï¼Œäºæ˜¯å¯ä»¥è¯»WALä¸­è¿™ä¸ªé¡µé¢çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯è§ï¼Œæœ‰äº†â€œend markâ€è¿™ä¸€æ ‡è®°ä½ç½®ä¹‹åï¼ŒåŠ ä¸Šé¡µé¢ç´¢å¼•ï¼Œä»»æ„æ•°é‡çš„è¯»æ“ä½œéƒ½èƒ½å¿«é€Ÿåˆ¤æ–­è‡ªå·±åº”è¯¥è¯»WALæ–‡ä»¶è¿˜æ˜¯æ•°æ®åº“æ–‡ä»¶ï¼Œå†™æ“ä½œå¯ä»¥ç»§ç»­å†™ï¼Œè¯»å’Œå†™ä¹‹é—´å¹¶ä¸ä¼šå†²çªï¼Œæå¤§æå‡äº†è¯»å¹¶å‘çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·è¦çœ‹åˆ°çš„æ˜¯ï¼Œç”±äºåªæœ‰ä¸€ä¸ªWALæ–‡ä»¶ï¼ŒåŒä¸€æ—¶é—´ä¹‹å†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚å³ï¼š&lt;strong&gt;sqliteçš„WALæ¨¡å¼ï¼Œåªèƒ½æ”¯æŒå•å†™å¤šè¯»çš„æ¨¡å¼ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;è¯»æ“ä½œå’Œcheckpointçš„è”ç³»&#34;&gt;è¯»æ“ä½œå’Œcheckpointçš„è”ç³»&lt;/h2&gt;
&lt;p&gt;å‰é¢è®²åˆ°äº†checkpointä»¥åŠè¯»å¹¶å‘çš„å®ç°ï¼Œä¸¤è€…å¯ä»¥å¹¶å‘ä¸€èµ·æ‰§è¡Œï¼Œä½†æ˜¯æŸäº›æ—¶åˆ»ä¼šæœ‰ä¸€äº›å…³è”ï¼Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¶…è¿‡è¯»æ“ä½œâ€œend markâ€çš„é¡µé¢ï¼Œè¯»æ“ä½œéœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–è¯¥é¡µé¢å†…å®¹ï¼Œé‚£ä¹ˆåè¿‡æ¥ï¼Œå½“checkpointæ“ä½œè¦å°†ä¸€ä¸ªè¶…è¿‡å½“å‰å¹¶å‘çš„&lt;strong&gt;ä»»æ„è¯»æ“ä½œ&lt;/strong&gt;â€œend markâ€çš„é¡µé¢è½åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­æ—¶ï¼Œå°±å¿…é¡»ç­‰å¾…è¿™ä¸ªè¯»æ“ä½œå®Œæˆæ‰èƒ½è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä»ç„¶ä»¥å‰é¢è¯»å¹¶å‘çš„ç¤ºæ„å›¾æ¥è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;checkpoint é¡µé¢ç¼–å·2çš„å†…å®¹åˆ°æ•°æ®åº“æ–‡ä»¶æ—¶ï¼Œè¯¥é¡µé¢æœ€ååœ¨WALæ–‡ä»¶ä¸­çš„ä½ç½®ï¼Œå¹¶ä¸æ¯”å½“å‰çš„ä»»æ„è¯»æ“ä½œçš„â€œend markâ€œæ›´å¤§ï¼Œæ‰€ä»¥checkpointè¿™ä¸ªé¡µé¢çš„å†…å®¹åˆ°æ•°æ®åº“æ–‡ä»¶æ—¶æ— éœ€ç­‰å¾…å³å¯å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;åè¿‡æ¥ï¼Œcheckpoint é¡µé¢ç¼–å·1çš„å†…å®¹åˆ°æ•°æ®åº“æ–‡ä»¶æ—¶ï¼Œè¯¥é¡µé¢æœ€ååœ¨WALæ–‡ä»¶ä¸­çš„ä½ç½®ï¼Œå¤§äºå½“å‰è¯»æ“ä½œçš„â€end markâ€œï¼Œæ‰€ä»¥è¿™ä¸ªé¡µé¢çš„å†…å®¹å°±éœ€è¦ç­‰å¾…è¯»æ“ä½œå®Œæˆæ‰èƒ½è¿›è¡Œä¸‹å»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¢è¨€ä¹‹ï¼šä¸€ä¸ªæ‰§è¡Œå¾ˆä¹…çš„è¯»æ“ä½œï¼Œå¯èƒ½ä¼šå½±å“åŒæ—¶åœ¨è¿›è¡Œçš„checkpointæ“ä½œçš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¢«é˜»å¡çš„checkpointå¿…é¡»ç­‰å¾…è¯»æ“ä½œå®Œæˆæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ¥ç»´æŠ¤å½“å‰checkpointæ‰§è¡Œçš„çŠ¶æ€ï¼Œè¿™äº›å…·ä½“çš„å®ç°ç»†èŠ‚éƒ½ä¼šåœ¨ä¸‹é¢å®ç°ç¯èŠ‚çš„åˆ†æä¸­æ¶‰åŠã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å·²ç»å¤§ä½“æ¸…æ¥šWALçš„åŸç†äº†ï¼Œä¸‹é¢æ¥çœ‹å…·ä½“çš„å®ç°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;walçš„å®ç°&#34;&gt;WALçš„å®ç°&lt;/h1&gt;
&lt;p&gt;sqliteä¸­ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;PRAGMA journal_mode=wal&lt;/code&gt;è®¾ç½®é¡µé¢å¤‡ä»½æœºåˆ¶ä¸ºwalï¼Œè¿™æ—¶å€™å°±ä¼šæœ‰ä¸‰ä¸ªä¸æ•°æ®åº“ç›¸å…³çš„æ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ–‡ä»¶ï¼Œå‡è®¾åå­—ä¸ºXã€‚&lt;/li&gt;
&lt;li&gt;WALæ–‡ä»¶ï¼Œåå­—ä¸ºâ€œX-walâ€ã€‚&lt;/li&gt;
&lt;li&gt;walç´¢å¼•æ–‡ä»¶ï¼Œåå­—ä¸ºâ€œX-shmâ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;walçš„æ–‡ä»¶æ ¼å¼&#34;&gt;WALçš„æ–‡ä»¶æ ¼å¼&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ¥çœ‹WALæ–‡ä»¶çš„æ ¼å¼ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WALæ–‡ä»¶å¤´ï¼šä¸€æ¬¡å†™äº‹åŠ¡ï¼Œå¯¹åº”ä¸€ä¸ªWALæ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;é™¤å»æ–‡ä»¶å¤´ï¼Œæ¯ä¸€é¡µæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨â€œå¸§ï¼ˆframeï¼‰â€é‡Œï¼Œæ¯ä¸€å¸§åˆåŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼š
&lt;ul&gt;
&lt;li&gt;å¸§å¤´éƒ¨ï¼šæè¿°å­˜å‚¨çš„è¿™ä¸€é¡µæ•°æ®çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢æ•°æ®ï¼šå­˜å‚¨é¡µé¢æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;WALæ–‡ä»¶å¤´ï¼Œåªä¼šåœ¨æ¯æ¬¡å†™äº‹åŠ¡ä¸­å†™å…¥ä¸€æ¬¡ï¼Œè€Œå¸§å¯èƒ½åœ¨ä¸€æ¬¡å†™äº‹åŠ¡ä¸­å¤šå¤šä¸ªï¼Œå–å†³äºè¿™ä¸€æ¬¡å†™äº‹åŠ¡ä¿®æ”¹äº†å¤šå°‘é¡µé¢ã€‚å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/wal-format.png&#34; alt=&#34;WALæ–‡ä»¶ç»“æ„&#34; title=&#34;WALæ–‡ä»¶ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼Œä¾æ¬¡å­˜å‚¨äº†ä¸¤æ¬¡å†™äº‹åŠ¡çš„æ•°æ®ï¼Œå…¶ä¸­ç¬¬ä¸€æ¬¡å†™äº†ä¸¤å¸§æ•°æ®ï¼Œç¬¬äºŒæ¬¡å†™äº†ä¸€å¸§æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†ä»¥ä¸Šçš„æ¦‚å¿µï¼Œä¸‹é¢è¯¦ç»†çœ‹WALæ–‡ä»¶çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;walæ–‡ä»¶å¤´æ ¼å¼&#34;&gt;WALæ–‡ä»¶å¤´æ ¼å¼&lt;/h3&gt;
&lt;p&gt;ï¼ˆå¼•ç”¨è‡ª &lt;a href=&#34;https://www.sqlite.org/fileformat2.html&#34;&gt;Database File Format&lt;/a&gt; section 4.1ï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Offset&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Size&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Magic number. 0x377f0682 or 0x377f0683&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;File format version. Currently 3007000.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;8&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Database page size. Example: 1024&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;12&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checkpoint sequence number&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;16&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Salt-1: random integer incremented with each checkpoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;20&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Salt-2: a different random number for each checkpoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;24&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checksum-1: First part of a checksum on the first 24 bytes of header&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;28&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checksum-2: Second part of the checksum on the first 24 bytes of header&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…¶ä¸­çš„å¾ˆå¤šå­—æ®µè‡ªæœ‰è§£é‡Šï¼Œå…¶ä¸­å¤šæ•°æ¶‰åŠåˆ°é¡µé¢å†…å®¹çš„æ ¡éªŒï¼Œåé¢å†å±•å¼€è¯´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;walå¸§å¤´éƒ¨æ ¼å¼&#34;&gt;WALå¸§å¤´éƒ¨æ ¼å¼&lt;/h3&gt;
&lt;p&gt;ï¼ˆå¼•ç”¨è‡ª &lt;a href=&#34;https://www.sqlite.org/fileformat2.html&#34;&gt;Database File Format&lt;/a&gt; section 4.1ï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Offset&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Size&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Page number&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;For commit records, the size of the database file in pages after the commit. For all other records, zero.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;8&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Salt-1 copied from the WAL header&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;12&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Salt-2 copied from the WAL header&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;16&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checksum-1: Cumulative checksum up through and including this page&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;20&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checksum-2: Second half of the cumulative checksum.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¸§å¤´éƒ¨éœ€è¦å­˜å‚¨å¦‚ä¸‹çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-4å­—èŠ‚ï¼šé¡µé¢ç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;4-8å­—èŠ‚ï¼šå¯¹äºæäº¤è®°å½•è€Œè¨€ï¼Œè¿™4å­—èŠ‚å­˜å‚¨çš„æ˜¯è¯¥äº‹åŠ¡æäº¤ä¹‹åï¼Œæ•°æ®åº“æ–‡ä»¶çš„æœ€å¤§é¡µé¢ç¼–å·ï¼›å…¶å®ƒçš„æ—¶å€™ï¼Œè¿™4å­—èŠ‚ä¸º0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™4å­—èŠ‚å¤§äº0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ˜¯ä¸€æ¬¡äº‹åŠ¡çš„æœ€åä¸€æ¬¡é¡µé¢ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶å®ƒçš„å­—æ®µï¼Œéƒ½è·Ÿé¡µé¢çš„æ ¡éªŒæœ‰å…³ï¼Œæ¥ä¸‹æ¥å°±çœ‹çœ‹è¿™éƒ¨åˆ†çš„å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¡µé¢å†…å®¹æ ¡éªŒç®—æ³•&#34;&gt;é¡µé¢å†…å®¹æ ¡éªŒç®—æ³•&lt;/h3&gt;
&lt;p&gt;å‰é¢çš„æ ¼å¼ä¸­ï¼Œæ— è®ºæ˜¯WALæ–‡ä»¶å¤´ï¼Œè¿˜æ˜¯WALå¸§å¤´éƒ¨ï¼Œéƒ½æœ‰ä»¥ä¸‹çš„å­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;8å­—èŠ‚çš„saltæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤ç»„4å­—èŠ‚çš„checksumæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¡éªŒæ—¶ï¼Œåªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æƒ…å†µä¸‹æ‰è®¤ä¸ºæ˜¯æ­£ç¡®çš„å¸§æ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¸§å¤´éƒ¨ä¸­çš„8å­—èŠ‚çš„saltæ•°æ®ï¼Œå’ŒWALå¤´éƒ¨çš„saltæ•°æ®ç›¸åŒã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®æ ¡éªŒç®—æ³•éå†é¡µé¢æ•°æ®è®¡ç®—å‡ºæ¥çš„checksumï¼Œå’Œå¸§å¤´éƒ¨çš„checksumæ•°æ®ç›¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€éƒ¨åˆ†saltæ•°æ®ï¼Œæ¯æ¬¡å†™äº‹åŠ¡ç”Ÿæˆä¸€æ¬¡ï¼Œæ‰€ä»¥æ ¡éªŒè¿™ä¸ªå€¼å¯ä»¥è®¤ä¸ºæ ¡éªŒè¿™ä¸€å¸§æ•°æ®æ˜¯å¦å’Œè¿™æ¬¡äº‹åŠ¡åŒ¹é…ï¼›è€Œç¬¬äºŒéƒ¨åˆ†çš„checksumæ•°æ®ï¼Œåˆ™ä¼šç”¨æ¥ä¾æ¬¡ä¸²èµ·ä¸€æ¬¡å†™äº‹åŠ¡çš„æ‰€æœ‰é¡µé¢ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå†™äº‹åŠ¡æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡å†™é¡µé¢ï¼Œç”±äºä¹‹å‰è¿™ä¸ªå†™äº‹åŠ¡æ²¡æœ‰å†™è¿‡é¡µé¢ï¼Œæ‰€ä»¥åˆå§‹çš„checksumä¸º0ï¼Œä»¥è¿™ä¸ªåˆå§‹çš„checksumæ¥è®¡ç®—è¿™ç¬¬ä¸€ä¸ªé¡µé¢çš„checksumï¼Œè®¡ç®—ä¹‹åçš„å€¼è®°å½•åˆ°è¿™ä¸ªé¡µé¢çš„checksumï¼Œè®°ä¸º&lt;code&gt;checksum_1&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ¬¡å†™é¡µé¢ï¼Œå–ä¸Šä¸€æ¬¡è®¡ç®—çš„checksumå³&lt;code&gt;checksum_1&lt;/code&gt;ï¼Œæ¥è®¡ç®—è¿™ç¬¬äºŒä¸ªé¡µé¢çš„checksumï¼Œè®°ä¸º&lt;code&gt;checksum_2&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç±»ä¼¼çš„ï¼Œç¬¬Næ¬¡å†™é¡µé¢æ—¶ï¼Œä»¥ä¸Šä¸€æ¬¡è®¡ç®—çš„checksumå³&lt;code&gt;checksum_n-1&lt;/code&gt;æ¥åšä¸ºè®¡ç®—çš„åˆå§‹å€¼è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·ï¼Œç›¸é‚»é¡µé¢ä¹‹é—´çš„æ ¡éªŒå€¼å°±æœ‰äº†å…³è”ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“èµ·æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;saltï¼šæ¯æ¬¡äº‹åŠ¡ç®—ä¸€æ¬¡éšæœºå€¼ã€‚&lt;/li&gt;
&lt;li&gt;checksumï¼šæ»¡è¶³ä»¥ä¸‹ä»¥ä¸‹æ¡ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;checksum_0 = 0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;checksum_n = F(checksum_n-1, é¡µé¢æ•°æ®) &lt;/code&gt;ï¼Œå…¶ä¸­å‡½æ•°Fæ˜¯æ ¹æ®åˆå§‹æ ¡éªŒå€¼å’Œé¡µé¢æ•°æ®è®¡ç®—å‡ºæ–°æ ¡éªŒå€¼çš„å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¡éªŒé¡µé¢çš„å‡½æ•°å®ç°åœ¨&lt;code&gt;walDecodeFrame&lt;/code&gt;ä¸­ï¼Œè€Œè®¡ç®—é¡µé¢æ ¡éªŒå€¼çš„å‡½æ•°å®ç°åœ¨&lt;code&gt;walChecksumBytes&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;walé¡µé¢ç´¢å¼•&#34;&gt;WALé¡µé¢ç´¢å¼•&lt;/h2&gt;
&lt;h3 id=&#34;ç»“æ„&#34;&gt;ç»“æ„&lt;/h3&gt;
&lt;p&gt;å‰é¢åˆ†æWALæ–‡ä»¶ç»“æ„çš„æ—¶å€™ï¼Œæåˆ°ä¿å­˜ä¸€é¡µæ•°æ®çš„å†…å®¹è¢«ç§°ä¸ºâ€œå¸§ï¼ˆframeï¼‰â€ï¼Œå¸§çš„ç¼–å·ä»1å¼€å§‹é¡ºåºé€’å¢ï¼Œæ¯ä¸€å¸§å†…å®¹å­˜å‚¨çš„é¡µé¢å†…å®¹å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/wal-frame.png&#34; alt=&#34;å¸§ä¸é¡µé¢çš„å¯¹åº”å…³ç³»&#34; title=&#34;å¸§ä¸é¡µé¢çš„å¯¹åº”å…³ç³»&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ï¼Œä¾æ¬¡æœ‰å››å¸§é¡µé¢æ•°æ®ï¼Œå¸§æ•°ä¸é¡µé¢çš„å¯¹åº”å…³ç³»ä¾æ¬¡æ˜¯ï¼š(1,1)ï¼Œ(2,3)ï¼Œ(3,5)ï¼Œ(4,4)ã€‚å‡è®¾éšç€è¿è¡Œï¼Œç¬¬ä¸€å¸§å¯¹åº”çš„é¡µé¢1è¢«å†™å…¥äº†æ•°æ®åº“ï¼Œé‚£ä¹ˆç¬¬ä¸€å¸§çš„ç©ºé—´å°±ä¼šè¢«å¤ç”¨æ¥å­˜å‚¨åˆ«çš„é¡µé¢çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼ŒWALé¡µé¢ç´¢å¼•ä¸­ï¼Œéœ€è¦å­˜å‚¨å¸§æ•°ä¸é¡µé¢ç¼–å·ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œè¿™æ ·å°±èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¿é—®ä¸€å¸§çš„å†…å®¹æ—¶ï¼ŒçŸ¥é“ä¿å­˜çš„æ˜¯å“ªä¸ªé¡µé¢çš„å†…å®¹ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®é¡µé¢ç¼–å·ï¼Œèƒ½æŸ¥åˆ°è¿™ä¸ªé¡µé¢çš„æœ€æ–°æ•°æ®ä¿å­˜åœ¨å“ªä¸€å¸§ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ¹æ®éœ€è¦çš„è¿™ä¸¤ä»½æ•°æ®ï¼Œå®šä¹‰äº†ç”¨äºä¿å­˜walç´¢å¼•çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;struct&lt;/span&gt; WalHashLoc {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;volatile&lt;/span&gt; ht_slot &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;aHash;  &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Start of the wal-index hash table */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;volatile&lt;/span&gt; u32 &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;aPgno;      &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* aPgno[1] is the page of first frame indexed */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 iZero;                &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* One less than the frame number of first indexed*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;aHashï¼šä¿å­˜äº†æ ¹æ®é¡µé¢ç¼–å·æŸ¥æ‰¾iFrameå¸§æ•°çš„hashæ•°ç»„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;aPgnoï¼šä¿å­˜äº†æ ¹æ®å¸§æ•°æŸ¥æ‰¾é¡µé¢ç¼–å·çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;iZeroï¼šä¿å­˜äº†å½“å‰ç´¢å¼•é¡µé¢ç¬¬ä¸€å¸§çš„å¸§æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¹ˆçœ‹æ¥æœ‰ä¸€äº›æŠ½è±¡ï¼Œæˆ‘ä»¬ä»¥ä¸‹å›¾æ¥åšè§£é‡Šwal-indexæ–‡ä»¶çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/wal-index-format.png&#34; alt=&#34;WAL-Indexç´¢å¼•æ–‡ä»¶ç»“æ„å›¾&#34; title=&#34;WAL-Indexç´¢å¼•æ–‡ä»¶ç»“æ„å›¾&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;walç´¢å¼•æ–‡ä»¶ä¸€é¡µå¤§å°ä¸º32KBï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸è¦æŠŠwalç´¢å¼•æ–‡ä»¶çš„ä¸€é¡µä¸æ•°æ®åº“æ–‡ä»¶çš„ä¸€é¡µææ··ï¼Œä¸¤è€…å¹¶ä¸ä¸€å®šç›¸åŒï¼Œä½†æ˜¯éƒ½ä¸º2çš„æ¬¡æ–¹ï¼Œæ•°æ®åº“æ–‡ä»¶çš„ä¸€é¡µå¯ä»¥ç¼–è¯‘æœŸä¿®æ”¹ï¼Œä½†æ˜¯walç´¢å¼•æ–‡ä»¶çš„ä¸€é¡µå¤§å°å†™æ­»ä¸º32KBã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€é¡µç›¸å¯¹æœ‰äº›ç‰¹æ®Šï¼Œå› ä¸ºæœ€å¼€å§‹çš„136å­—èŠ‚æ˜¯walç´¢å¼•æ–‡ä»¶å¤´ï¼Œæ‰€ä»¥ç›¸å¯¹çš„ï¼Œå‰©ä¸‹ç”¨æ¥å­˜å‚¨ç´¢å¼•æ•°æ®çš„ç©ºé—´å°±ä¼šå˜å°‘ä¸€äº›ã€‚ç´¢å¼•æ–‡ä»¶å¤´çš„å†…å®¹ï¼Œç•™å¾…åé¢å†è¯¦ç»†è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€é¡µå­˜å‚¨çš„æ•°æ®ä¸­ï¼Œ&lt;code&gt;aPgno&lt;/code&gt;å¤§å°ä¸º4096ï¼ˆç¬¬ä¸€é¡µåªæœ‰4062ï¼Œå› ä¸ºæœ‰å¤´éƒ¨ç”¨åˆ°çš„ç©ºé—´ï¼‰ï¼Œ&lt;code&gt;aHash&lt;/code&gt;çš„å¤§å°ä¸º8192ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/WalHashLoc.png&#34; alt=&#34;é¡µé¢ç´¢å¼•æ•°æ®çš„æ„æˆ&#34; title=&#34;é¡µé¢ç´¢å¼•æ•°æ®çš„æ„æˆ&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™å‡ ä¸ªå¸¸é‡ï¼Œç”±ä¸‹é¢è¿™å‡ ä¸ªå®æ¥å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// æ¯ä¸€é¡µaPgnoæ•°ç»„å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define HASHTABLE_NPAGE      4096                 &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Must be power of 2 */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// æŸ¥è¯¢æ—¶hashå–æ¨¡æ—¶çš„è´¨æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define HASHTABLE_HASH_1     383                  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Should be prime */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// æ¯ä¸€é¡µhash slotæ•°ç»„å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define HASHTABLE_NSLOT      (HASHTABLE_NPAGE*2)  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Must be a power of 2 */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// é¡µé¢1å®é™…èƒ½å®¹çº³çš„aPgnoå¤§å°ï¼šHASHTABLE_NPAGEå‡å»WALINDEX_HDR_SIZEä½¿ç”¨çš„å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define HASHTABLE_NPAGE_ONE  (HASHTABLE_NPAGE - (WALINDEX_HDR_SIZE/sizeof(u32)))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// ä¸€ä¸ªwalç´¢å¼•é¡µé¢çš„å¤§å°ï¼Œä¸º4096*4+8192*2 = 32KB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WALINDEX_PGSZ   (                                         \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;    sizeof(ht_slot)*HASHTABLE_NSLOT + HASHTABLE_NPAGE*sizeof(u32) \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ç´¢å¼•æ–‡ä»¶å¤´ç»“æ„&#34;&gt;ç´¢å¼•æ–‡ä»¶å¤´ç»“æ„&lt;/h4&gt;
&lt;p&gt;æ¥çœ‹çœ‹ç´¢å¼•æ–‡ä»¶å¤´çš„ç»“æ„ï¼Œå…¶æ•´ä½“å¤§å°ä¸º136å­—èŠ‚ï¼Œåˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;ï¼ˆå¼•ç”¨è‡ª&lt;a href=&#34;https://www.sqlite.org/walformat.html&#34;&gt;WAL-mode File Format&lt;/a&gt; section 2.1ï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Bytes&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0..47&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;First copy of the WAL Index Information&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;48..95&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Second copy of the WAL Index Information&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;96..135&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checkpoint Information and Locks&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™æ€»å…±136å­—èŠ‚çš„æ•°æ®ï¼Œä¸€å…±åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0-47å­—èŠ‚ï¼šWALç´¢å¼•å¤´éƒ¨ï¼Œç”±ç»“æ„ä½“&lt;code&gt;WalIndexHdr&lt;/code&gt;æ¥æè¿°ã€‚&lt;/li&gt;
&lt;li&gt;48-95å­—èŠ‚ï¼šè¿˜æ˜¯ä¸€ä¸ªç”±ç»“æ„ä½“&lt;code&gt;WalIndexHdr&lt;/code&gt;æè¿°çš„WALç´¢å¼•å¤´éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;96-136å­—èŠ‚ï¼šç”±ç»“æ„ä½“&lt;code&gt;WalCkptInfo&lt;/code&gt;æè¿°çš„WAL checkpointä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢çš„è¡¨æ ¼ï¼Œè¯¦ç»†å±•ç¤ºäº†è¿™136å­—èŠ‚ä¸­éƒ½æœ‰å“ªäº›å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆå¼•ç”¨è‡ª&lt;a href=&#34;https://www.sqlite.org/walformat.html&#34;&gt;WAL-mode File Format&lt;/a&gt; section 2.1ï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Bytes&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Name&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Meaning&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0..3&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;iVersion&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;The WAL-index format version number. Always 3007000.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4..7&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Unused padding space. Must be zero.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;8..11&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;iChange&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Unsigned integer counter, incremented with each transaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;12&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;isInit&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;The &amp;ldquo;isInit&amp;rdquo; flag. 1 when the shm file has been initialized.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;13&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;bigEndCksum&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;True if the WAL file uses big-ending checksums. 0 if the WAL uses little-endian checksums.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;14..15&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;szPage&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;The database page size in bytes, or 1 if the page size is 65536.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;16..19&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;mxFrame&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Number of valid and committed frames in the WAL file.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;20..23&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;nPage&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Size of the database file in pages.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;24..31&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;aFrameCksum&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Checksum of the last frame in the WAL file.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;32..39&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;aSalt&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;The two salt value copied from the WAL file header. These values are in the byte-order of the WAL file, which might be different from the native byte-order of the machine.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;40..47&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;aCksum&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;A checksum over bytes 0 through 39 of this header.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;48..95&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;A copy of bytes 0 through 47 of this header.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;96..99&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;nBackfill&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Number of WAL frames that have already been backfilled into the database by prior checkpoints&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;100..119&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;read-mark[0..4]&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Five &amp;ldquo;read marks&amp;rdquo;. Each read mark is a 32-bit unsigned integer (4 bytes).&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;120..127&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Unused space set aside for 8 file locks.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;128..132&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;nBackfillAttempted&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Number of WAL frames that have attempted to be backfilled but which might not have been backfilled successfully.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;132..136&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Unused space reserved for further expansion.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢å°±è¿™é‡Œçš„ä¸€äº›é‡ç‚¹å­—æ®µåšä¸€ä¸‹ä»‹ç»ã€‚&lt;/p&gt;
&lt;h5 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç›¸åŒå¤§å°çš„walç´¢å¼•å¤´éƒ¨&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç›¸åŒå¤§å°çš„WALç´¢å¼•å¤´éƒ¨ï¼Ÿ&lt;/h5&gt;
&lt;p&gt;æ³¨æ„åˆ°0-47å’Œ48-95è¿™ä¸¤éƒ¨åˆ†48å­—èŠ‚çš„æ•°æ®ï¼Œéƒ½æ˜¯åŒæ ·ç±»å‹çš„æ•°æ®ï¼Œéƒ½ç”±&lt;code&gt;WalIndexHdr&lt;/code&gt;ç»“æ„ä½“æ¥æè¿°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·è®¾è®¡çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†è¯»å†™çš„æ—¶å€™æ•°æ®æ ¡éªŒã€‚å‡è®¾å¤´48å­—èŠ‚ä¸º&lt;code&gt;h1&lt;/code&gt;ï¼Œå48å­—èŠ‚ä¸º&lt;code&gt;h2&lt;/code&gt;ã€‚é‚£ä¹ˆè¯»æ“ä½œçš„æ—¶å€™æ˜¯å…ˆè¯»&lt;code&gt;h1&lt;/code&gt;å†è¯»&lt;code&gt;h2&lt;/code&gt;ï¼Œè€Œå†™æ“ä½œçš„æ—¶å€™åˆ™ç›¸åï¼Œå…ˆå†™&lt;code&gt;h2&lt;/code&gt;å†å†™&lt;code&gt;h1&lt;/code&gt;ã€‚è¿™æ ·ï¼Œå¦‚æœåœ¨è¯»æ“ä½œçš„æ—¶å€™ï¼Œè¯»åˆ°è¿™ä¸¤éƒ¨åˆ†å†…å®¹å¹¶ä¸ä¸€æ ·ï¼Œè¯´æ˜å½“å‰æœ‰å†™æ“ä½œåœ¨è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¯»å¤´éƒ¨çš„å®ç°è§å‡½æ•°&lt;code&gt;walIndexTryHdr&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;static SQLITE_NO_TSAN int walIndexTryHdr(Wal *pWal, int *pChanged)
{
  u32 aCksum[2];              /* Checksum on the header content */
  WalIndexHdr h1, h2;         /* Two copies of the header content */
  WalIndexHdr volatile *aHdr; /* Header in shared memory */

  aHdr = walIndexHdr(pWal);
  memcpy(&amp;amp;h1, (void *)&amp;amp;aHdr[0], sizeof(h1)); /* Possible TSAN false-positive */
  walShmBarrier(pWal);
  memcpy(&amp;amp;h2, (void *)&amp;amp;aHdr[1], sizeof(h2));

  // å¯¹æ¯”ä¸¤ä¸ªheaderï¼Œä¸ç›¸åŒå°±è¿”å›
  if (memcmp(&amp;amp;h1, &amp;amp;h2, sizeof(h1)) != 0)
  {
    return 1; /* Dirty read */
  }
  if (h1.isInit == 0)
  {
    return 1; /* Malformed header - probably all zeros */
  }
  // å¯¹æ¯”æ ¡éªŒå€¼
  walChecksumBytes(1, (u8 *)&amp;amp;h1, sizeof(h1) - sizeof(h1.aCksum), 0, aCksum);
  if (aCksum[0] != h1.aCksum[0] || aCksum[1] != h1.aCksum[1])
  {
    return 1; /* Checksum does not match */
  }

  // åˆ°äº†è¿™é‡Œï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦å‘ç”Ÿè¿‡æ”¹å˜äº†
  if (memcmp(&amp;amp;pWal-&amp;gt;hdr, &amp;amp;h1, sizeof(WalIndexHdr)))
  {
    *pChanged = 1;
    memcpy(&amp;amp;pWal-&amp;gt;hdr, &amp;amp;h1, sizeof(WalIndexHdr));
    pWal-&amp;gt;szPage = (pWal-&amp;gt;hdr.szPage &amp;amp; 0xfe00) + ((pWal-&amp;gt;hdr.szPage &amp;amp; 0x0001) &amp;lt;&amp;lt; 16);
    testcase(pWal-&amp;gt;szPage &amp;lt;= 32768);
    testcase(pWal-&amp;gt;szPage &amp;gt;= 65536);
  }

  /* The header was successfully read. Return zero. */
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;mxframeå’Œnbackfill&#34;&gt;mxFrameå’ŒnBackfill&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;mxFrame&lt;/code&gt;è®°å½•ç€å½“å‰WALæ–‡ä»¶çš„æœ€å¤§å¸§æ•°ï¼Œè€Œ&lt;code&gt;nBackfill&lt;/code&gt;è®°å½•ç€å½“å‰&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œè¿›è¡Œåˆ°ç¬¬å‡ å¸§ï¼Œå³åœ¨&lt;code&gt;nBackfill&lt;/code&gt;ä¹‹å‰çš„å¸§æ•°éƒ½å·²ç»è¢«å†™å…¥æ•°æ®åº“æ–‡ä»¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶è¿™ä¸¤ä¸ªå€¼æœ‰å¦‚ä¸‹å…³ç³»ï¼š&lt;code&gt;nBackfill&amp;lt;=mxFrame&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;nBackfill&amp;lt;mxFrame&lt;/code&gt;ï¼Œ&lt;code&gt;checkpoint&lt;/code&gt;è¿‡ç¨‹è¿˜æœªç»“æŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nBackfill==mxFrame&lt;/code&gt;ï¼Œ&lt;code&gt;checkpoint&lt;/code&gt;è¿‡ç¨‹å·²ç»ç»“æŸï¼Œè¿™æ—¶å€™ï¼š
&lt;ul&gt;
&lt;li&gt;WALæ–‡ä»¶ä¸­çš„æ‰€æœ‰é¡µé¢å·²ç»è¢«å›å¡«ï¼ˆbackfillï¼‰åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­äº†ï¼›&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è¯»é¡µé¢çš„æ“ä½œï¼Œéƒ½ä¸å†éœ€è¦è®¿é—®WALæ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®æ•°æ®åº“æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;ä¸‹ä¸€æ¬¡å†æœ‰å†™æ“ä½œï¼Œå¯ä»¥ä»WALçš„å¤´éƒ¨å¼€å§‹å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h3&gt;
&lt;p&gt;æœ‰äº†å‰é¢çš„å‡†å¤‡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ç§å¯¹åº”å…³ç³»çš„æŸ¥æ‰¾æ˜¯æ€ä¹ˆåšçš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç´¢å¼•é¡µé¢çš„å­˜å‚¨&#34;&gt;ç´¢å¼•é¡µé¢çš„å­˜å‚¨&lt;/h4&gt;
&lt;p&gt;å‰é¢åˆ†æåˆ°ï¼Œä¸€ä¸ªwalç´¢å¼•é¡µé¢çš„å¤§å°ä¸º32KBï¼Œè¿™äº›æ•°æ®æ˜¯å­˜å‚¨åœ¨&lt;code&gt;Wal&lt;/code&gt;ç»“æ„ä½“ä¸­çš„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct Wal {
	// ...
	int nWiData;               /* Size of array apWiData */
	volatile u32 **apWiData;   /* Pointer to wal-index content in memory */
	// ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;apWiDataï¼šå­˜å‚¨é¡µé¢æŒ‡é’ˆçš„æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;nWiDataï¼šé¡µé¢æŒ‡é’ˆæ•°ç»„çš„å¤§å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ ¹æ®å¸§æ•°æŸ¥è¯¢é¡µé¢ç¼–å·&#34;&gt;æ ¹æ®å¸§æ•°æŸ¥è¯¢é¡µé¢ç¼–å·&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆæ¥çœ‹æ ¹æ®å¸§æ•°æŸ¥è¯¢è¿™ä¸€å¸§å­˜å‚¨çš„æ˜¯å“ªä¸ªé¡µé¢çš„æ•°æ®ï¼Œå³æ ¹æ®å¸§æ•°æŸ¥è¯¢é¡µé¢ç¼–å·çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºwalæ–‡ä»¶ä¸­ï¼Œåˆ°äº†ä¸€å®šå¤§å°ä¹‹åï¼Œå°±ä¼šæ‰§è¡Œâ€œcheckpointâ€æ“ä½œï¼Œæ‰€ä»¥å¸§æ•°ä¸€å®šæ˜¯æœ‰é™çš„ã€‚å³å¸§æ•°æ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»0å¼€å§‹é€’å¢ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ä¼šæ— é™å¢å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥åœ¨&lt;code&gt;aPgno&lt;/code&gt;ä¸­ï¼Œå°±ç›´æ¥ä½¿ç”¨å¸§æ•°æ¥åšä¸ºè¿™ä¸ªæ•°ç»„çš„ç´¢å¼•ã€‚æ€»ç»“ä¸‹æ¥ï¼Œæ·»åŠ ä¸€ä¸ªå¸§æ•°å’Œé¡µé¢ä¹‹é—´å¯¹åº”å…³ç³»çš„å¤§ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼ˆå‡½æ•°&lt;code&gt;walIndexAppend&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ ¹æ®å¸§æ•°ï¼ŒçŸ¥é“åœ¨ç¬¬å‡ ä¸ªç´¢å¼•é¡µé¢ä¸­ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;apWiData&lt;/code&gt;æ•°ç»„çš„ç¬¬å‡ ä¸ªå…ƒç´ ï¼Œè¿™æ ·å°±æ‹¿åˆ°è¿™ä¸€å¸§å¯¹åº”åœ¨å“ªä¸ª32KBçš„æ•°æ®ã€‚ï¼ˆå‡½æ•°&lt;code&gt;walHashGet&lt;/code&gt;ï¼Œå¦å¤–å‡½æ•°&lt;code&gt;walFramePage&lt;/code&gt;æ˜¯æ ¹æ®å¸§æ•°å¾—åˆ°&lt;code&gt;apWiData&lt;/code&gt;æ•°ç»„ç´¢å¼•ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; walHashGet(pWal, walFramePage(iFrame), &lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;sLoc);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¸§æ•°å‡å»è¿™ä¸€é¡µçš„&lt;code&gt;iZero&lt;/code&gt;çŸ¥é“æ˜¯è¿™ä¸€é¡µä¸­çš„&lt;code&gt;aPgno&lt;/code&gt;æ•°ç»„çš„ç´¢å¼•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;idx &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; iFrame &lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt; sLoc.iZero;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨hashæ•°ç»„ä¸­æ‰¾åˆ°ç©ºä½ç½®å­˜å‚¨é¡µé¢ç¼–å·ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Write the aPgno[] array entry and the hash-table slot. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    nCollide &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; idx;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;for&lt;/span&gt;(iKey&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;walHash(iPage); sLoc.aHash[iKey]; iKey&lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt;walNextHash(iKey)){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt;( (nCollide&lt;span style=&#34;color:#666&#34;&gt;--&lt;/span&gt;)&lt;span style=&#34;color:#666&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;0&lt;/span&gt; ) &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;return&lt;/span&gt; SQLITE_CORRUPT_BKPT;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°†ä¸¤è€…çš„å¯¹åº”å…³ç³»å­˜å‚¨ä¸‹æ¥ï¼Œå³ï¼šå‘&lt;code&gt;aPgno&lt;/code&gt;ä¸­å­˜å…¥é¡µé¢ç¼–å·ï¼Œå‘&lt;code&gt;aHash&lt;/code&gt;ä¸­å­˜å‚¨å¸§æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sLoc.aPgno[idx] &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; iPage;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    AtomicStore(&lt;span style=&#34;color:#666&#34;&gt;&amp;amp;&lt;/span&gt;sLoc.aHash[iKey], (ht_slot)idx);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹çš„å¤§ä½“ç¤ºæ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/frame-pageno.png&#34; alt=&#34;æ·»åŠ å¸§æ•°ä¸é¡µé¢ç¼–å·å¯¹åº”å…³ç³»çš„æµç¨‹&#34; title=&#34;æ·»åŠ å¸§æ•°ä¸é¡µé¢ç¼–å·å¯¹åº”å…³ç³»çš„æµç¨‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸Šé¢çš„æµç¨‹ï¼Œå‡è®¾è¦å­˜å‚¨çš„å¯¹åº”å…³ç³»æ˜¯å¸§æ•°5000å­˜å‚¨çš„æ˜¯é¡µé¢ç¼–å·5ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®å¸§æ•°5000ï¼Œç®—å‡ºè¿™ä¸€å¸§çš„ç´¢å¼•æ•°æ®åº”è¯¥å­˜å‚¨åœ¨ç¬¬äºŒä¸ªç´¢å¼•é¡µé¢ä¸­ï¼Œç”±æ­¤æ‹¿åˆ°è¿™ä¸ªé¡µé¢çš„&lt;code&gt;WalHashLoc&lt;/code&gt;æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†æ ¹æ®5000ï¼Œå‡å»è¿™ä¸ªé¡µé¢çš„å¸§æ•°èµ·å§‹ä½ç½®4063ï¼Œå¾—åˆ°å¸§æ•°åç§»é‡ä¸º927ï¼Œå³è¿™ä¸ªå¸§åœ¨è¿™ä¸ª&lt;code&gt;WalHashLoc-&amp;gt;aPgno&lt;/code&gt;æ•°ç»„çš„ä½ç½®æ˜¯927ï¼Œå³&lt;code&gt;idx=927&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†åˆ°&lt;code&gt;WalHashLoc-&amp;gt;aHash&lt;/code&gt;ä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®ï¼Œè¿™ä¸ªç©ºä½ç½®å‡è®¾æ˜¯&lt;code&gt;iKey=101&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ°äº†è¿™é‡Œï¼Œä½ç½®éƒ½æ‰¾åˆ°äº†ï¼Œæ›´æ–°æ•°æ®ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sLoc.aPgno[927] = 5;
AtomicStore(&amp;amp;sLoc.aHash[101], (ht_slot)927);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å¸§æ•°æ‰¾åˆ°&lt;code&gt;aPgno&lt;/code&gt;æ˜¯ä¸€ä¸ªä¸¤æ¬¡ç´¢å¼•çš„è¿‡ç¨‹ï¼šç¬¬ä¸€æ¬¡æ ¹æ®å¸§æ•°æ‰¾åˆ°32KBé¡µé¢ï¼Œç¬¬äºŒæ¬¡å†æ ¹æ®å¸§æ•°æ‰¾åˆ°åœ¨è¿™ä¸€é¡µä¸­çš„å¸§æ•°åç§»é‡ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åä¿®æ”¹&lt;code&gt;aHash&lt;/code&gt;æ˜¯ä¸€æ¬¡åŸå­æ“ä½œï¼Œå› ä¸ºå…¶å®ƒåœ°æ–¹å¯èƒ½åŒæ—¶åœ¨æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ ¹æ®é¡µé¢ç¼–å·æŸ¥è¯¢æ‰€åœ¨å¸§&#34;&gt;æ ¹æ®é¡µé¢ç¼–å·æŸ¥è¯¢æ‰€åœ¨å¸§&lt;/h4&gt;
&lt;p&gt;å‰é¢åˆ†æäº†å¦‚ä½•å­˜å‚¨å¸§æ•°åˆ°é¡µé¢ç¼–å·çš„å¯¹åº”å…³ç³»ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€æ¬¡æ›´æ–°æ˜¯æŠŠä¸¤ä¸ªå¯¹åº”å…³ç³»ä¸€èµ·æ›´æ–°çš„ã€‚ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®å¸§æ•°æŸ¥æ‰¾çš„æµç¨‹å®é™…è¿˜æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå°±æ˜¯ä¸¤æ¬¡ç´¢å¼•ï¼šä¸€æ¬¡æ‰¾åˆ°é¡µé¢ï¼Œå†ä¸€æ¬¡å°±æ˜¯é¡µé¢å†…çš„æŸ¥æ‰¾ï¼ŒåŸå› åœ¨äºï¼šå¸§æ•°æ˜¯æœ‰é™çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯é¡µé¢å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œå› ä¸ºè¿™é‡Œè¦å­˜å‚¨çš„é¡µé¢ç¼–å·æ˜¯æ•°æ®åº“æ–‡ä»¶ä¸­çš„é¡µé¢ç¼–å·ï¼Œå¹¶ä¸çŸ¥é“å½“å‰æ•°æ®åº“åˆ°åº•å˜åˆ°å¤šå¤§äº†ï¼Œè¿™æ ·å°±ä¸èƒ½æŒ‰ç…§å‰é¢çš„æ–¹å¼æ¥ä¸¤æ¬¡ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ ¹æ®é¡µé¢ç¼–å·ï¼ŒçŸ¥é“è¿™ä¸€é¡µé¢æ˜¯å­˜å‚¨åœ¨å“ªä¸€å¸§é‡Œçš„ï¼Œå³walæ–‡ä»¶çš„å¸§æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨å‡½æ•°&lt;code&gt;sqlite3WalFindFrame&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹¿åˆ°è¯¥è¯»æ“ä½œå½“å‰æœ€å¤§å’Œæœ€å°å¸§æ•°ï¼Œæ ¹æ®è¿™ä¸¤ä¸ªå¸§æ•°å¾—åˆ°å¯¹åº”çš„ç´¢å¼•32KBé¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;ä»åå¾€å‰éå†è¿™äº›é¡µé¢ï¼Œæ¯ä¸ªé¡µé¢ä¸­åˆ°&lt;code&gt;WalHashLoc-&amp;gt;aHash&lt;/code&gt;ä¸­ï¼Œæ ¹æ®é¡µé¢ç¼–å·çš„hashå€¼æ¥æŸ¥æ‰¾ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªæµç¨‹ä¸€ç›´åˆ°æ‰¾åˆ°é¡µé¢ï¼Œæˆ–è€…å…¨éƒ¨éå†å®Œæ¯•ä¸ºæ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/sqlite3WalFindFrame.png&#34; alt=&#34;æ ¹æ®é¡µé¢ç¼–å·æŸ¥æ‰¾å¸§çš„æµç¨‹&#34; title=&#34;æ ¹æ®é¡µé¢ç¼–å·æŸ¥æ‰¾å¸§çš„æµç¨‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿™ä¸ªæµç¨‹å¯ä»¥çœ‹åˆ°ï¼šæŸ¥æ‰¾é¡µé¢å¯¹åº”å¸§æ•°çš„æµç¨‹ï¼Œæœ€åçš„æƒ…å†µä¸‹å¯èƒ½éå†äº†æ‰€æœ‰ç´¢å¼•é¡µé¢ï¼Œè™½ç„¶å…¶ä¸­çš„æŸ¥æ‰¾è¿‡ç¨‹ä¼šæ ¹æ®é¡µé¢ç¼–å·çš„hashå€¼æ¥æŸ¥æ‰¾ã€‚äºæ˜¯ä¸€ä¸ªé‡è¦çš„ç»“è®ºå°±å‡ºæ¥äº†ï¼š&lt;strong&gt;WALçš„å®ç°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå½“WALæ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œå¯¹åº”çš„ç´¢å¼•é¡µé¢ä¹Ÿä¼šå¾ˆå¤§ï¼Œåœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾é¡µé¢ç¼–å·çš„æµç¨‹å°±ä¼šå˜ä¹…ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;é”çš„å®ç°&#34;&gt;é”çš„å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;walæ¨¡å¼æä¾›äº†ä»¥ä¸‹4ç§é”ï¼Œè¿™4ç§é”ä»walç´¢å¼•æ–‡ä»¶å¤´éƒ¨120å­—èŠ‚å¤„å¼€å§‹ï¼Œæ¯ç§é”å ä¸€ä¸ªå­—èŠ‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WAL_WRITE_LOCKï¼šå†™é”ï¼Œå†™æ“ä½œä¹‹å‰å¿…é¡»æ‹¿åˆ°å†™é”ã€‚&lt;/li&gt;
&lt;li&gt;WAL_CKPT_LOCKï¼šcheckpointé”ï¼Œåœ¨åšcheckpointä¹‹å‰éœ€è¦æ‹¿åˆ°è¿™ä¸ªé”ã€‚&lt;/li&gt;
&lt;li&gt;WAL_RECOVER_LOCKï¼šæ¢å¤é”ï¼Œåœ¨è¿›è¡Œæ¢å¤æ“ä½œä¹‹å‰è¦æ‹¿åˆ°è¿™ä¸ªé”ã€‚&lt;/li&gt;
&lt;li&gt;WAL_READ_LOCKï¼šè¯»é”ï¼Œä¸€å…±æœ‰äº”ä¸ªè¯»é”ï¼Œä½†æ˜¯ä½œç”¨ä¸å°½ç›¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™å››ç§é”ï¼Œå…¶ä¸­æœ‰äº”ä¸ªè¯»é”ï¼Œä¸€å…±åŠ èµ·æ¥å°±æ˜¯8ä¸ªé”ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// walç´¢å¼•æ–‡ä»¶ä¸­é”çš„æ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define SQLITE_SHM_NLOCK        8
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// å†™é”åœ¨æ‰€æœ‰é”ä¸­çš„åç§»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_WRITE_LOCK 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// é™¤äº†å†™é”ä»¥å¤–çš„å…¶ä»–æ‰€æœ‰é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_ALL_BUT_WRITE 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// checkpointé”åœ¨æ‰€æœ‰é”ä¸­çš„åç§»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_CKPT_LOCK 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// æ¢å¤é”åœ¨æ‰€æœ‰é”ä¸­çš„åç§»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_RECOVER_LOCK 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// è¾“å…¥è¯»é”ç´¢å¼•ï¼Œè¿”å›å¯¹åº”è¯»é”åœ¨æ‰€æœ‰é”ä¸­çš„åç§»é‡ï¼Œå› ä¸ºè¯»é”ä»3å¼€å§‹ï¼Œæ‰€ä»¥+3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_READ_LOCK(I) (3 + (I))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// è¯»ç´¢å¼•çš„æ•°é‡ = æ‰€æœ‰é”æ•°é‡ - è¯»é”èµ·å§‹ä½ç½®3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WAL_NREADER (SQLITE_SHM_NLOCK - 3)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæ˜¯ç´¢å¼•æ–‡ä»¶å¤´éƒ¨120å­—èŠ‚å¤„å¼€å§‹çš„å‘¢ï¼Ÿä»ä¸Šé¢å¯¹walç´¢å¼•æ–‡ä»¶çš„æ ¼å¼åˆ†æå¯çŸ¥ï¼šç´¢å¼•æ–‡ä»¶å¼€å§‹æ˜¯ä¸¤ä¸ª&lt;code&gt;WalIndexHdr&lt;/code&gt; + ä¸€ä¸ª&lt;code&gt;WalCkptInfo&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;WalCkptInfo&lt;/code&gt;ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;struct&lt;/span&gt; WalCkptInfo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 nBackfill;              &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Number of WAL frames backfilled into DB */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 aReadMark[WAL_NREADER]; &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Reader marks */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u8 aLock[SQLITE_SHM_NLOCK]; &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Reserved space for locks */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 nBackfillAttempted;     &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* WAL frames perhaps written, or maybe not */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 notUsed0;               &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Available for future enhancements */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­çš„&lt;code&gt;aLock&lt;/code&gt;å­—æ®µå°±æ˜¯å­˜å‚¨ä¸Šé¢çš„è¿™äº›é”çš„æ•°ç»„ï¼ŒæŠŠå‰é¢è¿™äº›æ•°æ®çš„å¤§å°åŠ èµ·æ¥ï¼Œä¸€ç›´åˆ°è¿™ä¸ªå­—æ®µå°±æ­£å¥½æ˜¯120ï¼Œæœ‰å®å®šä¹‰ä¸ºè¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* A block of WALINDEX_LOCK_RESERVED bytes beginning at
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;** WALINDEX_LOCK_OFFSET is reserved for locks. Since some systems
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;** only support mandatory file-locks, we do not read or write data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;** from the region of the file on which locks are applied.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define WALINDEX_LOCK_OFFSET (sizeof(WalIndexHdr) * 2 + offsetof(WalCkptInfo, aLock))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ï¼ˆå¼•ç”¨è‡ª&lt;a href=&#34;https://www.sqlite.org/walformat.html&#34;&gt;WAL-mode File Format&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Name&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Offset&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;xShmLock&lt;/td&gt;
&lt;td&gt;File&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_WRITE_LOCK&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0&lt;/td&gt;
&lt;td&gt;120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_CKPT_LOCK&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1&lt;/td&gt;
&lt;td&gt;121&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_RECOVER_LOCK&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;2&lt;/td&gt;
&lt;td&gt;122&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_READ_LOCK(0)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;3&lt;/td&gt;
&lt;td&gt;123&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_READ_LOCK(1)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td&gt;124&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_READ_LOCK(2)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;td&gt;125&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_READ_LOCK(3)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;6&lt;/td&gt;
&lt;td&gt;126&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;WAL_READ_LOCK(4)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;7&lt;/td&gt;
&lt;td&gt;127&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;åŠ è§£é”æ“ä½œ&#34;&gt;åŠ è§£é”æ“ä½œ&lt;/h3&gt;
&lt;p&gt;walä¸å‰é¢çš„journalç›¸æ¯”ï¼Œå°‘äº†å¾ˆå¤šå…¶ä»–ç±»å‹çš„é”ï¼Œwalåªæœ‰ä¸¤ç§ç±»å‹çš„é”ï¼šsharedå…±äº«é”ï¼Œä»¥åŠexclusiveæ’å®ƒé”ã€‚å¯¹åº”çš„APIæœ‰ä¸‹é¢å››ä¸ªï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;walLockShared&lt;/span&gt;(Wal &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;pWal, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; lockIdx);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;walUnlockShared&lt;/span&gt;(Wal &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;pWal, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; lockIdx);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;walLockExclusive&lt;/span&gt;(Wal &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;pWal, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; lockIdx, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; n);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;walUnlockExclusive&lt;/span&gt;(Wal &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;pWal, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; lockIdx, &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; n);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼Œéœ€è¦äº¤å¾…ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå…¶ä¸­ä¼ å…¥çš„å‚æ•°&lt;code&gt;lockIdx&lt;/code&gt;ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„å‡ ç§é”çš„ç±»å‹ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œä»£ç ä¸­æœ‰&lt;code&gt;walLockShared(pWal, WAL_WRITE_LOCK)&lt;/code&gt;è¿™æ ·çš„æ“ä½œã€‚å¯¹ä¸€ä¸ªå†™é”åŠ å…±äº«é”åº”è¯¥æ€ä¹ˆç†è§£ï¼Ÿéœ€è¦çº æ­£çš„æ˜¯ï¼Œç±»ä¼¼&lt;code&gt;WAL_WRITE_LOCK&lt;/code&gt;è¿™æ ·çš„å®ï¼Œåªæ˜¯è¡¨ç¤ºè¿™ä¸€å­—èŠ‚ç”¨äºä»€ä¹ˆæ“ä½œï¼Œæ¯”å¦‚&lt;code&gt;WAL_WRITE_LOCK&lt;/code&gt;ç”¨äºå†™æ“ä½œï¼Œå³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦æ‹’ç»å…¶ä»–å†™è¯·æ±‚çš„æƒ…å†µä¸‹è¯»æ•°æ®æ—¶ï¼Œå°±åº”è¯¥å¯¹&lt;code&gt;WAL_WRITE_LOCK&lt;/code&gt;ç±»å‹çš„é”åŠ å…±äº«é”ã€‚&lt;/li&gt;
&lt;li&gt;è¦å¼€å§‹å†™æ“ä½œæ—¶ï¼Œå°±åº”è¯¥å¯¹&lt;code&gt;WAL_WRITE_LOCK&lt;/code&gt;ç±»å‹çš„é”åŠ æ’å®ƒé”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–ç±»å‹çš„é”ä¾æ¬¡ç±»æ¨ï¼Œå³&lt;code&gt;WAL_*_LOCK&lt;/code&gt;è¿™ç±»å®åªæ˜¯è¡¨ç¤ºè¿™ä¸€ä¸ªå­—èŠ‚çš„ç”¨é€”ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åä¸€ä¸ªç»†èŠ‚æ˜¯ï¼ŒåŠ å…±äº«é”æ—¶åªèƒ½ä¼ å…¥é”ç±»å‹ç´¢å¼•ï¼Œè€ŒåŠ æ’å®ƒé”çš„æ—¶å€™è¿˜èƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•°nï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™äº›ä¸åŒç±»å‹çš„é”ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯walç´¢å¼•å…±äº«æ–‡ä»¶ä¸Šè¿ç»­çš„å­—èŠ‚ï¼Œæ‰€ä»¥åŒºåˆ«åœ¨äºï¼Œå…±äº«é”ä¸€æ¬¡åªèƒ½å¯¹ä¸€ä¸ªé”è¿›è¡Œæ“ä½œï¼›è€Œæ’å®ƒé”åˆ™å¯ä»¥ä¸€æ¬¡å¤šå¯¹å¤šä¸ªé”è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;walLockExclusive(pWal, WAL_READ_LOCK(&lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;), WAL_NREADER &lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·å°±èƒ½æŠŠä»1å·è¯»é”å¼€å§‹çš„æ‰€æœ‰è¯»é”éƒ½åŠ ä¸Šæ’å®ƒé”ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  iLock &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; WAL_ALL_BUT_WRITE &lt;span style=&#34;color:#666&#34;&gt;+&lt;/span&gt; pWal&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;ckptLock;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  rc &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; walLockExclusive(pWal, iLock, WAL_READ_LOCK(&lt;span style=&#34;color:#666&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt; iLock);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„å‡ ä¸ªå¸¸é‡å–å€¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ckptLock&lt;/code&gt;å–å€¼ä¸º0æˆ–è€…1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;WAL_ALL_BUT_WRITE&lt;/code&gt;ä¸º1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#define WAL_READ_LOCK(I) (3 + (I))&lt;/code&gt;ï¼Œæ‰€ä»¥&lt;code&gt;WAL_READ_LOCK(0)&lt;/code&gt;ä¸º3ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºæ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ&lt;code&gt;ckptLock&lt;/code&gt;å–å€¼ä¸º0ï¼Œè¡¨ç¤ºè¿™æ—¶å€™è¿˜æ²¡æœ‰åŠ ä¸Šäº†checkpointçš„æ’å®ƒé”ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iLock&lt;/code&gt;ä¸º1ï¼Œ1ä¸º&lt;code&gt;WAL_CKPT_LOCK&lt;/code&gt;è¿™ä¸ªç±»å‹çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;WAL_READ_LOCK(0) - iLock&lt;/code&gt;ä¸º2ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œ&lt;code&gt;walLockExclusive(pWal, iLock, WAL_READ_LOCK(0) - iLock);&lt;/code&gt;å°±èƒ½æŠŠcheckpointå’Œ0å·è¯»é”éƒ½åŠ ä¸Šæ’å®ƒé”ï¼Œè¿™æ ·å°±ä¸ä¼šå…¶ä»–checkpointæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœ&lt;code&gt;ckptLock&lt;/code&gt;å–å€¼ä¸º1ï¼Œè¡¨ç¤ºè¿™æ—¶å€™å·²ç»åŠ ä¸Šäº†checkpointçš„æ’å®ƒé”ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iLock&lt;/code&gt;ä¸º2ï¼Œ2ä¸º&lt;code&gt;WAL_RECOVER_LOCK&lt;/code&gt;è¿™ä¸ªç±»å‹çš„é”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;WAL_READ_LOCK(0) - iLock&lt;/code&gt;ä¸º1ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œ&lt;code&gt;walLockExclusive(pWal, iLock, WAL_READ_LOCK(0) - iLock);&lt;/code&gt;å°±èƒ½æŠŠæ¢å¤åŠ ä¸Šæ’å®ƒé”ï¼Œè¿™æ ·èƒ½è¿›è¡Œæ¢å¤æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç‰¹æ®Šçš„0å·è¯»é”&#34;&gt;ç‰¹æ®Šçš„0å·è¯»é”&lt;/h3&gt;
&lt;p&gt;é™¤æ­¤ä»¥å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„0å·è¯»é”å¾ˆç‰¹æ®Šï¼Œå®ƒè¡¨ç¤ºè¯»äº‹åŠ¡ç”³è¯·çš„å…±äº«é”ï¼Œå’ŒWAL_WRITE_LOCKä¸å†²çªï¼Œè¯»å†™å¯ä»¥å®Œå…¨å¹¶å‘è¿›è¡Œï¼Œäº’ä¸å½±å“ï¼Œä½†æ˜¯ä¸èƒ½å’Œæ•°æ®åº“åŒæ­¥æ“ä½œå’ŒWAL-indexæ–‡ä»¶æ¢å¤å¹¶å‘è¿›è¡Œã€‚0å·è¯»é”è¡¨ç¤ºåªä»æ•°æ®åº“è¯»å–é¡µã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†å¯¹é”çš„äº†è§£ï¼Œå¯ä»¥æ¥ä¸‹æ¥çœ‹å„ç§æ“ä½œçš„å…·ä½“å®ç°äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯»æ“ä½œ&#34;&gt;è¯»æ“ä½œ&lt;/h2&gt;
&lt;p&gt;è¿›è¡Œè¯»æ“ä½œæ—¶ï¼Œå¤§ä½“éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªæ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿å­˜å½“å‰çš„&lt;code&gt;aReadMark&lt;/code&gt;ï¼Œå› ä¸ºè¿™æ¶‰åŠåˆ°è¯»é¡µé¢çš„æ—¶å€™æ•°æ®ä»å“ªé‡Œæ¥çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°å¯¹åº”çš„è¯»é”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢åˆ†åˆ«è®¨è®ºè¿™ä¸¤æ–¹é¢çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;readmark&#34;&gt;readMark&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆå«&lt;code&gt;readMark&lt;/code&gt;ï¼Œä»¥åŠæœ‰ä»€ä¹ˆä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å›é¡¾ä¹‹å‰è°ˆåˆ°walæ–‡ä»¶ä»¥åŠwalç´¢å¼•æ–‡ä»¶çš„æ ¼å¼ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªè¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºåŒä¸€ä¸ªé¡µé¢ç¼–å·çš„é¡µé¢ï¼Œå¯èƒ½ä¼šåœ¨walæ–‡ä»¶å­˜åœ¨ä¸åŒæ—¶é—´çš„å¤šæ¬¡å†™å…¥ç»“æœã€‚è¿™äº›å¤šæ¬¡å†™å…¥ç»“æœé‡Œï¼Œå¦‚æœæ‰€åœ¨çš„äº‹åŠ¡è¿˜æœªæäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿®æ”¹åº”è¯¥å¯¹è¯»æ“ä½œè¿˜å¤„äºä¸å¯è§çš„çŠ¶æ€ã€‚walæ–‡ä»¶å¤´ä¸­ä½¿ç”¨&lt;code&gt;mxFrame&lt;/code&gt;è¿™ä¸ªå­—æ®µæ¥å­˜å‚¨å½“å‰æœ€åå®Œæˆçš„å†™äº‹åŠ¡çš„å¸§æ•°ï¼Œè¶…è¿‡è¿™ä¸ªå¸§æ•°çš„ä¿®æ”¹éƒ½è®¤ä¸ºè¿˜æ²¡æœ‰å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;walç´¢å¼•ä¿å­˜ç€é¡µé¢çš„æœ€æ–°ä¿®æ”¹çš„ä½ç½®ä¿¡æ¯ï¼Œè¿™â€œæœ€æ–°ä¿®æ”¹â€æŒ‡çš„æ˜¯å·²ç»æäº¤çš„äº‹åŠ¡ï¼Œå¹¶ä¸åŒ…æ‹¬è¿˜æœªæäº¤çš„äº‹åŠ¡çš„ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œæ—¶ï¼Œä»¥é¡µé¢ç¼–å·å…ˆä»walç´¢å¼•ä¸­å°è¯•è¯»è¿™ä¸ªé¡µé¢åœ¨walä¸­çš„ä½ç½®ä¿¡æ¯ï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¯»æˆåŠŸï¼Œæ ¹æ®è¿™ä¸ªwalçš„ä½ç½®ä¿¡æ¯ï¼Œåˆ°walæ–‡ä»¶ä¸­è¯»å–è¯¥é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œè¯¥é¡µé¢æ²¡æœ‰åœ¨walä¸­ï¼Œåˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ä¸ºä¾‹æ¥è¯´æ˜æƒ…å†µï¼Œä¸ºäº†ç®€åŒ–è¯´æ˜ï¼Œä¸€ä¸ªé¡µé¢å­˜å‚¨çš„ä¸€å¯¹KVçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/read-wal.png&#34; alt=&#34;è¯»æ“ä½œçœ‹åˆ°çš„æ•°æ®åº“æ–‡ä»¶å’Œwal&#34; title=&#34;è¯»æ“ä½œçœ‹åˆ°çš„æ•°æ®åº“æ–‡ä»¶å’Œwal&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰ä¸‰ä¸ªå†™äº‹åŠ¡ï¼Œå…¶ä¸­ï¼š
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªäº‹åŠ¡å·²ç»å®Œæˆï¼Œä¿®æ”¹äº†å€¼&lt;code&gt;y=20&lt;/code&gt;ï¼Œè¿™ä¸ªä¿®æ”¹å­˜åœ¨ç¬¬ä¸€å¸§ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿå·²ç»å®Œæˆï¼Œä¿®æ”¹äº†å€¼&lt;code&gt;x=1&lt;/code&gt;å’Œ&lt;code&gt;y=2&lt;/code&gt;ï¼Œè¿™ä¸¤ä¸ªä¿®æ”¹å­˜åœ¨ç¬¬äºŒå’Œç¬¬ä¸‰å¸§ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰ä¸ªäº‹åŠ¡è¿˜åœ¨è¿›è¡Œä¸­ï¼Œç›®å‰ä¿®æ”¹äº†å€¼&lt;code&gt;x=3&lt;/code&gt;ï¼Œè¿™ä¸ªä¿®æ”¹å­˜åœ¨ç¬¬å››å¸§ä¸­ï¼Œå…¶ä½™ä¿®æ”¹è¿˜åœ¨è¿›è¡Œä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œé‚£ä¹ˆwalç´¢å¼•ä¸­è¿™å‡ ä¸ªç»´æŠ¤ä½ç½®ä¿¡æ¯çš„å†…å®¹å°±æ˜¯ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mxFrame=3&lt;/code&gt;ï¼Œå› ä¸ºè¿™æ˜¯æœ€åä¸€ä¸ªå®Œæˆçš„å†™äº‹åŠ¡çš„æœ€å¤§å¸§æ•°ã€‚&lt;/li&gt;
&lt;li&gt;walç´¢å¼•ä¸­ï¼š
&lt;ul&gt;
&lt;li&gt;xçš„ä½ç½®åœ¨ç¬¬å››å¸§ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„è¿™ä¸ªå€¼è¿˜å¹¶æœªæäº¤ï¼Œæ‰€ä»¥è¦åŒºåˆ†ä¸èƒ½è¯»åˆ°æœªæäº¤çš„å€¼ï¼ˆread uncommittedï¼‰ï¼Œè¿™åœ¨ä¸‹é¢ä¼šå±•å¼€è¯´æ˜ã€‚&lt;/li&gt;
&lt;li&gt;yçš„ä½ç½®åœ¨ç¬¬ä¸‰å¸§ã€‚æ³¨æ„åˆ°yæœ‰ä¸¤ä¸ªæ•°æ®ï¼Œä½†æ˜¯å–äº†å·²æäº¤äº‹åŠ¡ä¸­æœ€æ–°çš„é‚£æ¬¡æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;zåœ¨walä¸­æ²¡æœ‰ï¼Œå³åœ¨walå½“å‰ä¿å­˜çš„æ‰€æœ‰äº‹åŠ¡ä¸­éƒ½æ²¡æœ‰ä¿®æ”¹åˆ°zï¼Œäºæ˜¯å¦‚æœéœ€è¦è¯»å–zçš„å€¼ï¼Œéœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œxã€yã€zåˆæ˜¯å¦å¤–çš„ä¸‰ä¸ªå€¼ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ï¼Œå·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹è¿˜åœ¨WALæ–‡ä»¶ä¸­ï¼Œå¹¶æœªå†™å…¥æ•°æ®åº“æ–‡ä»¶é‡Œé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºæ˜¯ï¼Œå½“ä¸€ä¸ªæ–°çš„è¯»æ“ä½œå¼€å§‹çš„æ—¶å€™ï¼Œä¼šè®°å½•ä¸‹æ¥å½“æ—¶çš„&lt;code&gt;mxFrame&lt;/code&gt;ï¼Œè¿™ä¸ªå€¼å¯¹äºè¯»æ“ä½œè€Œè¨€ï¼Œè¢«ç§°ä¸º&lt;code&gt;readMark&lt;/code&gt;ï¼Œä¿å­˜åœ¨&lt;code&gt;WalCkptInfo&lt;/code&gt;ç»“æ„ä½“çš„æˆå‘˜&lt;code&gt;aReadMark&lt;/code&gt;æ•°ç»„ä¸­ã€‚æœ‰äº†è¿™ä¸ªå€¼ï¼Œå½“è¿›è¡Œcheckpointæ“ä½œçš„æ—¶å€™ï¼Œå°±èƒ½åˆ¤æ–­å½“å‰æ˜¯å¦éœ€è¦ç­‰å¾…è¯»æ“ä½œå®Œæˆã€‚è¿™éƒ¨åˆ†å°†åœ¨ä¸‹é¢ç»“åˆcheckpointæµç¨‹ç»§ç»­è®²è§£ã€‚&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œ&lt;code&gt;readMark&lt;/code&gt;è¿˜æœ‰å¦ä¸€å±‚å«ä¹‰ï¼šå³å½“å‰å·²å®Œæˆäº‹åŠ¡çš„æœ€å¤§å¸§æ•°ï¼Œæ‰€ä»¥å½“è¯»äº‹åŠ¡å»è¯»ä¸€ä¸ªé¡µé¢çš„å†…å®¹æ—¶ï¼Œä¼šé¦–å…ˆåˆ°walç´¢å¼•ä¸­ï¼Œæ ¹æ®è¯¥é¡µé¢çš„ç¼–å·æŸ¥è¯¢è¿™ä¸ªé¡µé¢å¯¹åº”çš„å¸§æ•°ï¼Œæœ‰è¿™å‡ ç§å¯èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰æ‰¾åˆ°ï¼šè¿™è¯´æ˜å½“å‰walæ–‡ä»¶ä¸­æ²¡æœ‰è¯¥é¡µé¢çš„å†…å®¹ï¼Œè¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;æ‰¾åˆ°äº†ï¼Œå‡è®¾è¿™ä¸ªå¸§æ•°ä¸º&lt;code&gt;iFrame&lt;/code&gt;ï¼Œè¿™åˆåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iFrame&amp;gt;readMark&lt;/code&gt;ï¼šè¿™è¯´æ˜æ˜¯è¿™ä¸ªè¯»äº‹åŠ¡ä¹‹åæ‰è¿›è¡Œçš„å†™æ“ä½œï¼Œäºæ˜¯è¿™ä¸ªé¡µé¢çš„å†…å®¹è¿˜æ˜¯ä¸èƒ½ä»WALæ–‡ä»¶ä¸­è¯»å–ï¼Œä»ç„¶åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä»WALä¸­è¯»å–ï¼Œå¯èƒ½è¯»åˆ°çš„æ˜¯è¿˜æœªæäº¤çš„äº‹åŠ¡çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;iFrame&amp;lt;=readMark&lt;/code&gt;ï¼šè¿™è¯´æ˜æ˜¯åœ¨è¿™ä¸ªè¯»äº‹åŠ¡ä¹‹å‰çš„å†™æ“ä½œï¼Œå¯ä»¥ä»WALæ–‡ä»¶è¯»è¿™ä¸ªé¡µé¢çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ç„¶ä»¥å‰é¢çš„å›¾ä¸ºä¾‹æ¥è¯´æ˜æƒ…å†µï¼Œå‡è®¾åœ¨ä¸Šå›¾çš„ç¬¬ä¸‰ä¸ªå†™äº‹åŠ¡è¿˜åœ¨è¿›è¡Œçš„æ—¶å€™ï¼Œæ¥äº†ä¸€ä¸ªè¯»äº‹åŠ¡ï¼ŒæŒ‰ç…§å‰é¢çš„è§£é‡Šï¼Œæ­¤æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿™ä¸ªè¯»äº‹åŠ¡çš„&lt;code&gt;readMark=3&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å‡å¦‚è¿™ä¸ªè¯»äº‹åŠ¡åˆ†åˆ«è¯»äº†xã€yã€zè¿™ä¸‰ä¸ªå€¼ï¼Œå®ƒéœ€è¦åˆ°walç´¢å¼•ä¸­æŸ¥è¯¢è¿™å‡ ä¸ªå€¼æ˜¯å¦åœ¨walæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆï¼š
&lt;ul&gt;
&lt;li&gt;xï¼šxçš„æœ€æ–°å€¼åœ¨ç¬¬å››å¸§ï¼Œå¤§äº&lt;code&gt;readMark=3&lt;/code&gt;ï¼Œè¯´æ˜æ˜¯ä¸ªå‘èµ·è¯»æ“ä½œä¹‹åè¿˜æœªæäº¤çš„å†™äº‹åŠ¡æ›´æ–°çš„ï¼Œè¿™å°±ä¸èƒ½è¯»walçš„æœ€æ–°å€¼ï¼Œè€Œè¦è¯»æ•°æ®åº“æ–‡ä»¶ä¸­çš„å€¼ï¼Œæ­¤æ—¶è¯»å‡ºæ¥çš„å€¼ä¸º&lt;code&gt;x=100&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;yï¼šyçš„æœ€æ–°å€¼åœ¨ç¬¬ä¸‰å¸§ï¼Œå¹¶ä¸å¤§äº&lt;code&gt;readMark=3&lt;/code&gt;ï¼Œæ‰€ä»¥å¯ä»¥ä»¥walçš„å€¼ä¸ºå‡†ï¼Œè¯»å‡ºæ¥&lt;code&gt;y=2&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;zï¼šåœ¨walç´¢å¼•ä¸­æ²¡æœ‰æ‰¾åˆ°zï¼Œåªèƒ½å»æ•°æ®åº“æ–‡ä»¶ä¸­æŸ¥ï¼Œè¯»å‡ºæ¥&lt;code&gt;z=300&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†æ¬¡è¯´æ˜çš„æ˜¯ï¼Œä¸ºäº†é—®é¢˜æè¿°çš„ç®€åŒ–ï¼Œè¿™é‡Œå‡è®¾ä¸€ä¸ªé¡µé¢åªå­˜å‚¨äº†ä¸€å¯¹KVçš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†å¯¹&lt;code&gt;readMark&lt;/code&gt;çš„åˆæ­¥äº†è§£ï¼Œç»§ç»­çœ‹è¯»æ“ä½œå¦‚ä½•è·å¾—è¯»é”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯»é”&#34;&gt;è¯»é”&lt;/h3&gt;
&lt;p&gt;å‰é¢å·²ç»æåˆ°ï¼Œè¯»é”çš„ä¿¡æ¯ä¿å­˜åœ¨&lt;code&gt;WalCkptInfo&lt;/code&gt;çš„&lt;code&gt;aLock&lt;/code&gt;æˆå‘˜ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;struct&lt;/span&gt; WalCkptInfo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;  u32 aReadMark[WAL_NREADER]; &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Reader marks */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u8 aLock[SQLITE_SHM_NLOCK]; &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Reserved space for locks */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;aReadMark&lt;/code&gt;ï¼šç”¨äºå­˜å‚¨æ¯ä¸ªè¯»æ“ä½œçš„&lt;code&gt;readMark&lt;/code&gt;å€¼ï¼Œè¿™ä¸ªå€¼å·²ç»åœ¨ä¸Šé¢åšäº†è§£é‡Šï¼Œè¿™ä¸ªæ•°ç»„çš„å¤§å°ä¸º&lt;code&gt;WAL_NREADER&lt;/code&gt;ï¼Œå³æ¯ä¸ªreaderä¸€ä¸ªreadMarkå€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aLock&lt;/code&gt;ï¼šå­˜å‚¨é”ç±»å‹çš„æ•°ç»„ï¼Œè¿™äº›é”ç±»å‹ä¹Ÿåœ¨ä¸Šé¢åšäº†è¯ é‡Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä¸€ä¸ªè¯»æ“ä½œæ¥çš„æ—¶å€™ï¼Œéœ€è¦è·å¾—ä¸€ä¸ªè¯»é”ï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹è¿›è¡Œå®ƒçš„è¯»æ“ä½œï¼Œè¿™ä¸ªè·å¾—é”çš„æµç¨‹ï¼Œåœ¨å‡½æ•°&lt;code&gt;walTryBeginRead&lt;/code&gt;ä¸­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;walIndexReadHdr&lt;/code&gt;å‡½æ•°è¯»å–walçš„ç´¢å¼•æ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äº&lt;code&gt;WalCkptInfo&lt;/code&gt;ä¿¡æ¯å­˜å‚¨åœ¨ç´¢å¼•æ–‡ä»¶å¤´ä¸­ï¼Œäºæ˜¯å¯ä»¥æ¥ä¸‹æ¥è°ƒç”¨&lt;code&gt;walCkptInfo&lt;/code&gt;å‡½æ•°æ‹¿åˆ°è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¯»æ‰¾å½“å‰å¯ç”¨çš„è¯»é”ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š
&lt;ol&gt;
&lt;li&gt;æœ‰äº†å½“å‰çš„&lt;code&gt;WalCkptInfo&lt;/code&gt;ä¿¡æ¯ï¼Œéå†å…¶ä¸­çš„&lt;code&gt;aReadMark&lt;/code&gt;æ•°ç»„ï¼Œé€‰å‡ºå…¶ä¸­&lt;code&gt;readMark&lt;/code&gt;æœ€å°çš„é‚£ä¸ªå€¼ï¼Œå¹¶ä¸”è®°å½•ä¸‹è¿™ä¸ªæœ€å°å€¼çš„ç´¢å¼•&lt;code&gt;i&lt;/code&gt;ã€‚è¿™æ˜¯å› ä¸º&lt;code&gt;readMark&lt;/code&gt;å°çš„è¯»æ“ä½œï¼Œæ›´æœ‰å¯èƒ½å·²ç»å®Œæˆäº†è¯»æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;å°è¯•è°ƒç”¨&lt;code&gt;walLockExclusive(pWal, WAL_READ_LOCK(i), 1)&lt;/code&gt;å¯¹ä¸Šä¸€æ­¥æ‹¿åˆ°çš„&lt;code&gt;readMark&lt;/code&gt;æ•°ç»„ç´¢å¼•åŠ æ’ä»–é”ï¼š
&lt;ol&gt;
&lt;li&gt;å¦‚æœæˆåŠŸï¼Œè¯´æ˜è¿™ä¸ªè¯»é”å½“å‰æ²¡æœ‰å…¶å®ƒè¿›ç¨‹åœ¨ç”¨ï¼Œå¯ä»¥é€€å‡ºå¾ªç¯äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå°±é€’å¢&lt;code&gt;i&lt;/code&gt;ç´¢å¼•å¯¹ä¸‹ä¸€ä¸ªè¯»é”è¿›è¡Œå°è¯•ï¼Œç›´åˆ°éå†å®Œæ¯•æ‰€æœ‰è¯»é”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;åˆ°äº†è¿™é‡Œï¼Œå·²ç»æ‹¿åˆ°ä¸€ä¸ªå¯ç”¨çš„è¯»é”äº†ï¼Œè°ƒç”¨&lt;code&gt;walLockShared&lt;/code&gt;å¯¹è¿™ä¸ªè¯»é”åŠ å…±äº«é”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨å‰é¢çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¯èƒ½æœ‰å†™æ“ä½œåœ¨è¿›è¡Œï¼Œæ‰€ä»¥åœ¨è¿”å›ä¹‹å‰ï¼Œæœ€ååˆ¤æ–­ä¸€ä¸‹wal ç´¢å¼•å¤´æ•°æ®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œå‰é¢çš„æ­¥éª¤å°±å¾—é‡æ–°æ¥è¿‡ï¼Œè¿”å›é‡è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦è¡¥å……è¯´æ˜çš„æ˜¯ï¼Œå‡½æ•°&lt;code&gt;walTryBeginRead&lt;/code&gt;åœ¨è°ƒç”¨æ—¶ï¼Œå¦‚æœè¿”å›é‡è¯•ï¼ˆ&lt;code&gt;WAL_RETRY&lt;/code&gt;ï¼‰çš„è¯ï¼Œè°ƒç”¨è€…ä¼šå°†è°ƒç”¨è®¡æ•°é€’å¢ï¼Œå½“è¿™ä¸ªè°ƒç”¨è®¡æ•°è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œå†æ¬¡è°ƒç”¨æ—¶&lt;code&gt;walTryBeginRead&lt;/code&gt;ä¼šä¼‘çœ ä¸€ä¸‹ï¼Œè¶…è¿‡100æ¬¡åˆ™ä¼šæŠ¥é”™ä¸å†å°è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// å°è¯•è¶…è¿‡5æ¬¡çš„æƒ…å†µä¸‹ï¼Œè¦ä¼‘çœ ä¸€ä¸‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt; (cnt &lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; nDelay &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Pause time in microseconds */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt; (cnt &lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;100&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// è¶…è¿‡100æ¬¡äº†ï¼Œé€€å‡ºæŠ¥é”™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;      VVA_ONLY(pWal&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;lockError &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;1&lt;/span&gt;;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;return&lt;/span&gt; SQLITE_PROTOCOL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt; (cnt &lt;span style=&#34;color:#666&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      nDelay &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; (cnt &lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;9&lt;/span&gt;) &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt; (cnt &lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;9&lt;/span&gt;) &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;39&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sqlite3OsSleep(pWal&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;pVfs, nDelay);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/walTryBeginRead.png&#34; alt=&#34;walTryBeginReadå‡½æ•°æµç¨‹&#34; title=&#34;walTryBeginReadå‡½æ•°æµç¨‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä»åŠ è¯»é”çš„æµç¨‹çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sqliteçš„WALæœºåˆ¶ï¼Œæœ€å¤§åªèƒ½æ”¯æŒåŒæ—¶æœ‰&lt;code&gt;WAL_NREADER&lt;/code&gt;ä¸ªè¯»æ“ä½œå¹¶å‘ã€‚&lt;/li&gt;
&lt;li&gt;åŠ è¯»é”çš„æ—¶å€™ï¼Œå¦‚æœå› ä¸ºå†™æ“ä½œå¯¼è‡´walç´¢å¼•æ–‡ä»¶å¤´å‘ç”Ÿäº†å˜åŒ–ï¼Œå°†å‰åŠŸå°½å¼ƒå†æ¬¡å°è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†™æ“ä½œ&#34;&gt;å†™æ“ä½œ&lt;/h2&gt;
&lt;h3 id=&#34;å†™é”&#34;&gt;å†™é”&lt;/h3&gt;
&lt;p&gt;æ‹¿åˆ°å†™é”çš„æµç¨‹ï¼Œå¯¹æ¯”ä¸Šé¢æ‹¿åˆ°è¯»é”çš„æµç¨‹æ¥è¯´ï¼Œå°±ç®€å•å¾ˆå¤šäº†ï¼Œåœ¨å‡½æ•°&lt;code&gt;sqlite3WalBeginWriteTransaction&lt;/code&gt;ä¸­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;walLockExclusive(pWal, WAL_WRITE_LOCK, 1)&lt;/code&gt;æ‹¿åˆ°å†™é”çš„æ’å®ƒé”ã€‚&lt;/li&gt;
&lt;li&gt;åŒæ ·ä¹Ÿæ˜¯æ£€æŸ¥æ˜¯å¦walç´¢å¼•å¤´å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœæ˜¯åˆ™éœ€è¦å†æ¬¡å°è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œè§£å†™é”æ“ä½œå°±åœ¨å‡½æ•°&lt;code&gt;sqlite3WalBeginWriteTransaction&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°éƒ½æŒºç®€å•ï¼Œå°±ä¸å±•å¼€é˜è¿°äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å†™æ“ä½œ-1&#34;&gt;å†™æ“ä½œ&lt;/h3&gt;
&lt;p&gt;çœŸæ­£å°†è„é¡µé¢å†™å…¥walæ–‡ä»¶ä¸­çš„æ“ä½œåœ¨å‡½æ•°&lt;code&gt;sqlite3WalFrames&lt;/code&gt;ä¸­ï¼Œè¯¥å‡½æ•°æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PgHdr *pListï¼šè„é¡µé¢é“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;int isCommitï¼šä¸º1çš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºè¿™æ˜¯æäº¤æ“ä½œï¼Œå³è¿™ä¸ªå†™äº‹åŠ¡çš„æœ€åä¸€æ¬¡è°ƒç”¨&lt;code&gt;sqlite3WalFrames&lt;/code&gt;å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;sqlite3WalFrames&lt;/code&gt;å‡½æ•°çš„å®ç°ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªäº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹¿åˆ°å½“å‰å†™walçš„èµ·å§‹ä½ç½®ï¼Œä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œéå†è„é¡µé¢å†™å…¥walæ–‡ä»¶ä¸­ã€‚è€Œè¿™ä¸ªèµ·å§‹ä½ç½®ï¼Œå°±æ˜¯å‰é¢æåˆ°çš„&lt;code&gt;mxFrame+1&lt;/code&gt;å¸§ã€‚
&lt;ul&gt;
&lt;li&gt;ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘åˆ°å¯èƒ½å‡ºç°çš„è¦†ç›–æƒ…å†µï¼Œå³ï¼šåŒä¸€æ¬¡å†™äº‹åŠ¡ï¼Œå¯¹åŒä¸€ä¸ªé¡µé¢æœ‰å¤šæ¬¡å†™æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåé¢å¯¹åŒä¸€ä¸ªé¡µé¢çš„å†™æ“ä½œï¼Œä¸åº”è¯¥å†™åˆ°walåé¢ï¼Œè€Œæ˜¯è¦†ç›–å‰é¢çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éå†è„é¡µé¢é“¾è¡¨ï¼Œå°†è„é¡µé¢å†™å…¥walæ–‡ä»¶ä¹‹åï¼Œå°±éœ€è¦æ ¹æ®æœ€æ–°çš„é¡µé¢ç¼–å·å’Œwalæ–‡ä»¶å¸§æ•°çš„å¯¹åº”å…³ç³»ï¼Œæ›´æ–°walç´¢å¼•çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæ›´æ–°&lt;code&gt;mxFrame&lt;/code&gt;çš„å€¼ä¸ºWALæ–‡ä»¶å½“å‰çš„æœ€å¤§å¸§æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜æ˜¯ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/write-wal.png&#34; alt=&#34;å†™äº‹åŠ¡ä¿®æ”¹WALæ–‡ä»¶å’ŒWALç´¢å¼•æ•°æ®&#34; title=&#34;å†™äº‹åŠ¡ä¿®æ”¹WALæ–‡ä»¶å’ŒWALç´¢å¼•æ•°æ®&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç²¾ç®€äº†å¾ˆå¤šæƒ…å†µï¼Œå‡è®¾ä»WALæ–‡ä»¶çš„å¼€å¤´å¼€å§‹å†™è„é¡µé¢äº†ï¼Œå›¾ä¸­çš„å†™äº‹åŠ¡ä¸€å…±å†™äº†ä¸‰æ¬¡é¡µé¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™å…¥&lt;code&gt;y=200&lt;/code&gt;ï¼šè¿™æ—¶å€™å°†è¿™ä¸ªå†…å®¹å†™å…¥WALæ–‡ä»¶ä¸­çš„ç¬¬ä¸€å¸§ï¼Œæ›´æ–°walç´¢å¼•ä¸­yé¡µé¢çš„å¸§æ•°ä¸º1ï¼Œè€Œæ­¤æ—¶xè¿˜æ²¡æœ‰å†…å®¹ã€‚å†™å®Œæ¯•ä¹‹åï¼Œæ›´æ–°&lt;code&gt;mxFrame=1&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†™å…¥&lt;code&gt;x=100&lt;/code&gt;ï¼šè¿™æ—¶å€™å°†è¿™ä¸ªå†…å®¹å†™å…¥WALæ–‡ä»¶ä¸­çš„ç¬¬äºŒå¸§ï¼Œæ›´æ–°walç´¢å¼•ä¸­xé¡µé¢çš„å¸§æ•°ä¸º2ã€‚å†™å®Œæ¯•ä¹‹åï¼Œæ›´æ–°&lt;code&gt;mxFrame=1&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å†™å…¥&lt;code&gt;y=101&lt;/code&gt;ï¼šå†™å…¥æ—¶å‘ç°ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¹‹å‰å·²ç»ä¿®æ”¹è¿‡yé¡µé¢äº†ï¼Œäºæ˜¯è¿™ä¸€æ¬¡å¹¶ä¸æŠŠ&lt;code&gt;y=101&lt;/code&gt;çš„ä¿®æ”¹ç»§ç»­å†™åˆ°WALæ–‡ä»¶ç»“å°¾ï¼Œè€Œæ˜¯è¦†ç›–ç¬¬ä¸€å¸§ä¸­å·²ç»å­˜åœ¨çš„yé¡µé¢å†…å®¹ï¼ŒåŒæ—¶ç´¢å¼•æ•°æ®ä¹Ÿä¸éœ€è¦æ›´æ–°ï¼šå› ä¸ºæ˜¯è¦†ç›–æ“ä½œï¼Œyé¡µé¢çš„å¸§æ•°å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚åŒæ ·çš„ï¼Œç”±äºæ²¡æœ‰ä¿®æ”¹WALæ–‡ä»¶çš„æœ€å¤§å¸§æ•°ï¼Œ&lt;code&gt;mxFrame&lt;/code&gt;ä¹Ÿæ²¡æœ‰ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é¡µé¢æ ¡éªŒå€¼çš„è®¡ç®—&#34;&gt;é¡µé¢æ ¡éªŒå€¼çš„è®¡ç®—&lt;/h3&gt;
&lt;h2 id=&#34;checkpoint-1&#34;&gt;checkpoint&lt;/h2&gt;
&lt;h3 id=&#34;æ€»ä½“æµç¨‹&#34;&gt;æ€»ä½“æµç¨‹&lt;/h3&gt;
&lt;p&gt;æœ‰äº†å‰é¢è¯»ã€å†™æ“ä½œçš„äº†è§£ï¼Œæ¥ç€æ¥äº†è§£ä¸€ä¸‹checkpointæ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å›é¡¾ä¸€ä¸‹&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œè¦å®Œæˆçš„äº‹æƒ…ï¼šç”±äºwalæ—¥å¿—ä¸­å­˜å‚¨çš„ï¼Œéƒ½æ˜¯æ¯æ¬¡å†™äº‹åŠ¡è¢«ä¿®æ”¹çš„é¡µé¢ï¼Œå› æ­¤&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œå°±æ˜¯å°†walæ—¥å¿—ä¸­è¢«ä¿®æ”¹çš„é¡µé¢å†™å…¥æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œå› æ­¤&lt;code&gt;checkpoint&lt;/code&gt;ä¹Ÿè¢«ç§°ä¸º&lt;code&gt;backfillï¼ˆå›å¡«ï¼‰&lt;/code&gt;æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/checkpoint.png&#34; alt=&#34;checkpointæ“ä½œ&#34; title=&#34;checkpointæ“ä½œ&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„è¯»å†™æµç¨‹çš„åˆ†æé‡Œçœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒæ—¶èƒ½æ”¯æŒå¤šä¸ªè¯»äº‹åŠ¡ï¼Œæ¯ä¸ªè¯»äº‹åŠ¡éƒ½æœ‰ä¸€ä¸ª&lt;code&gt;readMark&lt;/code&gt;å€¼ï¼Œç”¨æ¥åŒºåˆ†è¿™ä¸ªè¯»æ“ä½œè¯»åˆ°åœ¨WALä¸­å­˜å‚¨çš„æŸä¸ªé¡µé¢æ—¶ï¼Œæ˜¯ä»¥walçš„é¡µé¢ä¸ºå‡†ï¼Œè¿˜æ˜¯åº”è¯¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–è¿™ä¸ªé¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ªå†™äº‹åŠ¡ï¼Œè¿™ä¸ªå†™äº‹åŠ¡æ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œä»»ä½•è¯»äº‹åŠ¡ä¸èƒ½è¯»åˆ°å®ƒçš„æ•°æ®ï¼Œå› ä¸ºæ˜¯æœªæäº¤ï¼ˆuncommittedï¼‰çš„ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨åš&lt;code&gt;checkpoint&lt;/code&gt;çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸èƒ½å°†æœªæäº¤å†™äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºæ­£åœ¨è¿›è¡Œçš„è¯»æ“ä½œï¼Œä¸èƒ½å°†è¶…è¿‡è¯¥è¯»æ“ä½œçš„&lt;code&gt;readMark&lt;/code&gt;å€¼çš„å¸§ï¼Œå›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œéœ€è¦ç­‰å¾…è¯»æ“ä½œå®Œæˆæ‰èƒ½å›å¡«è¿™éƒ¨åˆ†æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20220106-sqlite-btree-4-wal/checkpoint-readmark.png&#34; alt=&#34;checkpointæ“ä½œ&#34; title=&#34;checkpointæ“ä½œ&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç‚¹å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºæœªæäº¤çš„å†™äº‹åŠ¡ï¼Œå¯èƒ½åªä¿®æ”¹äº†ä¸€éƒ¨åˆ†ï¼Œå¦‚æœåœ¨æœªæäº¤è¿™ä¸ªå†™äº‹åŠ¡ä¹‹å‰ï¼Œå°±æŠŠè¿™ä¸€éƒ¨åˆ†å›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œä¼šé€ æˆè¯»å‡ºæ¥çš„è¿™éƒ¨åˆ†æ•°æ®é©´å¤´ä¸å¯¹é©¬å˜´ã€‚æ¯”å¦‚ä¸€ä¸ªå†™äº‹åŠ¡çš„ä¿®æ”¹ï¼Œæ˜¯å°†Aè´¦å·çš„100è½¬è´¦åˆ°Bè´¦å·ä¸Šï¼Œäºæ˜¯è¿™ä¸ªå†™äº‹åŠ¡å°±æ¶‰åŠä¸¤ä¸ªä¿®æ”¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Aï¼šæ‰£é™¤100ã€‚&lt;/li&gt;
&lt;li&gt;Bï¼šåŠ ä¸Š100ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¿™ä¸ªäº‹åŠ¡å½“å‰åªå®Œæˆäº†ä¸Šé¢çš„ç¬¬ä¸€æ­¥ä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹é©¬ä¸Šè¢«å›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè¿™æ—¶å€™çœ‹åˆ°çš„å°±æ˜¯Aå°‘äº†100ï¼Œè€ŒBæ²¡æœ‰å˜åŒ–ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹çš„ç†è§£ï¼Œè¦å›åˆ°å‰é¢å¯¹&lt;code&gt;readMark&lt;/code&gt;å€¼çš„è§£é‡Šä¸Šï¼šä¸€ä¸ªè¯»æ“ä½œå¼€å§‹ä¹‹å‰ï¼Œä¼šè®°å½•ä¸€ä¸‹å½“å‰å·²å®Œæˆå†™äº‹åŠ¡çš„æœ€å¤§ä¿®æ”¹å¸§æ•°åšä¸ºè‡ªå·±çš„&lt;code&gt;readMark&lt;/code&gt;ï¼Œåœ¨åç»­çš„è¯»æ“ä½œä¸­ï¼Œä»walç´¢å¼•ä¸­æŸ¥è¯¢ä¸€ä¸ªé¡µé¢ç¼–å·ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜éœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥é¡µé¢å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;æ‰¾åˆ°äº†ï¼Œåˆéœ€è¦åŒºåˆ†ä¸¤ç§æƒ…å†µï¼š
&lt;ul&gt;
&lt;li&gt;è¿™ä¸ªé¡µé¢æ‰€åœ¨çš„å¸§æ•°&amp;lt;&lt;code&gt;readMark&lt;/code&gt;ï¼šè¯´æ˜è¿™ä¸ªé¡µé¢åœ¨è¯»æ“ä½œå¼€å§‹ä¹‹åå†æ²¡æœ‰è¢«ä¿®æ”¹äº†ï¼Œå¯ä»¥ä»¥walçš„å†…å®¹ä¸ºå‡†ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼šè¯´æ˜è¿™ä¸ªé¡µé¢åœ¨è¯»æ“ä½œä¹‹åè¢«ä¿®æ”¹äº†ï¼Œéœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­æŸ¥è¯¢è¢«ä¿®æ”¹ä¹‹å‰çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼šä¸Šé¢çš„â€è¿™ä¸ªé¡µé¢åœ¨è¯»æ“ä½œä¹‹åè¢«ä¿®æ”¹â€œæ¡ä»¶ï¼Œä¸ä»…åŒ…æ‹¬è¿™ä¸ªä¿®æ”¹å¯¹åº”çš„å†™äº‹åŠ¡æ²¡æœ‰è¢«æäº¤ï¼Œä¹ŸåŒ…æ‹¬å†™äº‹åŠ¡å·²æäº¤çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å³ï¼š&lt;code&gt;readMark&lt;/code&gt;ä¿è¯äº†ï¼Œä¸€ä¸ªè¯»äº‹åŠ¡ç»å¯¹ä¸èƒ½è¯»åˆ°åœ¨è¿™ä¸ªè¯»äº‹åŠ¡ä¹‹åçš„ä»»ä½•ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ç”±è¿™ä¸ªè§£é‡Šå¯ä»¥çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªè¯»æ“ä½œåˆ¤æ–­ä¸€ä¸ªé¡µé¢çš„å†…å®¹éœ€è¦åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–æ—¶ï¼Œéœ€è¦è¯»åˆ°çš„æ˜¯è¿™ä¸ªè¯»äº‹åŠ¡ä¹‹å‰çš„ä¿®æ”¹ã€‚å› æ­¤ï¼Œ&lt;code&gt;checkpoint&lt;/code&gt;éœ€è¦ä¿è¯ï¼šä¸èƒ½å°†è¶…è¿‡å½“å‰ä»»ä½•è¯»æ“ä½œçš„&lt;code&gt;readMark&lt;/code&gt;å€¼çš„å¸§æ•°ï¼Œå›å¡«å…¶ä¿å­˜çš„é¡µé¢åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°äº†è¿™é‡Œï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šä¸€ä¸ª&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œçš„æµç¨‹äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ &lt;code&gt;checkpoint&lt;/code&gt;çš„æ’å®ƒé”ï¼Œä¿è¯åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œåœ¨è¿›è¡Œã€‚&lt;/li&gt;
&lt;li&gt;ç®—å‡ºå½“å‰æœ€å¤§å¯ä»¥å›å¡«åˆ°ç¬¬å‡ å¸§çš„æ•°æ®ï¼Œå‡è®¾è¿™ä¸ªå€¼ä¿å­˜åœ¨å˜é‡&lt;code&gt;mxSafeFrame&lt;/code&gt;ä¸­ï¼Œæµç¨‹å¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;åˆå§‹æ—¶ï¼Œå–&lt;code&gt;mxSafeFrame=mxFrame&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éå†å½“å‰æ‰€æœ‰è¿˜åœ¨è¿›è¡Œçš„è¯»æ“ä½œï¼Œå–&lt;code&gt;mxSafeFrame=min(mxSafeFrame, aReadMark)&lt;/code&gt;ï¼Œå³ä¸èƒ½è¶…è¿‡ä»»ä½•ä¸€ä¸ªåœ¨è¿›è¡Œçš„è¯»æ“ä½œçš„&lt;code&gt;readMark&lt;/code&gt;å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¡ç®—å‡ºæ¥äº†æœ€å¤§å›å¡«å¸§æ•°ï¼Œå¯ä»¥å®é™…è¿›è¡Œå›å¡«æ“ä½œäº†ï¼šéå†å½“å‰çš„walæ–‡ä»¶ï¼Œå°†æ‰€æœ‰å¸§æ•°å°äºç­‰äº&lt;code&gt;mxSafeFrame&lt;/code&gt;çš„ä¿®æ”¹éƒ½å›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯&lt;code&gt;checkpoint&lt;/code&gt;æµç¨‹çš„æ€»ä½“æè¿°ï¼Œå…¶ä¸­æ¶‰åŠçš„ä¸»è¦å‡½æ•°æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;sqlite3WalCheckpoint&lt;/code&gt;ï¼š&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œçš„å…¥å£å‡½æ•°ï¼Œè´Ÿè´£åŠ &lt;code&gt;checkpoint&lt;/code&gt;æ’å®ƒé”ï¼Œç„¶åç»§ç»­è°ƒç”¨ä¸‹é¢çš„&lt;code&gt;walCheckpoint&lt;/code&gt;è¿›è¡Œå®é™…çš„å›å¡«æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;walCheckpoint&lt;/code&gt;ï¼šæ‰§è¡Œ&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æƒ³äº†è§£æ›´å¤šç»†èŠ‚çš„è¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸åŒçš„checkpointæ¨¡å¼&#34;&gt;ä¸åŒçš„checkpointæ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢åªæ˜¯äº†è§£äº†&lt;code&gt;checkpoint&lt;/code&gt;çš„å¤§ä½“æµç¨‹ï¼Œä½†æ˜¯ä¸åŒçš„checkpointæ¨¡å¼åˆæœ‰åŒºåˆ«ï¼Œæœ‰å¦‚ä¸‹çš„å®æ¥è¿›è¡ŒåŒºåˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define SQLITE_CHECKPOINT_PASSIVE  0  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Do as much as possible w/o blocking */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define SQLITE_CHECKPOINT_FULL     1  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Wait for writers, then checkpoint */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define SQLITE_CHECKPOINT_RESTART  2  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Like FULL but wait for for readers */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080&#34;&gt;#define SQLITE_CHECKPOINT_TRUNCATE 3  &lt;/span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Like RESTART but also truncate WAL */&lt;/span&gt;&lt;span style=&#34;color:#080&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;sqlite_checkpoint_passive&#34;&gt;SQLITE_CHECKPOINT_PASSIVE&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œä¸ä¼šç­‰å¾…è¯»å†™æ“ä½œå®Œæˆï¼Œè€Œæ˜¯åŸºäºç°æœ‰çš„æ•°æ®ï¼Œå°½å¯èƒ½å°†å®‰å…¨çš„å¸§å›å¡«åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ¨¡å¼æ›´æ¥è¿‘äºä¸€ç§â€æ­¥è¿›ï¼ˆstepï¼‰â€œçš„æ¨¡å¼ï¼šæ¯æ¬¡å›å¡«ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå›å¡«ä¸å®Œå°±ç›´æ¥è¿”å›ä¸å†è¿›è¡Œã€‚æ‰€ä»¥ï¼Œéœ€è¦æŸäº›å˜é‡æ¥ä¿å­˜å½“å‰çš„å›å¡«è¿›åº¦ï¼Œè¿™ä¸ªå€¼ä¿å­˜åœ¨&lt;code&gt;WalCkptInfo.nBackfill&lt;/code&gt;ï¼Œæ‰€ä»¥å›å¡«è¿˜æ²¡æœ‰ç»“æŸçš„æ¡ä»¶ä¹Ÿå°±æ˜¯ï¼š&lt;code&gt;pInfo-&amp;gt;nBackfill &amp;lt; pWal-&amp;gt;hdr.mxFrame&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;sqlite_checkpoint_full&#34;&gt;SQLITE_CHECKPOINT_FULL&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œ&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œä¼šç­‰å¾…å†™æ“ä½œå®Œæˆï¼Œæ‰ç»§ç»­è¿›è¡Œå›å¡«æ“ä½œï¼Œè€Œåœ¨å›å¡«è¿‡ç¨‹ä¸­ä¹Ÿä¸å†å…è®¸æœ‰æ–°çš„å†™æ“ä½œè¿›è¡Œã€‚&lt;/p&gt;
&lt;h4 id=&#34;sqlite_checkpoint_restart&#34;&gt;SQLITE_CHECKPOINT_RESTART&lt;/h4&gt;
&lt;p&gt;å¯¹æ¯”&lt;code&gt;SQLITE_CHECKPOINT_FULL&lt;/code&gt;æ¨¡å¼ï¼Œè¿™ä¸€ä¸ªæ¨¡å¼æ›´è¿›äº†ä¸€æ­¥ï¼šç­‰å¾…æ‰€æœ‰è¯»æ“ä½œå®Œæˆæ‰å¼€å§‹å›å¡«æ“ä½œï¼ŒåŒæ ·çš„ï¼Œåœ¨&lt;code&gt;checkpoint&lt;/code&gt;è¿‡ç¨‹ä¸­é™¤äº†ä¸èƒ½æœ‰å†™æ“ä½œè¿˜ä¸èƒ½æœ‰è¯»æ“ä½œã€‚&lt;/p&gt;
&lt;h4 id=&#34;sqlite_checkpoint_truncate&#34;&gt;SQLITE_CHECKPOINT_TRUNCATE&lt;/h4&gt;
&lt;p&gt;è¿™ä¸€ä¸ªæ¨¡å¼å¯¹æ¯”&lt;code&gt;SQLITE_CHECKPOINT_RESTART&lt;/code&gt;åˆæ›´è¿‘äº†ä¸€æ­¥ï¼Œåœ¨å›å¡«å®Œæ¯•ä¹‹åï¼Œå°†æˆªæ–­WALæ–‡ä»¶ï¼Œè¿™æ ·åé¢æ–°æ¥çš„walçš„å†™æ“ä½œï¼Œå°†ä»walæ–‡ä»¶çš„å¼€å§‹ä½ç½®å¼€å§‹å†™ã€‚æˆ‘ä»¬å‰é¢æåˆ°ï¼Œåœ¨walæ–‡ä»¶ä¸­æŸ¥æ‰¾ä¸€ä¸ªé¡µé¢æ—¶ï¼Œè·Ÿwalæ–‡ä»¶çš„å¤§å°æˆæ­£æ¯”ï¼Œæ‰€ä»¥å›å¡«å®Œæ¯•æˆªæ–­walæ–‡ä»¶é‡æ–°å¼€å§‹å†™ï¼Œä¼šåŠ é€Ÿåé¢çš„æŸ¥è¯¢æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id=&#34;é”™è¯¯æ¢å¤&#34;&gt;é”™è¯¯æ¢å¤&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸Šå·²ç»æŠŠwalçš„è¯»ã€å†™ã€checkpointæµç¨‹éƒ½äº†è§£äº†ï¼Œæœ€åäº†è§£ä¸€ä¸‹walçš„é”™è¯¯æ¢å¤æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;åŒºåˆ†å‡ ç§æƒ…å†µä¸‹é¢çš„å‡ºé”™å´©æºƒï¼Œä»¥åŠè¿™äº›æƒ…å†µä¸‹éƒ½å¦‚ä½•æ¢å¤çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™äº‹åŠ¡è¿›è¡Œæ—¶å‡ºé”™å´©æºƒï¼šè¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¾ç„¶walä¸­å­˜å‚¨äº†ä¸€éƒ¨åˆ†è¿™ä¸ªå†™äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå´©æºƒæ¢å¤æ—¶æ ¡éªŒåä¼šå‘ç°è¿™éƒ¨åˆ†çš„ä¿®æ”¹ä¸å®Œå…¨ï¼Œäºæ˜¯ä¼šå°†è¿™éƒ¨åˆ†ä¿®æ”¹æˆªæ–­ï¼Œè€Œæ•°æ®åº“æ–‡ä»¶ï¼Œæ ¹æ®å‰é¢&lt;code&gt;checkpoint&lt;/code&gt;æµç¨‹çš„è®²è§£ï¼Œå¹¶ä¸ä¼šå›å¡«è¿˜æœªæäº¤çš„å†™äº‹åŠ¡çš„ä¿®æ”¹ï¼Œæ‰€ä»¥æ•°æ®åº“æ–‡ä»¶å¹¶æœªæŸåã€‚&lt;/li&gt;
&lt;li&gt;å½“å‰æ²¡æœ‰ä»»ä½•å†™äº‹åŠ¡ï¼Œåœ¨è¿›è¡Œ&lt;code&gt;checkpoint&lt;/code&gt;è¿‡ç¨‹ä¸­å´©æºƒï¼šåœ¨è¿›è¡Œ&lt;code&gt;checkpoint&lt;/code&gt;æ—¶ï¼Œä¸å…è®¸åŒæ—¶å¹¶å‘æœ‰å†™æ“ä½œã€‚äºæ˜¯è¿™ç§æƒ…å†µä¸‹ï¼Œwalæ–‡ä»¶ä¸­ä¿å­˜çš„æ•°æ®ï¼Œéƒ½æ˜¯å®Œæ•´çš„å†™äº‹åŠ¡ä¿®æ”¹æ•°æ®ã€‚å¯åŠ¨åæ ¡éªŒwalæ–‡ä»¶å‘ç°å†…å®¹éƒ½æ˜¯å¯¹çš„ï¼Œäºæ˜¯éå†walæ–‡ä»¶ï¼Œé¦–å…ˆå°†å½“å‰walæ–‡ä»¶ä¸­çš„å†…å®¹å…¨éƒ¨å›å¡«è‡³æ•°æ®åº“æ–‡ä»¶ä¸­å†å¯åŠ¨å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;æœ€åå¯¹walæœºåˆ¶åšä¸€ä¸ªç®€çŸ­çš„æ€»ç»“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸journalå¤‡ä»½æœºåˆ¶ä¸åŒçš„æ˜¯ï¼šjournalå¤‡ä»½çš„æ˜¯ä¿®æ”¹ä¹‹å‰çš„é¡µé¢å†…å®¹ï¼Œè€Œwalå­˜å‚¨çš„æ˜¯ä¿®æ”¹åçš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;äºæ˜¯ï¼Œwalä¸­å¯èƒ½å­˜å‚¨äº†åŒä¸€ä¸ªé¡µé¢çš„å¤šæ¬¡ä¿®æ”¹ç»“æœï¼Œå› ä¸ºä¸åŒçš„äº‹åŠ¡ã€ç”šè‡³ç›¸åŒçš„äº‹åŠ¡ï¼Œéƒ½æœ‰å¯èƒ½ä¿®æ”¹äº†åŒä¸€ä¸ªé¡µé¢ï¼Œè€Œæ¯ä¸€æ¬¡ä¿®æ”¹éƒ½è¦å°†ä¿®æ”¹ç»“æœå­˜å‚¨walæ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;walæ–‡ä»¶ä¸­ï¼Œå­˜å‚¨ä¸€ä¸ªé¡µé¢å†…å®¹çš„å•ä½æ˜¯â€å¸§ï¼ˆframeï¼‰â€œï¼Œä¸€å¸§å­˜å‚¨ä¸€ä¸ªé¡µé¢ï¼Œè€Œåè¿‡æ¥ä¸€ä¸ªé¡µé¢å¯èƒ½å…ˆåè¢«å­˜å‚¨åœ¨ä¸åŒå¸§çš„å†…å®¹ä¸­ã€‚äºæ˜¯å°±éœ€è¦walç´¢å¼•æ•°æ®ï¼š&lt;/li&gt;
&lt;li&gt;walç´¢å¼•éœ€è¦å­˜å‚¨ä¸¤ç±»æ•°æ®ï¼šä¸€ä¸ªå¸§å­˜å‚¨çš„æ˜¯å“ªä¸ªé¡µé¢çš„æ•°æ®ï¼Œä»¥åŠæŸä¸ªé¡µé¢æœ€æ–°çš„æ•°æ®å­˜å‚¨åœ¨å“ªä¸€å¸§ã€‚&lt;/li&gt;
&lt;li&gt;å®Œæˆä¸€æ¬¡å†™æ“ä½œï¼Œwalåªéœ€ä¸€æ¬¡syncæ“ä½œï¼ˆsync walæ–‡ä»¶ï¼‰ï¼Œjournaléœ€è¦ä¸¤æ¬¡ï¼ˆsync journalæ–‡ä»¶ä¸€æ¬¡ï¼Œå°†é¡µé¢ç¼“å­˜å†™å…¥æ•°æ®åº“æ–‡ä»¶ä¹‹åsyncæ•°æ®åº“æ–‡ä»¶ä¸€æ¬¡ï¼‰ï¼Œå› æ­¤walçš„å†™æ€§èƒ½æ›´é«˜ã€‚&lt;/li&gt;
&lt;li&gt;walæ”¯æŒä¸€å†™å¤šè¯»çš„å¹¶å‘ï¼Œä½†æ˜¯journalåœ¨å†™çš„æ—¶å€™ä¸æ”¯æŒåŒæ—¶è¯»æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰ä¸¤ä¸ªé‡è¦çš„å˜é‡æ¥ä¿è¯å¹¶å‘è¯»æ—¶ä¸ä¼šè¯»åˆ°è¯»æ“ä½œå¼€å§‹ä¹‹åçš„ä¿®æ”¹ï¼š&lt;code&gt;mxFrame&lt;/code&gt;ä¿å­˜çš„æ˜¯å½“å‰æœ€æäº¤çš„å†™äº‹åŠ¡å†™çš„æœ€å¤§å¸§æ•°ï¼›æ¯ä¸ªè¯»æ“ä½œè¿˜ä¿å­˜äº†ä¸€ä¸ª&lt;code&gt;readMark&lt;/code&gt;å€¼ï¼Œå­˜å‚¨çš„æ˜¯è¯»æ“ä½œå¼€å§‹æ—¶çš„&lt;code&gt;mxFrame&lt;/code&gt;å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;checkpoint&lt;/code&gt;æ“ä½œï¼Œåˆç§°ä¸º&lt;code&gt;å›å¡«ï¼ˆbackfillï¼‰&lt;/code&gt;æ“ä½œï¼Œç”¨äºå°†walæ–‡ä»¶çš„å†…å®¹åŒæ­¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå®ƒéœ€è¦å‰é¢çš„&lt;code&gt;mxFrame&lt;/code&gt;å’Œ&lt;code&gt;readMark&lt;/code&gt;æ¥ä¿è¯å›å¡«æ“ä½œçš„æ­£ç¡®æ€§ã€‚å›å¡«æ“ä½œä¼šå½±å“åŒæ—¶åœ¨è¿›è¡Œçš„è¯»ã€å†™æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlite.org/wal.html&#34;&gt;Write-Ahead Logging&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlite.org/walformat.html&#34;&gt;WAL-mode File Format&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;WALæ–‡ä»¶æ ¼å¼è§ï¼š&lt;a href=&#34;https://www.sqlite.org/fileformat2.html&#34;&gt;Database File Format&lt;/a&gt;ä¸­â€œ4. The Write-Ahead Logâ€è¿™ä¸€å°èŠ‚å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;checkpointä¸­å‡ ç§æ¨¡å¼çš„è§£é‡Šï¼š&lt;a href=&#34;https://sqlite.org/c3ref/wal_checkpoint_v2.html&#34;&gt;Checkpoint a database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/zearot/article/details/51039593&#34;&gt;SQLiteåˆ†æä¹‹WALæœºåˆ¶_å²©ä¹‹ç—•-CSDNåšå®¢_sqlite wal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/pfysw/article/details/80531495&#34;&gt;SQLite3æºç å­¦ä¹ ï¼ˆ31ï¼‰ WALæ—¥å¿—çš„é”æœºåˆ¶_test-CSDNåšå®¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶</title>
      <link>https://www.codedump.info/post/20211222-sqlite-btree-3-journal/</link>
      <pubDate>Wed, 22 Dec 2021 19:15:31 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20211222-sqlite-btree-3-journal/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼ˆ&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶&lt;/a&gt;ï¼‰ï¼Œå·²ç»è®²è§£äº†sqliteä¸­çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé‡Œé¢ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªâ€œå¤‡ä»½é¡µé¢â€çš„æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤‡ä»½æ‰€æœ‰åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä¼šä¿®æ”¹åˆ°çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å‡ºé”™æ—¶å›æ»šé¡µé¢å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‡Œé¢ä¹Ÿæåˆ°ï¼Œæœ‰ä¸¤ç§å¤‡ä»½æ–‡ä»¶çš„æœºåˆ¶ï¼šjournalæ–‡ä»¶ï¼Œä»¥åŠWALæ–‡ä»¶ã€‚ä»Šå¤©é¦–å…ˆè®²è§£journalæ–‡ä»¶çš„å®ç°ï¼Œå®ƒçš„æ•ˆç‡ä¼šæ›´ä½ä¸€äº›ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› åç»­æ¨å‡ºäº†æ›´ä¼˜çš„WALæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›¸å…³å‘½ä»¤&#34;&gt;ç›¸å…³å‘½ä»¤&lt;/h2&gt;
&lt;p&gt;sqliteä¸­ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;PRAGMA journal_mode&lt;/code&gt;æ¥ä¿®æ”¹å¤‡ä»½æ–‡ä»¶æœºåˆ¶ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;deleteï¼šé»˜è®¤æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œåœ¨äº‹åŠ¡ç»“æŸæ—¶ï¼Œå¤‡ä»½æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚&lt;/li&gt;
&lt;li&gt;truncateï¼šæ—¥å¿—æ–‡ä»¶è¢«æˆªæ–­ä¸ºé›¶å­—èŠ‚é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;persistï¼šæ—¥å¿—æ–‡ä»¶è¢«ç•™åœ¨åŸåœ°ï¼Œä½†å¤´éƒ¨è¢«é‡å†™ï¼Œè¡¨æ˜æ—¥å¿—ä¸å†æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;memoryï¼šæ—¥å¿—è®°å½•ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ç£ç›˜ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;offï¼šä¸ä¿ç•™ä»»ä½•å¤‡ä»½è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;walï¼šé‡‡ç”¨walå½¢å¼çš„å¤‡ä»½æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­ï¼Œå‰é¢ä¸‰ç§deleteã€truncateã€persistéƒ½æ˜¯ä½¿ç”¨journalæ–‡ä»¶æ¥å®ç°çš„å¤‡ä»½ï¼ŒåŒºåˆ«åœ¨äºäº‹åŠ¡ç»“æŸä¹‹åçš„å¯¹å¤‡ä»½æ–‡ä»¶çš„å¤„ç†ç½¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚é¦–å…ˆè®²è§£journalæ–‡ä»¶ï¼Œä¸‹ä¸€èŠ‚è®²è§£walå¤‡ä»½æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h1 id=&#34;journalæ–‡ä»¶æ ¼å¼&#34;&gt;journalæ–‡ä»¶æ ¼å¼&lt;/h1&gt;
&lt;p&gt;journalæ–‡ä»¶çš„æ–‡ä»¶åè§„åˆ™æ˜¯ï¼šä¸åŒç›®å½•çš„æ•°æ®åº“æ–‡ä»¶åŒåï¼Œä½†æ˜¯å¤šäº†å­—ç¬¦ä¸²â€œ-journalâ€ä¸ºåç¼€ã€‚æ¯”å¦‚æ•°æ®åº“æ–‡ä»¶æ˜¯â€œtest.dbâ€ï¼Œé‚£ä¹ˆå¯¹åº”çš„journalæ–‡ä»¶åä¸ºâ€œtest.db-journalâ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶å¤´&#34;&gt;æ–‡ä»¶å¤´&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§»é‡&lt;/th&gt;
&lt;th&gt;å¤§å°&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶å¤´çš„magic number: 0xd9, 0xd5, 0x05, 0xf9, 0x20, 0xa1, 0x63, 0xd7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;journalæ–‡ä»¶ä¸­çš„é¡µé¢æ•°é‡ï¼Œå¦‚æœä¸º-1è¡¨ç¤ºä¸€ç›´åˆ°journalæ–‡ä»¶å°¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡è®¡ç®—æ ¡éªŒå€¼æ—¶ç®—å‡ºæ¥çš„éšæœºæ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;åœ¨å¼€å§‹å¤‡ä»½å‰æ•°æ®åº“æ–‡ä»¶çš„é¡µé¢æ•°é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;ç£ç›˜æ‰‡åŒºå¤§å°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;journalæ–‡ä»¶ä¸­çš„é¡µé¢å¤§å°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™é‡Œå¤§éƒ¨åˆ†çš„å­—æ®µéƒ½è‡ªè§£é‡Šäº†ï¼Œä¸å¿…å¤šåšè§£é‡Šï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯éšæœºæ•°ï¼Œå› ä¸ºè¿™æ˜¯ç”¨æ¥åç»­æ ¡éªŒå¤‡ä»½é¡µé¢çš„å­—æ®µï¼Œè¿™å°†åœ¨åé¢ç»“åˆæµç¨‹æ¥è¯´æ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¡µé¢å†…å®¹&#34;&gt;é¡µé¢å†…å®¹&lt;/h2&gt;
&lt;p&gt;ç´§è·Ÿç€æ–‡ä»¶å¤´ä¹‹åï¼Œjournalæ–‡ä»¶è¿˜æœ‰ä¸€ç³»åˆ—é¡µé¢æ•°æ®ç»„æˆçš„å†…å®¹ï¼Œå…¶ä¸­æ¯éƒ¨åˆ†çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§»é‡&lt;/th&gt;
&lt;th&gt;å¤§å°&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;é¡µé¢ç¼–å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;å¤‡ä»½çš„é¡µé¢å†…å®¹ï¼ŒNä»¥é¡µé¢å¤§å°ä¸ºå‡†ï¼Œå…¶ä¸­æ¯é¡µé¢å¤§å°åœ¨æ–‡ä»¶å¤´ä¸­å®šä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;N+4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;é¡µé¢çš„æ ¡éªŒå€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç”±ä¸Šé¢åˆ†æå¯è§ï¼Œæ•´ä¸ªjournalæ–‡ä»¶æ˜¯è¿™æ ·æ¥ç»„ç»‡çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;28å­—èŠ‚çš„æ–‡ä»¶å¤´ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢æ•°æ®ç»„æˆçš„æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„æ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸ºï¼š4+é¡µé¢å¤§å°ï¼ˆNï¼‰+4ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211222-sqlite-btree-3-journal/journal.png&#34; alt=&#34;journalæ–‡ä»¶ç»“æ„&#34; title=&#34;journalæ–‡ä»¶ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h1&gt;
&lt;h2 id=&#34;åˆ¤æ–­é¡µé¢æ˜¯å¦å·²ç»å¤‡ä»½&#34;&gt;åˆ¤æ–­é¡µé¢æ˜¯å¦å·²ç»å¤‡ä»½&lt;/h2&gt;
&lt;p&gt;å¯åŠ¨ä¸€ä¸ªå†™äº‹åŠ¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šä¿®æ”¹å¤šä¸ªé¡µé¢ï¼Œä½†æ˜¯è¿™å…¶ä¸­å¯èƒ½æœ‰äº›ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ˜¯åŒä¸€ä¸ªé¡µé¢çš„å†…å®¹ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹åªéœ€è¦å¯¹è¿™ä¸ªé¡µé¢å¤‡ä»½ä¸€æ¬¡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•çŸ¥é“é¡µé¢æ˜¯å¦å·²ç»è¢«å¤‡ä»½è¿‡ï¼Ÿé¡µé¢ç®¡ç†å™¨é€šè¿‡ä¸€ä¸ªä½å›¾æ•°æ®ç»“æ„æ¥ä¿å­˜è¿™ä¸ªä¿¡æ¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Bitvec *pInJournal;         /* One bit for each page in the database file */
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;è®¡ç®—é¡µé¢æ ¡éªŒå€¼&#34;&gt;è®¡ç®—é¡µé¢æ ¡éªŒå€¼&lt;/h2&gt;
&lt;p&gt;è®¡ç®—ä¸€ä¸ªé¡µé¢æ ¡éªŒç çš„æµç¨‹åœ¨å‡½æ•°&lt;code&gt;pager_cksum&lt;/code&gt;ä¸­å®ç°ï¼Œå…¶æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥éšæœºç®—å‡ºçš„æ ¡éªŒå€¼ä¸ºåˆå§‹å€¼ï¼Œè¿™ä¸ªåˆå§‹å€¼å°±æ˜¯å­˜åœ¨journalæ–‡ä»¶å¤´ä¸­åç§»é‡ä¸º[12,16]çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ä»åå¾€å‰éå†é¡µé¢æ•°æ®ï¼Œæ¯éš”200å­—èŠ‚å–ä¸€ä¸ªu32ç±»å‹çš„å€¼ï¼Œç´¯åŠ èµ·æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰äº†è¿™æ ·çš„å…³è”ï¼Œè¿›è¡Œæ•°æ®æ¢å¤æ—¶å°±èƒ½é©¬ä¸Šé€šè¿‡æ–‡ä»¶å¤´å­˜å‚¨çš„éšæœºæ•°ï¼Œè®¡ç®—å‡ºæ¥é¡µé¢çš„æ•°æ®æ˜¯å¦å‡†ç¡®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;static&lt;/span&gt; u32 &lt;span style=&#34;color:#00a000&#34;&gt;pager_cksum&lt;/span&gt;(Pager &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;pPager, &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;const&lt;/span&gt; u8 &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;aData){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  u32 cksum &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; pPager&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;cksumInit;         &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Checksum value to return */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#666&#34;&gt;=&lt;/span&gt; pPager&lt;span style=&#34;color:#666&#34;&gt;-&amp;gt;&lt;/span&gt;pageSize&lt;span style=&#34;color:#666&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;200&lt;/span&gt;;          &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;/* Loop counter */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// æ¯éš”200å­—èŠ‚ç®—ä¸€ä¸ªå€¼ç´¯åŠ èµ·æ¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;while&lt;/span&gt;( i&lt;span style=&#34;color:#666&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#666&#34;&gt;0&lt;/span&gt; ){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cksum &lt;span style=&#34;color:#666&#34;&gt;+=&lt;/span&gt; aData[i];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    i &lt;span style=&#34;color:#666&#34;&gt;-=&lt;/span&gt; &lt;span style=&#34;color:#666&#34;&gt;200&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;return&lt;/span&gt; cksum;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¤‡ä»½é¡µé¢&#34;&gt;å¤‡ä»½é¡µé¢&lt;/h2&gt;
&lt;p&gt;æœ‰äº†å‰é¢è®¡ç®—æ ¡éªŒå€¼ã€ä»¥ä½å›¾æ¥åˆ¤æ–­é¡µé¢æ˜¯å¦å·²ç»å¤‡ä»½è¿‡çš„äº†è§£ï¼Œç°åœ¨å¼€å§‹å°†å¤‡ä»½é¡µé¢çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸€æ¬¡éœ€è¦ä¿®æ”¹ä¸€ä¸ªé¡µé¢ä¹‹å‰ï¼Œéƒ½ä¼šè°ƒç”¨å‡½æ•°&lt;code&gt;pager_write&lt;/code&gt;ï¼Œè¿™æ ·å°±èƒ½åœ¨ä¿®æ”¹ä¹‹å‰é¦–å…ˆå¤‡ä»½è¿™ä¸ªé¡µé¢çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¦åŒºåˆ†ä¸¤ç§ä¸åŒçš„é¡µé¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœé¡µé¢ç¼–å·æ¯”å½“å‰æ•°æ®åº“æ–‡ä»¶çš„é¡µé¢æ•°é‡å°ï¼Œè¯´æ˜æ˜¯å·²æœ‰é¡µé¢ï¼Œéœ€è¦èµ°å¤‡ä»½é¡µé¢çš„æµç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œè¯´æ˜æ˜¯æ–°å¢é¡µé¢ï¼Œæ–°å¢çš„é¡µé¢ä¸éœ€è¦å¤‡ä»½ï¼Œåªéœ€è¦ä¿®æ”¹è¯¥é¡µé¢çš„æ ‡å¿—ä½æ˜¯éœ€è¦è½ç›˜ï¼ˆ&lt;code&gt;PGHDR_NEED_SYNC&lt;/code&gt;ï¼‰ï¼Œå¹¶ä¸”æ”¾å…¥è„é¡µé¢é“¾è¡¨å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬äºŒç§æƒ…å†µæ˜¯æ–°å¢é¡µé¢ï¼Œæ²¡æœ‰å¤‡ä»½çš„éœ€æ±‚ï¼Œè¿™é‡Œå°±ä¸åšè§£é‡Šã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå…·ä½“è§£é‡Šç¬¬ä¸€ç§æƒ…å†µï¼Œå³å¤‡ä»½å·²æœ‰é¡µé¢çš„æµç¨‹ï¼Œå…¶ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ ¹æ®å‰é¢çš„&lt;code&gt;pInJournal&lt;/code&gt;ä½å›¾æ•°æ®ï¼Œä¼ å…¥é¡µé¢ç¼–å·ï¼Œåˆ¤æ–­è¿™ä¸ªé¡µé¢æ˜¯å¦å¤‡ä»½è¿‡ï¼Œå¦‚æœå·²ç»å¤‡ä»½è¿‡ï¼Œä¸åšä»»ä½•æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™è¯´æ˜éœ€è¦å¤‡ä»½é¡µé¢ï¼Œå°†è¿›å…¥å‡½æ•°&lt;code&gt;pagerAddPageToRollbackJournal&lt;/code&gt;ä¸­å°†è¯¥é¡µé¢å†…å®¹å¤‡ä»½å†™å…¥journalæ–‡ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨å‰é¢æåˆ°çš„&lt;code&gt;pager_cksum&lt;/code&gt;å‡½æ•°ï¼Œè®¡ç®—é¡µé¢çš„æ ¡éªŒå€¼ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§ä¸Šé¢è§£é‡Šçš„journalæ–‡ä»¶æ ¼å¼ï¼Œä¾æ¬¡å†™å…¥é¡µé¢ç¼–å·ã€é¡µé¢å†…å®¹ã€ç¬¬ä¸€æ­¥è®¡ç®—å‡ºæ¥çš„æ ¡éªŒå€¼ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºå¤‡ä»½äº†é¡µé¢ï¼Œæ‰€ä»¥è¦æŠŠè¿™ä¸ªæ–°å¢çš„å¤‡ä»½é¡µé¢ç¼–å·å†™å…¥&lt;code&gt;pInJournal&lt;/code&gt;ä½å›¾æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¤‡ä»½é¡µé¢çš„ä¾‹å­&#34;&gt;å¤‡ä»½é¡µé¢çš„ä¾‹å­&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å¤‡ä»½é¡µé¢çš„æµç¨‹ï¼Œå‡è®¾å†™äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½“æ—¶æ•°æ®åº“çš„é¡µé¢æ•°é‡ä¸º2ï¼Œå³æœ‰2ä¸ªé¡µé¢ï¼Œå…¶ä¸­é¡µé¢çš„å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ä¸€ï¼šä¿å­˜äº†&lt;code&gt;x=0&lt;/code&gt;å’Œ&lt;code&gt;y=1&lt;/code&gt;çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢äºŒï¼šä¿å­˜äº†&lt;code&gt;z=2&lt;/code&gt;çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¾æ¬¡åšäº†å¦‚ä¸‹çš„ä¿®æ”¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢1çš„ä¸€å¤„å†…å®¹ï¼š&lt;code&gt;x=1&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢2çš„ä¸€å¤„å†…å®¹ï¼š&lt;code&gt;z=3&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢1çš„ä¸€å¤„å†…å®¹ï¼š&lt;code&gt;y=2&lt;/code&gt;ï¼Œæ³¨æ„è¿™é‡Œè·Ÿç¬¬ä¸€æ¬¡ä¿®æ”¹å±äºåŒä¸€ä¸ªé¡µé¢çš„ä¸åŒä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;æ–°å¢é¡µé¢3ï¼š&lt;code&gt;p=4&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œå¯¹ç…§ä¸Šé¢çš„æµç¨‹ï¼Œè¿™å››æ¬¡é¡µé¢ä¿®æ”¹åœ¨è°ƒç”¨å‡½æ•°&lt;code&gt;pager_write&lt;/code&gt;æ—¶ï¼Œæƒ…å†µæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢1çš„ä¸€å¤„å†…å®¹&lt;code&gt;x=1&lt;/code&gt;ï¼šç”±äºåœ¨å¤‡ä»½é¡µé¢ä½å›¾ä¸­æŸ¥ä¸åˆ°é¡µé¢ç¼–å·ä¸º1çš„é¡µé¢ï¼Œä¸”é¡µé¢1å°äºå½“å‰æ•°æ®åº“æ–‡ä»¶çš„é¡µé¢æ•°é‡2ï¼Œå› æ­¤å±äºä¿®æ”¹å½“å‰å·²æœ‰é¡µé¢ï¼Œäºæ˜¯å°†è¿™ä¸ªé¡µé¢å¤‡ä»½åˆ°journalæ–‡ä»¶ï¼Œå³å°†é¡µé¢ä¸€çš„æœªä¿®æ”¹ä¹‹å‰çš„å†…å®¹&lt;code&gt;x=0,y=1&lt;/code&gt;å†™å…¥journalå¤‡ä»½æ–‡ä»¶ä¸­ï¼Œå®Œäº‹äº†ä¹‹åå°†è¿™ä¸ªé¡µé¢ç¼–å·1åŠ å…¥ä½å›¾ï¼Œè¡¨ç¤ºå·²ç»å¤‡ä»½äº†è¿™ä¸ªé¡µé¢çš„æœªä¿®æ”¹ä¹‹å‰çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢2çš„ä¸€å¤„å†…å®¹ï¼šç±»ä¼¼çš„ï¼Œä¹Ÿæ˜¯å¤‡ä»½äº†é¡µé¢2çš„å†…å®¹&lt;code&gt;z=2&lt;/code&gt;ï¼ŒåŒæ—¶å°†é¡µé¢2åŠ å…¥ä½å›¾ï¼Œè¡¨ç¤ºå·²ç»å¤‡ä»½äº†è¿™ä¸ªé¡µé¢çš„æœªä¿®æ”¹ä¹‹å‰çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é¡µé¢1çš„ä¸€å¤„å†…å®¹&lt;code&gt;y=2&lt;/code&gt;ï¼šè¿™ä¸€æ¬¡è™½ç„¶ä¹Ÿæ˜¯è¦ä¿®æ”¹å·²æœ‰é¡µé¢ï¼Œä½†æ˜¯ç”±äºåœ¨ä½å›¾ä¸­æ‰¾åˆ°è¿™ä¸ªé¡µé¢ç¼–å·ï¼Œè¯´æ˜åœ¨è¿™ä¸€æ¬¡äº‹åŠ¡ä¸­å·²ç»å¤‡ä»½è¿‡è¿™ä¸ªé¡µé¢äº†ï¼Œäºæ˜¯ä¸å†éœ€è¦å¤‡ä»½æ“ä½œï¼Œç›´æ¥è¿”å›ã€‚&lt;/li&gt;
&lt;li&gt;æ–°å¢é¡µé¢3&lt;code&gt;p=4&lt;/code&gt;ï¼šå‘ç°è¯¥é¡µé¢çš„ç¼–å·3ï¼Œå¤§äºå½“å‰æ•°æ®åº“é¡µé¢æ•°é‡2ï¼Œå±äºæ–°å¢é¡µé¢ï¼Œäºæ˜¯ä¸è¿›è¡Œå¤‡ä»½ï¼Œåªæ˜¯åŠ å…¥åˆ°è„é¡µé¢é“¾è¡¨ä¸­åŒæ—¶æ ‡è®°éœ€è¦è½ç›˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å³ï¼šåœ¨è¿™ä¸€æ¬¡å†™äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶éœ€è¦ä¿®æ”¹4å¤„å†…å®¹ï¼Œå®é™…ä¿®æ”¹å¤‡ä»½æ–‡ä»¶ä¸¤æ¬¡ï¼Œæ–°å¢æ•°æ®åº“é¡µé¢é¡µé¢ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¾‹å­å‰åæ•°æ®åº“æ–‡ä»¶ä»¥åŠå¤‡ä»½æ–‡ä»¶å†…å®¹çš„å¯¹æ¯”è§ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211222-sqlite-btree-3-journal/journal-example.png&#34; alt=&#34;journalå¤‡ä»½é¡µé¢ä¾‹å­&#34; title=&#34;journalå¤‡ä»½é¡µé¢ä¾‹å­&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä½•æ—¶è½ç›˜&#34;&gt;ä½•æ—¶è½ç›˜&lt;/h2&gt;
&lt;p&gt;å‰é¢å¤‡ä»½å¾…ä¿®æ”¹é¡µé¢çš„æµç¨‹ä¸­ï¼Œå¤‡ä»½çš„é¡µé¢å†…å®¹åªæ˜¯å†™åˆ°äº†å¤‡ä»½æ–‡ä»¶é‡Œï¼Œå®é™…è¿˜å¹¶æ²¡æœ‰æ‰§è¡Œ&lt;code&gt;sync&lt;/code&gt;æ“ä½œå¼ºåˆ¶è½ç›˜ï¼Œåªè¦æ²¡æœ‰è½ç›˜å°±è¿˜æ˜¯å­˜åœ¨å¤‡ä»½æ•°æ®æŸåçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚çš„ï¼ˆ&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶&lt;/a&gt;ï¼‰ï¼Œå¤‡ä»½æ–‡ä»¶å†…å®¹è½ç›˜æ˜¯æ”¾åœ¨ç¬¬ä¸ƒæ­¥åšçš„ï¼Œæ­¤æ—¶å¯¹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹çš„ä¿®æ”¹å·²ç»å®Œæˆäº†ï¼Œä¸æ¸…æ¥šè¿™ä¸€æµç¨‹çš„å¯ä»¥å›å¤´å†çœ‹çœ‹ä¸Šä¸€èŠ‚çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“åˆ°journalæ–‡ä»¶çš„æœºåˆ¶ï¼Œè¿™ä¸€æ­¥æ˜¯æ”¾åœ¨å‡½æ•°&lt;code&gt;pager_end_transaction&lt;/code&gt;è¿›è¡Œçš„ï¼Œ&lt;code&gt;pager_end_transaction&lt;/code&gt;å‡½æ•°å°±æ˜¯ä¸Šé¢ä»‹ç»çš„ï¼šåœ¨äº‹åŠ¡ä¿®æ”¹å®Œæ¯•ç”¨æˆ·ç©ºé—´çš„é¡µé¢ä¹‹åï¼Œè¢«è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é”™è¯¯æ¢å¤&#34;&gt;é”™è¯¯æ¢å¤&lt;/h2&gt;
&lt;p&gt;ç»§ç»­ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ä½¿ç”¨journalå¤‡ä»½æ–‡ä»¶æœºåˆ¶ä¸‹çš„é”™è¯¯æ¢å¤çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„æµç¨‹é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;journalå¤‡ä»½æ–‡ä»¶å¤‡ä»½çš„æ˜¯æœªä¿®æ”¹ä¹‹å‰çš„é¡µé¢å†…å®¹ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢åœ¨ä¸€æ¬¡ä¿®æ”¹ä¸­ä¼šè¢«å¤šæ¬¡ä¿®æ”¹ï¼Œä¹Ÿåªä¼šå¤‡ä»½ä¸€æ¬¡ï¼ˆå¦‚ä¸Šé¢ä¾‹å­ä¸­çš„é¡µé¢1ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å†™äº‹åŠ¡å®Œæˆä¹‹åï¼Œé¦–å…ˆä¼šå°†journalå¤‡ä»½æ–‡ä»¶ä¸­çš„å†…å®¹é¦–å…ˆsyncåˆ°ç£ç›˜ï¼Œæ‰å¼€å§‹å°†é¡µé¢ç¼“å­˜ä¸­çš„å†…å®¹è½åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†æ¬¡æ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶&lt;/a&gt;ä¸­çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ–‡ä»¶ï¼šä»»ä½•å†™æ“ä½œçš„ä¿®æ”¹æœ€ç»ˆéƒ½å°†è½åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ï¼šæš‚å­˜æ¯æ¬¡å†™æ“ä½œè¿‡ç¨‹ä¸­ä¿®æ”¹çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;journalå¤‡ä»½æ–‡ä»¶ï¼šå¤‡ä»½é¡µé¢è¢«ä¿®æ”¹ä¹‹å‰çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„ä¾‹å­ï¼ŒåŠ ä¸Šé¡µé¢ç¼“å­˜ä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211222-sqlite-btree-3-journal/journal-backup.png&#34; alt=&#34;journalæ¢å¤æµç¨‹ä¾‹å­&#34; title=&#34;journalæ¢å¤æµç¨‹ä¾‹å­&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯¹åº”è¿™ä¸ªæµç¨‹ï¼Œè¿™ä¸€æ¬¡å†™æ“ä½œåªå¯èƒ½åœ¨ä»¥ä¸‹è¿™å‡ ä¸ªé˜¶æ®µä¸­å‘ç”Ÿé”™è¯¯å®•æœºï¼Œå…¶å¯¹åº”çš„æ¢å¤æœºåˆ¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œå¼€å§‹ä¹‹å‰ï¼šè¿™ä¸ªæ²¡æœ‰å¤ªå¤šå¯ä»¥è¯´çš„ï¼Œç”±äºè¿˜æ²¡æœ‰å¼€å§‹çœŸæ­£çš„å†™æ“ä½œï¼Œæ•°æ®åº“æ–‡ä»¶ä¸­çš„å†…å®¹è¿˜æ˜¯å®Œæ•´çš„ï¼Œä¸”journalå¤‡ä»½æ–‡ä»¶ä¸­æ²¡æœ‰å†…å®¹ï¼Œäºæ˜¯å¯ä»¥ç›´æ¥ä»¥æ•°æ®åº“æ–‡ä»¶å†…å®¹æ¥å¯åŠ¨å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;å†™æ“ä½œæµç¨‹ä¸­ï¼šå³å†™äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè¿˜æ²¡æœ‰å®Œæˆæ•´ä¸ªå†™äº‹åŠ¡çš„æ—¶å€™å‘ç”Ÿé”™è¯¯ã€‚è¿™ä¸ªåœºæ™¯ä¸­ï¼Œä¹‹å‰å†™å…¥çš„æ•°æ®éƒ½åœ¨é¡µé¢ç¼“å­˜é‡Œï¼Œå¤‡ä»½ä¿®æ”¹é¡µé¢çš„å†…å®¹åœ¨å¤‡ä»½æ–‡ä»¶ä¸­ï¼Œè€Œæ•°æ®åº“æ–‡ä»¶è¿˜æœªå‘ç”Ÿä»»ä½•æ”¹åŠ¨ã€‚æ‰€ä»¥åœ¨é”™è¯¯é‡æ–°å¯åŠ¨çš„æ—¶å€™ï¼Œé¡µé¢ç¼“å­˜ä¸­å·²ç»æ²¡æœ‰ä»»ä½•å†…å®¹äº†ï¼Œç„¶åä¼šå»æ ¡éªŒä¸€ä¸‹å¤‡ä»½æ–‡ä»¶ï¼Œç”±äºåªå†™äº†ä¸€éƒ¨åˆ†æ•°æ®è€Œå·²ï¼Œæ‰€ä»¥å¤‡ä»½æ–‡ä»¶æ˜¯ä¸å®Œæ•´å³æŸåçš„ï¼Œæ­¤æ—¶å¤‡ä»½æ–‡ä»¶çš„å†…å®¹ä¸èƒ½ç®—æ•°ã€‚äºæ˜¯å’Œä¸Šé¢çš„åœºæ™¯ä¸€æ ·ï¼Œä»¥æ•°æ®åº“æ–‡ä»¶æ¥å¯åŠ¨å³å¯ï¼Œå³è¿™æ¬¡ä¸å®Œæ•´çš„å†™æ“ä½œï¼Œä¹‹å‰å†™å…¥çš„éƒ¨åˆ†å†…å®¹ä¼šè¢«å…¨éƒ¨ä¸¢å¼ƒäº†ã€‚&lt;/li&gt;
&lt;li&gt;å†™æ“ä½œå®Œæˆä¹‹åï¼šè¿™ä¸ªé˜¶æ®µæ˜¯å†™æ“ä½œå®Œæˆï¼Œä¿®æ”¹çš„é¡µé¢åœ¨ä¿®æ”¹ä¹‹å‰çš„å†…å®¹å·²ç»å…¨éƒ¨å†™å…¥å¤‡ä»½æ–‡ä»¶ï¼Œä½†æ˜¯é¡µé¢ç¼“å­˜ä¸­çš„å†…å®¹è¿˜æ²¡æœ‰å…¨éƒ¨è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶æ—¶ï¼Œå‘ç”Ÿäº†é”™è¯¯å´©æºƒã€‚è¿™ç§æƒ…å†µä¸‹é‡å¯ï¼Œé‚£ä¹ˆæ•°æ®åº“æ–‡ä»¶å¯èƒ½æ˜¯é”™ä¹±çš„ï¼Œå› ä¸ºåªæœ‰éƒ¨åˆ†å†…å®¹è½ç›˜äº†ï¼Œå¦‚è¿™é‡Œçš„é¡µé¢1ï¼Œåˆå§‹å†…å®¹æ˜¯&lt;code&gt;x=0,y=1&lt;/code&gt;ï¼Œå®Œæ•´çš„ä¿®æ”¹åº”è¯¥æ˜¯&lt;code&gt;x=1,y=2&lt;/code&gt;ï¼Œå¦‚æœåªä¿®æ”¹äº†ä¸€éƒ¨åˆ†åˆ™æ˜¯&lt;code&gt;x=1,y=1&lt;/code&gt;ã€‚è¿™ç§æƒ…å†µä¸‹é‡å¯æ—¶ï¼Œæ£€æŸ¥åˆ°å¤‡ä»½æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯å®Œæ•´çš„ï¼Œè¿™å°±ä¼šä»¥å¤‡ä»½æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ¥è¦†ç›–æ•°æ®åº“æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå³å°†æ•°æ®åº“æ–‡ä»¶æ¢å¤åˆ°è¿™æ¬¡å†™äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»è¿™ä¸ªæ¢å¤æµç¨‹å¯ä»¥çœ‹åˆ°ï¼šä½¿ç”¨é¡µé¢å¤‡ä»½æœºåˆ¶ï¼Œåœ¨å®Œæˆå†™æ“ä½œã€ä½†æ˜¯è¿˜æœªå®Œå…¨å°†é¡µé¢ç¼“å­˜çš„å†…å®¹è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶ä¹‹å‰ï¼Œä»»ä½•å‡ºé”™éƒ½ä¼šå¯¼è‡´è¿™ä¸ªå†™äº‹åŠ¡çš„ä¿®æ”¹ï¼ˆä¸ç®¡æ˜¯éƒ¨åˆ†ä¿®æ”¹è¿˜æ˜¯å…¨éƒ¨ä¿®æ”¹ï¼‰è¢«ä¸¢æ‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;æœ¬èŠ‚è®²è§£äº†journalæ–‡ä»¶çš„å®ç°æœºåˆ¶ï¼Œä»æœ€æ—©çš„sqlite btreeå®ç°æ—¶ï¼Œå¤‡ä»½é¡µé¢çš„æœºåˆ¶å°±ä¸€ç›´ä½¿ç”¨journalæœºåˆ¶ï¼Œä»è¿™é‡Œçš„åˆ†æå¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æœºåˆ¶å¾ˆâ€œæœ´ç´ â€ï¼Œæ€§èƒ½ä¹Ÿå¹¶ä¸å¥½ï¼Œæ‰€ä»¥åç»­åœ¨3.7ç‰ˆæœ¬çš„sqliteä¸­å¼•å…¥äº†æ›´ä¼˜çš„WALå®ç°æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚ä¹Ÿå¹¶æ²¡æœ‰æŠŠæ‰€æœ‰journalæ–‡ä»¶å®ç°æœºåˆ¶éƒ½è¯¦ç»†æè¿°ï¼Œåªæ˜¯æŠŠæœ€æ ¸å¿ƒçš„æ–‡ä»¶ç»“æ„ä»¥åŠå¤‡ä»½æµç¨‹åšäº†è®²è§£ï¼Œå› ä¸ºå¹¶ä¸æƒ³åœ¨è¿™ä¸ªæ€§èƒ½ä¸é«˜çš„æœºåˆ¶ä¸Šç€å¢¨æ›´å¤šï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ç›¸å…³ä»£ç ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlite.org/fileformat.html&#34;&gt;Database File Format&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶</title>
      <link>https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/</link>
      <pubDate>Sat, 18 Dec 2021 15:25:05 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;æŒ‰ç…§ä¹‹å‰èµ·æ­¥é˜¶æ®µå¯¹sqlite btreeæ•´ä½“æ¶æ„çš„åˆ†æï¼Œâ€œé¡µé¢ç®¡ç†æ¨¡å—â€åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå­æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢å¤‡ä»½ï¼Œåˆåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;journalæ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;WALæ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¡µé¢ç®¡ç†æ¨¡å—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰é¢ä¸€èŠ‚è®²å®Œäº†â€œé¡µé¢ç¼“å­˜ç®¡ç†â€çš„å®ç°ï¼ŒæŒ‰ç…§è‡ªä¸‹å¾€ä¸Šçš„é¡ºåºï¼Œå°±åº”è¯¥åˆ°â€œé¡µé¢å¤‡ä»½â€äº†ã€‚â€œé¡µé¢å¤‡ä»½â€æ ¸å¿ƒçš„å·¥ä½œæ˜¯ï¼šåœ¨çœŸæ­£ä¿®æ”¹é¡µé¢å†…å®¹ä¹‹å‰ï¼Œå°†è¿˜æœªä¿®æ”¹çš„é¡µé¢å†…å®¹å¤‡ä»½ï¼Œè¿™æ ·ä¸€æ—¦ç³»ç»Ÿåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­å®•æœºå´©æºƒï¼Œå°±å¯ä»¥ç”¨è¿™éƒ¨åˆ†å†…å®¹å›æ»šè¿˜æœªè½ç›˜çš„äº‹åŠ¡ä¿®æ”¹ï¼Œè®©ç³»ç»Ÿå›åˆ°ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;â€œé¡µé¢å¤‡ä»½â€æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåœ¨æ—©æœŸä½¿ç”¨çš„journalæ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼æ€§èƒ½ä¸é«˜ï¼›åœ¨3.7ç‰ˆæœ¬ä¹‹åï¼Œsqliteå¼•å…¥äº†WALæ–‡ä»¶æ¥ä¿å­˜é¡µé¢å†…å®¹ï¼Œè¿™æ ·åšçš„æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚å°±è®²è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œåœ¨å¯¹è¿™éƒ¨åˆ†å†…å®¹æœ‰ä¸€ä¸ªæ€»ä½“çš„äº†è§£ä¹‹åï¼Œç»§ç»­è®²è§£é¡µé¢å¤‡ä»½çš„æ€»ä½“æµç¨‹ã€‚åé¢çš„ç« èŠ‚å†å…·ä½“åˆ†æjournalä»¥åŠWALçš„å®ç°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†™äº‹åŠ¡çš„æµç¨‹&#34;&gt;å†™äº‹åŠ¡çš„æµç¨‹&lt;/h1&gt;
&lt;p&gt;ï¼ˆä»¥ä¸‹æµç¨‹åˆ†æï¼ŒæŒ‰ç…§sqliteå®˜ç½‘ä¸­çš„æ–‡æ¡£&lt;a href=&#34;https://sqlite.org/atomiccommit.html&#34;&gt;Atomic Commit In SQLite&lt;/a&gt;è¿›è¡Œè®²è§£ï¼Œå›¾ä¾‹ä¹Ÿå…¨éƒ¨å¼•ç”¨è‡ªå®˜ç½‘ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;sqliteçš„å†™äº‹åŠ¡ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š&lt;/p&gt;
&lt;h2 id=&#34;1åˆå§‹åŒ–é˜¶æ®µinitial-state&#34;&gt;1ã€åˆå§‹åŒ–é˜¶æ®µï¼ˆInitial Stateï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-0.gif&#34; alt=&#34;åˆå§‹åŒ–&#34; title=&#34;åˆå§‹åŒ–&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾ä¸­ï¼Œä»å³åˆ°å·¦å³æ˜¯ç³»ç»Ÿçš„ç£ç›˜ã€æ“ä½œç³»ç»Ÿç¼“å†²åŒºã€ç”¨æˆ·ç©ºé—´ä¸‰éƒ¨åˆ†ï¼Œå…¶ä¸­ç£ç›˜å’Œæ“ä½œç³»ç»Ÿç¼“å†²åŒºæœ‰åˆ’åˆ†ä¸ºå¤šå—çš„ç©ºé—´ï¼Œæ¯ä¸€å—åœ¨sqliteé‡Œè¢«ç§°ä¸ºä¸€ä¸ª&lt;code&gt;sector&lt;/code&gt;ï¼Œè“è‰²éƒ¨åˆ†è¡¨ç¤ºæ˜¯ä¿®æ”¹ä¹‹å‰çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ç³»ç»Ÿåˆå§‹æ—¶çš„æ ·å­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2æ‹¿åˆ°è¯»é”acquiring-a-read-lock&#34;&gt;2ã€æ‹¿åˆ°è¯»é”ï¼ˆAcquiring A Read Lockï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-1.gif&#34; alt=&#34;æ‹¿åˆ°è¯»é”&#34; title=&#34;æ‹¿åˆ°è¯»é”&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹è¿›è¡Œå†™æ“ä½œä¹‹å‰ï¼Œsqliteå¿…é¡»å…ˆæŠŠå¾…ä¿®æ”¹çš„é¡µé¢åŠ è½½å†…å­˜ä¸­ï¼ˆè¿™å°±æ˜¯ä¸Šä¸€èŠ‚â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€åšçš„äº‹æƒ…ï¼‰ï¼Œåç»­çš„ä¿®æ”¹å…¶å®ä¹Ÿæ˜¯é¦–å…ˆä¿®æ”¹è¿™éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­çš„é¡µé¢å†…å®¹ï¼Œå› ä¸ºå¯èƒ½ä¸€æ¬¡æäº¤ä¼šä¿®æ”¹åŒä¸€ä¸ªé¡µé¢ä¸­çš„å¤šå¤„å†…å®¹ï¼Œæœ€åæ‰æŠŠé¡µé¢å†…å®¹è½ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œè¿™ä¸€æ­¥æ‰€è¦åšçš„ï¼Œæ˜¯é¦–å…ˆæ‹¿åˆ°æ•°æ®åº“æ–‡ä»¶çš„è¯»é”ï¼ˆshared lockï¼‰ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ªè¯»é”æ˜¯æ•°æ®åº“çº§åˆ«çš„é”ã€‚åŒä¸€æ—¶é—´ï¼Œç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªè¯»é”ï¼Œä½†æ˜¯åªè¦ç³»ç»Ÿä¸­è¿˜å­˜åœ¨è¯»é”ï¼Œå°±ä¸å†å…è®¸åˆ†é…å‡ºæ–°çš„å†™é”ï¼ˆwrite lockï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3è¯»å‡ºé¡µé¢çš„å†…å®¹åˆ°é¡µé¢ç¼“å­˜&#34;&gt;3ã€è¯»å‡ºé¡µé¢çš„å†…å®¹åˆ°é¡µé¢ç¼“å­˜&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-2.gif&#34; alt=&#34;è¯»å‡ºé¡µé¢å†…å®¹&#34; title=&#34;è¯»å‡ºé¡µé¢å†…å®¹&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°è¯»é”ä¹‹åï¼Œå°±å¯ä»¥æŠŠéœ€è¦è¿›è¡Œä¿®æ”¹çš„é¡µé¢è¯»å‡ºæ¥åˆ°ç”¨æˆ·ç©ºé—´çš„é¡µé¢ç¼“å­˜äº†ã€‚ä»ä¸Šå›¾æ¥çœ‹ï¼Œè¯»äº†ä¸‰ä¸ªé¡µé¢çš„å†…å®¹å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯ä¾‹å­ä¸­çš„å†™æ“ä½œè¦ä¿®æ”¹ä¸‰ä¸ªé¡µé¢çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4æ‹¿åˆ°ä¿ç•™é”obtaining-a-reserved-lock&#34;&gt;4ã€æ‹¿åˆ°ä¿ç•™é”ï¼ˆObtaining A Reserved Lockï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-3.gif&#34; alt=&#34;æ‹¿åˆ°ä¿ç•™é”&#34; title=&#34;æ‹¿åˆ°ä¿ç•™é”&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿›è¡Œä¿®æ”¹ä¹‹å‰ï¼Œè¿˜éœ€è¦é¦–å…ˆå°†å‰é¢æ‹¿åˆ°çš„è¯»é”ï¼ˆshared lockï¼‰å‡çº§ä¸ºä¿ç•™é”ï¼ˆreserved lockï¼‰ã€‚åŒä¸€æ—¶é—´ï¼Œç³»ç»Ÿä¸­ä¿ç•™é”å¯ä»¥å’Œå¤šä¸ªè¯»é”å¹¶å­˜ï¼Œä½†æ˜¯åªèƒ½å­˜åœ¨æœ€å¤šä¸€ä¸ªä¿ç•™é”ã€‚è¿™ä¸ªæœºåˆ¶ï¼Œä¿è¯äº†åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹å¯¹æ•°æ®åº“è¿›è¡Œå†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ‹¿åˆ°ä¿ç•™é”çš„è¿›ç¨‹ï¼Œè¿˜å¹¶æ²¡æœ‰çœŸæ­£è¿›è¡Œæ•°æ®çš„ä¿®æ”¹æ“ä½œï¼Œåªæ˜¯ç”¨è¿™ä¸ªé”ï¼ŒæŒ¡ä½äº†å…¶å®ƒæ‰“ç®—è¿›è¡Œå†™æ“ä½œçš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5åˆ›å»ºå›æ»šç”¨çš„å¤‡ä»½æ–‡ä»¶creating-a-rollback-journal-file&#34;&gt;5ã€åˆ›å»ºå›æ»šç”¨çš„å¤‡ä»½æ–‡ä»¶ï¼ˆCreating A Rollback Journal Fileï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-4.gif&#34; alt=&#34;åˆ›å»ºå›æ»šç”¨çš„å¤‡ä»½æ–‡ä»¶&#34; title=&#34;åˆ›å»ºå›æ»šç”¨çš„å¤‡ä»½æ–‡ä»¶&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°äº†è¿™ä¸€æ­¥ï¼Œé¦–å…ˆå°†å¾…ä¿®æ”¹çš„é¡µé¢å†…å®¹å¤‡ä»½ã€‚å®˜ç½‘åŸæ–‡å†™çš„æ˜¯å¤‡ä»½åˆ°å›æ»šç”¨çš„journalæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸Šé¢æåˆ°å¤‡ä»½æœºåˆ¶é™¤äº†journalæ–‡ä»¶è¿˜æœ‰walæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œçš„â€œjournalæ–‡ä»¶â€åº”è¯¥æ›´æ³›åŒ–çš„ç†è§£ä¸ºâ€œä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶ä¸­â€ï¼Œè¿™ç§å¤‡ä»½æ–‡ä»¶å¯èƒ½æ˜¯journalæ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½æ˜¯walæ–‡ä»¶ï¼Œè§†æœºåˆ¶è€Œå®šã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼Œç”¨æˆ·ç©ºé—´çš„é¡µé¢å†™å…¥åˆ°äº†å¤‡ä»½æ–‡ä»¶ä¸­ï¼Œæ³¨æ„åˆ°å¤‡ä»½æ–‡ä»¶ä¸Šé¢æœ‰ä¸€å°å—ç»¿è‰²çš„éƒ¨åˆ†ï¼Œç†è§£ä¸ºå¤‡ä»½æ–‡ä»¶çš„metaä¿¡æ¯å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¤‡ä»½å·¥ä½œä¹Ÿä»…ä»…åˆ°äº†æ“ä½œç³»ç»Ÿç¼“å†²åŒºï¼Œå³å›¾ä¸­çš„ä¸­é—´éƒ¨åˆ†ï¼Œè€Œç£ç›˜éƒ¨åˆ†è¿˜æ˜¯ç©ºçš„ã€‚å³åˆ°äº†è¿™ä¸€æ­¥ï¼Œå³ä¾¿æ˜¯å¤‡ä»½é¡µé¢çš„å†…å®¹ï¼Œä¹Ÿè¿˜å¹¶æ²¡æœ‰syncåˆ°ç£ç›˜ä¸­ï¼Œå³åªè¿›è¡Œäº†å¤‡ä»½çš„å†™æ“ä½œï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶è½ç›˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;6ä¿®æ”¹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹changing-database-pages-in-user-space&#34;&gt;6ã€ä¿®æ”¹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹ï¼ˆChanging Database Pages In User Spaceï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-5.gif&#34; alt=&#34;ä¿®æ”¹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹&#34; title=&#34;ä¿®æ”¹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°äº†è¿™ä¸€æ­¥ï¼Œä¿®æ”¹è¿›ç¨‹ç”¨æˆ·ç©ºé—´çš„é¡µé¢å†…å®¹ï¼Œå³ä¸Šå›¾ä¸­çš„æ©™è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯ä¿®æ”¹åçš„ç”¨æˆ·ç©ºé—´æ•°æ®ã€‚ç”±äºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ç”¨æˆ·ç©ºé—´ï¼ˆå³ä¾¿æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„ä¸åŒçº¿ç¨‹ï¼Œå¯¹sqliteè€Œè¨€ï¼Œåªè¦ä½¿ç”¨çš„æ˜¯ä¸åŒçš„è¿æ¥ï¼ˆconnectionï¼‰ï¼Œé‚£ä¹ˆè¿æ¥èƒŒåçš„é¡µé¢ç¼“å†²åŒºå°±ä¸ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥è¿™äº›ä¿®æ”¹å¹¶ä¸è¢«å…¶å®ƒè¿›ç¨‹æ‰€è§ã€‚è¿™æ ·ï¼Œå†™è¿›ç¨‹åšè‡ªå·±çš„ä¿®æ”¹ï¼Œå…¶å®ƒè¯»è¿›ç¨‹è¯»åˆ°çš„è¿˜æ˜¯ä¿®æ”¹ä¹‹å‰çš„é¡µé¢æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;7å°†å¤‡ä»½æ–‡ä»¶çš„å†…å®¹è½ç›˜flushing-the-rollback-journal-file-to-mass-storage&#34;&gt;7ã€å°†å¤‡ä»½æ–‡ä»¶çš„å†…å®¹è½ç›˜ï¼ˆFlushing The Rollback Journal File To Mass Storageï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-6.gif&#34; alt=&#34;å°†å¤‡ä»½æ–‡ä»¶çš„å†…å®¹è½ç›˜&#34; title=&#34;å°†å¤‡ä»½æ–‡ä»¶çš„å†…å®¹è½ç›˜&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ç¬¬5æ­¥æåˆ°ï¼Œå½“æ—¶è¿˜åªæ˜¯å†™é¡µé¢å†…å®¹åˆ°å¤‡ä»½æ–‡ä»¶ä¸­ï¼Œè¿™ä¸€æ­¥æ¥åœ¨ä¿®æ”¹é¡µé¢å†…å®¹ä¹‹åï¼Œå°†ä¿®æ”¹ä¹‹å‰çš„é¡µé¢å†…å®¹syncåˆ°ç£ç›˜ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;8æ‹¿åˆ°æ’ä»–é”obtaining-an-exclusive-lock&#34;&gt;8ã€æ‹¿åˆ°æ’ä»–é”ï¼ˆObtaining An Exclusive Lockï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-7.gif&#34; alt=&#34;æ‹¿åˆ°æ’ä»–é”&#34; title=&#34;æ‹¿åˆ°æ’ä»–é”&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‰é¢çš„æ­¥éª¤åšå®Œï¼Œè¾¾åˆ°äº†è¿™æ ·çš„æ•ˆæœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºå¾…ä¿®æ”¹é¡µé¢ï¼Œä¿®æ”¹ä¹‹å‰çš„å†…å®¹å·²ç»ä¿å­˜åˆ°äº†å¤‡ä»½æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¿®æ”¹çš„å†…å®¹ï¼Œå·²ç»ä½“ç°åœ¨äº†è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´çš„é¡µé¢ç¼“å­˜é‡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œéœ€è¦å°†é¡µé¢ä¿®æ”¹çš„å†…å®¹å†™åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚åœ¨ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶ä¹‹å‰ï¼Œè¿˜éœ€è¦é¦–å…ˆæ‹¿åˆ°æ’ä»–é”ï¼ˆexclusive lockï¼‰ã€‚æ‹¿åˆ°æ’ä»–é”ï¼Œåˆåˆ†ä¸ºä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ‹¿åˆ°æ‚¬é”ï¼ˆpending lockï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ‚¬é”å‡çº§ä¸ºæ’ä»–é”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦é¦–å…ˆæ‹¿åˆ°æ‚¬é”ï¼ŸåŒä¸€æ—¶é—´å†…ï¼Œæ‚¬é”å’Œå‰é¢çš„ä¿ç•™é”ä¸€æ ·ï¼Œåªèƒ½å­˜åœ¨æœ€å¤šä¸€ä¸ªï¼›ä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œæ‚¬é”ä¸å…è®¸å†åˆ†é…æ–°çš„è¯»é”ï¼ˆshared lockï¼‰ï¼Œè€Œä¿ç•™é”æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ‚¬é”ä¹‹å‰çš„æ‰€æœ‰è¯»é”ï¼Œå¯ä»¥ç»§ç»­è¯»æ“ä½œï¼Œæ‚¬é”ä¼šç­‰å¾…å®ƒä»¬å®Œæˆï¼Œå†å‡çº§ä¸ºæ’ä»–é”ï¼›åŒæ—¶ï¼Œåªè¦ç³»ç»Ÿä¸­æœ‰æ‚¬é”ï¼Œå°±ä¸å†å…è®¸æœ‰æ–°çš„è¯»æ“ä½œï¼Œå¿…é¡»ç­‰å¾…ä¿®æ”¹æ•°æ®åº“å®Œæˆæ‰å¯ä»¥æœ‰æ–°çš„è¯»æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·çš„æœºåˆ¶ï¼Œé¿å…äº†è¯»æ“ä½œæ—¶ï¼Œè¯»åˆ°äº†æœªæäº¤çš„äº‹åŠ¡å†™åˆ°ä¸€åŠçš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;9ä¿å­˜ä¿®æ”¹åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­writing-changes-to-the-database-file&#34;&gt;9ã€ä¿å­˜ä¿®æ”¹åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼ˆWriting Changes To The Database Fileï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-8.gif&#34; alt=&#34;æ‹¿åˆ°æ’ä»–é”&#34; title=&#34;æ‹¿åˆ°æ’ä»–é”&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°äº†æ’ä»–é”ä¹‹åï¼Œæ„å‘³ç€æ­¤æ—¶ç³»ç»Ÿä¸­æ²¡æœ‰è¯»æ“ä½œã€æ²¡æœ‰å…¶ä»–å†™æ“ä½œï¼Œè¿™æ—¶å€™å¯ä»¥æ”¾å¿ƒå°†é¡µé¢ç¼“å­˜ä¸­çš„å†…å®¹è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­äº†ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€æ­¥çš„ä¿®æ”¹ï¼Œè¿˜è¿˜åªæ˜¯åˆ°äº†æ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºï¼Œå¹¶ä¸ä¿è¯è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;10è½ç›˜æ•°æ®åº“æ–‡ä»¶ä¿®æ”¹flushing-changes-to-mass-storage&#34;&gt;10ã€è½ç›˜æ•°æ®åº“æ–‡ä»¶ä¿®æ”¹ï¼ˆFlushing Changes To Mass Storageï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-9.gif&#34; alt=&#34;è½ç›˜æ•°æ®åº“æ–‡ä»¶ä¿®æ”¹&#34; title=&#34;è½ç›˜æ•°æ®åº“æ–‡ä»¶ä¿®æ”¹&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥ï¼Œå°†å¯¹æ•°æ®åº“æ–‡ä»¶çš„ä¿®æ”¹è½ç›˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;11åˆ é™¤å¤‡ä»½æ–‡ä»¶deleting-the-rollback-journal&#34;&gt;11ã€åˆ é™¤å¤‡ä»½æ–‡ä»¶ï¼ˆDeleting The Rollback Journalï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-A.gif&#34; alt=&#34;åˆ é™¤å¤‡ä»½æ–‡ä»¶&#34; title=&#34;åˆ é™¤å¤‡ä»½æ–‡ä»¶&#34;&gt;&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œè¿™ä¸€æ¬¡å†™æ“ä½œå·²ç»è½ç›˜åˆ°äº†æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œå‰é¢ä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®å¯ä»¥æ¸…é™¤äº†ã€‚æ¸…é™¤å¤‡ä»½æ–‡ä»¶å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒè´¹æ—¶çš„æ“ä½œï¼Œå…·ä½“å®ç°ç”±ä¸åŒçš„æœºåˆ¶å»ä¼˜åŒ–ï¼Œåé¢è®²åˆ°journalæ–‡ä»¶ä»¥åŠwalçš„å®ç°æ—¶å†å±•å¼€æè¿°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;12é‡Šæ”¾é”releasing-the-lock&#34;&gt;12ã€é‡Šæ”¾é”ï¼ˆReleasing The Lockï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/commit-B.gif&#34; alt=&#34;é‡Šæ”¾é”&#34; title=&#34;é‡Šæ”¾é”&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†™æ“ä½œå…¨éƒ¨å®Œæˆï¼Œå¤‡ä»½æ–‡ä»¶ä¹Ÿæ¸…é™¤äº†ï¼Œåˆ°äº†è¿™ä¸€æ­¥å°±å¯ä»¥é‡Šæ”¾é”ï¼Œä»¥ä¾¿åé¢å…¶ä»–çš„è¯»å†™æ“ä½œè¿›æ¥ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†™äº‹åŠ¡ä¸­æ¶‰åŠåˆ°çš„é”&#34;&gt;å†™äº‹åŠ¡ä¸­æ¶‰åŠåˆ°çš„é”&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢å†™äº‹åŠ¡æµç¨‹ä¸­ï¼Œä¾æ¬¡ä¼šæ‹¿åˆ°ä»¥ä¸‹ç±»å‹çš„é”ï¼Œä¸‹å›¾ä¸­åšä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211218-sqlite-btree-2-concurrency-control/write_lock.png&#34; alt=&#34;å†™æ“ä½œä¸­æ¶‰åŠåˆ°çš„é”&#34; title=&#34;å†™æ“ä½œä¸­æ¶‰åŠåˆ°çš„é”&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;å´©æºƒæ¢å¤æµç¨‹&#34;&gt;å´©æºƒæ¢å¤æµç¨‹&lt;/h1&gt;
&lt;p&gt;ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œéšæ—¶éƒ½å¯èƒ½å› ä¸ºç³»ç»Ÿå´©æºƒè€Œå¯¼è‡´æ•°æ®é”™ä¹±çš„ï¼Œå› æ­¤ä¸€ä¸ªå†™äº‹åŠ¡å¦‚æœè¿˜æœªå®Œæˆï¼Œé‡å¯æ—¶å­˜å‚¨å¼•æ“éœ€è¦è¯†åˆ«å‡ºæ¥ï¼Œå°†è¿˜æ²¡æœ‰å®Œæˆçš„äº‹åŠ¡è¿›è¡Œå›æ»šæ“ä½œï¼ˆrollbackï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µæ¥å¤„ç†ï¼š&lt;/p&gt;
&lt;h2 id=&#34;å†™å¤‡ä»½æ•°æ®ä¹‹å‰å¤±è´¥&#34;&gt;å†™å¤‡ä»½æ•°æ®ä¹‹å‰å¤±è´¥&lt;/h2&gt;
&lt;p&gt;å¦‚æœç³»ç»Ÿåœ¨è½ç›˜å¤‡ä»½æ•°æ®ä¹‹å‰å¤±è´¥ï¼Œå³å‰é¢çš„æµç¨‹7ä¹‹å‰å¤±è´¥ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹æ¥çœ‹ï¼Œæƒ…å†µæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™äº‹åŠ¡çš„æ•°æ®è¿˜åœç•™åœ¨ç”¨æˆ·ç©ºé—´çš„é¡µé¢ç¼“å­˜ä¸­ï¼Œæœªè½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶ä¸Šï¼ˆæµç¨‹6ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æµç¨‹5ï¼Œåªæ˜¯å°†æ•°æ®å†™åˆ°å¤‡ä»½æ–‡ä»¶ï¼Œè¿˜æ²¡æœ‰å¼ºåˆ¶åˆ·ç›˜ï¼Œæ‰€ä»¥è¿™æ—¶å€™å´©æºƒï¼Œå¯èƒ½å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®æ˜¯æŸåçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹é‡å¯ï¼Œé¢å¯¹çš„æ˜¯è¿™æ ·çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ–‡ä»¶ï¼šè¿˜åœ¨å†™äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ï¼Œå› ä¸ºå†™äº‹åŠ¡è¿˜æœªè½ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;å¤‡ä»½æ–‡ä»¶ï¼šå¯èƒ½æŸåã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºæ˜¯ï¼Œå¯åŠ¨ä¹‹åå°†æ ¡éªŒå¤‡ä»½æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœå®Œæ•´å°†é‡æ”¾ä¸€éå¤‡ä»½æ–‡ä»¶ä¸­çš„é¡µé¢åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼›å¦åˆ™ï¼Œåªæ˜¯ç®€å•çš„åˆ é™¤å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†™æ•°æ®åº“æ–‡ä»¶æ—¶å¤±è´¥&#34;&gt;å†™æ•°æ®åº“æ–‡ä»¶æ—¶å¤±è´¥&lt;/h2&gt;
&lt;p&gt;å¦‚æœå·²ç»è¿‡äº†æµç¨‹7ï¼Œè€Œåœ¨å°†é¡µé¢ç¼“å­˜ä¸­çš„ä¿®æ”¹è½ç›˜åˆ°æ•°æ®åº“æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå´©æºƒäº†ï¼Œé‚£ä¹ˆé¢ä¸´çš„æ˜¯è¿™æ ·çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åº“æ–‡ä»¶è‚¯å®šæŸåäº†ã€‚&lt;/li&gt;
&lt;li&gt;å†™äº‹åŠ¡ä¸­è¢«ä¿®æ”¹é¡µé¢ä¹‹å‰çš„å†…å®¹ï¼Œå·²ç»è½ç›˜åˆ°å¤‡ä»½æ–‡ä»¶ä¸­äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºæ˜¯ï¼Œå¯åŠ¨æ¢å¤çš„æ—¶å€™ï¼Œåªéœ€è¦å°†å¤‡ä»½æ–‡ä»¶ä¸­çš„é¡µé¢é‡æ”¾ä¸€éåˆ°æ•°æ®åº“æ–‡ä»¶å³å¯å°†æ•°æ®åº“æ–‡ä»¶æ¢å¤åˆ°å†™äº‹åŠ¡ä¿®æ”¹å‰çš„çŠ¶æ€äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œå°±æ˜¯sqliteä¸­å†™äº‹åŠ¡çš„æ€»ä½“æµç¨‹ï¼Œä»¥åŠé‡å¯æ¢å¤çš„æµç¨‹ï¼Œè¿™é‡Œè¿˜å¹¶æ²¡æœ‰æ¶‰åŠåˆ°å…·ä½“çš„ä»£ç ç»†èŠ‚ï¼Œæœ‰äº†å¯¹æ€»ä½“æµç¨‹çš„ç†è§£ï¼Œåé¢å†æ¥åˆ†æå…·ä½“çš„ä¸¤ç§å¤‡ä»½æœºåˆ¶ï¼šjournalä»¥åŠwalçš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œéœ€è¦çœ‹åˆ°çš„æ˜¯ï¼šsqliteä¸­é”çš„ç²’åº¦ï¼Œéƒ½è¿˜æ˜¯æ•°æ®åº“çº§åˆ«çš„ï¼Œç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“å…¶å®ƒæ›´é«˜æ•ˆçš„æ•°æ®åº“æ‰€è°“è¡Œé”çš„å®ç°ï¼Œç•™å¾…ä»¥åå§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlite.org/atomiccommit.html&#34;&gt;Atomic Commit In SQLite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlite.org/lockingv3.html&#34;&gt;File Locking And Concurrency In SQLite Version 3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜</title>
      <link>https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/</link>
      <pubDate>Fri, 17 Dec 2021 14:22:06 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;é¡µé¢ç®¡ç†&lt;/code&gt;æ¨¡å—ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ç¼“å­˜é¡µé¢çš„å†…å®¹åœ¨å†…å­˜ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»é¡µé¢ï¼šå¦‚æœé¡µé¢å·²ç»åœ¨å†…å­˜ï¼Œå°±ä¸éœ€è¦åˆ°æ–‡ä»¶ä¸­è¯»å‡ºé¡µé¢å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;å†™é¡µé¢ï¼šå¦‚æœé¡µé¢å·²ç»åœ¨å†…å­˜ï¼Œé‚£ä¹ˆå¯¹é¡µé¢çš„ä¿®æ”¹å°±åªéœ€è¦ä¿®æ”¹é¡µé¢åœ¨å†…å­˜ä¸­çš„æ•°æ®å³å¯ï¼Œè¢«ä¿®æ”¹äº†ä½†æ˜¯è¿˜æ²¡æœ‰è½ç›˜çš„é¡µé¢ï¼Œè¢«ç§°ä¸ºâ€œè„é¡µé¢ï¼ˆdirty pageï¼‰â€œã€‚è¿™æ ·ï¼Œå¤šæ¬¡å¯¹æŸä¸ªé¡µé¢çš„ä¿®æ”¹ï¼Œå¯èƒ½æœ€ååªéœ€è¦ä¸€æ¬¡è½ç›˜å³å¯ã€‚å½“ç„¶ï¼Œå¯¹é¡µé¢çš„ä¿®æ”¹ï¼Œå¦‚æœåœ¨è¿˜æ²¡æœ‰è½ç›˜ä¹‹å‰ï¼Œç³»ç»Ÿå°±å´©æºƒäº†ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•å¤„ç†ï¼Œè¿™å°±æ˜¯â€œå´©æºƒæ¢å¤â€æ¨¡å—åšçš„äº‹æƒ…äº†ã€‚æœ¬èŠ‚ä¸­ï¼Œå°†ä¸“æ³¨åœ¨â€œé¡µé¢ç¼“å­˜â€è¿™ä¸ªå­æ¨¡å—çš„å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ—¢ç„¶è¦å°†é¡µé¢ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°å‡ ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•çŸ¥é“å“ªäº›é¡µé¢å·²ç»è¢«ç¼“å­˜åœ¨å†…å­˜é‡Œäº†ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¼“å­˜åœ¨å†…å­˜ä¸­çš„é¡µé¢å¦‚ä½•ç»„ç»‡ç®¡ç†ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¼“å­˜é¡µé¢ä½¿ç”¨çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹â€œé¡µé¢ç¼“å­˜â€æ¨¡å—çš„æ€»ä½“åˆ’åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/pagecache.png&#34; alt=&#34;é¡µé¢ç¼“å­˜åŠŸèƒ½çš„æ¨¡å—åˆ’åˆ†&#34; title=&#34;é¡µé¢ç¼“å­˜åŠŸèƒ½çš„æ¨¡å—åˆ’åˆ†&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§ä¸Šå›¾çš„åˆ’åˆ†ï¼Œé¡µé¢ç¼“å­˜æ¨¡å—åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨ï¼šå®ç°äº†é¡µé¢ç¼“å­˜çš„æ€»ä½“ç®—æ³•æµç¨‹ï¼Œä»¥åŠæä¾›å¯¹å¤–çš„æ¥å£ï¼Œä½†æ˜¯å…·ä½“åˆ°â€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„å®ç°ï¼Œåˆ™æœ‰èµ–äºä¸‹é¢è¿™ä¸ªå¯ç”¨æˆ·å®šåˆ¶çš„&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ã€‚è¿™éƒ¨åˆ†åŠŸèƒ½åœ¨ä»£ç &lt;code&gt;pcache.c&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®—æ³•ï¼šç”¨æˆ·å¯è‡ªå·±å®šåˆ¶ï¼Œåªè¦å®ç°&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“ä¸­çš„æ¥å£å³å¯ã€‚ç³»ç»Ÿä¸­çš„é»˜è®¤å®ç°ï¼Œåœ¨æ–‡ä»¶&lt;code&gt;pcache1.c&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é™¤æ­¤ä»¥å¤–ï¼Œè¿˜éœ€è¦å¿«é€Ÿæ ¹æ®é¡µé¢ç¼–å·å°±èƒ½çŸ¥é“å“ªäº›é¡µé¢å·²ç»è¢«ç¼“å­˜çš„åŠŸèƒ½ï¼Œè¿™éƒ¨åˆ†sqliteä½¿ç”¨ä½å›¾æ•°æ®ç»“æ„æ¥å®ç°ï¼Œåœ¨æ–‡ä»¶&lt;code&gt;bitvec.c&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨ï¼Œæ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ç»´æŠ¤è„é¡µé¢é“¾è¡¨ï¼Œç¼“å­˜é¡µé¢çš„ç®¡ç†ï¼Œè¯¸å¦‚æ ¹æ®é¡µé¢ç¼–å·æŸ¥æ‰¾é¡µé¢ã€æ·˜æ±°é¡µé¢ç®—æ³•ç­‰ï¼Œéƒ½ç”±â€œé¡µé¢ç¼“å­˜ç®—æ³•â€æ¥ç»´æŠ¤ã€‚å¯ä»¥è¿™æ ·æ¥ç®€å•çš„ç†è§£ä¸Šé¢çš„åŠŸèƒ½åˆ’åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€ï¼šå®šä¹‰äº†ç®¡ç†é¡µé¢ç¼“å­˜çš„æ¥å£ã€æ€»ä½“æµç¨‹ï¼Œç»´æŠ¤ç®¡ç†ç›®å‰åœ¨ç”¨çš„è„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;â€œé¡µé¢ç¼“å­˜ç®—æ³•â€ï¼šç»´æŠ¤å…¶å®ƒä¸åœ¨ä½¿ç”¨ä½†è¿˜åœ¨å†…å­˜ä¸­çš„é¡µé¢ï¼Œè´Ÿè´£å…¶æ·˜æ±°ã€å›æ”¶ç­‰å®ç°ã€‚ç”±â€œsqlite3_pcache_methods2â€ç»“æ„ä½“å®ç°ï¼Œç”¨æˆ·å¯ä»¥å®šåˆ¶è‡ªå·±å®ç°çš„â€œsqlite3_pcache_methods2â€ï¼Œç³»ç»Ÿä¹Ÿæä¾›é»˜è®¤çš„å®ç°ã€‚å½“å†…å­˜ä¸è¶³ä»¥åˆ†é…æ—¶ï¼Œéœ€è¦æ·˜æ±°ä¸å¸¸ç”¨çš„é¡µé¢ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€æ³¨å†Œçš„å›è°ƒå‡½æ•°æ¥æ·˜æ±°é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/pagecache_module.png&#34; alt=&#34;é¡µé¢ç¼“å­˜ä¸¤ä¸ªæ¨¡å—çš„åŠŸèƒ½åˆ’åˆ†&#34; title=&#34;é¡µé¢ç¼“å­˜ä¸¤ä¸ªæ¨¡å—çš„åŠŸèƒ½åˆ’åˆ†&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæŠŠå½“å‰åœ¨å†…å­˜ä¸­çš„é¡µé¢åˆ’åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼Œé‚£ä¹ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å‰åœ¨ä½¿ç”¨çš„é¡µé¢ï¼šå³ä¸é¡µé¢ç¼–å·å¯¹åº”çš„é¡µé¢ï¼Œç”±â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;å½“å‰è¿˜æœªä½¿ç”¨ã€ä½†ä¹Ÿåœ¨å†…å­˜ä¸­çš„é¡µé¢ï¼šå³éšæ—¶å‡†å¤‡æ‹¿å‡ºæ¥å­˜å‚¨ä»ç£ç›˜ä¸­è¯»å‡ºæ¥çš„æ•°æ®çš„é¡µé¢ï¼Œç”±â€œé¡µé¢ç¼“å­˜ç®—æ³•â€ç»´æŠ¤ï¼Œæ¯”å¦‚æ·˜æ±°ã€å›æ”¶ã€å¤ç”¨ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/page_cache_memory.png&#34; alt=&#34;ä¸¤ç§é¡µé¢çš„åˆ’åˆ†&#34; title=&#34;ä¸¤ç§é¡µé¢çš„åˆ’åˆ†&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ï¼Œå°±å¼€å§‹â€œé¡µé¢ç¼“å­˜â€è¿™å‡ éƒ¨åˆ†åŠŸèƒ½çš„å…·ä½“è®²è§£ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç®¡ç†é¡µé¢&#34;&gt;ç®¡ç†é¡µé¢&lt;/h1&gt;
&lt;h2 id=&#34;é¡µé¢ç›¸å…³çš„æ•°æ®æ•°æ®ç»“æ„&#34;&gt;é¡µé¢ç›¸å…³çš„æ•°æ®æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ¥çœ‹é¡µé¢ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œsqliteä¸­ä½¿ç”¨&lt;code&gt;PgHdr&lt;/code&gt;ç»“æ„ä½“æ¥åœ¨å†…å­˜ä¸­æè¿°ä¸€ä¸ªé¡µé¢ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/*
** Every page in the cache is controlled by an instance of the following
** structure.
*/
struct PgHdr {
  sqlite3_pcache_page *pPage;    /* Pcache object page handle */
  void *pData;                   /* Page data */
  void *pExtra;                  /* Extra content */
  PCache *pCache;                /* PRIVATE: Cache that owns this page */
  PgHdr *pDirty;                 /* Transient list of dirty sorted by pgno */
  Pager *pPager;                 /* The pager this page is part of */
  Pgno pgno;                     /* Page number for this page */
#ifdef SQLITE_CHECK_PAGES
  u32 pageHash;                  /* Hash of page content */
#endif
  u16 flags;                     /* PGHDR flags defined below */

  /**********************************************************************
  ** Elements above, except pCache, are public.  All that follow are 
  ** private to pcache.c and should not be accessed by other modules.
  ** pCache is grouped with the public elements for efficiency.
  */
  i16 nRef;                      /* Number of users of this page */
  PgHdr *pDirtyNext;             /* Next element in list of dirty pages */
  PgHdr *pDirtyPrev;             /* Previous element in list of dirty pages */
                          /* NB: pDirtyNext and pDirtyPrev are undefined if the
                          ** PgHdr object is not dirty */
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­çš„ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†åœ¨æ³¨é‡Šä¸­å·²ç»è‡ªè§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pPageï¼šè¿™ä¸ªå­—æ®µç¨æ˜¾å¤æ‚ï¼Œåé¢å±•å¼€è¯¦ç»†è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;pDataï¼ŒpExtraï¼špDataæŒ‡å‘äº†é¡µé¢å®é™…çš„å†…å®¹ï¼ŒpExtraæŒ‡å‘é¡µé¢é¢å¤–æ•°æ®ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œåè€…çš„å†…å®¹å¯ä»¥å¿½è§†ã€‚&lt;/li&gt;
&lt;li&gt;pCacheï¼šé¡µé¢ç¼“å­˜ç®¡ç†å™¨å¯¹è±¡æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;pDirtyï¼šè„é¡µé¢é“¾è¡¨æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;pPagerï¼šé¡µé¢ç®¡ç†å™¨å¯¹è±¡æŒ‡é’ˆã€‚ï¼ˆæ³¨æ„å’ŒpCacheè¿›è¡ŒåŒºåˆ†ï¼ŒpCacheæ˜¯â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;pgnoï¼šå­˜å‚¨è¯¥é¡µé¢çš„é¡µé¢ç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;flagsï¼šé¡µé¢æ ‡å¿—ä½ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ï¼Œå¯ä»¥é€šè¿‡ä½æ“ä½œæ¥åŠ ä¸Šå¤šä¸ªæ ‡å¿—ä½ï¼š
&lt;ul&gt;
&lt;li&gt;PGHDR_CLEANï¼šå¹²å‡€çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_DIRTYï¼šè„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_WRITEABLEï¼šå·²ç»è®°å½•ä¸‹æ¥ä¿®æ”¹ä¹‹å‰çš„é¡µé¢å†…å®¹ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥å¯¹å†…å­˜ä¸­çš„é¡µé¢å†…å®¹è¿›è¡Œä¿®æ”¹äº†ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_NEED_SYNCï¼šå°†è¯¥é¡µé¢å†…å®¹å†™å…¥æ•°æ®åº“æ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦sync journalæ–‡ä»¶ä¸­çš„é¡µé¢å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_DONT_WRITEï¼šä¸éœ€è¦å†™é¡µé¢å†…å®¹åˆ°ç£ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_MMAPï¼šè¯¥é¡µé¢å†…å®¹æ˜¯é€šè¿‡mmapåˆ°å†…å­˜ä¸­çš„ã€‚&lt;/li&gt;
&lt;li&gt;PGHDR_WAL_APPENDï¼šé¡µé¢å†…å®¹å·²ç»æ·»åŠ åˆ°WALæ–‡ä»¶ä¸­äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;nRefï¼šé¡µé¢å¼•ç”¨è®¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;pDirtyNextã€pDirtyPrevï¼šå­˜å‚¨è„é¡µé¢é“¾è¡¨ä¸­å‰ã€åé¡µé¢æŒ‡é’ˆï¼Œå¦‚æœè¯¥é¡µé¢ä¸æ˜¯è„é¡µé¢ï¼Œåˆ™è¿™ä¸¤ä¸ªå­—æ®µæœªå®šä¹‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ç®€ç•¥çš„æ€»ç»“è¯¥ç»“æ„ä½“ä¸­çš„å†…å®¹ï¼Œæœ€é‡è¦çš„è«è¿‡äºä»¥ä¸‹å‡ é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pDataå­˜å‚¨çš„é¡µé¢å†…å®¹ï¼Œæ‰€è°“çš„è¯»ã€å†™é¡µé¢å†…å®¹å®é™…ä¸Šæ“ä½œçš„æ˜¯è¿™ä¸ªæˆå‘˜æŒ‡å‘çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;pDirtyã€pDirtyNextã€pDirtyPrevè¿™å‡ ä¸ªæˆå‘˜ç»´æŠ¤çš„è„é¡µé¢ç›¸å…³çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;flagsç»´æŠ¤çš„é¡µé¢æ ‡å¿—ä½ï¼Œé€šè¿‡è¿™äº›æ ‡å¿—ä½æ¥åŒºåˆ†åº”è¯¥å¯¹é¡µé¢è¿›è¡Œä»€ä¹ˆæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/PgHdr.png&#34; alt=&#34;å†…å­˜ä¸­è„é¡µé¢çš„ç»„ç»‡&#34; title=&#34;å†…å­˜ä¸­è„é¡µé¢çš„ç»„ç»‡&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;sqlite3_pcache_pageæ•°æ®ç»“æ„&#34;&gt;sqlite3_pcache_pageæ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„&lt;code&gt;PgHdr&lt;/code&gt;ç»“æ„ä½“ä¸­ï¼Œè¿˜æœ‰ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå³&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ç±»å‹çš„pPageæŒ‡é’ˆæ²¡æœ‰è®²è§£ï¼Œè¿™é‡Œå±•å¼€è§£é‡Šã€‚&lt;/p&gt;
&lt;p&gt;å‰é¢æ¦‚è¿°éƒ¨åˆ†æåˆ°ï¼Œâ€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„å®ç°ï¼Œæ˜¯å¯ä»¥äº¤ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œè¿™å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šæ¯ä¸ªè‡ªå®šä¹‰çš„å®ç°ï¼Œå†…éƒ¨å®ç°çš„ç®¡ç†é¡µé¢çš„ç»“æ„ä½“å¯èƒ½å¹¶ä¸ç›¸åŒã€‚äºæ˜¯ï¼Œå°±è¦ç±»ä¼¼C++ä¸­çš„é¢å‘å¯¹è±¡æœºåˆ¶ä¸€æ ·ï¼Œå…ˆå£°æ˜ä¸€ä¸ªâ€œé¡µé¢â€çš„åŸºç±»ï¼ŒåŸºç±»ä¸­å®šä¹‰æœ€åŸºç¡€çš„æˆå‘˜å˜é‡ï¼Œè¿™æ ·åšä¹‹åæœ‰è¿™æ ·çš„å¥½å¤„ï¼šé¡µé¢ç®¡ç†æ¨¡å—ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½èƒ½é’ˆå¯¹è¿™ä¸ªåŸºç±»æ¥è¿›è¡Œï¼Œè€Œä¸éœ€è¦ç®¡å…·ä½“å®ç°ä¸­çš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œè¿™ä¸ªåŸºç±»å°±æ˜¯æˆå‘˜&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct sqlite3_pcache_page sqlite3_pcache_page;
struct sqlite3_pcache_page {
  void *pBuf;        /* The content of the page */
  void *pExtra;      /* Extra information associated with the page */
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆå‘˜ä¸­çš„ç”¨é€”ï¼Œæ³¨é‡Šä¸­ä¹Ÿå†™å¾—æŒºæ¸…æ¥šäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pBufï¼šæŒ‡å‘é¡µé¢å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;pExtraï¼šä¿å­˜é¡µé¢çš„é¢å¤–ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯â€œåŸºç±»â€ï¼Œå°±è¦æ±‚æ¯ä¸ªå­ç±»éƒ½è¦æœ‰è¯¥åŸºç±»çš„ä¿¡æ¯ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œæ¯”å¦‚â€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„é»˜è®¤å®ç°ä¸­ï¼Œå…¶ç®¡ç†é¡µé¢çš„ç»“æ„ä½“æ˜¯&lt;code&gt;PgHdr1&lt;/code&gt;ï¼ˆåé¢ä¼šå±•å¼€è§£é‡Šè¿™ä¸ªç»“æ„ä½“ï¼‰ï¼Œå…¶åˆå§‹å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PgHdr1 {
  sqlite3_pcache_page page;      /* Base class. Must be first. pBuf &amp;amp; pExtra */
  ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼Œsqliteä¸­è¦æ±‚æ‰€æœ‰å®ç°é¡µé¢ç¼“å­˜ç®—æ³•ä¸­ç®¡ç†é¡µé¢çš„æ•°æ®ç»“æ„ä½“ï¼Œéƒ½è¦ä»¥&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ç»“æ„ä½“å¼€å§‹åšä¸ºç¬¬ä¸€ä¸ªæˆå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œ&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ç»“æ„ä½“ä¸­ï¼Œ&lt;code&gt;pExtra&lt;/code&gt;æˆå‘˜åŒ…æ‹¬å¦‚ä¸‹ä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¢å¤–å†…å®¹ï¼šç”±ç³»ç»ŸæŒ‡å®š&lt;code&gt;szExtra&lt;/code&gt;å¤§å°æ¥æŒ‡å®šè¿™éƒ¨åˆ†å†…å®¹å¤§å°ï¼Œç®€å•èµ·è§ï¼Œç›®å‰å¯ä»¥è®¤ä¸ºè¿™éƒ¨åˆ†ä¸º0ã€‚&lt;/li&gt;
&lt;li&gt;PgHdrç»“æ„ä½“ï¼šå³å‰é¢è®²è§£çš„&lt;code&gt;é¡µé¢ç¼“å­˜æ¨¡å—&lt;/code&gt;ä¸­æè¿°ä¸€ä¸ªé¡µé¢çš„ç»“æ„ä½“å¤§å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯»åˆ°è¿™é‡Œï¼Œæœ‰å¯èƒ½æŠŠè¯»è€…ç»•æ™•äº†ï¼Œæˆ‘ä»¬ä»¥ä»£ç å’Œå›¾ç¤ºä¸ºå¼•å­è¯¦ç»†çœ‹ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªâ€œé¡µé¢ç¼“å­˜ç®—æ³•â€æ¨¡å—æ—¶ï¼Œè¦è°ƒç”¨&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“ä¸­å®šä¹‰çš„&lt;code&gt;xCreate&lt;/code&gt;å‡½æ•°æŒ‡é’ˆæ¥å®Œæˆï¼Œå…¶å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sqlite3_pcache *(*xCreate)(int szPage, int szExtra, int bPurgeable);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°&lt;code&gt;szExtra&lt;/code&gt;éœ€è¦æŒ‡å®šé¢å¤–éƒ¨åˆ†çš„å†…å®¹å¤§å°ï¼Œå®é™…åœ¨è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªå‚æ•°çš„å¤§å°å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„&lt;code&gt;szExtra&lt;/code&gt;å’ŒPgHdrç»“æ„ä½“å¤§å°ä¹‹å’Œï¼ˆåšäº†8å­—èŠ‚å¯¹é½ï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    sqlite3_pcache *pNew;
    pNew = sqlite3GlobalConfig.pcache2.xCreate(
                szPage, pCache-&amp;gt;szExtra + ROUND8(sizeof(PgHdr)),
                pCache-&amp;gt;bPurgeable
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;äºæ˜¯ï¼Œâ€œé¡µé¢ç¼“å­˜æ¨¡å—â€ä¸­è¦è·å–ä¸€ä¸ªé¡µé¢æ—¶ï¼Œæ˜¯é€šè¿‡&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“ä¸­å®šä¹‰çš„&lt;code&gt;xFetch&lt;/code&gt;å‡½æ•°æŒ‡é’ˆæ¥å®Œæˆçš„ï¼Œè¿™ä¸ªå‡½æ•°æŒ‡é’ˆçš„å®šä¹‰æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sqlite3_pcache_page *(*xFetch)(sqlite3_pcache*, unsigned key, int createFlag);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œè¿”å›çš„å°±æ˜¯ä¸Šé¢è¯´çš„â€œåŸºç±»â€ï¼Œå³&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ç»“æ„ä½“æŒ‡é’ˆã€‚è€Œåœ¨å†…éƒ¨çš„é»˜è®¤å®ç°ä¸­ï¼Œå…¶å®è¿”å›çš„æ˜¯&lt;code&gt;PgHdr1&lt;/code&gt;æŒ‡é’ˆè¿›è¡Œå¼ºåˆ¶è½¬æ¢ä¹‹åçš„ç»“æœï¼Œå³&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;è¿™ä¸€åŸºç±»çš„å­ç±»ï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿåšï¼Œå®Œå…¨æ˜¯å› ä¸ºåœ¨&lt;code&gt;PgHdr1&lt;/code&gt;ç»“æ„ä½“å®šä¹‰æ—¶ï¼ŒæŠŠ&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;ç»“æ„ä½“æˆå‘˜æ”¾åœ¨ç¬¬ä¸€ä¸ªæˆå‘˜ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PgHdr1 {
  sqlite3_pcache_page page;      /* Base class. Must be first. pBuf &amp;amp; pExtra */
  ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¾—åˆ°è¿”å›çš„&lt;code&gt;sqlite3_pcache_page&lt;/code&gt;æŒ‡é’ˆä¹‹åï¼Œå°±èƒ½é€šè¿‡å…¶ä¸­çš„&lt;code&gt;pExtra&lt;/code&gt;æŒ‡é’ˆæ‹¿åˆ°&lt;code&gt;PgHdr&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;PgHdr *sqlite3PcacheFetchFinish(
  PCache *pCache,             /* Obtain the page from this cache */
  Pgno pgno,                  /* Page number obtained */
  sqlite3_pcache_page *pPage  /* Page obtained by prior PcacheFetch() call */
){
  PgHdr *pPgHdr;

  pPgHdr = (PgHdr *)pPage-&amp;gt;pExtra;
  // ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ€»ç»“èµ·æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/sqlite3_pcache_page.png&#34; alt=&#34;sqlite3_pcache_page&#34; title=&#34;sqlite3_pcache_page&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;é¡µé¢æ‰€åœ¨çš„æ•°æ®ç»“æ„&#34;&gt;é¡µé¢æ‰€åœ¨çš„æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;ç¼“å­˜ä¸­çš„é¡µé¢ï¼Œå¯èƒ½å­˜åœ¨äºä»¥ä¸‹ä¸‰ç§æ•°æ®ç»“æ„ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è„é¡µé¢é“¾è¡¨ï¼šè¯¥é“¾è¡¨ç»´æŠ¤æ‰€æœ‰å½“å‰åœ¨ä½¿ç”¨çš„é¡µé¢ï¼Œç”±â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;hashæ•°ç»„ï¼šä½œç”¨æ˜¯ä»¥é¡µé¢ç¼–å·ä¸ºé”®æ¥æŸ¥è¯¢é¡µé¢ï¼Œç”±é»˜è®¤çš„â€œé¡µé¢ç¼“å­˜ç®—æ³•â€æ¥ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;LRUé“¾è¡¨ï¼šè¶Šæ˜¯å¸¸è¢«è®¿é—®çš„é¡µé¢ï¼Œåœ¨LRUé“¾è¡¨ä¸­å°±è¶Šå¾€å‰ï¼Œä»LRUé“¾è¡¨ä¸­æ·˜æ±°æ•°æ®éƒ½æ˜¯ä»é“¾è¡¨å°¾éƒ¨å¼€å§‹çš„ï¼Œä¹Ÿæ˜¯ç”±é»˜è®¤çš„â€œé¡µé¢ç¼“å­˜ç®—æ³•â€æ¥ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-1-pagecache/page_ds.png&#34; alt=&#34;é¡µé¢æ‰€åœ¨çš„ä¸‰ç§æ•°æ®ç»“æ„&#34; title=&#34;é¡µé¢æ‰€åœ¨çš„ä¸‰ç§æ•°æ®ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;è„é¡µé¢é“¾è¡¨&#34;&gt;è„é¡µé¢é“¾è¡¨&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªé¡µé¢é“¾è¡¨å«â€œè„é¡µé¢ï¼ˆdirty pageï¼‰é“¾è¡¨â€å®é™…ä¸Šå¹¶ä¸ååˆ†å‡†ç¡®ï¼Œè¿™ä¼šè®©äººè¯¯ä»¥ä¸ºè¿™ä¸ªé“¾è¡¨ä¸Šçš„é¡µé¢å…¨éƒ½æ˜¯è„é¡µé¢ï¼Œå®é™…ä¸Šæ˜¯å¯èƒ½å­˜åœ¨å¹²å‡€çš„é¡µé¢çš„ã€‚æ›´å‡†ç¡®çš„è¯´æ³•ï¼Œæ˜¯å½“å‰ç³»ç»Ÿåœ¨ä½¿ç”¨çš„é¡µé¢ï¼Œéƒ½ç»´æŠ¤åœ¨è¿™ä¸ªé¡µé¢é“¾è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ“ä½œè¿™ä¸ªé“¾è¡¨çš„å…¥å£å‡½æ•°æ˜¯&lt;code&gt;pcacheManageDirtyList&lt;/code&gt;ï¼Œå…¶ä¼ å…¥çš„å‚æ•°ä¸€ä¸ªæ˜¯&lt;code&gt;PgHdr&lt;/code&gt;ç±»å‹çš„æŒ‡é’ˆï¼Œå¦ä¸€ä¸ªç”¨äºæŒ‡å®šè¡Œä¸ºï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#define PCACHE_DIRTYLIST_REMOVE   1    /* Remove pPage from dirty list */
#define PCACHE_DIRTYLIST_ADD      2    /* Add pPage to the dirty list */
#define PCACHE_DIRTYLIST_FRONT    3    /* Move pPage to the front of the list */
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨&lt;code&gt;pcacheManageDirtyList&lt;/code&gt;å‡½æ•°å®ç°ä¸­ï¼Œä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªå‚æ•°è¿›è¡Œä¸æ“ä½œåˆ¤æ–­æ¥åšä¸åŒçš„è¡Œä¸ºçš„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pcacheManageDirtyListå®ç°ï¼š
  å¦‚æœ addRemove &amp;amp; PCACHE_DIRTYLIST_REMOVE:
    ä»é“¾è¡¨ä¸Šåˆ é™¤
  å¦‚æœ addRemove &amp;amp; PCACHE_DIRTYLIST_ADDï¼š
    æ·»åŠ åˆ°é“¾è¡¨å¤´
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‚æ•°&lt;code&gt;PCACHE_DIRTYLIST_FRONT&lt;/code&gt;ä¸º3ï¼Œè€Œå¦å¤–ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯1ï¼ˆåˆ é™¤ï¼‰ä¸€ä¸ªæ˜¯2ï¼Œæ‰€ä»¥å½“ä¼ å…¥&lt;code&gt;PCACHE_DIRTYLIST_FRONT&lt;/code&gt;çš„æ—¶å€™ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹ï¼Œå°±æ˜¯é¦–å…ˆä»é“¾è¡¨ä¸Šåˆ é™¤ï¼Œå†æ”¾åˆ°é“¾è¡¨å¤´ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºè„é¡µé¢é“¾è¡¨æ˜¯ç”±â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æè¿°é¡µé¢çš„ç»“æ„ä½“ä¸è¿™ä¸ªé“¾è¡¨ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œéƒ½åœ¨&lt;code&gt;PgHdr&lt;/code&gt;ä¸Šï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PgHdr {
  ...
  PgHdr *pDirtyNext;             /* Next element in list of dirty pages */
  PgHdr *pDirtyPrev;             /* Previous element in list of dirty pages */
                          /* NB: pDirtyNext and pDirtyPrev are undefined if the
                          ** PgHdr object is not dirty */
}; 
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;hashæ•°ç»„&#34;&gt;hashæ•°ç»„&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¿«é€Ÿæ ¹æ®é¡µé¢ç¼–å·ï¼ŒæŸ¥æ‰¾åˆ°è¯¥ç¼–å·çš„é¡µé¢æ˜¯å¦å·²ç»åŠ è½½åˆ°é¡µé¢ä¸­ï¼Œæ¯ä¸ªé¡µé¢çš„æ•°æ®è¿˜å­˜åœ¨äºä¸€ä¸ªhashæ•°ç»„ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„ç”±é»˜è®¤çš„â€œé¡µé¢ç¼“å­˜ç®—æ³•â€ç»´æŠ¤ï¼Œæ‰€ä»¥ä¸ä¹‹ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œéƒ½åœ¨ç»“æ„ä½“&lt;code&gt;PgHdr1&lt;/code&gt;ä¸Šï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PgHdr1 {
  ...
  PgHdr1 *pNext;                 /* Next in hash table chain */
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;hashæ•°ç»„çš„å®ç°ï¼Œä¸ä¸€èˆ¬çš„å®ç°å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;lrué“¾è¡¨&#34;&gt;LRUé“¾è¡¨&lt;/h3&gt;
&lt;p&gt;å½“éœ€è¦åŠ è½½å½“å‰è¿˜ä¸åœ¨å†…å­˜ä¸­çš„é¡µé¢æ—¶ï¼Œéœ€è¦é¦–å…ˆåˆ†é…å‡ºä¸€å—ç©ºé—´ï¼Œç”¨äºä¿å­˜ä»æ–‡ä»¶ä¸­åŠ è½½çš„é¡µé¢æ•°æ®ã€‚å¦‚å‰æ‰€è¿°ï¼Œâ€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€ç®¡ç†çš„æ˜¯è¿˜åœ¨ä½¿ç”¨çš„é¡µé¢ï¼Œè€Œâ€œé¡µé¢ç¼“å­˜ç®—æ³•â€ç®¡ç†çš„æ˜¯å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨çš„é¡µé¢ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†åŠŸèƒ½ä¹Ÿæ˜¯ç”±é»˜è®¤çš„â€œé¡µé¢ç¼“å­˜ç®—æ³•â€æ¥å®ç°çš„ï¼Œä¸ä¹‹ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œå’Œhashæ•°ç»„çš„å®ç°ä¸€æ ·ï¼Œä¹Ÿåœ¨ç»“æ„ä½“&lt;code&gt;PgHdr1&lt;/code&gt;ä¸Šï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PgHdr1 {
  ...
  PgHdr1 *pLruNext;              /* Next in LRU list of unpinned pages */
  PgHdr1 *pLruPrev;              /* Previous in LRU list of unpinned pages */
                                 /* NB: pLruPrev is only valid if pLruNext!=0 */
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“éœ€è¦ä»â€œæ²¡æœ‰è¢«ä½¿ç”¨çš„é¡µé¢â€ä¸­ï¼Œåˆ†é…å‡ºæ¥ä¸€ä¸ªé¡µé¢æ•°æ®ç”¨äºä¿å­˜åŠ è½½çš„é¡µé¢æ—¶ï¼Œå°±æ¶‰åŠåˆ°æ·˜æ±°é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªé¡µé¢è™½ç„¶å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºç»å¸¸è¢«è®¿é—®ï¼Œæ‰€ä»¥ä¸åº”è¯¥æ·˜æ±°è¿™ä¸ªé¡µé¢ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½å®ƒé©¬ä¸Šåˆä¼šè¢«è®¿é—®åˆ°ï¼Œåº”è¯¥é¦–å…ˆæ·˜æ±°é‚£äº›ä¸å¸¸è¢«è®¿é—®çš„é¡µé¢ï¼Œç”¨æ¥åŠ è½½é¡µé¢æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ç»´æŠ¤è¿™äº›ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå°±æ˜¯LRUé“¾è¡¨ï¼šåœ¨é“¾è¡¨ä¸­è¶Šå¾€å‰çš„æ•°æ®ï¼Œæ„å‘³ç€è¢«è®¿é—®çš„è¶Šé¢‘ç¹ï¼›åä¹‹ï¼Œæ·˜æ±°éƒ½æ˜¯ä»é“¾è¡¨å°¾éƒ¨å¼€å§‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;pinå’Œunpinæ“ä½œ&#34;&gt;pinå’Œunpinæ“ä½œ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;pin&lt;/code&gt;å’Œ&lt;code&gt;unpin&lt;/code&gt;æ“ä½œï¼Œåœ¨é»˜è®¤çš„ç¼“å­˜ç®—æ³•ä¸­ï¼Œæ˜¯é’ˆå¯¹LRUé“¾è¡¨è€Œè¨€çš„ï¼šä¸€ä¸ªé¡µé¢æ•°æ®ï¼Œå¦‚æœæ‰§è¡Œäº†&lt;code&gt;pin&lt;/code&gt;æ“ä½œï¼Œå°±æ˜¯å°†è¿™ä¸ªé¡µé¢ä»LRUé“¾è¡¨ä¸Šæ‘˜ä¸‹æ¥ã€‚è€Œ&lt;code&gt;unpin&lt;/code&gt;æ“ä½œåˆ™åä¹‹ï¼Œå°†é¡µé¢æ”¾å…¥LRUé“¾è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸¤ä¸ªæ“ä½œï¼Ÿ&lt;/p&gt;
&lt;p&gt;å†å¤ä¹ ä¸€ä¸‹å‰é¢æåˆ°çš„åˆ†å·¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨ï¼šè´Ÿè´£ç»´æŠ¤åœ¨ä½¿ç”¨çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®—æ³•ï¼šè´Ÿè´£ç»´æŠ¤æœªä½¿ç”¨çš„é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‡è®¾ä¸€ä¸ªé¡µé¢ç¼–å·ä¸ºNçš„é¡µé¢ï¼Œè¢«è®¿é—®æ—¶éœ€è¦åŠ è½½åˆ°å†…å­˜ï¼Œæ­¤æ—¶å°±ä¼šç”±â€œé¡µé¢ç¼“å­˜ç®¡ç†å™¨â€åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ”¾å…¥è„é¡µé¢é“¾è¡¨ï¼›è€Œä¸€æ—¦è®¿é—®å®Œæˆï¼Œå°±ä¼šè°ƒç”¨é¡µé¢ç¼“å­˜ç®—æ³•çš„&lt;code&gt;xUnpin&lt;/code&gt;å‡½æ•°æŒ‡é’ˆæ‰§è¡Œ&lt;code&gt;unpin&lt;/code&gt;æ“ä½œï¼ˆå®ç°é¡µé¢ç¼“å­˜ç®—æ³•çš„&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“åœ¨åé¢è§£é‡Šï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤çš„ç¼“å­˜ç®—æ³•ä¸­ï¼Œæ‰§è¡Œ&lt;code&gt;unpin&lt;/code&gt;æ“ä½œï¼Œå°±æ˜¯å°†é¡µé¢æ”¾å…¥LRUé“¾è¡¨ï¼Œå¹¶ä¸ä¼šå°†é¡µé¢ä»hashæ•°ç»„ä¸­åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š&lt;code&gt;unpin&lt;/code&gt;æ“ä½œï¼Œå¹¶ä¸å¦¨ç¢è¿™ä¸ªèƒ½å¤Ÿä»¥é¡µé¢ç¼–å·ä»hashæ•°ç»„ä¸­å†æ¬¡æŸ¥åˆ°è¯¥é¡µé¢çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æ¢è¨€ä¹‹ï¼Œ&lt;code&gt;unpin&lt;/code&gt;æ“ä½œæ˜¯åœ¨â€œé¡µé¢ç¼“å­˜ç®—æ³•â€ä½¿ç”¨å®Œæ¯•æŸä¸ªé¡µé¢æ—¶æ‰§è¡Œçš„ï¼Œåªæ˜¯ç”¨æ¥é€šçŸ¥â€œé¡µé¢ç¼“å­˜ç®—æ³•â€ï¼šè¿™ä¸ªé¡µé¢æˆ‘å·²ç»ç”¨ä¸ä¸Šäº†ï¼Œåç»­æ€ä¹ˆå¤„ç†ï¼Œå¯ä»¥ç”±â€œé¡µé¢ç¼“å­˜ç®—æ³•â€è‡ªè¡Œå†³å®šã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯ï¼Œå¯¹äºé‚£äº›ç»å¸¸è¢«è®¿é—®çš„é¡µé¢ï¼Œå³ä¾¿å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨ï¼ŒçœŸæ­£åˆ°éœ€è¦å®ƒçš„æ—¶å€™ï¼Œåªè¦æ²¡æœ‰è¢«æ·˜æ±°å‡ºå»åˆ†é…ç»™å…¶ä»–é¡µé¢ï¼Œå°±ä¸å†éœ€è¦å†æ¬¡ä»æ–‡ä»¶ä¸­åŠ è½½å‡ºæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¡µé¢ç¼“å­˜ç®¡ç†å™¨&#34;&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨&lt;/h2&gt;
&lt;h3 id=&#34;é¡µé¢ç¼“å­˜ç®¡ç†å™¨çš„æ•°æ®ç»“æ„&#34;&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨çš„æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨ï¼Œæ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ç»´æŠ¤è„é¡µé¢é“¾è¡¨ï¼Œé¡µé¢ç¼“å­˜ç®¡ç†å™¨çš„æ•°æ®ç»“æ„ä¸­æœ€é‡è¦çš„è«è¿‡äºä»¥ä¸‹å‡ ä¸ªæˆå‘˜ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct PCache {
  PgHdr *pDirty, *pDirtyTail;         /* List of dirty pages in LRU order */
  PgHdr *pSynced;                     /* Last synced page in dirty page list */
  ...

  int (*xStress)(void*,PgHdr*);       /* Call to try make a page clean */
  void *pStress;                      /* Argument to xStress */
  sqlite3_pcache *pCache;             /* Pluggable cache module */
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªç»´æŠ¤é¡µé¢é“¾è¡¨ç›¸å…³çš„æŒ‡é’ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è„é¡µé¢é“¾è¡¨ï¼šç”±æˆå‘˜pDirty, pDirtyTailæŒ‡å‘è¯¥é“¾è¡¨çš„ä¸€å¤´ä¸€å°¾ã€‚è„é¡µé¢é“¾è¡¨ä¸­ï¼Œé¡µé¢æ˜¯æŒ‰ç…§LRUçš„é¡ºåºè¿›è¡Œæ’åˆ—çš„ï¼Œå³ï¼šè¶Šé è¿‘é“¾è¡¨å°¾çš„é¡µé¢æœ€å¯èƒ½è¢«æ·˜æ±°ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åè¿›è¡Œsyncçš„é¡µé¢æŒ‡é’ˆï¼šåœ¨è„é¡µé¢é“¾è¡¨ä¸­ï¼ŒpSyncedå§‹ç»ˆæŒ‡å‘æœ€åä¸€ä¸ªå·²ç»è¿›è¡Œsyncæ“ä½œçš„é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸€ä¸ª&lt;code&gt;pSynced&lt;/code&gt;æŒ‡é’ˆï¼Ÿå› ä¸ºåœ¨é¡µé¢ç¼“å­˜ç´§å¼ çš„æ—¶å€™ï¼Œéœ€è¦å¿«é€ŸçŸ¥é“å“ªäº›é¡µé¢å·²ç»syncäº†ï¼Œè¿™æ ·çš„é¡µé¢æ·˜æ±°çš„ä»£ä»·æœ€ä½ï¼Œå…·ä½“å¯ä»¥çœ‹å‡½æ•°&lt;code&gt;sqlite3PcacheFetchStress&lt;/code&gt;çš„å®ç°ï¼Œè¯¥å‡½æ•°çš„å¤§ä½“æµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;åˆ†ä¸ºä¸¤æ­¥å¯»æ‰¾å¯ä»¥æ·˜æ±°çš„é¡µé¢ï¼š
  é¦–å…ˆåœ¨pSyncedæŒ‡é’ˆå¼€å§‹å¾€å‰æ‰¾ä¸éœ€è¦syncä¸”å¼•ç”¨è®¡æ•°ä¸º0çš„é¡µé¢
  å¦‚æœæ‰¾ä¸åˆ°å°±ç»§ç»­åœ¨è„é¡µé¢é“¾è¡¨ä¸­å¯»æ‰¾å¼•ç”¨è®¡æ•°ä¸º0çš„é¡µé¢
  æ‰¾åˆ°ä¹‹åï¼Œè°ƒç”¨æ³¨å†Œçš„xStressè¿›è¡Œæ·˜æ±°æ“ä½œ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é™¤äº†è¿™å‡ ä¸ªå’Œè„é¡µé¢é“¾è¡¨ç›¸å…³çš„æ•°æ®ç»“æ„ä¹‹å¤–ï¼Œä¸Šé¢è¿˜åˆ—ä¸¾å‡ºæ¥äº†å…¶ä»–å‡ ä¸ªæˆå‘˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;xStresså’ŒpStressï¼šåœ¨é¡µé¢ç¼“å­˜å‡ºç°å‹åŠ›æ—¶ï¼Œéœ€è¦å°†é¡µé¢æ·˜æ±°åŒæ—¶è¿›è¡Œæ¸…ç†ï¼Œæ¸…ç†é¡µé¢çš„æ“ä½œæœ€ç»ˆç”±&lt;code&gt;xStress&lt;/code&gt;å‡½æ•°æŒ‡é’ˆæ¥å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;sqlite3_pcacheï¼šä¸‹é¢ä¼šæåˆ°ï¼Œå®ç°â€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“ï¼Œå…¶å†…éƒ¨çš„&lt;code&gt;xCreate&lt;/code&gt;å‡½æ•°æŒ‡é’ˆæœ€ç»ˆä¼šåˆ›å»ºå‡ºä¸€ä¸ª&lt;code&gt;sqlite3_pcache&lt;/code&gt;è¿”å›ï¼Œåç»­è°ƒç”¨&lt;code&gt;é¡µé¢ç¼“å­˜ç®—æ³•&lt;/code&gt;æ—¶ï¼Œä¼ å…¥çš„éƒ½æ˜¯è¿™ä¸ªè¿”å›çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¡µé¢ç¼“å­˜ç®—æ³•ç»“æ„ä½“&#34;&gt;é¡µé¢ç¼“å­˜ç®—æ³•ç»“æ„ä½“&lt;/h2&gt;
&lt;p&gt;é¡µé¢ç¼“å­˜ç®—æ³•ï¼Œéœ€è¦å®ç°&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;æ¥å£å¹¶ä¸”æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼Œæ¥çœ‹&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct sqlite3_pcache_methods2 sqlite3_pcache_methods2;
struct sqlite3_pcache_methods2 {
  int iVersion;
  void *pArg;
  int (*xInit)(void*);
  void (*xShutdown)(void*);
  sqlite3_pcache *(*xCreate)(int szPage, int szExtra, int bPurgeable);
  void (*xCachesize)(sqlite3_pcache*, int nCachesize);
  int (*xPagecount)(sqlite3_pcache*);
  sqlite3_pcache_page *(*xFetch)(sqlite3_pcache*, unsigned key, int createFlag);
  void (*xUnpin)(sqlite3_pcache*, sqlite3_pcache_page*, int discard);
  void (*xRekey)(sqlite3_pcache*, sqlite3_pcache_page*, 
      unsigned oldKey, unsigned newKey);
  void (*xTruncate)(sqlite3_pcache*, unsigned iLimit);
  void (*xDestroy)(sqlite3_pcache*);
  void (*xShrink)(sqlite3_pcache*);
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€ä¸ªè§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;iVersionï¼šç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;li&gt;pArgï¼šå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;xInitï¼šåˆå§‹åŒ–æ¨¡å—çš„å‡½æ•°æŒ‡é’ˆï¼Œè¿™åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§è°ƒç”¨å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;xShutdownï¼šåœæ­¢æ¨¡å—çš„å‡½æ•°æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;xCreateï¼šåˆ›å»ºä¸€ä¸ªâ€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„æŒ‡é’ˆ&lt;code&gt;sqlite3_pcache&lt;/code&gt;è¿”å›ï¼Œæ³¨æ„è¿™ä¸ªå‡½æ•°é‡Œä¼ å…¥äº†é¡µé¢å¤§å°ã€é¢å¤–ç©ºé—´å¤§å°ï¼Œè¿™äº›éƒ½åœ¨ä¸Šé¢æœ‰è¯´æ˜ã€‚åç»­çš„å…¶ä»–å‡½æ•°æŒ‡é’ˆï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯è¿™é‡Œè¿”å›çš„&lt;code&gt;sqlite3_pcache&lt;/code&gt;æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;xCachesizeï¼šè¿”å›å½“å‰cacheå¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;xPagecountï¼šè¿”å›é¡µé¢æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;xFetchï¼šæ ¸å¿ƒå‡½æ•°ï¼Œæ ¹æ®ä¼ å…¥çš„&lt;code&gt;key&lt;/code&gt;åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™æŒ‰ç…§&lt;code&gt;createFlag&lt;/code&gt;å‚æ•°æ¥å†³å®šåé¢çš„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;xUnpinï¼šé¡µé¢çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;xRekeyï¼šè¡¨ç¤ºæŠŠé¡µé¢çš„keyè¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œkeyå…¶å®å°±æ˜¯é¡µé¢ç¼–å·ã€‚&lt;/li&gt;
&lt;li&gt;xTruncateï¼šå°†æ‰€æœ‰é¡µé¢ç¼–å·&amp;gt;=iLimitçš„é¡µé¢éƒ½é‡Šæ”¾ï¼Œå›æ”¶å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;xDestroyï¼šé”€æ¯å‰é¢&lt;code&gt;xCreate&lt;/code&gt;å‡½æ•°è¿”å›çš„&lt;code&gt;sqlite3_pcache&lt;/code&gt;æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;xShrinkï¼šå°½å¯èƒ½çš„å›æ”¶å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€è¦è¯´æ˜çš„æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;xInitå‡½æ•°ï¼šå®Œæˆåˆå§‹åŒ–è¿™ä¸ªæ¨¡å—çš„å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;xCreateï¼šè¿”å›åˆ›å»ºä¸€ä¸ªâ€œé¡µé¢ç¼“å­˜ç®—æ³•â€çš„æŒ‡é’ˆ&lt;code&gt;sqlite3_pcache&lt;/code&gt;ï¼Œåç»­çš„æ‰€æœ‰æ“ä½œï¼Œéƒ½ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œsqliteä¸­ï¼Œå…¶å®å¹¶æ²¡æœ‰å®šä¹‰&lt;code&gt;sqlite3_pcache&lt;/code&gt;çš„å…·ä½“ç»“æ„ï¼Œä»…ä»…åªæ˜¯å£°æ˜äº†è¿™ä¸ªç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç±»ä¼¼äº&lt;code&gt;void*&lt;/code&gt;è¿™æ ·çš„æ³›å‹æŒ‡é’ˆï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/*
** CAPI3REF: Custom Page Cache Object
**
** The sqlite3_pcache type is opaque.  It is implemented by
** the pluggable module.  The SQLite core has no knowledge of
** its size or internal structure and never deals with the
** sqlite3_pcache object except by holding and passing pointers
** to the object.
**
** See [sqlite3_pcache_methods2] for additional information.
*/
typedef struct sqlite3_pcache sqlite3_pcache;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sqlite&lt;/code&gt;é‡Œçš„é¡µé¢ç¼“å­˜ï¼Œåˆ†ä¸ºä¸¤ä¸ªå¤§çš„æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨ï¼šä¸»è¦ä»»åŠ¡æ˜¯ç®¡ç†è„é¡µé¢ï¼Œä»¥åŠå¯¹å¤–æä¾›æ ¹æ®é¡µé¢ç¼–å·æŸ¥è¯¢é¡µé¢çš„æ¥å£ï¼Œå½“æŸä¸ªé¡µé¢ä¸åœ¨å†…å­˜æ—¶ï¼Œè‡ªåŠ¨å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜ç®—æ³•ï¼šè´Ÿè´£å®ç°é¡µé¢çš„ç¼“å­˜ã€æ·˜æ±°ã€æŸ¥è¯¢ã€‚è¿™æ˜¯å¯ä»¥ç”±ç”¨æˆ·è‡ªå·±å®ç°çš„æ¨¡å—ï¼Œéœ€è¦å®ç°å¯¹åº”çš„&lt;code&gt;sqlite3_pcache_methods2&lt;/code&gt;ç»“æ„ä½“å³å¯ï¼Œä¹Ÿæä¾›äº†é»˜è®¤çš„å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å†…å­˜ä¸­çš„é¡µé¢ï¼Œåœ¨ä»¥ä¸‹å‡ ä¸ªæ•°æ®ç»“æ„ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è„é¡µé¢é“¾è¡¨ï¼Œç”±&lt;code&gt;é¡µé¢ç¼“å­˜ç®¡ç†å™¨&lt;/code&gt;ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;Hashæ•°ç»„ï¼šæ ¹æ®é¡µé¢ç¼–å·æŸ¥è¯¢åˆ°é¡µé¢æ•°æ®çš„æŒ‡é’ˆï¼Œç”±é»˜è®¤çš„&lt;code&gt;é¡µé¢ç¼“å­˜ç®—æ³•&lt;/code&gt;ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;LRUé“¾è¡¨ï¼šè´Ÿè´£æ·˜æ±°é¡µé¢ï¼Œç”±é»˜è®¤çš„&lt;code&gt;é¡µé¢ç¼“å­˜ç®—æ³•&lt;/code&gt;ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿°</title>
      <link>https://www.codedump.info/post/20211217-sqlite-btree-0/</link>
      <pubDate>Fri, 17 Dec 2021 10:19:05 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20211217-sqlite-btree-0/</guid>
      
      <description>&lt;p&gt;ã€Šsqlite3.36ç‰ˆæœ¬ btreeå®ç°ã€‹ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆé›¶ï¼‰- èµ·æ­¥åŠæ¦‚è¿° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-1-pagecache/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸€ï¼‰- ç®¡ç†é¡µé¢ç¼“å­˜ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211218-sqlite-btree-2-concurrency-control/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäºŒï¼‰- å¹¶å‘æ§åˆ¶æ¡†æ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20211222-sqlite-btree-3-journal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆä¸‰ï¼‰- journalæ–‡ä»¶å¤‡ä»½æœºåˆ¶ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220106-sqlite-btree-4-wal/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆå››ï¼‰- WALçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20220201-sqlite-btree-5-btree/&#34;&gt;sqlite3.36ç‰ˆæœ¬ btreeå®ç°ï¼ˆäº”ï¼‰- Btreeçš„å®ç° - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;èµ·æ­¥&#34;&gt;èµ·æ­¥&lt;/h1&gt;
&lt;p&gt;åœ¨å»å¹´å¤§ä½“æŠŠbtreeä»¥åŠb+treeç®—æ³•æµç¨‹ç ”ç©¶äº†ä¹‹åï¼Œæˆ‘å†™äº†ä¸¤ç¯‡åšå®¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200609-btree-1/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸Šï¼‰ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200615-btree-2/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸‹ï¼‰ - codedumpçš„ç½‘ç»œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆé‰´äºb+treeåªæ˜¯btreeçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œä¸‹é¢æè¿°å°†ä»…ä½¿ç”¨â€œbtreeâ€ï¼Œä¸å†ä¸¥æ ¼åŒºåˆ†ä¸¤è€…ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä»…ä»…åªæ˜¯è®©æˆ‘æ‡‚å¾—äº†æœ€åŸºæœ¬çš„åŸç†ã€‚æ‡‚å¾—åŸç†ï¼Œåªæ˜¯èƒ½åšå‡ºtoyçº§åˆ«çš„å®ç°ï¼Œæ‹¿btreeç±»çš„å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œè¦åšåˆ°ç”Ÿäº§çº§äº§å“ï¼Œè‡³å°‘è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æˆ‘å½“æ—¶ä¸çŸ¥é“æ€ä¹ˆåšçš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•å¤„ç†ä¸åŒå¤§å°çš„æ•°æ®çš„å­˜å‚¨ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸€ä¸ªæ•°æ®ä¹‹åï¼Œå¦‚ä½•å¤ç”¨å…¶ç•™ä¸‹çš„ç©ºé—´ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é”™è¯¯ã€å´©æºƒæ¢å¤æ€ä¹ˆåšï¼Ÿ&lt;/li&gt;
&lt;li&gt;è·Ÿç£ç›˜æ–‡ä»¶æ˜¯å¦‚ä½•äº¤äº’çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜æ¨¡å—å¦‚ä½•å®ç°ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç­‰ç­‰ç­‰ç­‰ï¼Œè¿˜æœ‰å¤ªå¤šæˆ‘è¿˜æ²¡æœ‰å¼„æ¸…æ¥šçš„å®ç°ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæˆ‘ç”šè‡³è¿˜åœ¨å¾®åšä¸Šå‘é—®ï¼Œå¾—åˆ°äº†ä¸¤ä¸ªè´¨é‡å¾ˆé«˜çš„å›ç­”ï¼Œè§æœ¬æ–‡æœ€åçš„&lt;a href=&#34;https://www.codedump.info/post/20211217-sqlite-btree-0/#%E5%BD%A9%E8%9B%8B&#34;&gt;å½©è›‹éƒ¨åˆ†&lt;/a&gt;ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;å¯¹LSMç±»å­˜å‚¨å¼•æ“æœ‰äº†è§£çš„äººéƒ½çŸ¥é“ï¼ŒLeveldbè¿™ä¸ªé¡¹ç›®åœ¨LSMé¢†åŸŸå±äºå…¥é—¨çº§åˆ«çš„ç”Ÿäº§çº§å®ç°ï¼Œå³è¿™ä¸ªé¢†åŸŸæœ€ç²¾ç®€ã€ä½†æ˜¯åˆèƒ½æ”¾å¿ƒåœ¨æŸäº›è¦æ±‚ä¸é«˜çš„åœºæ™¯ä¸‹ç”¨äºç”Ÿäº§çš„é¡¹ç›®ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä¸€ç›´åœ¨æ‰¾é‚£ç§btreeé¢†åŸŸçš„â€œleveldbâ€ï¼Œå¾ˆé—æ†¾ä¸€ç›´éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œæˆ‘åˆ†åˆ«çœ‹äº†ç›®å‰WiredTigerã€innodbã€sqliteçš„å¯¹åº”å®ç°ï¼Œéƒ½å¤ªå¤æ‚äº†ï¼Œçœ‹ä¸ä¸‹å»ã€‚&lt;/p&gt;
&lt;p&gt;ç›´åˆ°æœ‰ä¸€å¤©ï¼Œæ— æ„é—´å‘ç°äº†è¿™ä¸ªé¡¹ç›®ï¼š&lt;a href=&#34;https://github.com/madushadhanushka/simple-sqlite&#34;&gt;madushadhanushka/simple-sqlite: Code reading for sqlite backend&lt;/a&gt;ï¼Œçœ‹ä»‹ç»ï¼Œä½œè€…æŠŠsqlite2.5é‡Œb-treeç›¸å…³çš„éƒ¨åˆ†ä»£ç æŠ½å–å‡ºæ¥äº†ï¼Œæˆ‘ç¼–è¯‘è¿è¡Œäº†ä¸€ä¸‹ç”¨ä¾‹éƒ½èƒ½æ­£å¸¸è·‘ï¼Œä»£ç é‡ä¸è¿‡å‡ åƒè¡Œï¼Œæˆ‘åªèŠ±äº†å‡ å¤©å°±çœ‹å®Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æŒ‰ç…§&lt;a href=&#34;https://www.sqlite.org/changes.html&#34;&gt;Release History Of SQLite&lt;/a&gt;ä¸Šçš„è®°è½½ï¼Œsqlite 2.5ç‰ˆæœ¬æ˜¯2002å¹´çš„ç‰ˆæœ¬äº†ï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬è¿˜æ˜¯æŸç§ç¨‹åº¦å›ç­”äº†æˆ‘åœ¨ä¸Šé¢çš„ç–‘é—®ã€‚&lt;/p&gt;
&lt;p&gt;è¶çƒ­æ‰“é“ï¼Œæˆ‘åˆæ‰¾æ¥æ›´æ–°ä¸€äº›çš„sqlite 3.6.10ä»£ç ç»§ç»­çœ‹è¿™éƒ¨åˆ†çš„å®ç°ï¼Œè¿™æ¬¡èŠ±äº†æ›´å¤šçš„æ—¶é—´æ‰çœ‹å®Œï¼Œä½†æ˜¯åˆå¢å¼ºäº†æˆ‘çš„ä¿¡å¿ƒã€‚ç”±äºè¿™ä¸ªç‰ˆæœ¬çš„sqliteï¼Œè¿˜æœªå®ç°btreeçš„walï¼Œè¿˜åªæ˜¯ç”¨äº†journalæ–‡ä»¶æ¥åšå´©æºƒæ¢å¤ï¼ˆæ— è®ºwalè¿˜æ˜¯journalï¼Œéƒ½ä¼šåœ¨åé¢æ–‡ç« å±•å¼€è¯¦ç»†è®¨è®ºï¼‰ï¼Œæ‰€ä»¥åœ¨æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒä¹‹åï¼Œæˆ‘æ¥ä¸‹æ¥åˆç»§ç»­çœ‹å½“æ—¶ï¼ˆ2021.10æœˆä»½ï¼‰æœ€æ–°çš„sqlite 3.36ç‰ˆæœ¬çš„å®ç°ï¼Œè¿™éƒ¨åˆ†çš„å®ç°å¯¹æ¯”3.6.10æ¥è¯´ï¼Œåœ¨btreeéƒ¨åˆ†æœ€å¤§çš„å˜åŒ–å°±æ˜¯å¤šäº†walçš„å®ç°ï¼Œåœ¨å·²ç»æ¸…æ¥š3.6.10çš„å‰æä¸‹ï¼Œå†å¢åŠ äº†è§£è¿™éƒ¨åˆ†çš„å®ç°ï¼Œä¹Ÿå¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œç®€å•æè¿°äº†æˆ‘æ¢ç´¢ä¸€ä¸ªç”Ÿäº§çº§btreeå®ç°çš„åˆè¿‡ç¨‹ï¼Œbtreeç±»å­˜å‚¨å¼•æ“çš„å®ç°åšå¤§ç²¾æ·±ï¼Œæ›´å¤æ‚è€…è¿˜æœ‰å¾ˆå¤šï¼ˆWiredTigerã€innodbã€tokudb&amp;hellip;ï¼‰ï¼Œä½†æ˜¯æ— ç–‘ä»ä½ç‰ˆæœ¬sqliteå¼€å§‹çš„æ¢ç´¢æµç¨‹ï¼Œç»ˆäºè®©æˆ‘æ‰“å¼€äº†èµ°ä¸Šè¿™æ¡è·¯çš„ä¸€æ‰‡å¤§é—¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« å°±sqlite 3.36ç‰ˆæœ¬çš„btreeå®ç°å±•å¼€æè¿°ï¼Œå¸Œæœ›å¯¹é‚£äº›å’Œæˆ‘ä¸€æ ·å¯¹â€œç”Ÿäº§çº§btreeç±»å­˜å‚¨å¼•æ“å®ç°â€æœ‰å¥½å¥‡å¿ƒçš„äººæœ‰ä¸€ç‚¹å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¦‚æœä½ è¿˜æ˜¯è§‰å¾—åƒåŠ›ï¼Œå¯ä»¥å…ˆä»&lt;a href=&#34;https://github.com/madushadhanushka/simple-sqlite&#34;&gt;madushadhanushka/simple-sqlite: Code reading for sqlite backend&lt;/a&gt;è¿™é‡Œçœ‹èµ·ã€‚è¿™é‡Œå¹¶ä¸å»ºè®®å¯¹btreeåŸç†æ²¡æœ‰äº†è§£çš„äººç›´æ¥ä¸Šæ‰‹sqliteçš„å®ç°ï¼Œå¦‚æœéœ€è¦äº†è§£åŸç†è¯·å‚è€ƒç›¸å…³æ–‡ç« æˆ–è€…æˆ‘ä¸Šé¢ç»™å‡ºçš„æˆ‘å†™çš„ä¸¤ç¯‡åšå®¢ã€‚è¿™ç³»åˆ—æ–‡ç« ä¸­ï¼Œå°†ä¸å†å¯¹btreeåŸç†åšè¿‡å¤šæè¿°ï¼Œå°†å‡è®¾è¯»è€…å·²ç»äº†è§£è¿™éƒ¨åˆ†å†…å®¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;sqliteçš„btreeæ¶æ„æ¦‚è¿°&#34;&gt;sqliteçš„btreeæ¶æ„æ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;ä¸‹é¢ç®€å•æè¿°ä¸€ä¸‹sqliteçš„btreeæ¶æ„ï¼Œä»é«˜å¾€ä½å¤§ä½“åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/btree-arch.png&#34; alt=&#34;btreeæ¶æ„&#34; title=&#34;btreeæ¶æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸‰éƒ¨åˆ†æ¶æ„ï¼Œç”±ä¸‹å¾€ä¸Šä¾æ¬¡æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿçº§APIçš„å®ç°ï¼šå› ä¸ºsqliteæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å¤šä¸ªå¹³å°ç¼–è¯‘è¿è¡Œçš„æ•°æ®åº“ï¼Œæ‰€ä»¥ç³»ç»Ÿçº§APIè¿™ä¸€å±‚ï¼Œéœ€è¦è§£å†³å¹³å°ç›¸å…³çš„æ–‡ä»¶IOã€é”ç­‰é—®é¢˜ã€‚è¿™éƒ¨åˆ†å®ç°ï¼Œå°†ä¸åœ¨è¿™ç³»åˆ—æ–‡ç« ä¸­ä»‹ç»ï¼Œå› ä¸ºå¹¶ä¸å±äºæ•°æ®åº“å®ç°æ—¶çš„æ ¸å¿ƒé—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¡µé¢ç®¡ç†æ¨¡å—ï¼šbtreeå­˜å‚¨å¼•æ“ï¼Œå…¶æ“ä½œæ–‡ä»¶çš„æœ€åŸºæœ¬å•ä½å°±æ˜¯é¡µé¢ã€‚é¡µé¢ç®¡ç†æ¨¡å—è§£å†³ä»¥ä¸‹çš„é—®é¢˜ï¼šå¯¹ä¸Šå±‚çš„btreeæ¨¡å—ï¼Œæš´éœ²é’ˆå¯¹é¡µé¢è¯»ã€å†™çš„æ¥å£ï¼Œå†…éƒ¨ä¼šç¼“å­˜é¡µé¢çš„å†…å®¹ï¼Œä½•æ—¶å°†ä¿®æ”¹çš„é¡µé¢ï¼ˆæ‰€è°“è„é¡µé¢ï¼Œdirty pageï¼‰è½ç›˜åˆ°ç£ç›˜ï¼Œæ˜¯å¦éœ€è¦syncä¿®æ”¹ï¼Œå´©æºƒæˆ–è€…é‡å¯æ—¶çš„æ•°æ®æ¢å¤ï¼Œè¿™äº›éƒ½ä¸éœ€è¦ä¸Šå±‚çš„btreeæ¨¡å—å…³å¿ƒã€‚ä¸ºäº†è¾¾åˆ°è¿™äº›æ•ˆæœï¼Œå†…éƒ¨è¿˜æœ‰å‡ ä¸ªå­æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¡µé¢ç¼“å­˜æ¨¡å—ï¼šç”¨äºç¼“å­˜é¡µé¢çš„å†…å­˜æœ‰é™ï¼Œä½•æ—¶æ·˜æ±°ç¼“å­˜ä¸­çš„é¡µé¢ã€ä½•æ—¶å°†ç¼“å­˜ä¸­çš„è„é¡µé¢è½ç›˜ï¼Œç­‰ç­‰éƒ½ç”±è¿™ä¸ªæ¨¡å—è´Ÿè´£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¡µé¢å¤‡ä»½ï¼šä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºé¡µé¢çš„ä¿®æ”¹å¹¶ä¸ä¸€å®šé©¬ä¸Šè½ç›˜ï¼Œè€Œæ˜¯å¯èƒ½åªæ˜¯ä¿®æ”¹äº†ç¼“å­˜ä¸­çš„é¡µé¢ï¼Œè¿™æ ·åœ¨ç³»ç»Ÿå‘ç”Ÿå´©æºƒçš„æ—¶å€™ï¼Œéœ€è¦åšæ¢å¤æ“ä½œï¼Œä¸€äº›æ²¡æœ‰å®Œæˆçš„äº‹åŠ¡éœ€è¦å›æ»šï¼Œç­‰ç­‰ã€‚è¿™éƒ¨åˆ†é¡µé¢ç®¡ç†æ¨¡å—ç”±ä¸¤ç§ä¸åŒçš„å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;journalæ–‡ä»¶ï¼šè¿™æ˜¯æ—©æœŸï¼Œä½†æ˜¯æ•ˆç‡å¹¶ä¸é«˜çš„å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;WALæ–‡ä»¶ï¼šè¿™æ˜¯ä»3.7ä¹‹åå¼•å…¥çš„æ›´é«˜æ•ˆçš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‹åŠ¡ï¼šäº‹åŠ¡å¤„ç†ä¹Ÿæ”¾åœ¨äº†é¡µé¢ç®¡ç†ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;btreeï¼šåŸºäºé¡µé¢ç®¡ç†æ¨¡å—ä¹‹ä¸Šï¼Œå®ç°äº†å¯ä»¥å­˜å‚¨å¯å˜æ•°æ®çš„btreeæ¨¡å—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥è¿™æ ·æ¥ç®€å•åŒºåˆ«ç†è§£â€œé¡µé¢ç®¡ç†â€æ¨¡å—å’Œbtreeæ¨¡å—çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¡µé¢ç®¡ç†ï¼šé¡¾åæ€ä¹‰ï¼Œé¡µé¢ç®¡ç†æ¨¡å—çš„æœ€åŸºæœ¬å•ä½æ˜¯â€é¡µé¢â€œï¼Œé¡µé¢çš„è¯»ã€å†™ã€ç¼“å­˜ã€è½ç›˜ã€æ¢å¤ã€å›æ»šç­‰ï¼Œéƒ½ç”±é¡µé¢æ¨¡å—è´Ÿè´£ã€‚ä¸Šä¸€å±‚ä¾èµ–é¡µé¢ç®¡ç†æ¨¡å—çš„btreeæ¨¡å—ï¼Œä¸éœ€è¦å…³å¿ƒä¸€ä¸ªé¡µé¢ä½•æ—¶ç¼“å­˜ã€ä½•æ—¶è½ç›˜ç­‰ç»†èŠ‚ã€‚å³ï¼š&lt;strong&gt;é¡µé¢æ¨¡å—è´Ÿè´£é¡µé¢çš„ç‰©ç†çº§åˆ«çš„æ“ä½œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;btreeï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè´£æŒ‰ç…§btreeç®—æ³•ï¼Œæ¥ç»„ç»‡é¡µé¢ï¼Œå³è´Ÿè´£çš„æ˜¯é¡µé¢ä¹‹é—´é€»è¾‘å…³ç³»ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;é™¤æ­¤ä»¥å¤–ï¼Œä¸€ä¸ªé¡µé¢å†…éƒ¨çš„æ•°æ®çš„ç‰©ç†ã€é€»è¾‘ç»„ç»‡ï¼Œä¹Ÿæ˜¯btreeæ¨¡å—æ¥è´Ÿè´£çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å³ï¼š&lt;strong&gt;btreeè´Ÿè´£ç»´æŠ¤é¡µé¢é—´çš„é€»è¾‘å…³ç³»ï¼Œä»¥åŠä¸€ä¸ªé¡µé¢å†…æ•°æ®çš„ç»„ç»‡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/page-module.png&#34; alt=&#34;ä»¥é¡µé¢ç‰©ç†ã€é€»è¾‘å…³ç³»çš„ç»´æŠ¤çœ‹æ¨¡å—åˆ’åˆ†&#34; title=&#34;ä»¥é¡µé¢ç‰©ç†ã€é€»è¾‘å…³ç³»çš„ç»´æŠ¤çœ‹æ¨¡å—åˆ’åˆ†&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºæ¥ï¼Œâ€œé¡µé¢ç®¡ç†æ¨¡å—â€æ— ç–‘æ˜¯è¿™é‡Œæœ€å¤§æœ€å¤æ‚çš„éƒ¨åˆ†ï¼ŒAndy Pavloåœ¨CMU 15445è¯¾ç¨‹ä¸­æåˆ°è¿‡ï¼šä»»ä½•ç”¨&lt;code&gt;mmap&lt;/code&gt;æ¥åšé¡µé¢ç®¡ç†çš„åšæ³•éƒ½æ˜¯å¾ˆç³Ÿç³•çš„åšæ³•ï¼ˆå¦‚boltdbã€LMDBç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20211217-sqlite-btree-0/mmap.jpeg&#34; alt=&#34;mmap&#34; title=&#34;mmap&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç³»åˆ—çš„æ–‡ç« ï¼Œä¹Ÿå°†æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œä»ä¸‹å¾€ä¸Šé€å±‚åˆ†æsqliteçš„3.36ç‰ˆæœ¬çš„btreeå®ç°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å½©è›‹&#34;&gt;å½©è›‹&lt;/h1&gt;
&lt;p&gt;2021å¹´9æœˆ5æ—¥ï¼Œæˆ‘åœ¨å¾®åšä¸Šå°±å¤„ç†å´©æºƒæ¢å¤çš„å®ç°ï¼Œæäº†ä¸€ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é‚£äº›å¾ˆæˆç†Ÿçš„å­˜å‚¨å¼•æ“ï¼Œéƒ½æ˜¯æ€ä¹ˆå¤„ç†å´©æºƒæ¢å¤é—®é¢˜çš„å‘¢ï¼Œæ¯”å¦‚å†™æ•°æ®è½ç›˜åˆ°ä¸€åŠï¼Œè¿›ç¨‹å´©äº†ï¼Œè¯¥å¦‚ä½•æ¢å¤å‘¢ï¼Ÿæ±‚èµ„æ–™å’ŒæŒ‡ç‚¹ã€‚ â€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆè§ï¼š&lt;a href=&#34;https://weibo.com/1642628345/KwKqNgScT&#34;&gt;é‚£äº›å¾ˆæˆç†Ÿçš„å­˜å‚¨å¼•æ“&amp;hellip; - @ç©å®¶è€Cçš„å¾®åš - å¾®åš&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;å¾—åˆ°äº†ä¸¤ä¸ªå¾ˆä¸é”™çš„æŒ‡ç‚¹å›å¤ï¼š&lt;/p&gt;
&lt;h2 id=&#34;ba0tiaoçš„å›å¤&#34;&gt;ba0tiaoçš„å›å¤&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;åšInnoDB è¿™å—æŒºä¹…äº†, æˆ‘è¯•è¯•è¯´è¯´ InnoDB æ˜¯æ€ä¹ˆåšçš„å§..&lt;/p&gt;
&lt;p&gt;å…¶å®ä½ è¿™é‡Œåº”è¯¥ç»†åˆ†æˆä¸¤ä¸ªé—®é¢˜&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;16kb çš„page å†™å…¥çš„åŸå­æ€§è¯¥å¦‚ä½•ä¿è¯&lt;/li&gt;
&lt;li&gt;Btree ç»“æ„çš„å®Œæ•´æ€§å¦‚ä½•ä¿è¯, ä¹Ÿå°±æ˜¯ä½ è¯´çš„ä¿®æ”¹äº†nä¸ªé¡µé¢ä»¥åå¦‚æœä¿®æ”¹äº†çˆ¶å­, å…„å¼Ÿå…³ç³»ä»¥å, å¦‚æœè§£å†³ä¸­é—´çš„crash çš„é—®é¢˜&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é—®é¢˜1 æ˜¯é€šè¿‡double write buffer æ¥è§£å†³çš„, å› ä¸ºInnoDB çš„page å¤§å°æ˜¯16kb, å¾ˆå¤šæ–‡ä»¶ç³»ç»Ÿåªèƒ½ä¿è¯4kb å¤§å°å†™å…¥çš„åŸå­æ€§, å› æ­¤éœ€è¦å†™å…¥å‰å…ˆå°†page çš„å†…å®¹å†™å…¥åˆ°double write buffer æ¥ä¿è¯, å¦‚æœå†™å…¥å¤±è´¥ä¹Ÿä¸ä¼šå°†åŸæœ‰page çš„å†…å®¹è¦†ç›–.&lt;/p&gt;
&lt;p&gt;é—®é¢˜2 æ˜¯é€šè¿‡redo log + mtr(mini transaction) è¿›è¡Œä¿è¯.&lt;/p&gt;
&lt;p&gt;InnoDB é‡Œé¢çš„redo log æ˜¯ç”±mtr ç»„æˆ, mtr æ˜¯ä¿®æ”¹btree çš„æœ€å°å•ä½. æ¯æ¬¡å†™å…¥redo log çš„æ—¶å€™å¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„mtr çš„å†…å®¹, å…·ä½“å®ç°æ–¹å¼æ˜¯mtr ä¼šæœ‰MULTI_REC_END æ ‡è®°, åœ¨crash recovery çš„æ—¶å€™, å¦‚æœè¯»å–åˆ°mtr çš„å†…å®¹æ²¡æœ‰MULTI_REC_END æ ‡è®°, é‚£ä¹ˆåˆ™ä¼šè®¤ä¸ºè¿™ä¸ªmtr ä¸å®Œæ•´, å°±ä¼šæŠŠè¿™æ®µmtr æŠ›å¼ƒ.&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ˜¯ä¸æ˜¯ä¸€æ¬¡insert æ“ä½œäº§ç”Ÿçš„redo log éƒ½åŒ…å«åœ¨ä¸€ä¸ªmtr é‡Œé¢å‘¢?&lt;/p&gt;
&lt;p&gt;ä¸æ˜¯çš„.&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“åœ¨btree é‡Œé¢å¯¹page çš„ä¿®æ”¹éƒ½éœ€è¦å¯¹page åŠ é”, ä»fsp æ¨¡å—åˆ†é…ä¸€ä¸ªnew page ä¹Ÿéœ€è¦å¯¹root page è¿›è¡ŒåŠ é”ç­‰ç­‰. æ‰€ä»¥InnoDB çš„mtr é‡Œé¢è‡ªç„¶å°±åŒ…å«å¯¹é”çš„æ“ä½œ, å› æ­¤è¦ä¿®æ”¹æŸä¸€ä¸ªpage çš„æ—¶å€™, mtr begin çš„æ—¶å€™ä¼šå¯¹è¯¥page åŠ é”, ç„¶åå†™å…¥ä¿®æ”¹çš„å†…å®¹, ç„¶åmtr commit çš„æ—¶å€™, å¯¹äºä¿®æ”¹çš„page çš„é”å°±å¯ä»¥é‡Šæ”¾äº†.&lt;/p&gt;
&lt;p&gt;å¦‚æœæ•´ä¸ªinsert çš„è¿‡ç¨‹éƒ½æ”¾åœ¨ä¸€ä¸ªmtr é‡Œé¢åš, é‚£ä¹Ÿæ˜¯å¯ä»¥çš„, ä¹Ÿå°±æ˜¯å¯¹äºæ‰€æœ‰page çš„latch éƒ½æ˜¯ä¸€å¼€å§‹æŒæœ‰, æœ€åçš„æ—¶å€™åœ¨é‡Šæ”¾, å°±ç®—åç»­è¿™ä¸ªpage å·²ç»ä¸å†ä¿®æ”¹äº†, ä¹Ÿä¾ç„¶è¦ä¸€ç›´æŒæœ‰. å¾ˆå®¹æ˜“ç†è§£è¿™æ ·å¹¶å‘è‡ªç„¶å°±é™ä½ä¸‹æ¥çš„, å› æ­¤åœ¨InnoDB è®¾è®¡é‡Œé¢, mtr çš„ç²’åº¦æ˜¯å°½å¯èƒ½å°çš„. ä¿®æ”¹å®Œpage å°±åº”è¯¥å°½å¿«çš„commit, ç„¶åå°†page lock é‡Šæ”¾. ä½†æ˜¯åˆéœ€è¦ä¿è¯æ¯ä¸€æ¬¡çš„mtr æ“ä½œå‰å’Œæ“ä½œåbtree çš„å®Œæ•´æ€§.&lt;/p&gt;
&lt;p&gt;ä½“ç°å…·ä½“çš„ä¾‹å­å°±æ˜¯, InnoDBé‡Œé¢å¯¹äºä¸€ä¸ªç®€å•çš„insert æ“ä½œ, å…¶å®æ˜¯æœ‰éå¸¸å¤šä¸ªmtr ç»„æˆ, å°½å¯èƒ½å‡å°‘æŒæœ‰é”çš„æ—¶é—´.&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨åšbtree åˆ†è£‚æ“ä½œçš„æ—¶å€™, åˆ†é…æ–°çš„page, å°†ä¹‹å‰pageä¸€åŠçš„æ•°æ®è¿ç§»åˆ°new page æ˜¯åœ¨ä¸€ä¸ªmtr é‡Œé¢å®Œæˆ, ä½†æ˜¯åç»­å…·ä½“çš„insert æ“ä½œæ˜¯åœ¨å¦å¤–ä¸€ä¸ªmtr é‡Œé¢å®Œæˆçš„. é‚£ä¹ˆå¦‚æœåœ¨åšåˆ†è£‚æ“ä½œè¿‡ç¨‹ä¸­crash, é‚£ä¹ˆè¿™ä¸ªåˆ†è£‚æ“ä½œæ˜¯ä¸ä¼šå®Œæˆçš„, å¦‚æœåœ¨åˆ†è£‚æ“ä½œå®Œæˆä»¥å, insert ä¹‹å‰crash, é‚£ä¹ˆbtree æ˜¯å·²ç»åˆ†è£‚è¿‡çš„, åªæ˜¯æ•°æ®æ²¡æœ‰æ’å…¥äº†.&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿™é‡Œä¼šæœ‰ä½ è¯´çš„æ›´å¤æ‚çš„è®¾è®¡çš„çˆ¶èŠ‚ç‚¹ and çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„åˆ†è£‚, é‚£ä¹ˆè‡ªç„¶æŒæœ‰é”çš„æ—¶é—´å°±æ›´é•¿äº†, ä½†æ˜¯åœ¨æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯åšçš„ä¸€äº›ä¼˜åŒ–.&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€äº›æ¯”å¦‚InnoDB redo log æ˜¯&amp;quot;physical to a page, logical within a page&amp;quot; å°±æ˜¯è§£å†³æˆ‘ä»¬ä¸Šé¢è¯´çš„å¦‚æœåˆ†è£‚æ“ä½œæˆåŠŸäº†, ä½†æ˜¯è¿™ä¸ªäº‹åŠ¡è¦å›æ»š, è¿™ä¸ªæ—¶å€™è¯¥å¦‚ä½•å¤„ç†ç­‰ç­‰..&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„å†…å®¹å…¶å®è¿™äº›æ–‡ç« é‡Œé¢éƒ½æœ‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;C. Mohan, Don Handerle. ARIES: A Transaction Recovery Method Supporting Fine-Granularity Locking and Partial Rollbacks Using Write-Ahead Logging.&lt;/li&gt;
&lt;li&gt;C. Mohan, Frank Levine. ARIES/lM: An Efficient and High Concurrency index Management Method Using Write-Ahead Logging.&lt;/li&gt;
&lt;li&gt;Goetz Graefe. A Survey of B-Tree Logging and Recovery Techniques.&lt;/li&gt;
&lt;li&gt;Goetz Graefe. A Survey of B-Tree Locking Techniques.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äº†Goetz Graefe å·ç§°Btree å®ˆæŠ¤ç¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆè§ï¼š&lt;a href=&#34;https://weibo.com/1832563813/KwRpIxunM&#34;&gt;åšInnoDB è¿™å—&amp;hellip; - @ba0tiaoçš„å¾®åš - å¾®åš&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ³¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ba0tiao&lt;/code&gt;åº”è¯¥æ˜¯é˜¿é‡Œäº‘è´Ÿè´£PolarDBå¼€å‘çš„èµ„æ·±å¼€å‘ã€‚&lt;/li&gt;
&lt;li&gt;ä»–çš„åšå®¢æ˜¯ï¼š&lt;a href=&#34;http://baotiao.github.io/&#34;&gt;baotiao&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;çŸ¥ä¹ä¸“æ ï¼š&lt;a href=&#34;https://www.zhihu.com/column/360infra&#34;&gt;MySQLå†…æ ¸æ­ç§˜ - çŸ¥ä¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;bohutangçš„å›å¤&#34;&gt;BohuTANGçš„å›å¤&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ä»¥æ·±å…¥ä¸€ç‚¹ï¼šå¦‚æœæ¯æ¬¡å†™çš„logéƒ½åœ¨ï¼Œæ€ä¹ˆåšåˆ°åŸºäºè¿™äº›logåšå›æ”¾çš„é—®é¢˜ï¼Ÿå…¶å®å°±æ˜¯redo-log +checkpoint+ LSMçš„æœºåˆ¶ã€‚redoè§£å†³æ•°æ®ä¸ä¸¢ï¼Œcheckpointè§£å†³recoveryçš„æ—¶å€™æ‰«æçš„redoå°½é‡å°‘ï¼ŒLSMè§£å†³æ¯æ¬¡å†™å…¥åæ–°çš„pageä¸ä¼šè¦†ç›–è€çš„æ•°æ®ï¼Œè¿™ç±»å®ç°æ˜¯æ¯”è¾ƒç®€å•å¯è¡Œï¼Œä¹Ÿæ˜¯ç›®å‰çš„ä¸»æµåšæ³•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆè§ï¼š&lt;a href=&#34;https://weibo.com/1691468715/KwT2GdDfu&#34;&gt;å¯ä»¥æ·±å…¥ä¸€ç‚¹ï¼šå¦‚æœæ¯&amp;hellip; - @BohuTANGçš„å¾®åš - å¾®åš&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥åŠï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç›®å‰å¤§éƒ¨åˆ†ç†è®ºéƒ½å‚è€ƒäºè¿™ç¯‡ ARIES: A Transaction Recovery Method Supporting Fine-Granularity Locking and Partial Rollbacks Using Write-Ahead Logging â€“ Mohan et al. 1992&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆè§ï¼š&lt;a href=&#34;https://weibo.com/1691468715/Kx3yAhFKj&#34;&gt;ç›®å‰å¤§éƒ¨åˆ†ç†è®ºéƒ½å‚è€ƒ&amp;hellip; - @BohuTANGçš„å¾®åš - å¾®åš&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ³¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BohuTANGå·²ç»åœ¨æ•°æ®åº“é¢†åŸŸæ²‰æµ¸å¤šå¹´ï¼Œå‰é˜¿é‡Œäº‘æ•°æ®åº“å†…æ ¸ç»„æ—©æœŸæˆå‘˜ã€å‰é’äº‘æ•°æ®åº“å›¢é˜Ÿè´Ÿè´£äººã€‚ç°åœ¨æ•°æ®åº“é¢†åŸŸåˆ›ä¸šï¼Œå…¬å¸çš„é¡¹ç›®æ˜¯ï¼š&lt;a href=&#34;https://github.com/datafuselabs/databend&#34;&gt;datafuselabs/databend&lt;/a&gt;ï¼Œæ¬¢è¿å›´è§‚ã€‚&lt;/li&gt;
&lt;li&gt;åšå®¢åœ°å€ï¼š&lt;a href=&#34;https://bohutang.me/&#34;&gt;[ è™å“¥çš„åšå®¢ ]&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>boltdb 1.3.0å®ç°åˆ†æï¼ˆå››ï¼‰</title>
      <link>https://www.codedump.info/post/20200726-boltdb-4/</link>
      <pubDate>Sun, 26 Jul 2020 17:55:11 +0800</pubDate>
      
      <guid>https://www.codedump.info/post/20200726-boltdb-4/</guid>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºboltdb 1.3.0å¯¹å…¶å®ç°è¿›è¡Œåˆ†æã€‚boltdbæ˜¯etcdç³»ç»Ÿå­˜å‚¨æ•°æ®ä½¿ç”¨çš„KVåµŒå…¥å¼DBï¼Œä½¿ç”¨Goç¼–ç å®ç°ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªB+æ ‘ç»“æ„ä½“ã€‚å…³äºetcdã€raftåè®®ä»¥åŠB+æ ‘ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20180921-raft/&#34;&gt;Raftç®—æ³•åŸç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20180922-etcd-raft/&#34;&gt;etcd Raftåº“è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20181125-etcd-server/&#34;&gt;Etcdå­˜å‚¨çš„å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200609-btree-1/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸Šï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.codedump.info/post/20200615-btree-2/&#34;&gt;Bæ ‘ã€B+æ ‘ç´¢å¼•ç®—æ³•åŸç†ï¼ˆä¸‹ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡çš„å†™ä½œï¼Œä¸»è¦å‚è€ƒäº†&lt;a href=&#34;https://www.jianshu.com/p/b86a69892990&#34;&gt;ã€ŠåŒºå—çš„æŒä¹…åŒ–ä¹‹BoltDBã€‹ç³»åˆ—æ–‡ç« &lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://youjiali1995.github.io/storage/boltdb&#34;&gt;boltdb æºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‰é¢çš„ç« èŠ‚ä¸­ï¼Œåˆ†åˆ«è®²è§£äº†boltdbçš„é¡µé¢ç»“æ„ã€Bucketç»“æ„ä»¥åŠäº‹åŠ¡ç›¸å…³çš„é€»è¾‘ï¼Œæœ€åä¸€èŠ‚è®²è§£boltdbå¦‚ä½•å®ç°MVCCã€‚&lt;/p&gt;
&lt;h1 id=&#34;mvccæ¦‚è¿°&#34;&gt;MVCCæ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;æ•°æ®åº“çš„&lt;code&gt;ACID&lt;/code&gt;ç‰¹æ€§ä¸­ï¼Œ&lt;code&gt;Isolation&lt;/code&gt;å³éš”ç¦»æ€§æ˜¯ä¸€ä¸ªè¾ƒéš¾å®ç°çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ•°æ®åº“è¢«ä¿®æ”¹æ—¶ï¼Œåœ¨è¿™æ¬¡äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œä¸å¸Œæœ›å…¶ä»–äº‹åŠ¡æ“ä½œè¯»åˆ°ä¿®æ”¹çš„ç»“æœã€‚ä¸€ç§å¸¸è§çš„åŠæ³•å°±æ˜¯åŠ é”ï¼Œä½†æ˜¯é”çš„ç²’åº¦å¦‚æœå¾ˆå¤§ï¼Œå°±ä¼šå½±å“æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ï¼Œå³åœ¨å†™æ“ä½œå®Œæˆä¹‹å‰ä¸èƒ½è¿›è¡Œå…¶ä»–æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MVCCï¼ˆMultiversion concurrency controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰&lt;/code&gt;æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹å¼ã€‚å®ƒçš„åšæ³•æ˜¯ï¼šä¿å­˜æ•°æ®åº“ä¸­çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä¿®æ”¹çš„æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œè€ŒåŒæ—¶è¿›è¡Œçš„è¯»æ“ä½œè¯»å–åˆ°çš„æ•°æ®æ˜¯æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿™æ ·å³ä¾¿è¯»åˆ°äº†æ—§çš„æ•°æ®ä¹Ÿä¸å½±å“ï¼Œåªè¦ä¸æ˜¯å†™æ“ä½œä¸­é—´çš„æ•°æ®å°±å¥½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/readCommitted.png&#34; alt=&#34;readCommitted&#34; title=&#34;readCommitted&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œäº‹åŠ¡Aä¿®æ”¹äº†xçš„å€¼ä¸º2ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œè¯»äº‹åŠ¡Bè¯»å–åˆ°çš„è¿˜æ˜¯ä¿®æ”¹ä¹‹å‰çš„å€¼1ï¼Œå› ä¸ºå­˜åœ¨æœ‰ä¸¤ä¸ªè¯¥æ•°æ®çš„ä¸åŒç‰ˆæœ¬ï¼Œå¹¶ä¸”å¹¶æ²¡æœ‰å› ä¸ºæœ‰å†™æ“ä½œåŒæ—¶å­˜åœ¨è€Œå¿…é¡»ç­‰å¾…å†™æ“ä½œå®Œæˆæ‰èƒ½è¿›è¡Œè¯»æ“ä½œã€‚åœ¨äº‹åŠ¡Aæäº¤ä¹‹åï¼Œæ‰èƒ½è¯»åˆ°æ–°çš„å€¼2ã€‚ï¼ˆä½†æ˜¯è¿™ä¸ªå›¾é‡Œè¿˜æœ‰å¦å¤–çš„é—®é¢˜ï¼Œå³åŒä¸€ä¸ªè¯»äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå‰åè¯»åˆ°äº†åŒä¸€ä¸ªæ•°æ®ä¸¤æ¬¡ä¸åŒçš„å€¼ï¼Œè¿™å«â€œä¸å¯é‡å¤è¯»â€ï¼Œè¿™å°±æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜äº†ä¸åœ¨è¿™é‡Œå±•å¼€è®¨è®ºã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚è®²è§£boltdbå¦‚ä½•å®ç°&lt;code&gt;MVCC&lt;/code&gt;æ“ä½œï¼Œåœ¨å¼€å§‹è®¨è®ºä¹‹å‰å…ˆçœ‹çœ‹boltdbå¦‚ä½•ç®¡ç†æ•°æ®åº“æ–‡ä»¶çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ˜ å°„æ–‡ä»¶çš„ä½¿ç”¨&#34;&gt;æ˜ å°„æ–‡ä»¶çš„ä½¿ç”¨&lt;/h1&gt;
&lt;p&gt;boltdbé€šè¿‡&lt;code&gt;mmap&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨å°†æ•°æ®åº“æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œ64ä½ä½“ç³»ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æœ‰128TBï¼Œè¶³å¤Ÿæ˜ å°„ä¸€ä¸ªæ–‡ä»¶äº†ã€‚åœ¨æŠŠç£ç›˜æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¹‹åï¼Œå¯¹ç£ç›˜æ–‡ä»¶çš„è¯»å†™å¯ä»¥ç›´æ¥ä½¿ç”¨è¯»å†™å†…å­˜çš„æ“ä½œï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å†³å®šä»€ä¹ˆæ—¶å€™å°†å“ªéƒ¨åˆ†çš„è™šæ‹Ÿå†…å­˜æ¢å…¥ã€æ¢å‡ºç‰©ç†å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸Šå»è¿™ä¸ªå¥½åƒæ–¹ä¾¿äº†å¾ˆå¤šï¼Œå…¶å®å¹¶ä¸å»ºè®®åœ¨å­˜å‚¨å¼•æ“ä¸­ä½¿ç”¨å†…å­˜æ˜ å°„è¿™æ ·â€œå·æ‡’â€çš„æŠ€æœ¯ã€‚åŸå› åœ¨äºï¼šæ“ä½œç³»ç»Ÿå†…æ ¸é™¤äº†çŸ¥é“ä»€ä¹ˆæ—¶å€™æ¢å…¥æ¢å‡ºç‰©ç†å†…å­˜ä¹‹å¤–ï¼Œå¯¹æ•°æ®åº“çš„å…¶ä»–æ“ä½œä¸€æ— æ‰€çŸ¥ï¼Œå¹¶ä¸èƒ½å¾ˆç²¾å‡†çš„æ§åˆ¶å…¶è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/db-mmap.png&#34; alt=&#34;db-mmap&#34; title=&#34;db-mmap&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯¹æ•°æ®åº“è¿›è¡Œå†…å­˜æ˜ å°„çš„æ“ä½œåœ¨å‡½æ•°&lt;code&gt;db.mmap&lt;/code&gt;å‡½æ•°ä¸­è¿›è¡Œï¼Œå¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Go&#34; data-lang=&#34;Go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;func&lt;/span&gt; (db &lt;span style=&#34;color:#666&#34;&gt;*&lt;/span&gt;DB) &lt;span style=&#34;color:#00a000&#34;&gt;mmap&lt;/span&gt;(minsz &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#0b0;font-weight:bold&#34;&gt;error&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	db.mmaplock.&lt;span style=&#34;color:#00a000&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;defer&lt;/span&gt; db.mmaplock.&lt;span style=&#34;color:#00a000&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// è®¡ç®—è‡³å°‘è¦å¤šå¤§çš„æ–‡ä»¶å¤§å°æ‰èƒ½æ»¡è¶³minszéœ€æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;// Memory-map the data file as a byte slice.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#080;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#666&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#00a000&#34;&gt;mmap&lt;/span&gt;(db, size); err &lt;span style=&#34;color:#666&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a2f;font-weight:bold&#34;&gt;return&lt;/span&gt; err
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè¢«è°ƒç”¨åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dbåˆå§‹åŒ–æ—¶ï¼Œå³åˆæ¬¡åŠ è½½dbæ–‡ä»¶åˆ°å†…å­˜æ˜ å°„ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“å‰æ–‡ä»¶ä¸å¤Ÿå¤§ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹æ—¶ï¼Œå³åœ¨&lt;code&gt;db.allocate&lt;/code&gt;ä¸­åˆ†é…æ–°é¡µé¢è€Œå½“å‰é¡µé¢ä¸è¶³éœ€è¦æ‰©å……æ–‡ä»¶å¤§å°æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åè€…ä¹Ÿè¢«ç§°ä¸º&lt;code&gt;remmap&lt;/code&gt;æ“ä½œï¼Œå³ä»¥æ–°çš„å¤§å°é‡æ–°æ˜ å°„æ–‡ä»¶è¿›è¡Œå†…å­˜ä¸­ã€‚ä¸ºäº†é¿å…æ¯æ¬¡å¢åŠ äº†æ–‡ä»¶å¤§å°éƒ½éœ€è¦é‡æ–°è¿›è¡Œæ–‡ä»¶å†…å­˜æ˜ å°„æ“ä½œï¼Œå®é™…ä¸Šboltdbæ˜¯å¯¹æ–‡ä»¶å¤§å°åšäº†&lt;code&gt;over allocate&lt;/code&gt;æ“ä½œï¼Œå…·ä½“çš„è®¡ç®—æ–°æ–‡ä»¶å¤§å°çš„é€»è¾‘åœ¨å‡½æ•°&lt;code&gt;DB.mmapSize&lt;/code&gt;å‡½æ•°ä¸­å®ç°çš„ï¼Œè¿™é‡Œä¸åšå±•å¼€äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;boltdbçš„æ›´æ–°æµç¨‹&#34;&gt;boltdbçš„æ›´æ–°æµç¨‹&lt;/h1&gt;
&lt;p&gt;äº†è§£äº†boltdbä½¿ç”¨å†…å­˜æ˜ å°„çš„æœºåˆ¶ï¼Œä¸‹é¢æ ¹æ®ä¸Šä¸€èŠ‚çš„å†…å®¹ï¼Œè¿›ä¸€æ­¥äº†è§£boltdbçš„æ›´æ–°æµç¨‹ã€‚å½“dbæœ‰æ›´æ–°æ—¶ï¼Œæ— éå°±æ˜¯ä»¥ä¸‹ä¸¤ç§æƒ…å†µçš„ç»„åˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯å¦éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;æ˜¯å¦éœ€è¦è¿›è¡Œremmapã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹åˆ†è¿™å‡ ç§æƒ…å†µè¿›è¡Œè®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆå§‹åŒ–&#34;&gt;åˆå§‹åŒ–&lt;/h2&gt;
&lt;p&gt;æ•°æ®åº“æ–‡ä»¶çš„é¡µé¢åˆå§‹æƒ…å†µå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/dbfile-1.png&#34; alt=&#34;dbfile-1&#34; title=&#34;dbfile-1&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;[0,1]&lt;/code&gt;é¡µé¢ä¸º&lt;code&gt;meta&lt;/code&gt;é¡µé¢ï¼Œè¿™ä¸¤ä¸ªäºº&lt;code&gt;meta&lt;/code&gt;é¡µé¢ä¸€å®šæ˜¯æœ€å¼€å§‹çš„ä¸¤ä¸ªé¡µé¢ä¸ä¼šå‘ç”Ÿå˜æ›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;2&lt;/code&gt;é¡µé¢ä¸º&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ï¼Œç”±äºé¡µé¢çš„åˆ†é…æƒ…å†µç»å¸¸å‘ç”Ÿä¿®æ”¹ï¼Œæ‰€ä»¥&lt;code&gt;freelist&lt;/code&gt;é¡µé¢IDä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œ&lt;code&gt;freelist&lt;/code&gt;é¡µé¢IDåšä¸ºæ•°æ®åº“&lt;code&gt;meta&lt;/code&gt;å†…å®¹çš„ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨&lt;code&gt;meta&lt;/code&gt;é¡µé¢ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[3,10]&lt;/code&gt;é¡µé¢å½“å‰å·²ç»å†™å…¥å†…å®¹ï¼Œè€Œ&lt;code&gt;meta.pgid&lt;/code&gt;ä¿å­˜çš„æ˜¯å½“å‰æœ€å¤§çš„é¡µé¢idï¼Œç›®å‰ä¸º10ï¼Œè¿™ä¸ªIDæ˜¯ç”¨äºåˆ¤æ–­å½“å‰æ˜¯å¦éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°çš„ä¾æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[11,12]&lt;/code&gt;ä¸ºç›®å‰è¿˜æœªåˆ†é…å‡ºå»çš„ç©ºé—²é¡µé¢ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªé¡µé¢åœ¨&lt;code&gt;freelist&lt;/code&gt;çš„ç©ºé—²é¡µé¢idä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[13,14]&lt;/code&gt;ä¸ºå½“å‰&lt;code&gt;over allocate&lt;/code&gt;å¤šå‡ºçš„é¡µé¢ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªé¡µé¢è¿˜ä¸åœ¨&lt;code&gt;freelist&lt;/code&gt;çš„ç©ºé—²é¡µé¢idä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ä¸éœ€è¦remmap&#34;&gt;éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ï¼Œä¸éœ€è¦remmap&lt;/h2&gt;
&lt;p&gt;å‡è®¾å†™äº‹åŠ¡ç¬¬ä¸€æ¬¡ä¿®æ”¹é¡µé¢&lt;code&gt;[3,10]&lt;/code&gt;ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œå³&lt;code&gt;rebalance&lt;/code&gt;å’Œ&lt;code&gt;spill&lt;/code&gt;æ“ä½œä¹‹åï¼Œéƒ½æ²¡æœ‰æ–°å¢é¡µé¢ã€‚ä½†æ˜¯å·²ç»è„çš„é¡µé¢ï¼Œå¦‚è¿™é‡Œçš„é¡µé¢&lt;code&gt;[3,10]&lt;/code&gt;ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ–°çš„é¡µé¢è¿›è¡Œå­˜å‚¨ï¼Œæ—§çš„è„é¡µé¢ä¼šåœ¨è¿™ä¸€æ¬¡äº‹åŠ¡ä¹‹åå˜æˆç©ºé—²é¡µé¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºé¡µé¢çš„åˆ†é…æƒ…å†µå‘ç”Ÿäº†å˜åŒ–ï¼Œå› æ­¤&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ä¹Ÿéœ€è¦å‘ç”Ÿå˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“èµ·æ¥å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™äº‹åŠ¡å¯¼è‡´çš„è„é¡µé¢éœ€è¦åˆ†é…æ–°çš„é¡µé¢å­˜å‚¨è„æ•°æ®ï¼Œå‡è®¾æ—§çš„è„é¡µé¢3å’Œ10å¯¹åº”çš„æ˜¯é¡µé¢&lt;code&gt;[11,12]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é¡µé¢åˆ†é…æƒ…å†µå‘ç”Ÿäº†å˜åŒ–ï¼Œ&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ä¹Ÿå˜æˆäº†è„é¡µé¢ï¼Œæ–°çš„&lt;code&gt;freelist&lt;/code&gt;é¡µé¢æ˜¯é¡µé¢&lt;code&gt;13&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸€æ¬¡äº‹åŠ¡å¯¹åº”çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢å°±æ˜¯é¡µé¢&lt;code&gt;[2,3,10]&lt;/code&gt;ï¼ˆ&lt;code&gt;2&lt;/code&gt;ä¸º&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ï¼‰ï¼Œå› ä¸ºå·²ç»æœ‰æ–°çš„é¡µé¢ä¿å­˜å®ƒä»¬çš„å†…å®¹ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œä¸‹ä¸€æ¬¡äº‹åŠ¡æ“ä½œæ—¶ï¼Œè¿™ä¸‰ä¸ªé¡µé¢å°±æ˜¯ç©ºé—²é¡µé¢äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œäº‹åŠ¡ç»“æŸä¹‹åçš„é¡µé¢åˆ†é…æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/dbfile-2.png&#34; alt=&#34;dbfile-2&#34; title=&#34;dbfile-2&#34;&gt;&lt;/p&gt;
&lt;p&gt;å³è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶å¢åŠ äº†æ–‡ä»¶çš„å¤§å°ï¼ˆæ–°å¢äº†é¡µé¢&lt;code&gt;13&lt;/code&gt;ï¼‰ï¼Œä½†æ˜¯ç”±äºåœ¨åŸå…ˆçš„&lt;code&gt;over allocate&lt;/code&gt;èŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡æ–°remmapæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šä¸ºä»€ä¹ˆåœ¨é¡µé¢å˜è„ä¹‹åï¼Œéœ€è¦é‡æ–°ä½¿ç”¨ä¸€ä¸ªé¡µé¢å­˜å‚¨è„é¡µé¢å†…å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨åŸå…ˆçš„é¡µé¢ä¸Šä¿®æ”¹ï¼Ÿç­”æ¡ˆæ˜¯ä¸ºäº†åšåˆ°&lt;code&gt;MVCC&lt;/code&gt;ï¼Œä¸‹é¢å°†å±•å¼€åˆ†æã€‚&lt;/p&gt;
&lt;h2 id=&#34;éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°éœ€è¦remmap&#34;&gt;éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ï¼Œéœ€è¦remmap&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå¼€å§‹äº†ä¸€ä¸ªæ–°çš„å†™äº‹åŠ¡æ“ä½œï¼Œæ­¤æ—¶ä¸Šä¸€ä¸ªäº‹åŠ¡çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢&lt;code&gt;[2,3,10]&lt;/code&gt;åœ¨è¿™ä¸ªæ–°çš„å†™äº‹åŠ¡ä¸­å˜æˆäº†å¯ç”¨çš„ç©ºé—²é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾è¿™ä¸ªå†™äº‹åŠ¡ä¿®æ”¹äº†é¡µé¢&lt;code&gt;[11,12]&lt;/code&gt;ï¼Œå¹¶ä¸”æäº¤ä¿®æ”¹çš„æ—¶å€™å‘ç°è¶…è¿‡äº†é¡µé¢å¡«å……ç‡çš„é˜ˆå€¼ï¼Œéœ€è¦è¿›è¡Œåˆ†è£‚ã€‚äºæ˜¯ä¸¤ä¸ªé¡µé¢è¿›è¡Œåˆ†è£‚ï¼Œå°±éœ€è¦4ä¸ªæ–°çš„é¡µé¢æ¥å­˜å‚¨åˆ†è£‚åçš„æ•°æ®ã€‚äºæ˜¯ï¼Œæ—§çš„é¡µé¢&lt;code&gt;[11,12,13]&lt;/code&gt;ï¼ˆé¡µé¢&lt;code&gt;13&lt;/code&gt;æ˜¯&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ï¼‰æˆä¸ºè¿™æ¬¡äº‹åŠ¡çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢ã€‚ç”±äºå½“å‰å¯ç”¨çš„ç©ºé—²é¡µé¢ä¸å¤Ÿç”¨ï¼Œäºæ˜¯åªèƒ½å¢åŠ æ–‡ä»¶å¤§å°ï¼ŒåŒæ—¶è¿›è¡Œäº†remmapæ“ä½œï¼Œ&lt;code&gt;meta.pgid&lt;/code&gt;ç§»åŠ¨åˆ°äº†&lt;code&gt;16&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡äº‹åŠ¡æ“ä½œä¹‹åçš„é¡µé¢åˆ†é…æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/dbfile-3.png&#34; alt=&#34;dbfile-3&#34; title=&#34;dbfile-3&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°éœ€è¦remmap&#34;&gt;ä¸éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ï¼Œéœ€è¦remmap&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå¼€å§‹äº†ä¸€ä¸ªæ–°çš„å†™äº‹åŠ¡æ“ä½œï¼Œæ­¤æ—¶ä¸Šä¸€ä¸ªäº‹åŠ¡çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢&lt;code&gt;[11,12,13]&lt;/code&gt;åœ¨è¿™ä¸ªæ–°çš„å†™äº‹åŠ¡ä¸­å˜æˆäº†å¯ç”¨çš„ç©ºé—²é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾è¿™ä¸€æ¬¡å†™äº‹åŠ¡ä¿®æ”¹äº†é¡µé¢&lt;code&gt;[2,3,10]&lt;/code&gt;ï¼Œå°†å®ƒä»¬å˜æˆäº†&lt;code&gt;pending&lt;/code&gt;é¡µé¢ï¼Œä¸”é¡µé¢&lt;code&gt;[11,12,13]&lt;/code&gt;è¢«ä¾æ¬¡åˆ†é…ç»™è¿™ä¸‰ä¸ªé¡µé¢å­˜å‚¨æ–°çš„é¡µé¢æ•°æ®ã€‚è¿™æ—¶&lt;code&gt;freelist&lt;/code&gt;é¡µé¢å°±æ²¡æœ‰ç©ºé—²é¡µé¢æ¥å­˜å‚¨äº†ï¼Œä¸ºäº†åˆ†é…æ–°é¡µé¢ï¼Œéœ€è¦remmapå°†æ˜ å°„èŒƒå›´ç§»åŠ¨åˆ°ä¸‹ä¸€é¡µåŠé¡µé¢17ï¼Œè€Œé¡µé¢è¿˜åœ¨æ–‡ä»¶èŒƒå›´ä¹‹å†…ï¼Œå› æ­¤ä¸éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡äº‹åŠ¡æ“ä½œä¹‹åçš„é¡µé¢åˆ†é…æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/dbfile-4.png&#34; alt=&#34;dbfile-4&#34; title=&#34;dbfile-4&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ä¸éœ€è¦remmap&#34;&gt;ä¸éœ€è¦å¢åŠ æ–‡ä»¶å¤§å°ï¼Œä¸éœ€è¦remmap&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå¼€å§‹äº†ä¸€ä¸ªæ–°çš„å†™äº‹åŠ¡æ“ä½œï¼Œæ­¤æ—¶ä¸Šä¸€ä¸ªäº‹åŠ¡çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢&lt;code&gt;[2,3,10,15]&lt;/code&gt;åœ¨è¿™ä¸ªæ–°çš„å†™äº‹åŠ¡ä¸­å˜æˆäº†å¯ç”¨çš„ç©ºé—²é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿™ä¸€æ¬¡å†™äº‹åŠ¡åªä¿®æ”¹äº†é¡µé¢&lt;code&gt;12&lt;/code&gt;ï¼Œå¹¶ä¸”æäº¤äº‹åŠ¡æ—¶ä¸éœ€è¦åˆ†è£‚ï¼Œé‚£ä¹ˆåªéœ€è¦ä¸€ä¸ªç©ºé—²é¡µé¢å°±èƒ½å­˜å‚¨è¿™ä¸ªä¿®æ”¹çš„è„é¡µé¢ï¼Œäºæ˜¯é¡µé¢2åšä¸ºè¿™ä¸ªæ–°çš„é¡µé¢è¢«åˆ†é…äº†å‡ºå»ï¼Œè€Œé¡µé¢12å˜æˆäº†è¿™æ¬¡äº‹åŠ¡æ“ä½œä¹‹åçš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢ã€‚åŒæ—¶&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ç”±é¡µé¢16å˜æˆäº†é¡µé¢3ï¼Œå› ä¸ºæœ‰è¶³å¤Ÿçš„ç©ºé—²é¡µé¢å­˜å‚¨è¿™ä¸€æ¬¡çš„ä¿®æ”¹ï¼Œäºæ˜¯æ—¢ä¸ä¼šå¢åŠ æ–‡ä»¶å¤§å°ä¹Ÿä¸éœ€è¦remmapæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡äº‹åŠ¡æ“ä½œä¹‹åçš„é¡µé¢åˆ†é…æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/dbfile-5.png&#34; alt=&#34;dbfile-5&#34; title=&#34;dbfile-5&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;boltdbå¦‚ä½•å®ç°mvcc&#34;&gt;boltdbå¦‚ä½•å®ç°MVCC&lt;/h1&gt;
&lt;p&gt;ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼šå½“ä¸€ä¸ªé¡µé¢è¢«ä¿®æ”¹æ—¶ï¼Œä¿®æ”¹ç»“æœå¹¶ä¸é©¬ä¸Šè¦†ç›–æ—§çš„é¡µé¢ï¼Œè€Œæ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†é…ä¸€ä¸ªç©ºé—²é¡µé¢ï¼Œå°†æ–°çš„é¡µé¢å†…å®¹å­˜å‚¨åˆ°è¿™ä¸ªç©ºé—²é¡µé¢ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;å°†æ—§çš„é¡µé¢è®¾ç½®ä¸ºè¿™ä¸€æ¬¡äº‹åŠ¡æ“ä½œçš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œ&lt;code&gt;pending&lt;/code&gt;é¡µé¢å˜æˆç©ºé—²é¡µé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ–°çš„é¡µé¢æ•°æ®è¦†ç›–é¡µé¢ï¼Œè€Œæ˜¯ä¸€ç›´ä¿å­˜åˆ°äº‹åŠ¡æäº¤æ—¶ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯ä¸ºäº†å®ç°&lt;code&gt;MVCC&lt;/code&gt;æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å®ç°&lt;code&gt;MVCC&lt;/code&gt;æ“ä½œçš„æ ¸å¿ƒï¼šä¿å­˜å½“å‰æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™æ ·å†™äº‹åŠ¡æ“ä½œçš„åŒæ—¶ï¼Œå…è®¸æœ‰å¤šä¸ªè¯»äº‹åŠ¡æ“ä½œè¿›è¡Œï¼Œåªæ˜¯è¯»äº‹åŠ¡ä¸ä¼šé©¬ä¸Šè¯»åˆ°å†™äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼Œç›´åˆ°è¿™ä¸ªå†™äº‹åŠ¡æäº¤ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;boltdbæœ‰ä¸¤ä¸ª&lt;code&gt;meta&lt;/code&gt;é¡µé¢ï¼Œä¹Ÿæ˜¯ä¸ºäº†å®ç°&lt;code&gt;MVCC&lt;/code&gt;åŠŸèƒ½ï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://www.codedump.info/media/imgs/20200726-boltdb-4/writeTx.png&#34; alt=&#34;writeTx&#34; title=&#34;writeTx&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…¶æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å†™äº‹åŠ¡å¼€å§‹ä¹‹å‰ï¼Œ&lt;code&gt;meta&lt;/code&gt;é¡µé¢å­˜å‚¨çš„äº‹åŠ¡IDæ˜¯&lt;code&gt;10&lt;/code&gt;å’Œ&lt;code&gt;11&lt;/code&gt;ï¼Œäºæ˜¯æ–°çš„å†™äº‹åŠ¡IDæ˜¯12ã€‚å†™äº‹åŠ¡12å¼€å§‹ä¹‹å‰ï¼Œæ‹·è´çš„æ˜¯é¡µé¢1å³äº‹åŠ¡11çš„&lt;code&gt;meta&lt;/code&gt;å†…å®¹ï¼Œè€Œåœ¨æäº¤æ—¶å°†è¦†ç›–é¡µé¢0å³äº‹åŠ¡&lt;code&gt;10&lt;/code&gt;çš„&lt;code&gt;meta&lt;/code&gt;å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;å†™äº‹åŠ¡12ä¿®æ”¹ä¹‹åï¼Œå¯¹åº”çš„&lt;code&gt;pending&lt;/code&gt;é¡µé¢æ˜¯&lt;code&gt;[10,12,15,16]&lt;/code&gt;ï¼Œå³è¿™äº›é¡µé¢çš„æ•°æ®å‘ç”Ÿäº†ä¿®æ”¹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¦†ç›–è¿™äº›é¡µé¢çš„å†…å®¹ï¼Œè€Œæ˜¯å¦å¤–æœ‰æ–°çš„ç©ºé—²é¡µé¢è¢«åˆ†é…å‡ºå»å­˜å‚¨è¿™å‡ ä¸ªé¡µé¢çš„ä¿®æ”¹å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰è¿™ä¸ªå†™äº‹åŠ¡æäº¤ä¹‹å‰çš„ä»»ä½•è¯»æ“ä½œï¼ŒåŒæ ·ä¹Ÿæ˜¯è¯»åˆ°çš„é¡µé¢1çš„äº‹åŠ¡11çš„&lt;code&gt;meta&lt;/code&gt;å†…å®¹ï¼Œå¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šè®¿é—®åˆ°æœ‰å†…å®¹å˜æ›´çš„é¡µé¢&lt;code&gt;[10,12,15,16]&lt;/code&gt;ï¼Œä½†æ˜¯è¿™å‡ ä¸ªé¡µé¢å†…å®¹å¹¶æ²¡æœ‰è¢«è¦†ç›–ï¼Œæ‰€ä»¥è¿˜æ˜¯å’Œäº‹åŠ¡11æ—¶å€™çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åäº‹åŠ¡12æäº¤å…¶ä¿®æ”¹ï¼Œæ­¤æ—¶å†™äº‹åŠ¡åªéœ€è¦ä¿®æ”¹&lt;code&gt;freelist&lt;/code&gt;å’Œé¡µé¢0çš„&lt;code&gt;meta&lt;/code&gt;é¡µé¢ï¼Œå°†äº‹åŠ¡12å†™å…¥é¡µé¢0å³å¯é‡Šæ”¾å†™é”ã€‚ä¸‹ä¸€æ¬¡å†æ¥æ–°çš„äº‹åŠ¡ï¼Œé€‰æ‹©çš„æ˜¯ä¸¤ä¸ª&lt;code&gt;meta&lt;/code&gt;é¡µé¢ä¸­äº‹åŠ¡IDæ›´å¤§çš„é‚£ä¸ª&lt;code&gt;meta&lt;/code&gt;æ•°æ®ï¼Œäºæ˜¯è¯»å–çš„é¡µé¢0çš„&lt;code&gt;meta&lt;/code&gt;é¡µé¢å†…å®¹å¾—åˆ°æ•°æ®åº“çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä¸Šé¢æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒåŒ&lt;code&gt;meta&lt;/code&gt;é¡µé¢ç›®çš„æ˜¯ä¸ºäº†å®ç°è¯»å†™æ“ä½œæ—¶å€™çš„&lt;code&gt;MVCC&lt;/code&gt;ï¼Œè®©å†™æ“ä½œä¸å½±å“è¯»æ“ä½œçš„è¿›è¡Œã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;è‡³æ­¤ï¼Œå¤§ä½“åˆ†æå®Œæ¯•boltdbçš„å®ç°ï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å†…å­˜æ˜ å°„å°†ç£ç›˜æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå¥½å¤„æ˜¯è¯»å†™èµ·æ¥æ–¹ä¾¿ï¼Œç”±OSå†…æ ¸æ¥æ§åˆ¶è™šæ‹Ÿå†…å­˜çš„æ˜ å°„åˆ†é…ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¾ˆå·æ‡’ã€‚LMDBç­‰ä¹Ÿæ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼ç®¡ç†æ•°æ®åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;ç”±å‡ ä¸ªå­˜å‚¨å…ƒä¿¡æ¯çš„é¡µé¢ä¿å­˜æ•°æ®åº“çš„å…ƒä¿¡æ¯ï¼š&lt;code&gt;meta&lt;/code&gt;é¡µé¢ä¿å­˜æ•°æ®åº“çš„å…ƒä¿¡æ¯ï¼Œ&lt;code&gt;freelist&lt;/code&gt;é¡µé¢ä¿å­˜é¡µé¢çš„åˆ†é…ä¿¡æ¯ä¿¡æ¯ï¼Œè€Œ&lt;code&gt;meta&lt;/code&gt;é¡µé¢è‚¯å®šæ˜¯æ•°æ®åº“æ–‡ä»¶æœ€å¼€å§‹çš„ä¸¤ä¸ªé¡µé¢ï¼Œä¹‹æ‰€ä»¥æœ‰ä¸¤ä¸ª&lt;code&gt;meta&lt;/code&gt;é¡µé¢æ˜¯ä¸ºäº†å®ç°&lt;code&gt;MVCC&lt;/code&gt;æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;boltdbåŒæ—¶å…è®¸ä¸€ä¸ªå†™æ“ä½œäº‹åŠ¡å’Œå¤šä¸ªè¯»æ“ä½œäº‹åŠ¡ï¼Œå®ç°&lt;code&gt;MVCC&lt;/code&gt;æ“ä½œçš„æ ¸å¿ƒæ˜¯ä½¿ç”¨äº†&lt;code&gt;append B+æ ‘&lt;/code&gt;çš„æ–¹å¼ï¼šå³å†™äº‹åŠ¡ä¸ç›´æ¥è¦†ç›–éœ€è¦ä¿®æ”¹çš„é¡µé¢å†…å®¹ï¼Œè€Œæ˜¯å†™åˆ°æ–°åˆ†é…çš„ç©ºé—²é¡µé¢ä¸­ï¼Œè¿™æ ·è¯»æ“ä½œå³ä¾¿è¯»åˆ°äº†æœ‰å†…å®¹ä¿®æ”¹çš„é¡µé¢ä¹Ÿè¿˜æ˜¯ä¸Šä¸€ä¸ªäº‹åŠ¡çš„å†…å®¹ï¼Œç›´åˆ°å†™äº‹åŠ¡æäº¤æ—¶æ‰ä¸€æ¬¡æ€§åŠ é”ä¿®æ”¹æ•°æ®åº“çš„å…ƒä¿¡æ¯ä½¿ä¿®æ”¹ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•´ä½“æ¥çœ‹ï¼Œä»£ç é‡å¾ˆç²¾ç®€ï¼Œæ ¸å¿ƒåªæœ‰å‡ åƒè¡Œçš„Goä»£ç ï¼Œä¹Ÿæ˜¯ç”Ÿäº§çº§åˆ«çš„å­˜å‚¨å¼•æ“ï¼Œåœ¨è¿™é‡Œå­¦ä¹ åˆ°äº†B+æ ‘çš„å®ç°ä»¥åŠ&lt;code&gt;MVCC&lt;/code&gt;å®ç°çš„æ–¹å¼ï¼Œå­¦ä¹ çš„æ€§ä»·æ¯”è¿˜æ˜¯å¾ˆé«˜çš„ã€‚&lt;/p&gt;
</description>
      
    </item>
    
  </channel>
</rss>
